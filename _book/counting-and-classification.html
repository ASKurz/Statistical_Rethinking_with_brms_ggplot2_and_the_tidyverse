<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>10 Counting and Classification | Statistical Rethinking with brms, ggplot2, and the tidyverse</title>
  <meta name="description" content="This project is an attempt to re-express the code in McElreath’s textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="10 Counting and Classification | Statistical Rethinking with brms, ggplot2, and the tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This project is an attempt to re-express the code in McElreath’s textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="github-repo" content="ASKURZ/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 Counting and Classification | Statistical Rethinking with brms, ggplot2, and the tidyverse" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This project is an attempt to re-express the code in McElreath’s textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  

<meta name="author" content="A Solomon Kurz">


<meta name="date" content="2019-05-05">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="big-entropy-and-the-generalized-linear-model.html">
<link rel="next" href="monsters-and-mixtures.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>This is a love letter</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-this"><i class="fa fa-check"></i>Why this?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#my-assumptions-about-you"><i class="fa fa-check"></i>My assumptions about you</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-use-and-understand-this-project"><i class="fa fa-check"></i>How to use and understand this project</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#you-can-do-this-too"><i class="fa fa-check"></i>You can do this, too</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#we-have-updates"><i class="fa fa-check"></i>We have updates</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague</a><ul>
<li class="chapter" data-level="" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html#reference"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a><ul>
<li class="chapter" data-level="2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#the-garden-of-forking-data"><i class="fa fa-check"></i><b>2.1</b> The garden of forking data</a><ul>
<li class="chapter" data-level="2.1.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#counting-possibilities."><i class="fa fa-check"></i><b>2.1.1</b> Counting possibilities.</a></li>
<li class="chapter" data-level="2.1.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#using-prior-information."><i class="fa fa-check"></i><b>2.1.2</b> Using prior information.</a></li>
<li class="chapter" data-level="2.1.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#from-counts-to-probability."><i class="fa fa-check"></i><b>2.1.3</b> From counts to probability.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#building-a-model"><i class="fa fa-check"></i><b>2.2</b> Building a model</a><ul>
<li class="chapter" data-level="2.2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-data-story."><i class="fa fa-check"></i><b>2.2.1</b> A data story.</a></li>
<li class="chapter" data-level="2.2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayesian-updating."><i class="fa fa-check"></i><b>2.2.2</b> Bayesian updating.</a></li>
<li class="chapter" data-level="2.2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#evaluate."><i class="fa fa-check"></i><b>2.2.3</b> Evaluate.</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#components-of-the-model"><i class="fa fa-check"></i><b>2.3</b> Components of the model</a><ul>
<li class="chapter" data-level="2.3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#likelihood."><i class="fa fa-check"></i><b>2.3.1</b> Likelihood.</a></li>
<li class="chapter" data-level="2.3.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#parameters."><i class="fa fa-check"></i><b>2.3.2</b> Parameters.</a></li>
<li class="chapter" data-level="2.3.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#prior."><i class="fa fa-check"></i><b>2.3.3</b> Prior.</a></li>
<li class="chapter" data-level="2.3.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#posterior."><i class="fa fa-check"></i><b>2.3.4</b> Posterior.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#making-the-model-go"><i class="fa fa-check"></i><b>2.4</b> Making the model go</a><ul>
<li class="chapter" data-level="2.4.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#grid-approximation."><i class="fa fa-check"></i><b>2.4.1</b> Grid approximation.</a></li>
<li class="chapter" data-level="2.4.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic-approximation."><i class="fa fa-check"></i><b>2.4.2</b> Quadratic approximation.</a></li>
<li class="chapter" data-level="2.4.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#markov-chain-monte-carlo."><i class="fa fa-check"></i><b>2.4.3</b> Markov chain Monte Carlo.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#reference-1"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a><ul>
<li class="chapter" data-level="3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-like-approximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-like approximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a><ul>
<li class="chapter" data-level="3.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-boundaries."><i class="fa fa-check"></i><b>3.2.1</b> Intervals of defined boundaries.</a></li>
<li class="chapter" data-level="3.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass."><i class="fa fa-check"></i><b>3.2.2</b> Intervals of defined mass.</a></li>
<li class="chapter" data-level="3.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimates."><i class="fa fa-check"></i><b>3.2.3</b> Point estimates.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a><ul>
<li class="chapter" data-level="3.3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#dummy-data."><i class="fa fa-check"></i><b>3.3.1</b> Dummy data.</a></li>
<li class="chapter" data-level="3.3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking."><i class="fa fa-check"></i><b>3.3.2</b> Model checking.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#summary-lets-practice-in-brms"><i class="fa fa-check"></i><b>3.4</b> <del>Summary</del> Let’s practice in brms</a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#reference-2"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="linear-models.html"><a href="linear-models.html"><i class="fa fa-check"></i><b>4</b> Linear Models</a><ul>
<li class="chapter" data-level="4.1" data-path="linear-models.html"><a href="linear-models.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why normal distributions are normal</a><ul>
<li class="chapter" data-level="4.1.1" data-path="linear-models.html"><a href="linear-models.html#normal-by-addition."><i class="fa fa-check"></i><b>4.1.1</b> Normal by addition.</a></li>
<li class="chapter" data-level="4.1.2" data-path="linear-models.html"><a href="linear-models.html#normal-by-multiplication."><i class="fa fa-check"></i><b>4.1.2</b> Normal by multiplication.</a></li>
<li class="chapter" data-level="4.1.3" data-path="linear-models.html"><a href="linear-models.html#normal-by-log-multiplication."><i class="fa fa-check"></i><b>4.1.3</b> Normal by log-multiplication.</a></li>
<li class="chapter" data-level="4.1.4" data-path="linear-models.html"><a href="linear-models.html#using-gaussian-distributions."><i class="fa fa-check"></i><b>4.1.4</b> Using Gaussian distributions.</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="linear-models.html"><a href="linear-models.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>4.2</b> A language for describing models</a><ul>
<li class="chapter" data-level="4.2.1" data-path="linear-models.html"><a href="linear-models.html#re-describing-the-globe-tossing-model."><i class="fa fa-check"></i><b>4.2.1</b> Re-describing the globe tossing model.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="linear-models.html"><a href="linear-models.html#a-gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> A Gaussian model of height</a><ul>
<li class="chapter" data-level="4.3.1" data-path="linear-models.html"><a href="linear-models.html#the-data."><i class="fa fa-check"></i><b>4.3.1</b> The data.</a></li>
<li class="chapter" data-level="4.3.2" data-path="linear-models.html"><a href="linear-models.html#the-model."><i class="fa fa-check"></i><b>4.3.2</b> The model.</a></li>
<li class="chapter" data-level="4.3.3" data-path="linear-models.html"><a href="linear-models.html#grid-approximation-of-the-posterior-distribution."><i class="fa fa-check"></i><b>4.3.3</b> Grid approximation of the posterior distribution.</a></li>
<li class="chapter" data-level="4.3.4" data-path="linear-models.html"><a href="linear-models.html#sampling-from-the-posterior."><i class="fa fa-check"></i><b>4.3.4</b> Sampling from the posterior.</a></li>
<li class="chapter" data-level="4.3.5" data-path="linear-models.html"><a href="linear-models.html#fitting-the-model-with-map-brm."><i class="fa fa-check"></i><b>4.3.5</b> Fitting the model with <del><code>map()</code></del> <code>brm()</code>.</a></li>
<li class="chapter" data-level="4.3.6" data-path="linear-models.html"><a href="linear-models.html#sampling-from-a-map-brm-fit."><i class="fa fa-check"></i><b>4.3.6</b> Sampling from a <del><code>map()</code></del> <code>brm()</code> fit.</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="linear-models.html"><a href="linear-models.html#adding-a-predictor"><i class="fa fa-check"></i><b>4.4</b> Adding a predictor</a><ul>
<li class="chapter" data-level="4.4.1" data-path="linear-models.html"><a href="linear-models.html#the-linear-model-strategy"><i class="fa fa-check"></i><b>4.4.1</b> The linear model strategy</a></li>
<li class="chapter" data-level="4.4.2" data-path="linear-models.html"><a href="linear-models.html#fitting-the-model."><i class="fa fa-check"></i><b>4.4.2</b> Fitting the model.</a></li>
<li class="chapter" data-level="4.4.3" data-path="linear-models.html"><a href="linear-models.html#interpreting-the-model-fit."><i class="fa fa-check"></i><b>4.4.3</b> Interpreting the model fit.</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="linear-models.html"><a href="linear-models.html#polynomial-regression"><i class="fa fa-check"></i><b>4.5</b> Polynomial regression</a></li>
<li class="chapter" data-level="" data-path="linear-models.html"><a href="linear-models.html#reference-3"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="linear-models.html"><a href="linear-models.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html"><i class="fa fa-check"></i><b>5</b> Multivariate Linear Models</a><ul>
<li class="chapter" data-level="5.1" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#spurious-associations"><i class="fa fa-check"></i><b>5.1</b> Spurious associations</a><ul>
<li class="chapter" data-level="5.1.1" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#multivariate-notation."><i class="fa fa-check"></i><b>5.1.1</b> Multivariate notation.</a></li>
<li class="chapter" data-level="5.1.2" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#fitting-the-model.-1"><i class="fa fa-check"></i><b>5.1.2</b> Fitting the model.</a></li>
<li class="chapter" data-level="5.1.3" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#plotting-multivariate-posteriors."><i class="fa fa-check"></i><b>5.1.3</b> Plotting multivariate posteriors.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#masked-relationship"><i class="fa fa-check"></i><b>5.2</b> Masked relationship</a></li>
<li class="chapter" data-level="5.3" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#multicollinearity"><i class="fa fa-check"></i><b>5.3</b> Multicollinearity</a><ul>
<li class="chapter" data-level="5.3.1" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#multicollinear-legs."><i class="fa fa-check"></i><b>5.3.1</b> Multicollinear legs.</a></li>
<li class="chapter" data-level="5.3.2" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#multicollinear-milk."><i class="fa fa-check"></i><b>5.3.2</b> Multicollinear <code>milk</code>.</a></li>
<li class="chapter" data-level="5.3.3" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#post-treatment-bias."><i class="fa fa-check"></i><b>5.3.3</b> Post-treatment bias.</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#categorical-variables"><i class="fa fa-check"></i><b>5.4</b> Categorical varaibles</a><ul>
<li class="chapter" data-level="5.4.1" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#binary-categories."><i class="fa fa-check"></i><b>5.4.1</b> Binary categories.</a></li>
<li class="chapter" data-level="5.4.2" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#many-categories."><i class="fa fa-check"></i><b>5.4.2</b> Many categories.</a></li>
<li class="chapter" data-level="5.4.3" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#adding-regular-predictor-variables."><i class="fa fa-check"></i><b>5.4.3</b> Adding regular predictor variables.</a></li>
<li class="chapter" data-level="5.4.4" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#another-approach-unique-intercepts."><i class="fa fa-check"></i><b>5.4.4</b> Another approach: Unique intercepts.</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#ordinary-least-squares-and-lm"><i class="fa fa-check"></i><b>5.5</b> <del>Ordinary least squares and <code>lm()</code></del></a></li>
<li class="chapter" data-level="" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#reference-4"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html"><i class="fa fa-check"></i><b>6</b> Overfitting, Regularization, and Information Criteria</a><ul>
<li class="chapter" data-level="6.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>6.1</b> The problem with parameters</a><ul>
<li class="chapter" data-level="6.1.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#more-parameters-always-improve-fit."><i class="fa fa-check"></i><b>6.1.1</b> More parameters always improve fit.</a></li>
<li class="chapter" data-level="6.1.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#too-few-parameters-hurts-too."><i class="fa fa-check"></i><b>6.1.2</b> Too few parameters hurts, too.</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#information-theory-and-model-performance"><i class="fa fa-check"></i><b>6.2</b> Information theory and model performance</a><ul>
<li class="chapter" data-level="6.2.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#firing-the-weatherperson."><i class="fa fa-check"></i><b>6.2.1</b> Firing the weatherperson.</a></li>
<li class="chapter" data-level="6.2.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#information-and-uncertainty."><i class="fa fa-check"></i><b>6.2.2</b> Information and uncertainty.</a></li>
<li class="chapter" data-level="6.2.3" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#from-entropy-to-accuracy."><i class="fa fa-check"></i><b>6.2.3</b> From entropy to accuracy.</a></li>
<li class="chapter" data-level="6.2.4" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#from-divergence-to-deviance."><i class="fa fa-check"></i><b>6.2.4</b> From divergence to deviance.</a></li>
<li class="chapter" data-level="6.2.5" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#from-deviance-to-out-of-sample."><i class="fa fa-check"></i><b>6.2.5</b> From deviance to out-of-sample.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#regularization"><i class="fa fa-check"></i><b>6.3</b> Regularization</a></li>
<li class="chapter" data-level="6.4" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#information-criteria"><i class="fa fa-check"></i><b>6.4</b> Information criteria</a><ul>
<li class="chapter" data-level="6.4.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#dic."><i class="fa fa-check"></i><b>6.4.1</b> DIC.</a></li>
<li class="chapter" data-level="6.4.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#waic."><i class="fa fa-check"></i><b>6.4.2</b> WAIC.</a></li>
<li class="chapter" data-level="6.4.3" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#dic-and-waic-as-estimates-of-deviance."><i class="fa fa-check"></i><b>6.4.3</b> DIC and WAIC as estimates of deviance.</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#using-information-criteria"><i class="fa fa-check"></i><b>6.5</b> Using information criteria</a><ul>
<li class="chapter" data-level="6.5.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#model-comparison."><i class="fa fa-check"></i><b>6.5.1</b> Model comparison.</a></li>
<li class="chapter" data-level="6.5.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#model-averaging."><i class="fa fa-check"></i><b>6.5.2</b> Model averaging.</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#summary-bonus-r2-talk"><i class="fa fa-check"></i><b>6.6</b> <del>Summary</del> Bonus: <span class="math inline">\(R^2\)</span> talk</a></li>
<li class="chapter" data-level="" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#reference-5"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="interactions.html"><a href="interactions.html"><i class="fa fa-check"></i><b>7</b> Interactions</a><ul>
<li class="chapter" data-level="7.1" data-path="interactions.html"><a href="interactions.html#building-an-interaction."><i class="fa fa-check"></i><b>7.1</b> Building an interaction.</a><ul>
<li class="chapter" data-level="7.1.1" data-path="interactions.html"><a href="interactions.html#adding-a-dummy-variable-doesnt-work."><i class="fa fa-check"></i><b>7.1.1</b> Adding a dummy variable doesn’t work.</a></li>
<li class="chapter" data-level="7.1.2" data-path="interactions.html"><a href="interactions.html#adding-a-linear-interaction-does-work."><i class="fa fa-check"></i><b>7.1.2</b> Adding a linear interaction does work.</a></li>
<li class="chapter" data-level="7.1.3" data-path="interactions.html"><a href="interactions.html#plotting-the-interaction."><i class="fa fa-check"></i><b>7.1.3</b> Plotting the interaction.</a></li>
<li class="chapter" data-level="7.1.4" data-path="interactions.html"><a href="interactions.html#interpreting-an-interaction-estimate."><i class="fa fa-check"></i><b>7.1.4</b> Interpreting an interaction estimate.</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="interactions.html"><a href="interactions.html#symmetry-of-the-linear-interaction."><i class="fa fa-check"></i><b>7.2</b> Symmetry of the linear interaction.</a><ul>
<li class="chapter" data-level="7.2.1" data-path="interactions.html"><a href="interactions.html#buridans-interaction."><i class="fa fa-check"></i><b>7.2.1</b> Buridan’s interaction.</a></li>
<li class="chapter" data-level="7.2.2" data-path="interactions.html"><a href="interactions.html#africa-depends-upon-ruggedness."><i class="fa fa-check"></i><b>7.2.2</b> Africa depends upon ruggedness.</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="interactions.html"><a href="interactions.html#continuous-interactions"><i class="fa fa-check"></i><b>7.3</b> Continuous interactions</a><ul>
<li class="chapter" data-level="7.3.1" data-path="interactions.html"><a href="interactions.html#the-data.-1"><i class="fa fa-check"></i><b>7.3.1</b> The data.</a></li>
<li class="chapter" data-level="7.3.2" data-path="interactions.html"><a href="interactions.html#the-un-centered-models."><i class="fa fa-check"></i><b>7.3.2</b> The un-centered models.</a></li>
<li class="chapter" data-level="7.3.3" data-path="interactions.html"><a href="interactions.html#center-and-re-estimate."><i class="fa fa-check"></i><b>7.3.3</b> Center and re-estimate.</a></li>
<li class="chapter" data-level="7.3.4" data-path="interactions.html"><a href="interactions.html#plotting-implied-predictions."><i class="fa fa-check"></i><b>7.3.4</b> Plotting implied predictions.</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="interactions.html"><a href="interactions.html#interactions-in-design-formulas"><i class="fa fa-check"></i><b>7.4</b> Interactions in design formulas</a></li>
<li class="chapter" data-level="7.5" data-path="interactions.html"><a href="interactions.html#summary-bonus-marginal_effects"><i class="fa fa-check"></i><b>7.5</b> <del>Summary</del> Bonus: <code>marginal_effects()</code></a></li>
<li class="chapter" data-level="" data-path="interactions.html"><a href="interactions.html#reference-6"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="interactions.html"><a href="interactions.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>8</b> Markov Chain Monte Carlo</a><ul>
<li class="chapter" data-level="8.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#good-king-markov-and-his-island-kingdom"><i class="fa fa-check"></i><b>8.1</b> Good King Markov and His island kingdom</a></li>
<li class="chapter" data-level="8.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#markov-chain-monte-carlo-1"><i class="fa fa-check"></i><b>8.2</b> Markov chain Monte Carlo</a></li>
<li class="chapter" data-level="8.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#easy-hmc-map2stan-brm"><i class="fa fa-check"></i><b>8.3</b> Easy HMC: <del>map2stan</del> <code>brm()</code></a><ul>
<li class="chapter" data-level="8.3.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#preparation."><i class="fa fa-check"></i><b>8.3.1</b> Preparation.</a></li>
<li class="chapter" data-level="8.3.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#estimation."><i class="fa fa-check"></i><b>8.3.2</b> Estimation.</a></li>
<li class="chapter" data-level="8.3.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#sampling-again-in-parallel."><i class="fa fa-check"></i><b>8.3.3</b> Sampling again, in parallel.</a></li>
<li class="chapter" data-level="8.3.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#visualization."><i class="fa fa-check"></i><b>8.3.4</b> Visualization.</a></li>
<li class="chapter" data-level="8.3.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#using-the-samples."><i class="fa fa-check"></i><b>8.3.5</b> Using the samples.</a></li>
<li class="chapter" data-level="8.3.6" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#checking-the-chain."><i class="fa fa-check"></i><b>8.3.6</b> Checking the chain.</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#care-and-feeding-of-your-markov-chain."><i class="fa fa-check"></i><b>8.4</b> Care and feeding of your Markov chain.</a><ul>
<li class="chapter" data-level="8.4.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>8.4.1</b> How many samples do you need?</a></li>
<li class="chapter" data-level="8.4.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-chains-do-you-need"><i class="fa fa-check"></i><b>8.4.2</b> How many chains do you need?</a></li>
<li class="chapter" data-level="8.4.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#taming-a-wild-chain."><i class="fa fa-check"></i><b>8.4.3</b> Taming a wild chain.</a></li>
<li class="chapter" data-level="8.4.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#non-identifiable-parameters."><i class="fa fa-check"></i><b>8.4.4</b> Non-identifiable parameters.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#reference-7"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>9</b> Big Entropy and the Generalized Linear Model</a><ul>
<li class="chapter" data-level="9.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>9.1</b> Maximum entropy</a><ul>
<li class="chapter" data-level="9.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#gaussian."><i class="fa fa-check"></i><b>9.1.1</b> Gaussian.</a></li>
<li class="chapter" data-level="9.1.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial."><i class="fa fa-check"></i><b>9.1.2</b> Binomial.</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>9.2</b> Generalized linear models</a><ul>
<li class="chapter" data-level="9.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family."><i class="fa fa-check"></i><b>9.2.1</b> Meet the family.</a></li>
<li class="chapter" data-level="9.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions."><i class="fa fa-check"></i><b>9.2.2</b> Linking linear models to distributions.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#reference-8"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="counting-and-classification.html"><a href="counting-and-classification.html"><i class="fa fa-check"></i><b>10</b> Counting and Classification</a><ul>
<li class="chapter" data-level="10.1" data-path="counting-and-classification.html"><a href="counting-and-classification.html#binomial-regression"><i class="fa fa-check"></i><b>10.1</b> Binomial regression</a><ul>
<li class="chapter" data-level="10.1.1" data-path="counting-and-classification.html"><a href="counting-and-classification.html#logistic-regression-prosocial-chimpanzees."><i class="fa fa-check"></i><b>10.1.1</b> Logistic regression: Prosocial chimpanzees.</a></li>
<li class="chapter" data-level="10.1.2" data-path="counting-and-classification.html"><a href="counting-and-classification.html#aggregated-binomial-chimpanzees-again-condensed."><i class="fa fa-check"></i><b>10.1.2</b> Aggregated binomial: Chimpanzees again, condensed.</a></li>
<li class="chapter" data-level="10.1.3" data-path="counting-and-classification.html"><a href="counting-and-classification.html#aggregated-binomial-graduate-school-admissions."><i class="fa fa-check"></i><b>10.1.3</b> Aggregated binomial: Graduate school admissions.</a></li>
<li class="chapter" data-level="10.1.4" data-path="counting-and-classification.html"><a href="counting-and-classification.html#fitting-binomial-regressions-with-glm."><i class="fa fa-check"></i><b>10.1.4</b> Fitting binomial regressions with <code>glm()</code>.</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="counting-and-classification.html"><a href="counting-and-classification.html#poisson-regression"><i class="fa fa-check"></i><b>10.2</b> Poisson regression</a><ul>
<li class="chapter" data-level="10.2.1" data-path="counting-and-classification.html"><a href="counting-and-classification.html#example-oceanic-tool-complexity."><i class="fa fa-check"></i><b>10.2.1</b> Example: Oceanic tool complexity.</a></li>
<li class="chapter" data-level="10.2.2" data-path="counting-and-classification.html"><a href="counting-and-classification.html#mcmc-islands."><i class="fa fa-check"></i><b>10.2.2</b> MCMC islands.</a></li>
<li class="chapter" data-level="10.2.3" data-path="counting-and-classification.html"><a href="counting-and-classification.html#example-exposure-and-the-offset."><i class="fa fa-check"></i><b>10.2.3</b> Example: Exposure and the offset.</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="counting-and-classification.html"><a href="counting-and-classification.html#other-count-regressions"><i class="fa fa-check"></i><b>10.3</b> Other count regressions</a><ul>
<li class="chapter" data-level="10.3.1" data-path="counting-and-classification.html"><a href="counting-and-classification.html#multinomial."><i class="fa fa-check"></i><b>10.3.1</b> Multinomial.</a></li>
<li class="chapter" data-level="10.3.2" data-path="counting-and-classification.html"><a href="counting-and-classification.html#geometric."><i class="fa fa-check"></i><b>10.3.2</b> Geometric.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="counting-and-classification.html"><a href="counting-and-classification.html#reference-9"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="counting-and-classification.html"><a href="counting-and-classification.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html"><i class="fa fa-check"></i><b>11</b> Monsters and Mixtures</a><ul>
<li class="chapter" data-level="11.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>11.1</b> Ordered categorical outcomes</a><ul>
<li class="chapter" data-level="11.1.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-moral-intuition."><i class="fa fa-check"></i><b>11.1.1</b> Example: Moral intuition.</a></li>
<li class="chapter" data-level="11.1.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#describing-an-ordered-distribution-with-intercepts."><i class="fa fa-check"></i><b>11.1.2</b> Describing an ordered distribution with intercepts.</a></li>
<li class="chapter" data-level="11.1.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#adding-predictor-variables."><i class="fa fa-check"></i><b>11.1.3</b> Adding predictor variables.</a></li>
<li class="chapter" data-level="11.1.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#bonus-figure-11.3-alternative."><i class="fa fa-check"></i><b>11.1.4</b> Bonus: Figure 11.3 alternative.</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>11.2</b> Zero-inflated outcomes</a><ul>
<li class="chapter" data-level="11.2.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-zero-inflated-poisson."><i class="fa fa-check"></i><b>11.2.1</b> Example: Zero-inflated Poisson.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersed-outcomes"><i class="fa fa-check"></i><b>11.3</b> Over-dispersed outcomes</a><ul>
<li class="chapter" data-level="11.3.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#beta-binomial."><i class="fa fa-check"></i><b>11.3.1</b> Beta-binomial.</a></li>
<li class="chapter" data-level="11.3.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#negative-binomial-or-gamma-poisson."><i class="fa fa-check"></i><b>11.3.2</b> Negative-binomial or gamma-Poisson.</a></li>
<li class="chapter" data-level="11.3.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersion-entropy-and-information-criteria."><i class="fa fa-check"></i><b>11.3.3</b> Over-dispersion, entropy, and information criteria.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#reference-10"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="multilevel-models.html"><a href="multilevel-models.html"><i class="fa fa-check"></i><b>12</b> Multilevel Models</a><ul>
<li class="chapter" data-level="12.1" data-path="multilevel-models.html"><a href="multilevel-models.html#example-multilevel-tadpoles"><i class="fa fa-check"></i><b>12.1</b> Example: Multilevel tadpoles</a></li>
<li class="chapter" data-level="12.2" data-path="multilevel-models.html"><a href="multilevel-models.html#varying-effects-and-the-underfittingoverfitting-trade-off"><i class="fa fa-check"></i><b>12.2</b> Varying effects and the underfitting/overfitting trade-off</a><ul>
<li class="chapter" data-level="12.2.1" data-path="multilevel-models.html"><a href="multilevel-models.html#the-model.-1"><i class="fa fa-check"></i><b>12.2.1</b> The model.</a></li>
<li class="chapter" data-level="12.2.2" data-path="multilevel-models.html"><a href="multilevel-models.html#assign-values-to-the-parameters."><i class="fa fa-check"></i><b>12.2.2</b> Assign values to the parameters.</a></li>
<li class="chapter" data-level="12.2.3" data-path="multilevel-models.html"><a href="multilevel-models.html#sumulate-survivors."><i class="fa fa-check"></i><b>12.2.3</b> Sumulate survivors.</a></li>
<li class="chapter" data-level="12.2.4" data-path="multilevel-models.html"><a href="multilevel-models.html#compute-the-no-pooling-estimates."><i class="fa fa-check"></i><b>12.2.4</b> Compute the no-pooling estimates.</a></li>
<li class="chapter" data-level="12.2.5" data-path="multilevel-models.html"><a href="multilevel-models.html#compute-the-partial-pooling-estimates."><i class="fa fa-check"></i><b>12.2.5</b> Compute the partial-pooling estimates.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="multilevel-models.html"><a href="multilevel-models.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>12.3</b> More than one type of cluster</a><ul>
<li class="chapter" data-level="12.3.1" data-path="multilevel-models.html"><a href="multilevel-models.html#multilevel-chimpanzees."><i class="fa fa-check"></i><b>12.3.1</b> Multilevel chimpanzees.</a></li>
<li class="chapter" data-level="12.3.2" data-path="multilevel-models.html"><a href="multilevel-models.html#two-types-of-cluster."><i class="fa fa-check"></i><b>12.3.2</b> Two types of cluster.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="multilevel-models.html"><a href="multilevel-models.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>12.4</b> Multilevel posterior predictions</a><ul>
<li class="chapter" data-level="12.4.1" data-path="multilevel-models.html"><a href="multilevel-models.html#posterior-prediction-for-same-clusters."><i class="fa fa-check"></i><b>12.4.1</b> Posterior prediction for same clusters.</a></li>
<li class="chapter" data-level="12.4.2" data-path="multilevel-models.html"><a href="multilevel-models.html#posterior-prediction-for-new-clusters."><i class="fa fa-check"></i><b>12.4.2</b> Posterior prediction for new clusters.</a></li>
<li class="chapter" data-level="12.4.3" data-path="multilevel-models.html"><a href="multilevel-models.html#focus-and-multilevel-prediction."><i class="fa fa-check"></i><b>12.4.3</b> Focus and multilevel prediction.</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="multilevel-models.html"><a href="multilevel-models.html#summary-bonus-tidybayesspread_draws"><i class="fa fa-check"></i><b>12.5</b> <del>Summary</del> Bonus: <code>tidybayes::spread_draws()</code></a><ul>
<li class="chapter" data-level="12.5.1" data-path="multilevel-models.html"><a href="multilevel-models.html#intercepts-only-models-with-one-or-two-grouping-variables"><i class="fa fa-check"></i><b>12.5.1</b> Intercepts-only models with one or two grouping variables</a></li>
<li class="chapter" data-level="12.5.2" data-path="multilevel-models.html"><a href="multilevel-models.html#brmsposterior_samples"><i class="fa fa-check"></i><b>12.5.2</b> <code>brms::posterior_samples()</code></a></li>
<li class="chapter" data-level="12.5.3" data-path="multilevel-models.html"><a href="multilevel-models.html#brmscoef"><i class="fa fa-check"></i><b>12.5.3</b> <code>brms::coef()</code></a></li>
<li class="chapter" data-level="12.5.4" data-path="multilevel-models.html"><a href="multilevel-models.html#brmsfitted"><i class="fa fa-check"></i><b>12.5.4</b> <code>brms::fitted()</code></a></li>
<li class="chapter" data-level="12.5.5" data-path="multilevel-models.html"><a href="multilevel-models.html#tidybayesspread_draws"><i class="fa fa-check"></i><b>12.5.5</b> <code>tidybayes::spread_draws()</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multilevel-models.html"><a href="multilevel-models.html#reference-11"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="multilevel-models.html"><a href="multilevel-models.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html"><i class="fa fa-check"></i><b>13</b> Adventures in Covariance</a><ul>
<li class="chapter" data-level="13.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>13.1</b> Varying slopes by construction</a><ul>
<li class="chapter" data-level="13.1.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-the-population."><i class="fa fa-check"></i><b>13.1.1</b> Simulate the population.</a></li>
<li class="chapter" data-level="13.1.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-observations."><i class="fa fa-check"></i><b>13.1.2</b> Simulate observations.</a></li>
<li class="chapter" data-level="13.1.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#the-varying-slopes-model."><i class="fa fa-check"></i><b>13.1.3</b> The varying slopes model.</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-admission-decisions-and-gender"><i class="fa fa-check"></i><b>13.2</b> Example: Admission decisions and gender</a><ul>
<li class="chapter" data-level="13.2.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-intercepts."><i class="fa fa-check"></i><b>13.2.1</b> Varying intercepts.</a></li>
<li class="chapter" data-level="13.2.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-effects-of-being-male."><i class="fa fa-check"></i><b>13.2.2</b> Varying effects of being <code>male</code>.</a></li>
<li class="chapter" data-level="13.2.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#shrinkage."><i class="fa fa-check"></i><b>13.2.3</b> Shrinkage.</a></li>
<li class="chapter" data-level="13.2.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#model-comparison.-1"><i class="fa fa-check"></i><b>13.2.4</b> Model comparison.</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-cross-classified-chimpanzees-with-varying-slopes"><i class="fa fa-check"></i><b>13.3</b> Example: Cross-classified <code>chimpanzees</code> with varying slopes</a></li>
<li class="chapter" data-level="13.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>13.4</b> Continuous categories and the Gaussian process</a><ul>
<li class="chapter" data-level="13.4.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-spatial-autocorrelation-in-oceanic-tools."><i class="fa fa-check"></i><b>13.4.1</b> Example: Spatial autocorrelation in Oceanic tools.</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#summary-bonus-another-berkley-admissions-data-like-example."><i class="fa fa-check"></i><b>13.5</b> <del>Summary</del> Bonus: Another Berkley-admissions-data-like example.</a></li>
<li class="chapter" data-level="" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#reference-12"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#session-info-12"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html"><i class="fa fa-check"></i><b>14</b> Missing Data and Other Opportunities</a><ul>
<li class="chapter" data-level="14.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#measurement-error"><i class="fa fa-check"></i><b>14.1</b> Measurement error</a><ul>
<li class="chapter" data-level="14.1.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#error-on-the-outcome."><i class="fa fa-check"></i><b>14.1.1</b> Error on the outcome.</a></li>
<li class="chapter" data-level="14.1.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#error-on-both-outcome-and-predictor."><i class="fa fa-check"></i><b>14.1.2</b> Error on both outcome and predictor.</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#missing-data"><i class="fa fa-check"></i><b>14.2</b> Missing data</a><ul>
<li class="chapter" data-level="14.2.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#imputing-neocortex"><i class="fa fa-check"></i><b>14.2.1</b> Imputing <code>neocortex</code></a></li>
<li class="chapter" data-level="14.2.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#improving-the-imputation-model"><i class="fa fa-check"></i><b>14.2.2</b> Improving the imputation model</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#summary-bonus-meta-analysis"><i class="fa fa-check"></i><b>14.3</b> <del>Summary</del> Bonus: Meta-analysis</a></li>
<li class="chapter" data-level="" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#reference-13"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#session-info-13"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html"><i class="fa fa-check"></i><b>15</b> <del>Horoscopes</del> Insights</a><ul>
<li class="chapter" data-level="15.1" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#use-r-notebooks"><i class="fa fa-check"></i><b>15.1</b> Use R Notebooks</a></li>
<li class="chapter" data-level="15.2" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#save-your-model-fits"><i class="fa fa-check"></i><b>15.2</b> Save your model fits</a></li>
<li class="chapter" data-level="15.3" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#build-your-models-slowly"><i class="fa fa-check"></i><b>15.3</b> Build your models slowly</a></li>
<li class="chapter" data-level="15.4" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#look-at-your-data"><i class="fa fa-check"></i><b>15.4</b> Look at your data</a></li>
<li class="chapter" data-level="15.5" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#use-the-0-intercept-syntax"><i class="fa fa-check"></i><b>15.5</b> Use the <code>0 + intercept</code> syntax</a></li>
<li class="chapter" data-level="15.6" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#annotate-your-workflow"><i class="fa fa-check"></i><b>15.6</b> Annotate your workflow</a></li>
<li class="chapter" data-level="15.7" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#annotate-your-code"><i class="fa fa-check"></i><b>15.7</b> Annotate your code</a></li>
<li class="chapter" data-level="15.8" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#break-up-your-workflow"><i class="fa fa-check"></i><b>15.8</b> Break up your workflow</a></li>
<li class="chapter" data-level="15.9" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#read-gelmans-blog"><i class="fa fa-check"></i><b>15.9</b> Read Gelman’s blog</a></li>
<li class="chapter" data-level="15.10" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#check-out-other-social-media-too"><i class="fa fa-check"></i><b>15.10</b> Check out other social media, too</a></li>
<li class="chapter" data-level="15.11" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#parting-wisdom"><i class="fa fa-check"></i><b>15.11</b> Parting wisdom</a></li>
<li class="chapter" data-level="" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#reference-14"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#session-info-14"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Statistical Rethinking</em> with brms, ggplot2, and the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="counting-and-classification" class="section level1">
<h1><span class="header-section-number">10</span> Counting and Classification</h1>
<blockquote>
<p>All over the world, every day, scientists throw away information. Sometimes this is through the removal of “outliers,” cases in the data that offend the model and are exiled. More routinely, counted things are converted to proportions before analysis. Why does analysis of proportions throw away information? Because 10/20 and ½ are the same proportion, one-half, but have very different sample sizes. Once converted to proportions, and treated as outcomes in a linear regression, the information about sample size has been destroyed.</p>
<p>It’s easy to retain the information about sample size. All that is needed is to model what has actually been observed, the counts instead of the proportions. (p. 291)</p>
</blockquote>
<p>In this chapter, we focus on the two most common types of count models: the binomial and the Poisson.</p>
<p>Side note: For a nice Bayesian way to accommodate outliers in your Gaussian models, check out my blog <a href="https://solomonkurz.netlify.com/post/robust-linear-regression-with-the-robust-student-s-t-distribution/"><em>Robust Linear Regression with Student’s <span class="math inline">\(t\)</span>-Distribution</em></a>.</p>
<div id="binomial-regression" class="section level2">
<h2><span class="header-section-number">10.1</span> Binomial regression</h2>
<p>The basic binomial model follows the form</p>
<p><span class="math display">\[y \sim \text{Binomial} (n, p)\]</span></p>
<p>where <span class="math inline">\(y\)</span> is some count variable, <span class="math inline">\(n\)</span> is the number of trials, and <span class="math inline">\(p\)</span> it the probability a given trial was a 1, which is sometimes termed a <em>success</em>. When <span class="math inline">\(n = 1\)</span>, then <span class="math inline">\(y\)</span> is a vector of 0s and 1s. Presuming the logit link, models of this type are commonly termed logistic regression. When <span class="math inline">\(n &gt; 1\)</span>, and still presuming the logit link, we might call our model an aggregated logistic regression model, or more generally an aggregated binomial regression model.</p>
<div id="logistic-regression-prosocial-chimpanzees." class="section level3">
<h3><span class="header-section-number">10.1.1</span> Logistic regression: Prosocial chimpanzees.</h3>
<p>Load the <code>chimpanzees</code> data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rethinking)
<span class="kw">data</span>(chimpanzees)
d &lt;-<span class="st"> </span>chimpanzees</code></pre></div>
<p>Switch from rethinking to brms.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)
<span class="kw">library</span>(brms)
<span class="kw">rm</span>(chimpanzees)</code></pre></div>
<p>We start with the simple intercept-only logistic regression model, which follows the statistical formula</p>
<span class="math display">\[\begin{align*}
\text{pulled_left}_i &amp; \sim \text{Binomial} (1, p_i) \\
\text{logit} (p_i)    &amp; = \alpha \\
\alpha                &amp; \sim \text{Normal} (0, 10)
\end{align*}\]</span>
<p>In the <code>brm()</code> <code>formula</code> syntax, including a <code>|</code> bar on the left side of a formula indicates we have extra supplementary information about our criterion. In this case, that information is that each <code>pulled_left</code> value corresponds to a single trial (i.e., <code>trials(1)</code>), which itself corresponds to the <span class="math inline">\(n = 1\)</span> portion of the statistical formula, above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b10.<span class="dv">1</span> &lt;-
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> binomial,
      pulled_left <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,
      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),
      <span class="dt">seed =</span> <span class="dv">10</span>)</code></pre></div>
<p>You might use <code>fixef()</code> to get a focused summary of the intercept.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
 
<span class="kw">fixef</span>(b10.<span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code>##           Estimate Est.Error Q2.5 Q97.5
## Intercept     0.32      0.09 0.14   0.5</code></pre>
<p>The <code>brms::inv_logit_scaled()</code> function will be our alternative to the <code>logistic()</code> function in rethinking.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(.<span class="dv">18</span>, .<span class="dv">46</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inv_logit_scaled</span>()</code></pre></div>
<pre><code>## [1] 0.5448789 0.6130142</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fixef</span>(b10.<span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inv_logit_scaled</span>()</code></pre></div>
<pre><code>##           Estimate Est.Error      Q2.5     Q97.5
## Intercept 0.579012 0.5226864 0.5350585 0.6217093</code></pre>
<p>With the next two chimp models, we add predictors in the usual way.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b10.<span class="dv">2</span> &lt;-
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> binomial,
      pulled_left <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>prosoc_left,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> b)),
      <span class="dt">seed =</span> <span class="dv">10</span>)

b10.<span class="dv">3</span> &lt;-
<span class="st">  </span><span class="kw">update</span>(b10.<span class="dv">2</span>,
         <span class="dt">newdata =</span> d,
         <span class="dt">formula =</span> pulled_left <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>prosoc_left <span class="op">+</span><span class="st"> </span>condition<span class="op">:</span>prosoc_left)</code></pre></div>
<p>Compute the WAIC for each model and save the results within the brmfit objects.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b10.<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b10.<span class="dv">1</span>, <span class="st">&quot;waic&quot;</span>)
b10.<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b10.<span class="dv">2</span>, <span class="st">&quot;waic&quot;</span>)
b10.<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b10.<span class="dv">3</span>, <span class="st">&quot;waic&quot;</span>)</code></pre></div>
<p>Compare them with the <code>loo_compare()</code> and make sure to add the <code>criterion = &quot;waic&quot;</code> argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">w &lt;-<span class="st"> </span><span class="kw">loo_compare</span>(b10.<span class="dv">1</span>, b10.<span class="dv">2</span>, b10.<span class="dv">3</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>)

<span class="kw">print</span>(w, <span class="dt">simplify =</span> F)</code></pre></div>
<pre><code>##       elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
## b10.2    0.0       0.0  -340.2       4.7          2.0    0.0     680.4    9.4 
## b10.3   -1.0       0.4  -341.2       4.7          3.1    0.1     682.5    9.5 
## b10.1   -3.8       3.1  -344.0       3.5          1.0    0.0     688.0    7.1</code></pre>
<p>Recall our <code>cbind()</code> trick to convert the differences from the <span class="math inline">\(\text{elpd}\)</span> metric to the WAIC metric.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cbind</span>(<span class="dt">waic_diff =</span> w[, <span class="dv">1</span>] <span class="op">*</span><span class="st"> </span><span class="op">-</span><span class="dv">2</span>,
      <span class="dt">se        =</span> w[, <span class="dv">2</span>] <span class="op">*</span><span class="st">  </span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code>##       waic_diff   se
## b10.2      0.00 0.00
## b10.3      2.06 0.90
## b10.1      7.57 6.21</code></pre>
<p>For this chapter, we’ll take our color scheme from the <a href="https://cran.r-project.org/web/packages/wesanderson/index.html">wesanderson package</a>’s <code>Moonrise2</code> palette.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages(&quot;wesanderson&quot;, dependencies = T)</span>
<span class="kw">library</span>(wesanderson)

<span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)</code></pre></div>
<p><img src="10_files/figure-html/unnamed-chunk-8-1.png" width="288" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</code></pre></div>
<pre><code>## [1] &quot;#798E87&quot; &quot;#C27D38&quot; &quot;#CCC591&quot; &quot;#29211F&quot;</code></pre>
<p>We’ll also take a few formatting cues from <a href="https://www.edwardtufte.com/tufte/books_vdqi">Edward Tufte</a>, curtesy of the <a href="https://cran.r-project.org/web/packages/ggthemes/index.html">ggthemes package</a>. The <code>theme_tufte()</code> function will change the default font and remove some chart junk. The <code>theme_set()</code> function, below, will make these adjustments the default for all subsequent ggplot2 plots. To undo this, just execute <code>theme_set(theme_default())</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggthemes)
<span class="kw">library</span>(bayesplot)

<span class="kw">theme_set</span>(<span class="kw">theme_default</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">            </span><span class="kw">theme_tufte</span>() <span class="op">+</span>
<span class="st">            </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill  =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">3</span>],
                                                 <span class="dt">color =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">3</span>])))</code></pre></div>
<p>Finally, here’s our WAIC plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">w <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rownames_to_column</span>(<span class="dt">var =</span> <span class="st">&quot;model&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(model, <span class="op">-</span>waic), <span class="dt">y =</span> waic,
                      <span class="dt">ymin =</span> waic <span class="op">-</span><span class="st"> </span>se_waic,
                      <span class="dt">ymax =</span> waic <span class="op">+</span><span class="st"> </span>se_waic,
                      <span class="dt">color =</span> model),
                  <span class="dt">shape =</span> <span class="dv">16</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">4</span>)]) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>, <span class="dt">y =</span> <span class="ot">NULL</span>,
       <span class="dt">title =</span> <span class="st">&quot;WAIC&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.y    =</span> <span class="kw">element_blank</span>(),
        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</code></pre></div>
<p><img src="10_files/figure-html/unnamed-chunk-10-1.png" width="432" /></p>
<p>The full model, <code>b10.3</code>, did not have the lowest WAIC value. Though note how wide those standard error bars are relative to the point estimates. There’s a lot of model uncertainty there. Here are the WAIC weights.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">model_weights</span>(b10.<span class="dv">1</span>, b10.<span class="dv">2</span>, b10.<span class="dv">3</span>, 
              <span class="dt">weights =</span> <span class="st">&quot;waic&quot;</span>)</code></pre></div>
<pre><code>##      b10.1      b10.2      b10.3 
## 0.01645053 0.72480254 0.25874693</code></pre>
<p>Let’s look at the parameter summaries for the theory-based model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b10.<span class="dv">3</span>)</code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: pulled_left | trials(1) ~ prosoc_left + prosoc_left:condition 
##    Data: d (Number of observations: 504) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##                       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept                 0.04      0.13    -0.20     0.29       3514 1.00
## prosoc_left               0.63      0.23     0.19     1.07       2417 1.00
## prosoc_left:condition    -0.12      0.27    -0.65     0.42       2510 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Here’s what the odds are multiplied by:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fixef</span>(b10.<span class="dv">3</span>)[<span class="dv">2</span>] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">exp</span>()</code></pre></div>
<pre><code>## [1] 1.870972</code></pre>
<p>Given an estimated value of 4, the probability of a pull, all else equal, would be close to 1.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">inv_logit_scaled</span>(<span class="dv">4</span>)</code></pre></div>
<pre><code>## [1] 0.9820138</code></pre>
<p>Adding the coefficient, <code>fixef(b10.3)[2]</code>, would yield an even higher estimate.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dv">4</span> <span class="op">+</span><span class="st"> </span><span class="kw">fixef</span>(b10.<span class="dv">3</span>)[<span class="dv">2</span>]) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inv_logit_scaled</span>()</code></pre></div>
<pre><code>## [1] 0.9903055</code></pre>
<p>For our variant of Figure 10.2, we use <code>brms::pp_average()</code> in place of <code>rethinking::ensemble()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># the combined `fitted()` results of the three models weighted by their WAICs</span>
ppa &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">pp_average</span>(b10.<span class="dv">1</span>, b10.<span class="dv">2</span>, b10.<span class="dv">3</span>,
             <span class="dt">weights =</span> <span class="st">&quot;waic&quot;</span>,
             <span class="dt">method =</span> <span class="st">&quot;fitted&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">bind_cols</span>(b10.<span class="dv">3</span><span class="op">$</span>data) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">distinct</span>(Estimate, Q2.<span class="dv">5</span>, Q97.<span class="dv">5</span>, condition, prosoc_left) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">x_axis =</span> <span class="kw">str_c</span>(prosoc_left, condition, <span class="dt">sep =</span> <span class="st">&quot;/&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">x_axis =</span> <span class="kw">factor</span>(x_axis, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;0/0&quot;</span>, <span class="st">&quot;1/0&quot;</span>, <span class="st">&quot;0/1&quot;</span>, <span class="st">&quot;1/1&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">pulled_left =</span> Estimate)

<span class="co"># the empirically-based summaries</span>
d_plot &lt;-
<span class="st">  </span>d <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(actor, condition, prosoc_left) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">pulled_left =</span> <span class="kw">mean</span>(pulled_left)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">x_axis =</span> <span class="kw">str_c</span>(prosoc_left, condition, <span class="dt">sep =</span> <span class="st">&quot;/&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">x_axis =</span> <span class="kw">factor</span>(x_axis, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;0/0&quot;</span>, <span class="st">&quot;1/0&quot;</span>, <span class="st">&quot;0/1&quot;</span>, <span class="st">&quot;1/1&quot;</span>)))

<span class="co"># the plot</span>
ppa <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x_axis)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">y =</span> pulled_left, <span class="dt">ymin =</span> Q2.<span class="dv">5</span>, <span class="dt">ymax =</span> Q97.<span class="dv">5</span>, <span class="dt">group =</span> <span class="dv">0</span>),
              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,
              <span class="dt">fill =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">2</span>], <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, 
              <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> d_plot,
            <span class="kw">aes</span>(<span class="dt">y =</span> pulled_left, <span class="dt">group =</span> actor),
            <span class="dt">color =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">1</span>], <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_discrete</span>(<span class="dt">expand =</span> <span class="kw">c</span>(.<span class="dv">03</span>, .<span class="dv">03</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;prosoc_left/condition&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;proportion pulled left&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.x =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="10_files/figure-html/unnamed-chunk-15-1.png" width="288" /></p>
<p>McElreath didn’t show the actual pairs plot in the text. Here’s ours using <code>mcmc_pairs()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># this helps us set our custom color scheme</span>
<span class="kw">color_scheme_set</span>(<span class="kw">c</span>(<span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">3</span>], 
                   <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">1</span>], 
                   <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">2</span>], 
                   <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">2</span>], 
                   <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">1</span>], 
                   <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">1</span>]))

<span class="co"># the actual plot</span>
<span class="kw">mcmc_pairs</span>(<span class="dt">x =</span> <span class="kw">posterior_samples</span>(b10.<span class="dv">3</span>),
           <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">&quot;b_Intercept&quot;</span>, <span class="st">&quot;b_prosoc_left&quot;</span>, <span class="st">&quot;b_prosoc_left:condition&quot;</span>),
           <span class="dt">off_diag_args =</span> <span class="kw">list</span>(<span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">6</span>),
           <span class="dt">diag_fun =</span> <span class="st">&quot;dens&quot;</span>)</code></pre></div>
<p><img src="10_files/figure-html/unnamed-chunk-16-1.png" width="432" /></p>
<p>As McElreath observed, the posterior looks multivariate Gaussian.</p>
<p>In equations, the next model follows the form</p>
<span class="math display">\[\begin{align*}
\text{pulled_left}_i &amp; \sim \text{Binomial} (1, p_i) \\
\text{logit} (p_i)    &amp; = \alpha_{\text{actor}} + (\beta_1 + \beta_2 \text{condition}_i) \text{prosoc_left}_i \\
\alpha_{\text{actor}} &amp; \sim \text{Normal} (0, 10) \\
\beta_1               &amp; \sim \text{Normal} (0, 10) \\
\beta_2               &amp; \sim \text{Normal} (0, 10)
\end{align*}\]</span>
<p>Enclosing the <code>actor</code> variable within <code>factor()</code> will produce the indexing we need to get <code>actor</code>-specific intercepts. Also notice we’re using the <code>0 + factor(actor)</code> part of the model <code>formula</code> to suppress the brms default intercept. As such, the priors for all parameters in the model will be of <code>class = b</code>. And since we’re using the same Gaussian prior for each, we only need one line for the <code>prior</code> argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b10.<span class="dv">4</span> &lt;-
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> binomial,
      pulled_left <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span><span class="kw">factor</span>(actor) <span class="op">+</span><span class="st"> </span>prosoc_left <span class="op">+</span><span class="st"> </span>condition<span class="op">:</span>prosoc_left ,
      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> b),
      <span class="dt">iter =</span> <span class="dv">2500</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">chains =</span> <span class="dv">2</span>, <span class="dt">cores =</span> <span class="dv">2</span>,
      <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">0.9</span>),
      <span class="dt">seed =</span> <span class="dv">10</span>)</code></pre></div>
<p>Within the tidyverse, <code>distinct()</code> yields the information you’d otherwise get from <code>unique()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">distinct</span>(actor)</code></pre></div>
<pre><code>##   actor
## 1     1
## 2     2
## 3     3
## 4     4
## 5     5
## 6     6
## 7     7</code></pre>
<p>We have no need to use something like <code>depth=2</code> for our posterior summary.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b10.<span class="dv">4</span>)</code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: pulled_left | trials(1) ~ 0 + factor(actor) + prosoc_left + condition:prosoc_left 
##    Data: d (Number of observations: 504) 
## Samples: 2 chains, each with iter = 2500; warmup = 500; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##                       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## factoractor1             -0.74      0.27    -1.28    -0.21       3461 1.00
## factoractor2             10.98      5.48     3.89    24.16       1870 1.00
## factoractor3             -1.05      0.29    -1.63    -0.51       3714 1.00
## factoractor4             -1.05      0.28    -1.61    -0.51       3870 1.00
## factoractor5             -0.74      0.27    -1.28    -0.21       3782 1.00
## factoractor6              0.22      0.27    -0.29     0.77       4221 1.00
## factoractor7              1.82      0.40     1.08     2.69       4221 1.00
## prosoc_left               0.84      0.26     0.35     1.35       2455 1.00
## prosoc_left:condition    -0.13      0.30    -0.72     0.44       3259 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Correspondingly, <code>brms::posterior_samples()</code> returns an object for <code>b10.4</code> that doesn’t quite follow the same structure as from <code>rethinking::extract.samples()</code>. We just have a typical 2-dimensional data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(b10.<span class="dv">4</span>)
 
post <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">glimpse</span>()</code></pre></div>
<pre><code>## Observations: 4,000
## Variables: 10
## $ b_factoractor1            &lt;dbl&gt; -1.1858595, -0.4615217, -0.7064094, -0.2933396, -0.9631797, -1.0367221, -…
## $ b_factoractor2            &lt;dbl&gt; 7.454134, 6.917168, 7.084945, 7.208442, 16.542496, 5.172823, 8.026027, 9.…
## $ b_factoractor3            &lt;dbl&gt; -0.7563732, -1.3653995, -0.4588494, -0.1941674, -1.6394630, -1.2838897, -…
## $ b_factoractor4            &lt;dbl&gt; -0.9358261, -0.8761278, -1.0917094, -1.0846353, -1.0000311, -1.4545123, -…
## $ b_factoractor5            &lt;dbl&gt; -0.2041299, -0.9987514, -0.3351474, -0.3790166, -0.9260228, -1.1574304, -…
## $ b_factoractor6            &lt;dbl&gt; 0.68325055, -0.24779408, 0.96302540, 0.98686825, -0.36103079, 0.69365567,…
## $ b_factoractor7            &lt;dbl&gt; 2.9389421, 2.5470499, 1.6366450, 1.2998254, 2.6914495, 1.3223443, 0.89571…
## $ b_prosoc_left             &lt;dbl&gt; 0.3384714, 0.8072413, 0.7844121, 1.0413892, 0.9789063, 1.3959586, 1.10938…
## $ `b_prosoc_left:condition` &lt;dbl&gt; 0.521824578, 0.147820067, -0.601883627, -0.619894359, 0.394578954, -0.388…
## $ lp__                      &lt;dbl&gt; -297.4577, -292.0001, -293.5426, -300.4224, -296.1999, -292.4967, -294.35…</code></pre>
<p>Our variant of Figure 10.3:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">post <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> b_factoractor2)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>,
               <span class="dt">fill =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">1</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x        =</span> <span class="ot">NULL</span>,
       <span class="dt">title    =</span> <span class="st">&quot;Actor 2&#39;s large and uncertain intercept&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Once your log-odds are above, like, 4, it&#39;s all</span><span class="ch">\n</span><span class="st">pretty much a probability of 1.&quot;</span>)</code></pre></div>
<p><img src="10_files/figure-html/unnamed-chunk-20-1.png" width="288" /></p>
<p>Figure 10.4. shows the idiographic trajectories for four of our chimps.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># subset the `d_plot` data</span>
d_plot_<span class="dv">4</span> &lt;-
<span class="st">  </span>d_plot <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(actor <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">5</span><span class="op">:</span><span class="dv">7</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">actor =</span> <span class="kw">str_c</span>(<span class="st">&quot;actor &quot;</span>, actor))

<span class="co"># compute the model-implied estimates with `fitted()` and wrangle</span>
f &lt;-
<span class="st">  </span><span class="kw">fitted</span>(b10.<span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">bind_cols</span>(b10.<span class="dv">4</span><span class="op">$</span>data) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(actor <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">5</span><span class="op">:</span><span class="dv">7</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">distinct</span>(Estimate, Q2.<span class="dv">5</span>, Q97.<span class="dv">5</span>, condition, prosoc_left, actor) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(actor, <span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">actor  =</span> <span class="kw">str_c</span>(<span class="st">&quot;actor &quot;</span>, actor),
         <span class="dt">x_axis =</span> <span class="kw">str_c</span>(prosoc_left, condition, <span class="dt">sep =</span> <span class="st">&quot;/&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">x_axis =</span> <span class="kw">factor</span>(x_axis, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;0/0&quot;</span>, <span class="st">&quot;1/0&quot;</span>, <span class="st">&quot;0/1&quot;</span>, <span class="st">&quot;1/1&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">pulled_left =</span> Estimate)

<span class="co"># plot</span>
f <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x_axis, <span class="dt">y =</span> pulled_left, <span class="dt">group =</span> actor)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2.<span class="dv">5</span>, <span class="dt">ymax =</span> Q97.<span class="dv">5</span>),
              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,
              <span class="dt">fill =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">2</span>], <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, 
              <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> d_plot_<span class="dv">4</span>,
            <span class="dt">color =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">1</span>], <span class="dt">size =</span> <span class="fl">1.25</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_discrete</span>(<span class="dt">expand =</span> <span class="kw">c</span>(.<span class="dv">03</span>, .<span class="dv">03</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;prosoc_left/condition&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;proportion pulled left&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.x     =</span> <span class="kw">element_blank</span>(),
        <span class="co"># color came from: http://www.color-hex.com/color/ccc591</span>
        <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;#d1ca9c&quot;</span>,
                                        <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>actor)</code></pre></div>
<p><img src="10_files/figure-html/unnamed-chunk-21-1.png" width="576" /></p>
<div id="overthinking-using-the-by-group_by-function." class="section level4">
<h4><span class="header-section-number">10.1.1.1</span> Overthinking: Using the <del>by</del> <code>group_by()</code> function.</h4>
<p>Let’s work within the tidyverse, instead. If you wanted to compute the proportion of trials <code>pulled_left == 1</code> for each combination of <code>prosoc_left</code>, <code>condition</code>, and chimp <code>actor</code>, you’d put those last three variables within <code>group_by()</code> and then compute the <code>mean()</code> of <code>pulled_left</code> within <code>summarise()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(prosoc_left, condition, actor) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="st">`</span><span class="dt">proportion pulled_left</span><span class="st">`</span> =<span class="st"> </span><span class="kw">mean</span>(pulled_left))</code></pre></div>
<pre><code>## # A tibble: 28 x 4
## # Groups:   prosoc_left, condition [4]
##    prosoc_left condition actor `proportion pulled_left`
##          &lt;int&gt;     &lt;int&gt; &lt;int&gt;                    &lt;dbl&gt;
##  1           0         0     1                    0.333
##  2           0         0     2                    1    
##  3           0         0     3                    0.278
##  4           0         0     4                    0.333
##  5           0         0     5                    0.333
##  6           0         0     6                    0.778
##  7           0         0     7                    0.778
##  8           0         1     1                    0.278
##  9           0         1     2                    1    
## 10           0         1     3                    0.167
## # … with 18 more rows</code></pre>
<p>And since we’re working within the tidyverse, that operation returns a tibble rather than a list.</p>
</div>
</div>
<div id="aggregated-binomial-chimpanzees-again-condensed." class="section level3">
<h3><span class="header-section-number">10.1.2</span> Aggregated binomial: Chimpanzees again, condensed.</h3>
<p>With the tidyverse, we use <code>group_by()</code> and <code>summarise()</code> to achieve what McElreath did with <code>aggregate()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d_aggregated &lt;-
<span class="st">  </span>d <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>recipient, <span class="op">-</span>block, <span class="op">-</span>trial, <span class="op">-</span>chose_prosoc) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(actor, condition, prosoc_left) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">x =</span> <span class="kw">sum</span>(pulled_left))

d_aggregated <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(actor <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</code></pre></div>
<pre><code>## # A tibble: 8 x 4
## # Groups:   actor, condition [4]
##   actor condition prosoc_left     x
##   &lt;int&gt;     &lt;int&gt;       &lt;int&gt; &lt;int&gt;
## 1     1         0           0     6
## 2     1         0           1     9
## 3     1         1           0     5
## 4     1         1           1    10
## 5     2         0           0    18
## 6     2         0           1    18
## 7     2         1           0    18
## 8     2         1           1    18</code></pre>
<p>To fit an aggregated binomial model in brms, we augment the <code>&lt;criterion&gt; | trials()</code> syntax where the value that goes in <code>trials()</code> is either a fixed number, as in this case, or variable in the data indexing <span class="math inline">\(n\)</span>. Either way, at least some of those trials will have an <span class="math inline">\(n &gt; 1\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b10.<span class="dv">5</span> &lt;-
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d_aggregated, <span class="dt">family =</span> binomial,
      x <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">18</span>) <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>prosoc_left <span class="op">+</span><span class="st"> </span>condition<span class="op">:</span>prosoc_left,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> b)),
      <span class="dt">iter =</span> <span class="dv">2500</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">cores =</span> <span class="dv">2</span>, <span class="dt">chains =</span> <span class="dv">2</span>, 
      <span class="dt">seed =</span> <span class="dv">10</span>)</code></pre></div>
<p>We might compare <code>b10.3</code> with <code>b10.5</code> like this.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fixef</span>(b10.<span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code>##                       Estimate Est.Error  Q2.5 Q97.5
## Intercept                 0.04      0.13 -0.20  0.29
## prosoc_left               0.63      0.23  0.19  1.07
## prosoc_left:condition    -0.12      0.27 -0.65  0.42</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fixef</span>(b10.<span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code>##                       Estimate Est.Error  Q2.5 Q97.5
## Intercept                 0.04      0.13 -0.21  0.29
## prosoc_left               0.61      0.23  0.18  1.06
## prosoc_left:condition    -0.09      0.26 -0.61  0.42</code></pre>
<p>A coefficient plot can offer a complimentary perspective.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(broom)

<span class="co"># wrangle</span>
<span class="kw">tibble</span>(<span class="dt">model  =</span> <span class="kw">str_c</span>(<span class="st">&quot;b10.&quot;</span>, <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">5</span>))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fit  =</span> <span class="kw">map</span>(model, get)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tidy =</span> <span class="kw">map</span>(fit, tidy)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unnest</span>(tidy) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(term <span class="op">!=</span><span class="st"> &quot;lp__&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="co"># plot</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="kw">aes</span>(<span class="dt">x =</span> model, <span class="dt">y =</span> estimate,
                      <span class="dt">ymin =</span> lower,
                      <span class="dt">ymax =</span> upper,
                      <span class="dt">color =</span> term),
                  <span class="dt">shape =</span> <span class="dv">16</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">4</span>)]) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>, <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.y    =</span> <span class="kw">element_blank</span>(),
        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>term, <span class="dt">ncol =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="10_files/figure-html/unnamed-chunk-25-1.png" width="432" /></p>
<p>The two are close within simulation error.</p>
</div>
<div id="aggregated-binomial-graduate-school-admissions." class="section level3">
<h3><span class="header-section-number">10.1.3</span> Aggregated binomial: Graduate school admissions.</h3>
<p>Load the infamous <code>UCBadmit</code> data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># detach(package:brms)</span>
<span class="kw">library</span>(rethinking)
<span class="kw">data</span>(UCBadmit)
d &lt;-<span class="st"> </span>UCBadmit</code></pre></div>
<p>Switch from rethinking to brms.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)
<span class="kw">library</span>(brms)
<span class="kw">rm</span>(UCBadmit)

d</code></pre></div>
<pre><code>##    dept applicant.gender admit reject applications
## 1     A             male   512    313          825
## 2     A           female    89     19          108
## 3     B             male   353    207          560
## 4     B           female    17      8           25
## 5     C             male   120    205          325
## 6     C           female   202    391          593
## 7     D             male   138    279          417
## 8     D           female   131    244          375
## 9     E             male    53    138          191
## 10    E           female    94    299          393
## 11    F             male    22    351          373
## 12    F           female    24    317          341</code></pre>
<p>Now compute our newly-constructed dummy variable, <code>male</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span>
<span class="st">  </span>d <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">male =</span> <span class="kw">ifelse</span>(applicant.gender <span class="op">==</span><span class="st"> &quot;male&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>))</code></pre></div>
<p>The univariable logistic model with <code>male</code> as the sole predictor of <code>admit</code> follows the form</p>
<span class="math display">\[\begin{align*}
n_{\text{admit}_i} &amp; \sim \text{Binomial} (n_i, p_i) \\
\text{logit} (p_i) &amp; = \alpha + \beta \text{male}_i \\
\alpha             &amp; \sim \text{Normal} (0, 10) \\
\beta              &amp; \sim \text{Normal} (0, 10)
\end{align*}\]</span>
<p>The second model omits the <code>male</code> predictor.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b10.<span class="dv">6</span> &lt;-
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> binomial,
      admit <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(applications) <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>male ,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> b)),
      <span class="dt">iter =</span> <span class="dv">2500</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">cores =</span> <span class="dv">2</span>, <span class="dt">chains =</span> <span class="dv">2</span>,
      <span class="dt">seed =</span> <span class="dv">10</span>) 

b10.<span class="dv">7</span> &lt;-
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> binomial,
      admit <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(applications) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,
      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),
      <span class="dt">iter =</span> <span class="dv">2500</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">cores =</span> <span class="dv">2</span>, <span class="dt">chains =</span> <span class="dv">2</span>,
      <span class="dt">seed =</span> <span class="dv">10</span>)</code></pre></div>
<p>Compute the information criteria for each model and save the results within the brmfit objects.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b10.<span class="dv">6</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b10.<span class="dv">6</span>, <span class="st">&quot;waic&quot;</span>)
b10.<span class="dv">7</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b10.<span class="dv">7</span>, <span class="st">&quot;waic&quot;</span>)</code></pre></div>
<p>Here’s the WAIC comparison.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">w &lt;-<span class="st"> </span><span class="kw">loo_compare</span>(b10.<span class="dv">6</span>, b10.<span class="dv">7</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>)

<span class="kw">print</span>(w, <span class="dt">simplify =</span> F)</code></pre></div>
<pre><code>##       elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
## b10.6    0.0       0.0  -496.2     163.8        112.9   40.4     992.5  327.6 
## b10.7  -29.7      82.1  -525.9     164.8         86.3   37.6    1051.8  329.7</code></pre>
<p>If you prefer the difference in the WAIC metric, use our <code>cbind()</code> conversion method from above.</p>
<p><strong>Bonus: Information criteria digression.</strong></p>
<p>Let’s see what happens if we switch to the LOO.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b10.<span class="dv">6</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b10.<span class="dv">6</span>, <span class="st">&quot;loo&quot;</span>)</code></pre></div>
<pre><code>## Warning: Found 7 observations with a pareto_k &gt; 0.7 in model &#39;b10.6&#39;. It is recommended to set &#39;reloo = TRUE&#39;
## in order to calculate the ELPD without the assumption that these observations are negligible. This will refit
## the model 7 times to compute the ELPDs for the problematic observations directly.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b10.<span class="dv">7</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b10.<span class="dv">7</span>, <span class="st">&quot;loo&quot;</span>)</code></pre></div>
<pre><code>## Warning: Found 4 observations with a pareto_k &gt; 0.7 in model &#39;b10.7&#39;. It is recommended to set &#39;reloo = TRUE&#39;
## in order to calculate the ELPD without the assumption that these observations are negligible. This will refit
## the model 4 times to compute the ELPDs for the problematic observations directly.</code></pre>
<p>If you just ape the text and use the WAIC, everything appears fine. But holy smokes look at those nasty warning messages from the <code>loo()</code>! One of the frightening but ultimately handy things about working with the PSIS-LOO is that it requires we estimate a Pareto <span class="math inline">\(k\)</span> parameter, which you can learn all about in the <code>loo-package</code> section of the <a href="https://cran.r-project.org/web/packages/loo/loo.pdf">loo reference manual</a>. As it turns out, the Pareto <span class="math inline">\(k\)</span> <a href="https://cran.r-project.org/web/packages/loo/vignettes/loo2-example.html#plotting-pareto-k-diagnostics">can be used as a diagnostic tool</a>. Each case in the data gets its own <span class="math inline">\(k\)</span> value and we like it when those <span class="math inline">\(k\)</span>s are low. The makers of the loo package get worried when those <span class="math inline">\(k\)</span>s exceed 0.7 and as a result, <code>loo()</code> spits out a warning message when they do.</p>
<p>First things first, if you explicitly open the loo package, you’ll have access to some handy diagnostic functions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(loo)</code></pre></div>
<p>We’ll be leveraging those <span class="math inline">\(k\)</span> values with the <code>pareto_k_table()</code> and <code>pareto_k_ids()</code> functions. Both functions take objects created by the <code>loo()</code> or <code>psis()</code> functions. So, before we can get busy, we’ll first make two objects with the <code>loo()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">l_b10.<span class="dv">6</span> &lt;-<span class="st"> </span><span class="kw">loo</span>(b10.<span class="dv">6</span>)</code></pre></div>
<pre><code>## Warning: Found 7 observations with a pareto_k &gt; 0.7 in model &#39;b10.6&#39;. It is recommended to set &#39;reloo = TRUE&#39;
## in order to calculate the ELPD without the assumption that these observations are negligible. This will refit
## the model 7 times to compute the ELPDs for the problematic observations directly.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">l_b10.<span class="dv">7</span> &lt;-<span class="st"> </span><span class="kw">loo</span>(b10.<span class="dv">7</span>)</code></pre></div>
<pre><code>## Warning: Found 4 observations with a pareto_k &gt; 0.7 in model &#39;b10.7&#39;. It is recommended to set &#39;reloo = TRUE&#39;
## in order to calculate the ELPD without the assumption that these observations are negligible. This will refit
## the model 4 times to compute the ELPDs for the problematic observations directly.</code></pre>
<p>There are those warning messages, again. Using the loo-object for model <code>b10.6</code>, which we’ve named <code>l_b10.6</code>, let’s take a look at the <code>pareto_k_table()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pareto_k_table</span>(l_b10.<span class="dv">6</span>) </code></pre></div>
<pre><code>## Pareto k diagnostic values:
##                          Count Pct.    Min. n_eff
## (-Inf, 0.5]   (good)     4     33.3%   635       
##  (0.5, 0.7]   (ok)       1      8.3%   391       
##    (0.7, 1]   (bad)      2     16.7%   90        
##    (1, Inf)   (very bad) 5     41.7%   2</code></pre>
<p>You may have noticed that this same table pops out when you just do something like <code>loo(b10.6)</code>. Recall that this data set has 12 observations (i.e., execute <code>count(d)</code>). With <code>pareto_k_table()</code>, we see how the Pareto <span class="math inline">\(k\)</span> values have been categorized into bins ranging from “good” to “very bad”. Clearly, we like nice and low <span class="math inline">\(k\)</span>s. In this example, our observations are all over the place, with 5 in the “bad” <span class="math inline">\(k\)</span> range We can take a closer look like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(l_b10.<span class="dv">6</span>)</code></pre></div>
<p><img src="10_files/figure-html/unnamed-chunk-35-1.png" width="432" /></p>
<p>So when you <code>plot()</code> a loo object, you get a nice diagnostic plot for those <span class="math inline">\(k\)</span> values, ordered by observation number. Our plot indicates cases 1, 2, 3, 11, and 12 had “very bad” <span class="math inline">\(k\)</span> values for this model. If we wanted to further verify to ourselves which observations those were, we’d use the <code>pareto_k_ids()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pareto_k_ids</span>(l_b10.<span class="dv">6</span>, <span class="dt">threshold =</span> <span class="dv">1</span>)</code></pre></div>
<pre><code>## [1]  1  2  3 11 12</code></pre>
<p>Note our use of the <code>threshold</code> argument. Play around with it to see how it works.</p>
<p>If you want an explicit look at those <span class="math inline">\(k\)</span> values, you do:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">l_b10.<span class="dv">6</span><span class="op">$</span>diagnostics</code></pre></div>
<pre><code>## $pareto_k
##  [1] 2.29760490 1.02057506 1.58539693 0.04789929 0.42364825 0.61818010 0.78376601 0.41292102 0.47109654
## [10] 0.72698486 2.18412716 1.85392099
## 
## $n_eff
##  [1]    1.875425   45.003615    3.370704 3160.753814 1051.252892  391.491348   89.731920 1145.574819
##  [9]  635.209403  258.696950    3.503268    7.730014</code></pre>
<p>The <code>pareto_k</code> values can be used to examine cases that are overly-influential on the model parameters, something like a Cook’s <span class="math inline">\(D_{i}\)</span>. See, for example <a href="https://stackoverflow.com/questions/39578834/linear-model-diagnostics-for-bayesian-models-using-rstan/39595436">this discussion on stackoverflow.com</a> in which several members of the <a href="http://mc-stan.org">Stan team</a> weighed in. The issue is also discussed in <a href="https://arxiv.org/abs/1507.04544">this paper</a> and in <a href="https://www.youtube.com/watch?v=FUROJM3u5HQ&amp;feature=youtu.be&amp;a=">this presentation by Aki Vehtari</a>.</p>
<p>Anyway, the implication of all this is these values suggest model <code>b10.6</code> isn’t a great fit for these data.</p>
<p>Part of the warning message for model <code>b10.6</code> read:</p>
<blockquote>
<p>It is recommended to set ‘reloo = TRUE’ in order to calculate the ELPD without the assumption that these observations are negligible. This will refit the model [<span class="math inline">\(n\)</span>] times to compute the ELPDs for the problematic observations directly.</p>
</blockquote>
<p>Let’s do that.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">l_b10.6_reloo &lt;-<span class="st"> </span><span class="kw">loo</span>(b10.<span class="dv">6</span>, <span class="dt">reloo =</span> T)</code></pre></div>
<p>Check the results.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">l_b10.6_reloo</code></pre></div>
<pre><code>## 
## Computed from 4000 by 12 log-likelihood matrix
## 
##          Estimate    SE
## elpd_loo   -518.2 170.5
## p_loo       134.9  51.9
## looic      1036.4 341.1
## ------
## Monte Carlo SE of elpd_loo is NA.
## 
## Pareto k diagnostic values:
##                          Count Pct.    Min. n_eff
## (-Inf, 0.5]   (good)     11    91.7%   2         
##  (0.5, 0.7]   (ok)        1     8.3%   391       
##    (0.7, 1]   (bad)       0     0.0%   &lt;NA&gt;      
##    (1, Inf)   (very bad)  0     0.0%   &lt;NA&gt;      
## 
## All Pareto k estimates are ok (k &lt; 0.7).
## See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<p>Now that looks better. We’ll do the same thing for model <code>b10.7</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">l_b10.7_reloo &lt;-<span class="st"> </span><span class="kw">loo</span>(b10.<span class="dv">7</span>, <span class="dt">reloo =</span> T)</code></pre></div>
<p>Okay, let’s compare models with formal <span class="math inline">\(\text{elpd}_{\text{loo}}\)</span> differences before and after adjusting with <code>reloo = T</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">loo_compare</span>(l_b10.<span class="dv">6</span>, l_b10.<span class="dv">7</span>)</code></pre></div>
<pre><code>##       elpd_diff se_diff
## b10.6   0.0       0.0  
## b10.7 -27.3      76.8</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">loo_compare</span>(l_b10.6_reloo, l_b10.7_reloo)</code></pre></div>
<pre><code>##       elpd_diff se_diff
## b10.6   0.0       0.0  
## b10.7 -12.2      81.3</code></pre>
<p>In this case, the results are kinda similar. The standard errors for the differences are huge compared to the point estimates, suggesting large uncertainty. Watch out for this in your real-world data.</p>
<p>But this has all been a tangent from the central thrust of this section.</p>
<p><strong>Back from our information criteria digression.</strong></p>
<p>Let’s get back on track with the text. Here’s a look at <code>b10.6</code>, the unavailable model:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b10.<span class="dv">6</span>)</code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: admit | trials(applications) ~ 1 + male 
##    Data: d (Number of observations: 12) 
## Samples: 2 chains, each with iter = 2500; warmup = 500; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept    -0.83      0.05    -0.93    -0.73       1929 1.00
## male          0.61      0.06     0.48     0.74       2527 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Here’s the relative difference in admission odds.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fixef</span>(b10.<span class="dv">6</span>)[<span class="dv">2</span>] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">exp</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code>## [1] 1.84</code></pre>
<p>And now we’ll compute difference in admission probabilities.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(b10.<span class="dv">6</span>)

post <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">p_admit_male   =</span> <span class="kw">inv_logit_scaled</span>(b_Intercept <span class="op">+</span><span class="st"> </span>b_male),
         <span class="dt">p_admit_female =</span> <span class="kw">inv_logit_scaled</span>(b_Intercept),
         <span class="dt">diff_admit     =</span> p_admit_male <span class="op">-</span><span class="st"> </span>p_admit_female) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="st">`</span><span class="dt">2.5%</span><span class="st">`</span>  =<span class="st"> </span><span class="kw">quantile</span>(diff_admit, <span class="dt">probs =</span> .<span class="dv">025</span>),
            <span class="st">`</span><span class="dt">50%</span><span class="st">`</span>   =<span class="st"> </span><span class="kw">median</span>(diff_admit),
            <span class="st">`</span><span class="dt">97.5%</span><span class="st">`</span> =<span class="st"> </span><span class="kw">quantile</span>(diff_admit, <span class="dt">probs =</span> .<span class="dv">975</span>))</code></pre></div>
<pre><code>##        2.5%       50%     97.5%
## 1 0.1125269 0.1414872 0.1705231</code></pre>
<p>Instead of the <code>summarise()</code> code, we could have also used <code>tidybayes::median_qi(diff_admit)</code>. It’s good to have options. Here’s our version of Figure 10.5.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-
<span class="st">  </span>d <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">case =</span> <span class="kw">factor</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>))

p &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">predict</span>(b10.<span class="dv">6</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">bind_cols</span>(d)

d_text &lt;-
<span class="st">  </span>d <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(dept) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">case  =</span> <span class="kw">mean</span>(<span class="kw">as.numeric</span>(case)),
            <span class="dt">admit =</span> <span class="kw">mean</span>(admit <span class="op">/</span><span class="st"> </span>applications) <span class="op">+</span><span class="st"> </span>.<span class="dv">05</span>)

<span class="kw">ggplot</span>(<span class="dt">data =</span> d, <span class="kw">aes</span>(<span class="dt">x =</span> case, <span class="dt">y =</span> admit <span class="op">/</span><span class="st"> </span>applications)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="dt">data =</span> p, 
                  <span class="kw">aes</span>(<span class="dt">y    =</span> Estimate <span class="op">/</span><span class="st"> </span>applications,
                      <span class="dt">ymin =</span> Q2.<span class="dv">5</span>     <span class="op">/</span><span class="st"> </span>applications ,
                      <span class="dt">ymax =</span> Q97.<span class="dv">5</span>    <span class="op">/</span><span class="st"> </span>applications),
                  <span class="dt">color =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">1</span>],
                  <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">2</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> dept),
            <span class="dt">color =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">2</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> d_text,
            <span class="kw">aes</span>(<span class="dt">y =</span> admit, <span class="dt">label =</span> dept),
            <span class="dt">color =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">2</span>],
            <span class="dt">family =</span> <span class="st">&quot;serif&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">y     =</span> <span class="st">&quot;Proportion admitted&quot;</span>,
       <span class="dt">title =</span> <span class="st">&quot;Posterior validation check&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.x =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="10_files/figure-html/unnamed-chunk-43-1.png" width="384" /></p>
<p>As alluded to in all that LOO/<code>pareto_k</code> talk, above, this is not a great fit. So we’ll ditch the last model paradigm for one that answers the new question “<em>What is the average difference in probability of admission between females and males within departments?</em>” (p. 307). The statistical formula for the full model follows the form</p>
<span class="math display">\[\begin{align*}
n_{\text{admit}_i}   &amp; \sim \text{Binomial} (n_i, p_i) \\
\text{logit} (p_i)   &amp; = \alpha_{\text{dept}_i} + \beta \text{male}_i \\
\alpha_{\text{dept}} &amp; \sim \text{Normal} (0, 10) \\
\beta                &amp; \sim \text{Normal} (0, 10)
\end{align*}\]</span>
<p>We don’t need to coerce an index like McElreath did in the text. But here are the models.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b10.<span class="dv">8</span> &lt;-
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> binomial,
      admit <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(applications) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>dept,
      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> b),
      <span class="dt">iter =</span> <span class="dv">2500</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">cores =</span> <span class="dv">2</span>, <span class="dt">chains =</span> <span class="dv">2</span>,
      <span class="dt">seed =</span> <span class="dv">10</span>) 

b10.<span class="dv">9</span> &lt;-
<span class="st">  </span><span class="kw">update</span>(b10.<span class="dv">8</span>,
         <span class="dt">newdata =</span> d,
         <span class="dt">formula =</span> admit <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(applications) <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>dept <span class="op">+</span><span class="st"> </span>male)</code></pre></div>
<p>Let’s make two more <code>loo()</code> objects using <code>reloo = T</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">l_b10.8_reloo &lt;-<span class="st"> </span><span class="kw">loo</span>(b10.<span class="dv">8</span>, <span class="dt">reloo =</span> T)
l_b10.9_reloo &lt;-<span class="st"> </span><span class="kw">loo</span>(b10.<span class="dv">9</span>, <span class="dt">reloo =</span> T)</code></pre></div>
<p>Now compare them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">loo_compare</span>(l_b10.6_reloo, l_b10.7_reloo, l_b10.8_reloo, l_b10.9_reloo)</code></pre></div>
<pre><code>##       elpd_diff se_diff
## b10.8    0.0       0.0 
## b10.9   -4.2       2.7 
## b10.6 -453.7     166.2 
## b10.7 -465.9     160.6</code></pre>
<p>Here are the LOO weights.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">model_weights</span>(b10.<span class="dv">6</span>, b10.<span class="dv">7</span>, b10.<span class="dv">8</span>, b10.<span class="dv">9</span>,
              <span class="dt">weights =</span> <span class="st">&quot;loo&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</code></pre></div>
<pre><code>## b10.6 b10.7 b10.8 b10.9 
## 0.000 0.000 0.877 0.123</code></pre>
<p>The parameters summaries for our multivariable model, <code>b10.9</code>, look like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fixef</span>(b10.<span class="dv">9</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code>##       Estimate Est.Error  Q2.5 Q97.5
## deptA     0.68      0.10  0.49  0.87
## deptB     0.64      0.11  0.42  0.87
## deptC    -0.58      0.07 -0.72 -0.44
## deptD    -0.61      0.09 -0.78 -0.45
## deptE    -1.06      0.10 -1.26 -0.87
## deptF    -2.64      0.16 -2.96 -2.33
## male     -0.10      0.08 -0.25  0.05</code></pre>
<p>And on the proportional odds scale, the posterior mean for <code>b_male</code> is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fixef</span>(b10.<span class="dv">9</span>)[<span class="dv">7</span>, <span class="dv">1</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">exp</span>()</code></pre></div>
<pre><code>## [1] 0.9033437</code></pre>
<p>Since we’ve been using brms, there’s no need to fit our version of McElreath’s <code>m10.9stan</code>. We already have that in our <code>b10.9</code>. But just for kicks and giggles, here’s another way to get the model summary.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b10.<span class="dv">9</span><span class="op">$</span>fit</code></pre></div>
<pre><code>## Inference for Stan model: a56936c0ede77895dee7937133dd0dcd.
## 2 chains, each with iter=2500; warmup=500; thin=1; 
## post-warmup draws per chain=2000, total post-warmup draws=4000.
## 
##           mean se_mean   sd   2.5%    25%    50%    75%  97.5% n_eff Rhat
## b_deptA   0.68    0.00 0.10   0.49   0.62   0.69   0.75   0.87  2186    1
## b_deptB   0.64    0.00 0.11   0.42   0.57   0.64   0.72   0.87  2236    1
## b_deptC  -0.58    0.00 0.07  -0.72  -0.63  -0.58  -0.53  -0.44  3125    1
## b_deptD  -0.61    0.00 0.09  -0.78  -0.67  -0.61  -0.55  -0.45  3391    1
## b_deptE  -1.06    0.00 0.10  -1.26  -1.13  -1.06  -0.99  -0.87  3372    1
## b_deptF  -2.64    0.00 0.16  -2.96  -2.74  -2.63  -2.52  -2.33  4162    1
## b_male   -0.10    0.00 0.08  -0.25  -0.16  -0.10  -0.05   0.05  1858    1
## lp__    -70.67    0.05 1.91 -75.16 -71.69 -70.30 -69.28 -68.02  1605    1
## 
## Samples were drawn using NUTS(diag_e) at Sat May  4 13:20:48 2019.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<p>Here’s our version of Figure 10.6, the posterior validation check.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">predict</span>(b10.<span class="dv">9</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">bind_cols</span>(d) <span class="op">%&gt;%</span><span class="st"> </span>

<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> case, <span class="dt">y =</span> admit <span class="op">/</span><span class="st"> </span>applications)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="kw">aes</span>(<span class="dt">y    =</span> Estimate <span class="op">/</span><span class="st"> </span>applications,
                      <span class="dt">ymin =</span> Q2.<span class="dv">5</span>     <span class="op">/</span><span class="st"> </span>applications ,
                      <span class="dt">ymax =</span> Q97.<span class="dv">5</span>    <span class="op">/</span><span class="st"> </span>applications),
                  <span class="dt">color =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">1</span>],
                  <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">2</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> dept),
            <span class="dt">color =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">2</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> d_text,
            <span class="kw">aes</span>(<span class="dt">y =</span> admit, <span class="dt">label =</span> dept),
            <span class="dt">color =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">2</span>],
            <span class="dt">family =</span> <span class="st">&quot;serif&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">y     =</span> <span class="st">&quot;Proportion admitted&quot;</span>,
       <span class="dt">title =</span> <span class="st">&quot;Posterior validation check&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.x =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="10_files/figure-html/unnamed-chunk-49-1.png" width="384" /></p>
<p>The model precisions are imperfect, but way more valid than before. The posterior looks reasonably multivariate Gaussian.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pairs</span>(b10.<span class="dv">9</span>,
      <span class="dt">off_diag_args =</span> <span class="kw">list</span>(<span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">6</span>))</code></pre></div>
<p><img src="10_files/figure-html/unnamed-chunk-50-1.png" width="720" /></p>
<div id="overthinking-waic-and-aggregated-binomial-models." class="section level4">
<h4><span class="header-section-number">10.1.3.1</span> Overthinking: WAIC and aggregated binomial models.</h4>
<p>McElreath wrote:</p>
<blockquote>
<p>The <code>WAIC</code> function in <code>rethinking</code> detects aggregated binomial models and automatically splits them apart into 0/1 Bernoulli trials, for the purpose of calculating WAIC. It does this, because WAIC is computed point by point (see Chapter 6). So what you define as a “point” affects WAIC’s value. In an aggregated binomial each “point” is a bunch of independent trials that happen to share the same predictor values. In order for the disaggregated and aggregated models to agree, it makes sense to use the disaggregated representation. (p. 309)</p>
</blockquote>
<p>To my knowledge, <code>brms::waic()</code> and <code>brms::loo()</code> do not do this, which might well be why some of our values didn’t match up with those in the text. If you have additional insight on this, please <a href="https://github.com/ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse/issues">share with the rest of the class</a>.</p>
</div>
</div>
<div id="fitting-binomial-regressions-with-glm." class="section level3">
<h3><span class="header-section-number">10.1.4</span> Fitting binomial regressions with <code>glm()</code>.</h3>
<p>We’re not here to learn frequentist code, so we’re going to skip most of this section. But model <code>b.good</code> is worth fitting. Here are the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># outcome and predictor almost perfectly associated</span>
y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">10</span>))
x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">9</span>), <span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">11</span>))</code></pre></div>
<p>Fit the <code>b.good</code> model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b.good &lt;-
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">y =</span> y, <span class="dt">x =</span> x), <span class="dt">family =</span> binomial,
      y <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> b)),
      <span class="dt">seed =</span> <span class="dv">10</span>) </code></pre></div>
<p>Our model summary will differ a bit from the one in the text. It seems this is because of the MAP/HMC contrast and our choice of priors.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b.good)</code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: y ~ 1 + x 
##    Data: list(y = y, x = x) (Number of observations: 20) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept    -5.34      4.24   -15.14     0.43        530 1.01
## x             8.07      4.23     2.47    18.06        532 1.01
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>You might experiment with different prior <span class="math inline">\(SD\)</span>s to see how they influence the posterior <span class="math inline">\(SD\)</span>s. Anyways, here’s the <code>pairs()</code> plot McElreath excluded from the text.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pairs</span>(b.good,
      <span class="dt">off_diag_args =</span> <span class="kw">list</span>(<span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">6</span>))</code></pre></div>
<p><img src="10_files/figure-html/unnamed-chunk-53-1.png" width="312" /></p>
<p>That posterior, my friends, is not multivariate Gaussian. The plot deserves and extensive quote from McElreath.</p>
<blockquote>
<p>Inspecting the pairs plot (<del>not</del> shown) demonstrates just how subtle even simple models can be, once we start working with GLMs. I don’t say this to scare the reader. But it’s true that even simple models can behave in complicated ways. How you fit the model is part of the model, and in principle no GLM is safe for MAP estimation. (p. 311)</p>
</blockquote>
</div>
</div>
<div id="poisson-regression" class="section level2">
<h2><span class="header-section-number">10.2</span> Poisson regression</h2>
<p>We’ll simulate our sweet count data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">10</span>) <span class="co"># make the results reproducible</span>

<span class="kw">tibble</span>(<span class="dt">y =</span> <span class="kw">rbinom</span>(<span class="fl">1e5</span>, <span class="dv">1000</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">1000</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">y_mean     =</span> <span class="kw">mean</span>(y),
            <span class="dt">y_variance =</span> <span class="kw">var</span>(y))</code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   y_mean y_variance
##    &lt;dbl&gt;      &lt;dbl&gt;
## 1  0.994      0.995</code></pre>
<p>Yes, those statistics are virtually the same. When dealing with Poisson data, <span class="math inline">\(\mu = \sigma^2\)</span>. When you have a number of trials for which <span class="math inline">\(n\)</span> is unknown or much larger than seen in the data, the Poisson likelihood is a useful tool. We define it like this</p>
<p><span class="math display">\[y \sim \text{Poisson} (\lambda)\]</span></p>
<p>As <span class="math inline">\(\lambda\)</span> expresses both mean and variance because, within this model, the variance scales right along with the mean. Since <span class="math inline">\(\lambda\)</span> is constrained to be positive, we typically use the log link. Thus the basic Poisson regression model is</p>
<span class="math display">\[\begin{align*}
y_i                    &amp; \sim \text{Poisson} (\lambda_i) \\
\text{log} (\lambda_i) &amp; = \alpha + \beta x_i
\end{align*}\]</span>
<div id="example-oceanic-tool-complexity." class="section level3">
<h3><span class="header-section-number">10.2.1</span> Example: Oceanic tool complexity.</h3>
<p>Load the <code>Kline</code> data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rethinking)
<span class="kw">data</span>(Kline)
d &lt;-<span class="st"> </span>Kline</code></pre></div>
<p>Switch from rethinking to brms.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)
<span class="kw">library</span>(brms)
<span class="kw">rm</span>(Kline)

d</code></pre></div>
<pre><code>##       culture population contact total_tools mean_TU
## 1    Malekula       1100     low          13     3.2
## 2     Tikopia       1500     low          22     4.7
## 3  Santa Cruz       3600     low          24     4.0
## 4         Yap       4791    high          43     5.0
## 5    Lau Fiji       7400    high          33     5.0
## 6   Trobriand       8000    high          19     4.0
## 7       Chuuk       9200    high          40     3.8
## 8       Manus      13000     low          28     6.6
## 9       Tonga      17500    high          55     5.4
## 10     Hawaii     275000     low          71     6.6</code></pre>
<p>Here are our new columns.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-
<span class="st">  </span>d <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">log_pop      =</span> <span class="kw">log</span>(population),
         <span class="dt">contact_high =</span> <span class="kw">ifelse</span>(contact <span class="op">==</span><span class="st"> &quot;high&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>))</code></pre></div>
<p>Our statistical model will follow the form</p>
<span class="math display">\[\begin{align*}
\text{total_tools}_i   &amp; \sim \text{Poisson} (\lambda_i) \\
\text{log} (\lambda_i) &amp; = \alpha + \beta_1 \text{log_pop}_i + \beta_2 \text{contact_high}_i + \beta_3 \text{contact_high}_i \times \text{log_pop}_i \\
\alpha  &amp; \sim \text{Normal} (0, 100) \\
\beta_1 &amp; \sim \text{Normal} (0, 1) \\
\beta_2 &amp; \sim \text{Normal} (0, 1) \\
\beta_3 &amp; \sim \text{Normal} (0, 1)
\end{align*}\]</span>
<p>The only new thing in our model code is <code>family = poisson</code>. brms defaults to the <code>log()</code> link.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b10.<span class="dv">10</span> &lt;-
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> poisson,
      total_tools <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>log_pop <span class="op">+</span><span class="st"> </span>contact_high <span class="op">+</span><span class="st"> </span>contact_high<span class="op">:</span>log_pop,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b)),
      <span class="dt">iter =</span> <span class="dv">3000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,
      <span class="dt">seed =</span> <span class="dv">10</span>) </code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b10.<span class="dv">10</span>)</code></pre></div>
<pre><code>##  Family: poisson 
##   Links: mu = log 
## Formula: total_tools ~ 1 + log_pop + contact_high + contact_high:log_pop 
##    Data: d (Number of observations: 10) 
## Samples: 4 chains, each with iter = 3000; warmup = 1000; thin = 1;
##          total post-warmup samples = 8000
## 
## Population-Level Effects: 
##                      Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept                0.94      0.35     0.24     1.63       4087 1.00
## log_pop                  0.26      0.03     0.20     0.33       4331 1.00
## contact_high            -0.11      0.84    -1.74     1.53       3115 1.00
## log_pop:contact_high     0.04      0.09    -0.14     0.22       3080 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Here’s the lower triangle of the correlation matrix for the parameters.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">post &lt;-
<span class="st">  </span><span class="kw">posterior_samples</span>(b10.<span class="dv">10</span>)

post <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>lp__) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">b_interaction =</span> <span class="st">`</span><span class="dt">b_log_pop:contact_high</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>psych<span class="op">::</span><span class="kw">lowerCor</span>()</code></pre></div>
<pre><code>##                b_Int b_lg_ b_cn_ b_ntr
## b_Intercept     1.00                  
## b_log_pop      -0.97  1.00            
## b_contact_high -0.12  0.11  1.00      
## b_interaction   0.06 -0.07 -0.99  1.00</code></pre>
<p>And here’s the coefficient plot via <code>bayesplot::mcmc_intervals()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># we&#39;ll set a renewed color theme</span>
<span class="kw">color_scheme_set</span>(<span class="kw">c</span>(<span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">2</span>],
                   <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">1</span>], 
                   <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">4</span>], 
                   <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">2</span>], 
                   <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">1</span>], 
                   <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">1</span>]))

post <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>lp__) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">b_interaction =</span> <span class="st">`</span><span class="dt">b_log_pop:contact_high</span><span class="st">`</span>) <span class="op">%&gt;%</span>

<span class="st">  </span><span class="kw">mcmc_intervals</span>(<span class="dt">prob =</span> .<span class="dv">5</span>, <span class="dt">prob_outer =</span> .<span class="dv">95</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.text.y  =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>))</code></pre></div>
<p><img src="10_files/figure-html/unnamed-chunk-60-1.png" width="768" /></p>
<p>How plausible is it a high-contact island will have more tools than a low-contact island?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">post &lt;-
<span class="st">  </span>post <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lambda_high =</span> <span class="kw">exp</span>(b_Intercept <span class="op">+</span><span class="st"> </span>b_contact_high <span class="op">+</span><span class="st"> </span>(b_log_pop <span class="op">+</span><span class="st"> `</span><span class="dt">b_log_pop:contact_high</span><span class="st">`</span>) <span class="op">*</span><span class="st"> </span><span class="dv">8</span>),
         <span class="dt">lambda_low  =</span> <span class="kw">exp</span>(b_Intercept <span class="op">+</span><span class="st"> </span>b_log_pop <span class="op">*</span><span class="st"> </span><span class="dv">8</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">diff        =</span> lambda_high <span class="op">-</span><span class="st"> </span>lambda_low) 

post <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">sum =</span> <span class="kw">sum</span>(diff <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(diff))</code></pre></div>
<pre><code>##       sum
## 1 0.95525</code></pre>
<p>Quite, it turns out. Behold the corresponding Figure 10.8.a.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">post <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> diff)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>,
               <span class="dt">fill =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">1</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">linetype =</span> <span class="dv">2</span>,
             <span class="dt">color =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">2</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;lambda_high - lambda_low&quot;</span>)</code></pre></div>
<p><img src="10_files/figure-html/unnamed-chunk-62-1.png" width="288" /></p>
<p>I’m not happy with how clunky this solution is, but one way to get those marginal dot and line plots for the axes is to make intermediary tibbles. Anyway, here’s a version of Figure 10.8.b.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># intermediary tibbles for our the dot and line portoin of the plot</span>
point_tibble &lt;-
<span class="st">  </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="kw">median</span>(post<span class="op">$</span>b_contact_high), <span class="kw">min</span>(post<span class="op">$</span>b_contact_high)),
         
         <span class="dt">y =</span> <span class="kw">c</span>(<span class="kw">min</span>(post<span class="op">$</span><span class="st">`</span><span class="dt">b_log_pop:contact_high</span><span class="st">`</span>), <span class="kw">median</span>(post<span class="op">$</span><span class="st">`</span><span class="dt">b_log_pop:contact_high</span><span class="st">`</span>)))

line_tibble &lt;-
<span class="st">  </span><span class="kw">tibble</span>(<span class="dt">parameter =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;b_contact_high&quot;</span>, <span class="st">&quot;b_log_pop:contact_high&quot;</span>), <span class="dt">each =</span> <span class="dv">2</span>),
         
         <span class="dt">x =</span> <span class="kw">c</span>(<span class="kw">quantile</span>(post<span class="op">$</span>b_contact_high, <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">025</span>, .<span class="dv">975</span>)),
               <span class="kw">rep</span>(<span class="kw">min</span>(post<span class="op">$</span>b_contact_high), <span class="dt">times =</span> <span class="dv">2</span>)),
         
         <span class="dt">y =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="kw">min</span>(post<span class="op">$</span><span class="st">`</span><span class="dt">b_log_pop:contact_high</span><span class="st">`</span>), <span class="dt">times =</span> <span class="dv">2</span>),
               <span class="kw">quantile</span>(post<span class="op">$</span><span class="st">`</span><span class="dt">b_log_pop:contact_high</span><span class="st">`</span>, <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">025</span>, .<span class="dv">975</span>))))

<span class="co"># the plot</span>
post <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> b_contact_high, <span class="dt">y =</span> <span class="st">`</span><span class="dt">b_log_pop:contact_high</span><span class="st">`</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">1</span>],
             <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> point_tibble,
             <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> line_tibble,
            <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">group =</span> parameter))</code></pre></div>
<p><img src="10_files/figure-html/unnamed-chunk-63-1.png" width="288" /></p>
<p>Here we deconstruct model <code>b10.10</code>, bit by bit.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># no interaction</span>
b10.<span class="dv">11</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">update</span>(b10.<span class="dv">10</span>, <span class="dt">formula =</span> total_tools <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>log_pop <span class="op">+</span><span class="st"> </span>contact_high)

<span class="co"># no contact rate</span>
b10.<span class="dv">12</span> &lt;-
<span class="st">  </span><span class="kw">update</span>(b10.<span class="dv">10</span>, <span class="dt">formula =</span> total_tools <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>log_pop)

<span class="co"># no log-population</span>
b10.<span class="dv">13</span> &lt;-
<span class="st">  </span><span class="kw">update</span>(b10.<span class="dv">10</span>, <span class="dt">formula =</span> total_tools <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>contact_high)

<span class="co"># intercept only</span>
b10.<span class="dv">14</span> &lt;-
<span class="st">  </span><span class="kw">update</span>(b10.<span class="dv">10</span>, <span class="dt">formula =</span> total_tools <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,
         <span class="dt">seed =</span> <span class="dv">10</span>)</code></pre></div>
<p>I know we got all excited with the LOO, above. Let’s just be lazy and go WAIC. [Though beware, the LOO opens up a similar can of worms, here.]</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b10.<span class="dv">10</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b10.<span class="dv">10</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>)
b10.<span class="dv">11</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b10.<span class="dv">11</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>)
b10.<span class="dv">12</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b10.<span class="dv">12</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>)
b10.<span class="dv">13</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b10.<span class="dv">13</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>)
b10.<span class="dv">14</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b10.<span class="dv">14</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>)</code></pre></div>
<p>Now compare them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">w &lt;-<span class="st"> </span><span class="kw">loo_compare</span>(b10.<span class="dv">10</span>, b10.<span class="dv">11</span>, b10.<span class="dv">12</span>, b10.<span class="dv">13</span>, b10.<span class="dv">14</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>)

<span class="kw">cbind</span>(<span class="dt">waic_diff =</span> w[, <span class="dv">1</span>] <span class="op">*</span><span class="st"> </span><span class="op">-</span><span class="dv">2</span>,
      <span class="dt">se        =</span> w[, <span class="dv">2</span>] <span class="op">*</span><span class="st">  </span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code>##        waic_diff    se
## b10.11      0.00  0.00
## b10.10      0.75  1.35
## b10.12      4.86  8.29
## b10.14     62.07 34.55
## b10.13     71.30 47.08</code></pre>
<p>Let’s get those WAIC weights, too.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">model_weights</span>(b10.<span class="dv">10</span>, b10.<span class="dv">11</span>, b10.<span class="dv">12</span>, b10.<span class="dv">13</span>, b10.<span class="dv">14</span>, <span class="dt">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code>## b10.10 b10.11 b10.12 b10.13 b10.14 
##   0.39   0.56   0.05   0.00   0.00</code></pre>
<p>Now wrangle <code>w</code> a little and make the WAIC plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">w <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rownames_to_column</span>(<span class="dt">var =</span> <span class="st">&quot;model&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(model, <span class="op">-</span>waic), 
             <span class="dt">y    =</span> waic,
             <span class="dt">ymin =</span> waic <span class="op">-</span><span class="st"> </span>se_waic,
             <span class="dt">ymax =</span> waic <span class="op">+</span><span class="st"> </span>se_waic,
             <span class="dt">color =</span> model)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="dt">shape =</span> <span class="dv">16</span>, <span class="dt">show.legend =</span> F) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)]) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>, <span class="dt">y =</span> <span class="ot">NULL</span>,
       <span class="dt">title =</span> <span class="st">&quot;WAIC&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.y    =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="10_files/figure-html/unnamed-chunk-66-1.png" width="432" /></p>
<p>Here’s our version of Figure 10.9. Recall, to do an “ensemble” posterior prediction in brms, one uses the <code>pp_average()</code> function. I know we were just lazy and focused on the WAIC. But let’s play around, a bit. Here we’ll weight the models based on the LOO by adding a <code>weights = &quot;loo&quot;</code> argument to the <code>pp_average()</code> function. If you check the corresponding section of the <a href="https://cran.r-project.org/web/packages/brms/brms.pdf">brms reference manual</a>, you’ll find several weighting schemes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nd &lt;-
<span class="st">  </span><span class="kw">tibble</span>(<span class="dt">contact_high =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">expand</span>(contact_high,
         <span class="dt">log_pop =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">6.5</span>, <span class="dt">to =</span> <span class="dv">13</span>, <span class="dt">length.out =</span> <span class="dv">50</span>))

ppa &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">pp_average</span>(b10.<span class="dv">10</span>, b10.<span class="dv">11</span>, b10.<span class="dv">12</span>,
             <span class="dt">weights =</span> <span class="st">&quot;loo&quot;</span>,
             <span class="dt">method  =</span> <span class="st">&quot;fitted&quot;</span>,
             <span class="dt">newdata =</span> nd) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bind_cols</span>(nd)

ppa <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x     =</span> log_pop,
             <span class="dt">group =</span> contact_high)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q2.<span class="dv">5</span>, <span class="dt">ymax =</span> Q97.<span class="dv">5</span>,
                  <span class="dt">fill =</span> contact_high, <span class="dt">color =</span> contact_high),
              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,
              <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> d, 
             <span class="kw">aes</span>(<span class="dt">y     =</span> total_tools,
                 <span class="dt">label =</span> total_tools,
                 <span class="dt">color =</span> contact_high),
             <span class="dt">size =</span> <span class="fl">3.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="fl">7.1</span>, <span class="fl">12.4</span>),
                  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">70</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;log population&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;total tools&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Blue is the high contact rate; black is the low.&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,
        <span class="dt">panel.border    =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="10_files/figure-html/unnamed-chunk-67-1.png" width="336" /></p>
<p>In case you were curious, here are those LOO weights:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">model_weights</span>(b10.<span class="dv">10</span>, b10.<span class="dv">11</span>, b10.<span class="dv">12</span>, 
              <span class="dt">weights =</span> <span class="st">&quot;loo&quot;</span>)</code></pre></div>
<pre><code>##     b10.10     b10.11     b10.12 
## 0.37857139 0.57188875 0.04953986</code></pre>
</div>
<div id="mcmc-islands." class="section level3">
<h3><span class="header-section-number">10.2.2</span> MCMC islands.</h3>
<p>We fit our analogue to <code>m10.10stan</code>, <code>b10.10</code>, some time ago.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b10.<span class="dv">10</span>)</code></pre></div>
<pre><code>##  Family: poisson 
##   Links: mu = log 
## Formula: total_tools ~ 1 + log_pop + contact_high + contact_high:log_pop 
##    Data: d (Number of observations: 10) 
## Samples: 4 chains, each with iter = 3000; warmup = 1000; thin = 1;
##          total post-warmup samples = 8000
## 
## Population-Level Effects: 
##                      Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept                0.94      0.35     0.24     1.63       4087 1.00
## log_pop                  0.26      0.03     0.20     0.33       4331 1.00
## contact_high            -0.11      0.84    -1.74     1.53       3115 1.00
## log_pop:contact_high     0.04      0.09    -0.14     0.22       3080 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Center <code>log_pop</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-
<span class="st">  </span>d <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">log_pop_c =</span> log_pop <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(log_pop))</code></pre></div>
<p>Now fit the <code>log_pop</code>-centered model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b10.10_c &lt;-
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> poisson,
      total_tools <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>log_pop_c <span class="op">+</span><span class="st"> </span>contact_high <span class="op">+</span><span class="st"> </span>contact_high<span class="op">:</span>log_pop_c,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b)),
      <span class="dt">iter =</span> <span class="dv">3000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,
      <span class="dt">seed =</span> <span class="dv">10</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b10.10_c)</code></pre></div>
<pre><code>##  Family: poisson 
##   Links: mu = log 
## Formula: total_tools ~ 1 + log_pop_c + contact_high + contact_high:log_pop_c 
##    Data: d (Number of observations: 10) 
## Samples: 4 chains, each with iter = 3000; warmup = 1000; thin = 1;
##          total post-warmup samples = 8000
## 
## Population-Level Effects: 
##                        Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept                  3.31      0.09     3.13     3.49       6035 1.00
## log_pop_c                  0.26      0.04     0.19     0.33       6024 1.00
## contact_high               0.28      0.12     0.06     0.52       6606 1.00
## log_pop_c:contact_high     0.06      0.17    -0.26     0.38       6718 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>We’ll use <code>mcmc_pairs()</code>, again, for Figure 10.10.a.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># this helps us set our custom color scheme</span>
<span class="kw">color_scheme_set</span>(<span class="kw">c</span>(<span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">3</span>], 
                   <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">1</span>], 
                   <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">2</span>], 
                   <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">2</span>], 
                   <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">1</span>], 
                   <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">1</span>]))

<span class="co"># the actual plot</span>
<span class="kw">mcmc_pairs</span>(<span class="dt">x =</span> <span class="kw">posterior_samples</span>(b10.<span class="dv">10</span>),
           <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">&quot;b_Intercept&quot;</span>, <span class="st">&quot;b_log_pop&quot;</span>, <span class="st">&quot;b_contact_high&quot;</span>, <span class="st">&quot;b_log_pop:contact_high&quot;</span>),
           <span class="dt">off_diag_args =</span> <span class="kw">list</span>(<span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>),
           <span class="dt">diag_fun =</span> <span class="st">&quot;dens&quot;</span>)</code></pre></div>
<p><img src="10_files/figure-html/unnamed-chunk-71-1.png" width="360" /></p>
<p>And now behold Figure 10.10.b.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mcmc_pairs</span>(<span class="dt">x =</span> <span class="kw">posterior_samples</span>(b10.10_c),
           <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">&quot;b_Intercept&quot;</span>, <span class="st">&quot;b_log_pop_c&quot;</span>, <span class="st">&quot;b_contact_high&quot;</span>, <span class="st">&quot;b_log_pop_c:contact_high&quot;</span>),
           <span class="dt">off_diag_args =</span> <span class="kw">list</span>(<span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>),
           <span class="dt">diag_fun =</span> <span class="st">&quot;dens&quot;</span>)</code></pre></div>
<p><img src="10_files/figure-html/unnamed-chunk-72-1.png" width="360" /></p>
<p>If you really want the correlation point estimates, use <code>psych::lowerCorr()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">psych<span class="op">::</span><span class="kw">lowerCor</span>(<span class="kw">posterior_samples</span>(b10.<span class="dv">10</span>)[, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>])</code></pre></div>
<pre><code>##                        b_Int b_lg_ b_cn_ b__:_
## b_Intercept             1.00                  
## b_log_pop              -0.97  1.00            
## b_contact_high         -0.12  0.11  1.00      
## b_log_pop:contact_high  0.06 -0.07 -0.99  1.00</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">psych<span class="op">::</span><span class="kw">lowerCor</span>(<span class="kw">posterior_samples</span>(b10.10_c)[, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>])</code></pre></div>
<pre><code>##                          b_Int b_l__ b_cn_ b___:
## b_Intercept               1.00                  
## b_log_pop_c              -0.48  1.00            
## b_contact_high           -0.77  0.36  1.00      
## b_log_pop_c:contact_high  0.09 -0.19 -0.24  1.00</code></pre>
</div>
<div id="example-exposure-and-the-offset." class="section level3">
<h3><span class="header-section-number">10.2.3</span> Example: Exposure and the offset.</h3>
<blockquote>
<p>For the last Poisson example, we’ll look at a case where the exposure varies across observations. When the length of observation, area of sampling, or intensity of sampling varies, the counts we observe also naturally vary. Since a Poisson distribution assumes that the rate of events is constant in time (or space), it’s easy to handle this. All we need to do, as explained on page 312 [of the text], is to add the logarithm of the exposure to the linear model. The term we add is typically called an <em>offset</em>. (p. 321, <em>emphasis</em> in the original)</p>
</blockquote>
<p>Here we simulate our data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">10</span>)

num_days  &lt;-<span class="st"> </span><span class="dv">30</span>
y         &lt;-<span class="st"> </span><span class="kw">rpois</span>(num_days, <span class="fl">1.5</span>)

num_weeks &lt;-<span class="st"> </span><span class="dv">4</span>
y_new     &lt;-<span class="st"> </span><span class="kw">rpois</span>(num_weeks, <span class="fl">0.5</span> <span class="op">*</span><span class="st"> </span><span class="dv">7</span>)</code></pre></div>
<p>Let’s make them tidy and add <code>log_days</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(
  d &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">tibble</span>(<span class="dt">y         =</span> <span class="kw">c</span>(y, y_new), 
         <span class="dt">days      =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">1</span>, num_days), <span class="kw">rep</span>(<span class="dv">7</span>, num_weeks)),
         <span class="dt">monastery =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">0</span>, num_days), <span class="kw">rep</span>(<span class="dv">1</span>, num_weeks))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">log_days  =</span> <span class="kw">log</span>(days))
)</code></pre></div>
<pre><code>## # A tibble: 34 x 4
##        y  days monastery log_days
##    &lt;int&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1     1     1         0        0
##  2     1     1         0        0
##  3     1     1         0        0
##  4     2     1         0        0
##  5     0     1         0        0
##  6     1     1         0        0
##  7     1     1         0        0
##  8     1     1         0        0
##  9     2     1         0        0
## 10     1     1         0        0
## # … with 24 more rows</code></pre>
<p>With the brms package, you use the <code>offset()</code> syntax, in which you put a pre-processed variable like <code>log_days</code> or the log of a variable, such as <code>log(days)</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b10.<span class="dv">15</span> &lt;-
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> poisson,
      y <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">offset</span>(log_days) <span class="op">+</span><span class="st"> </span>monastery,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b)),
      <span class="dt">iter =</span> <span class="dv">2500</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">cores =</span> <span class="dv">2</span>, <span class="dt">chains =</span> <span class="dv">2</span>,
      <span class="dt">seed =</span> <span class="dv">10</span>)</code></pre></div>
<p>The model summary:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b10.<span class="dv">15</span>)</code></pre></div>
<pre><code>##  Family: poisson 
##   Links: mu = log 
## Formula: y ~ 1 + offset(log_days) + monastery 
##    Data: d (Number of observations: 34) 
## Samples: 2 chains, each with iter = 2500; warmup = 500; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept     0.30      0.16    -0.04     0.61       3168 1.00
## monastery    -1.10      0.31    -1.72    -0.52       3340 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>The model summary helps clarify that when you use <code>offset()</code>, <code>brm()</code> fixes the value. Thus there is no parameter estimate for the <code>offset()</code>. It’s a fixed part of the model not unlike the <span class="math inline">\(\nu\)</span> parameter of the Student-<span class="math inline">\(t\)</span> distribution gets fixed to infinity when you use the Gaussian likelihood.</p>
<p>Here we’ll compute the posterior means and 89% HDIs with <code>tidybayes::mean_hdi()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidybayes)

<span class="kw">posterior_samples</span>(b10.<span class="dv">15</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">transmute</span>(<span class="dt">lambda_old =</span> <span class="kw">exp</span>(b_Intercept),
            <span class="dt">lambda_new =</span> <span class="kw">exp</span>(b_Intercept <span class="op">+</span><span class="st"> </span>b_monastery)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">key =</span> <span class="kw">factor</span>(key, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;lambda_old&quot;</span>, <span class="st">&quot;lambda_new&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(key) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mean_hdi</span>(value, <span class="dt">.width =</span> .<span class="dv">89</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code>## # A tibble: 2 x 7
##   key        value .lower .upper .width .point .interval
##   &lt;fct&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 lambda_old  1.37   0.99   1.7    0.89 mean   hdi      
## 2 lambda_new  0.47   0.27   0.66   0.89 mean   hdi</code></pre>
<p>As McElreath pointed out in the text, “Your estimates will be slightly different, because you got different randomly simulated data” (p. 322).</p>
</div>
</div>
<div id="other-count-regressions" class="section level2">
<h2><span class="header-section-number">10.3</span> Other count regressions</h2>
<p>The next two of the remaining four models are maximum entropy distributions for certain problem types. The last two are mixtures, of which we’ll see more in the next chapter.</p>
<div id="multinomial." class="section level3">
<h3><span class="header-section-number">10.3.1</span> Multinomial.</h3>
<blockquote>
<p>When more than two types of unordered events are possible, and the probability of each type of event is constant across trials, then the maximum entropy distribution is the multinomial distribution. [We] already met the multinomial, implicitly, in Chapter 9 when we tossed pebbles into buckets as an introduction to maximum entropy. The binomial is really a special case of this distribution. And so its distribution formula resembles the binomial, just extrapolated out to three or more types of events. If there are <span class="math inline">\(K\)</span> types of events with probabilities <span class="math inline">\(p_1, …, p_K\)</span>, then the probability of observing <span class="math inline">\(y_1, …, y_K\)</span> events of each type out of <span class="math inline">\(n\)</span> trials is (p. 323):</p>
</blockquote>
<p><span class="math display">\[\text{Pr} (y_1, ..., y_K | n, p_1, ..., p_K) = \frac{n!}{\prod_i y_i!} \prod_{i = 1}^K p_i^{y_i}\]</span></p>
<p>Compare that equation with the simpler version in section 2.3.1 (page 33 in the text).</p>
<div id="explicit-multinomial-models." class="section level4">
<h4><span class="header-section-number">10.3.1.1</span> Explicit multinomial models.</h4>
<p>“The conventional and natural link is this context is the <em>multinomial logit</em>. This link function takes a vector of <em>scores</em>, one for each <span class="math inline">\(K\)</span> event types, and computed the probability of a particular type of event <span class="math inline">\(K\)</span> as” (p. 323, <em>emphasis</em> in the original)</p>
<p><span class="math display">\[\text{Pr} (k |s_1, s_2, ..., s_K) = \frac{\text{exp} (s_k)}{\sum_{i = 1}^K \text{exp} (s_i)}\]</span></p>
<p>Let’s simulate the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rethinking)

<span class="co"># simulate career choices among 500 individuals</span>
n      &lt;-<span class="st"> </span><span class="dv">500</span>           <span class="co"># number of individuals</span>
income &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>           <span class="co"># expected income of each career</span>
score  &lt;-<span class="st"> </span><span class="fl">0.5</span> <span class="op">*</span><span class="st"> </span>income  <span class="co"># scores for each career, based on income</span>

<span class="co"># next line converts scores to probabilities</span>
p &lt;-<span class="st"> </span><span class="kw">softmax</span>(score[<span class="dv">1</span>], score[<span class="dv">2</span>], score[<span class="dv">3</span>])

<span class="co"># now simulate choice</span>
<span class="co"># outcome career holds event type values, not counts</span>
career &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, n)  <span class="co"># empty vector of choices for each individual</span>

<span class="kw">set.seed</span>(<span class="dv">10</span>)
<span class="co"># sample chosen career for each individual</span>
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) career[i] &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> p)</code></pre></div>
<p>Here’s what the data look like.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">career <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.factor</span>())) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">fill =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">2</span>])</code></pre></div>
<p><img src="10_files/figure-html/unnamed-chunk-79-1.png" width="288" /></p>
<p>Switch out rethinking for brms.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)
<span class="kw">library</span>(brms)</code></pre></div>
<p>Here’s my naïve attempt to fit the model in brms.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b10.<span class="dv">16</span> &lt;-
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">career =</span> career), 
      <span class="dt">family =</span> <span class="kw">categorical</span>(<span class="dt">link =</span> logit),
      career <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,
      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="dt">class =</span> Intercept),
      <span class="dt">iter =</span> <span class="dv">2500</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">cores =</span> <span class="dv">2</span>, <span class="dt">chains =</span> <span class="dv">2</span>,
      <span class="dt">seed =</span> <span class="dv">10</span>)</code></pre></div>
<p>This differs from McElreath’s <code>m10.16</code>. Most obviously, this has two parameters. McElreath’s <code>m10.16</code> only has one. If you have experience with these models and know how to reproduce McElreath’s results in brms, <a href="https://github.com/ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse/issues/5">please share your code</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b10.<span class="dv">16</span>)</code></pre></div>
<pre><code>##  Family: categorical 
##   Links: mu2 = logit; mu3 = logit 
## Formula: career ~ 1 
##    Data: list(career = career) (Number of observations: 500) 
## Samples: 2 chains, each with iter = 2500; warmup = 500; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##               Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## mu2_Intercept     0.49      0.14     0.23     0.76       1220 1.00
## mu3_Intercept     1.01      0.12     0.77     1.25       1263 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Here’s the second data simulation, this time based on McElreath’s R code 10.58.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rethinking)

n &lt;-<span class="st"> </span><span class="dv">100</span>

<span class="kw">set.seed</span>(<span class="dv">10</span>)
<span class="co"># simulate family incomes for each individual</span>
family_income &lt;-<span class="st"> </span><span class="kw">runif</span>(n)

<span class="co"># assign a unique coefficient for each type of event</span>
b      &lt;-<span class="st"> </span>(<span class="dv">1</span><span class="op">:-</span><span class="dv">1</span>)
career &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, n)  <span class="co"># empty vector of choices for each individual</span>

<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) {
    score     &lt;-<span class="st"> </span><span class="fl">0.5</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>) <span class="op">+</span><span class="st"> </span>b <span class="op">*</span><span class="st"> </span>family_income[i]
    p         &lt;-<span class="st"> </span><span class="kw">softmax</span>(score[<span class="dv">1</span>], score[<span class="dv">2</span>], score[<span class="dv">3</span>])
    career[i] &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> p)
}</code></pre></div>
<p>Switch out rethinking for brms.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)
<span class="kw">library</span>(brms)</code></pre></div>
<p>Here’s the brms version of McElreath’s <code>m10.17</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b10.<span class="dv">17</span> &lt;-
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">career        =</span> career,  <span class="co"># note how we used a list instead of a tibble</span>
                  <span class="dt">family_income =</span> family_income), 
      <span class="dt">family =</span> <span class="kw">categorical</span>(<span class="dt">link =</span> logit),
      career <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>family_income,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="dt">class =</span> b)),
      <span class="dt">iter =</span> <span class="dv">2500</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">cores =</span> <span class="dv">2</span>, <span class="dt">chains =</span> <span class="dv">2</span>,
      <span class="dt">seed =</span> <span class="dv">10</span>)</code></pre></div>
<p>Happily, these results cohere with the rethinking model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b10.<span class="dv">17</span>)</code></pre></div>
<pre><code>##  Family: categorical 
##   Links: mu2 = logit; mu3 = logit 
## Formula: career ~ 1 + family_income 
##    Data: list(career = career, family_income = family_incom (Number of observations: 100) 
## Samples: 2 chains, each with iter = 2500; warmup = 500; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##                   Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## mu2_Intercept         1.03      0.55     0.02     2.11       2758 1.00
## mu3_Intercept         1.04      0.54     0.02     2.13       2753 1.00
## mu2_family_income    -1.77      1.00    -3.72     0.16       2931 1.00
## mu3_family_income    -1.72      0.99    -3.76     0.13       2846 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>McElreath described the parameters as “on a scale that is very hard to interpret” (p. 325). Indeed.</p>
</div>
<div id="multinomial-in-disguise-as-poisson." class="section level4">
<h4><span class="header-section-number">10.3.1.2</span> Multinomial in disguise as Poisson.</h4>
<p>Here we fit a multinomial likelihood by refactoring it to a series of Poissons. Let’s retrieve the Berkeley data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rethinking)

<span class="kw">data</span>(UCBadmit)
d &lt;-<span class="st"> </span>UCBadmit
<span class="kw">rm</span>(UCBadmit)

<span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)
<span class="kw">library</span>(brms)</code></pre></div>
<p>Fit the models.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># binomial model of overall admission probability</span>
b_binom &lt;-
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> binomial,
      admit <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(applications) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,
      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="dt">class =</span> Intercept),
      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">cores =</span> <span class="dv">3</span>, <span class="dt">chains =</span> <span class="dv">3</span>,
      <span class="dt">seed =</span> <span class="dv">10</span>)

<span class="co"># Poisson model of overall admission rate and rejection rate</span>
b_pois &lt;-
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">mutate</span>(<span class="dt">rej =</span> reject),  <span class="co"># &#39;reject&#39; is a reserved word</span>
      <span class="dt">family =</span> poisson,
      <span class="kw">mvbind</span>(admit, rej) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,
      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="dt">class =</span> Intercept),
      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">cores =</span> <span class="dv">3</span>, <span class="dt">chains =</span> <span class="dv">3</span>,
      <span class="dt">seed =</span> <span class="dv">10</span>)</code></pre></div>
<p>Note, the <code>mvbind()</code> syntax made <code>b_pois</code> a multivariate Poisson model. Starting with version 2.0.0, <a href="https://cran.r-project.org/web/packages/brms/vignettes/brms_multivariate.html">brms supports a variety of multivariate models</a>. Anyway, here are the implications of <code>b_pois</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># extract the samples</span>
post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(b_pois)

<span class="co"># wrangle</span>
post <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">transmute</span>(<span class="dt">admit  =</span> <span class="kw">exp</span>(b_admit_Intercept), 
            <span class="dt">reject =</span> <span class="kw">exp</span>(b_rej_Intercept)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="co"># plot</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> key, <span class="dt">fill =</span> key)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_halfeyeh</span>(<span class="dt">point_interval =</span> median_qi, <span class="dt">.width =</span> .<span class="dv">95</span>,
                <span class="dt">color =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">4</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">1</span>],
                               <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">2</span>])) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot; Mean admit/reject rates across departments&quot;</span>,
       <span class="dt">x     =</span> <span class="st">&quot;# applications&quot;</span>,
       <span class="dt">y     =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,
        <span class="dt">axis.ticks.y    =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="10_files/figure-html/unnamed-chunk-86-1.png" width="624" /></p>
<p>The model summaries:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b_binom)</code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: admit | trials(applications) ~ 1 
##    Data: d (Number of observations: 12) 
## Samples: 3 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 3000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept    -0.46      0.03    -0.52    -0.40       1219 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b_pois)</code></pre></div>
<pre><code>##  Family: MV(poisson, poisson) 
##   Links: mu = log
##          mu = log 
## Formula: admit ~ 1 
##          rej ~ 1 
##    Data: d %&gt;% mutate(rej = reject) (Number of observations: 12) 
## Samples: 3 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 3000
## 
## Population-Level Effects: 
##                 Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## admit_Intercept     4.98      0.02     4.94     5.03       2194 1.00
## rej_Intercept       5.44      0.02     5.41     5.48       2591 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Here’s the posterior mean for the probability of admission, based on <code>b_binom</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fixef</span>(b_binom)[ ,<span class="st">&quot;Estimate&quot;</span>] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inv_logit_scaled</span>()</code></pre></div>
<pre><code>## [1] 0.387497</code></pre>
<p>Happily, we get the same value within simulation error from model <code>b_pois</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">k &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">fixef</span>(b_pois) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as.numeric</span>()

<span class="kw">exp</span>(k[<span class="dv">1</span>]) <span class="op">/</span><span class="st"> </span>(<span class="kw">exp</span>(k[<span class="dv">1</span>]) <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(k[<span class="dv">2</span>]))</code></pre></div>
<pre><code>## [1] 0.3876675</code></pre>
<p>The formula for what we just did in code is</p>
<p><span class="math display">\[p_{\text{admit}} = \frac{\lambda_1}{\lambda_1 + \lambda_2} = \frac{\text{exp} (\alpha_1)}{\text{exp} (\alpha_1) + \text{exp} (\alpha_2)}\]</span></p>
</div>
</div>
<div id="geometric." class="section level3">
<h3><span class="header-section-number">10.3.2</span> Geometric.</h3>
<blockquote>
<p>Sometimes a count variable is a number of events up until something happened. Call this “something” the terminating event. Often we want to model the probability of that event, a kind of analysis known as event history analysis or survival analysis. When the probability of the terminating event is constant through time (or distance), and the units of time (or distance) are discrete, a common likelihood function is the geometric distribution. This distribution has the form:</p>
<p><span class="math display">\[\text{Pr} (y | p) = p (1 - p) ^{y - 1}\]</span></p>
<p>where <span class="math inline">\(y\)</span> is the number of time steps (events) until the terminating event occurred and <span class="math inline">\(p\)</span> is the probability of that event in each time step. This distribution has maximum entropy for unbounded counts with constant expected value. (pp. 327–328)</p>
</blockquote>
<p>Here we simulate exemplar data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># simulate</span>
n &lt;-<span class="st"> </span><span class="dv">100</span>
<span class="kw">set.seed</span>(<span class="dv">10</span>)
x &lt;-<span class="st"> </span><span class="kw">runif</span>(n)

<span class="kw">set.seed</span>(<span class="dv">10</span>)
y &lt;-<span class="st"> </span><span class="kw">rgeom</span>(n, <span class="dt">prob =</span> <span class="kw">inv_logit_scaled</span>(<span class="op">-</span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>x))</code></pre></div>
<p>In case you’re curious, here are the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">list</span>(<span class="dt">y =</span> y, <span class="dt">x =</span> x) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">alpha =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>)</code></pre></div>
<p><img src="10_files/figure-html/unnamed-chunk-91-1.png" width="384" /></p>
<p>We fit the geometric model using <code>family = geometric(link = log)</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b10.<span class="dv">18</span> &lt;-
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">y =</span> y, <span class="dt">x =</span> x), 
      <span class="dt">family =</span> <span class="kw">geometric</span>(<span class="dt">link =</span> log),
      y <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>intercept <span class="op">+</span><span class="st"> </span>x,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> b, <span class="dt">coef =</span> intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b)),
      <span class="dt">iter =</span> <span class="dv">2500</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">chains =</span> <span class="dv">2</span>, <span class="dt">cores =</span> <span class="dv">2</span>,
      <span class="dt">seed =</span> <span class="dv">10</span>)</code></pre></div>
<p>The results:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b10.<span class="dv">18</span>, <span class="dt">digits =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code>##  Family: geometric 
##   Links: mu = log 
## Formula: y ~ 0 + intercept + x 
##    Data: list(y = y, x = x) (Number of observations: 100) 
## Samples: 2 chains, each with iter = 2500; warmup = 500; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## intercept     0.75      0.24     0.26     1.20       1322 1.00
## x            -1.62      0.51    -2.58    -0.61       1286 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>It turns out brms uses a <a href="https://cran.r-project.org/web/packages/brms/vignettes/brms_families.html#binary-and-count-data-models">different parameterization for the geometric distribution</a> than rethinking does. It follows the form</p>
<p><span class="math display">\[f(y_i) = {y_i \choose y_i} \bigg (\frac{\mu_i}{\mu_i + 1} \bigg )^{y_i} \bigg (\frac{1}{\mu_i + 1} \bigg )\]</span></p>
<p>Even though the parameters brms yielded look different from those in the text, their predictions describe the data well. Here’s the <code>marginal_effects()</code> plot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">marginal_effects</span>(b10.<span class="dv">18</span>),
     <span class="dt">points =</span> T,
     <span class="dt">point_args =</span> <span class="kw">c</span>(<span class="dt">size =</span> <span class="dv">3</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">alpha =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>),
     <span class="dt">line_args  =</span> <span class="kw">c</span>(<span class="dt">color =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">1</span>],
                    <span class="dt">fill  =</span> <span class="kw">wes_palette</span>(<span class="st">&quot;Moonrise2&quot;</span>)[<span class="dv">1</span>]))</code></pre></div>
<p><img src="10_files/figure-html/unnamed-chunk-93-1.png" width="384" /></p>
</div>
</div>
<div id="reference-9" class="section level2 unnumbered">
<h2>Reference</h2>
<p><a href="https://xcelab.net/rm/statistical-rethinking/">McElreath, R. (2016). <em>Statistical rethinking: A Bayesian course with examples in R and Stan.</em> Chapman &amp; Hall/CRC Press.</a></p>
</div>
<div id="session-info-9" class="section level2 unnumbered">
<h2>Session info</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sessionInfo</span>()</code></pre></div>
<pre><code>## R version 3.5.1 (2018-07-02)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS High Sierra 10.13.6
## 
## Matrix products: default
## BLAS: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] parallel  stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] tidybayes_1.0.4        loo_2.1.0              broom_0.5.1            bayesplot_1.6.0       
##  [5] ggthemes_4.0.1         wesanderson_0.3.6.9000 forcats_0.3.0          stringr_1.4.0         
##  [9] dplyr_0.8.0.1          purrr_0.2.5            readr_1.1.1            tidyr_0.8.1           
## [13] tibble_2.1.1           tidyverse_1.2.1        brms_2.8.8             Rcpp_1.0.1            
## [17] rstan_2.18.2           StanHeaders_2.18.0-1   ggplot2_3.1.1         
## 
## loaded via a namespace (and not attached):
##   [1] colorspace_1.3-2          ggridges_0.5.0            rsconnect_0.8.8           rprojroot_1.3-2          
##   [5] ggstance_0.3              markdown_0.8              base64enc_0.1-3           rstudioapi_0.7           
##   [9] listenv_0.7.0             svUnit_0.7-12             DT_0.4                    fansi_0.4.0              
##  [13] mvtnorm_1.0-10            lubridate_1.7.4           xml2_1.2.0                bridgesampling_0.6-0     
##  [17] codetools_0.2-15          mnormt_1.5-5              knitr_1.20                shinythemes_1.1.1        
##  [21] jsonlite_1.5              shiny_1.1.0               compiler_3.5.1            httr_1.3.1               
##  [25] backports_1.1.4           assertthat_0.2.0          Matrix_1.2-14             lazyeval_0.2.2           
##  [29] cli_1.0.1                 later_0.7.3               htmltools_0.3.6           prettyunits_1.0.2        
##  [33] tools_3.5.1               igraph_1.2.1              coda_0.19-2               gtable_0.3.0             
##  [37] glue_1.3.1.9000           reshape2_1.4.3            cellranger_1.1.0          nlme_3.1-137             
##  [41] crosstalk_1.0.0           psych_1.8.4               xfun_0.3                  globals_0.12.4           
##  [45] ps_1.2.1                  rvest_0.3.2               mime_0.5                  miniUI_0.1.1.1           
##  [49] gtools_3.8.1              future_1.12.0             MASS_7.3-50               zoo_1.8-2                
##  [53] scales_1.0.0              colourpicker_1.0          hms_0.4.2                 promises_1.0.1           
##  [57] Brobdingnag_1.2-6         inline_0.3.15             shinystan_2.5.0           yaml_2.1.19              
##  [61] gridExtra_2.3             stringi_1.4.3             dygraphs_1.1.1.5          pkgbuild_1.0.2           
##  [65] rlang_0.3.4               pkgconfig_2.0.2           matrixStats_0.54.0        HDInterval_0.2.0         
##  [69] evaluate_0.10.1           lattice_0.20-35           rstantools_1.5.1          htmlwidgets_1.2          
##  [73] labeling_0.3              processx_3.2.1            tidyselect_0.2.5          plyr_1.8.4               
##  [77] magrittr_1.5              bookdown_0.9              R6_2.3.0                  generics_0.0.2           
##  [81] foreign_0.8-70            pillar_1.3.1              haven_1.1.2               withr_2.1.2              
##  [85] xts_0.10-2                abind_1.4-5               modelr_0.1.2              crayon_1.3.4             
##  [89] arrayhelpers_1.0-20160527 utf8_1.1.4                rmarkdown_1.10            grid_3.5.1               
##  [93] readxl_1.1.0              callr_3.1.0               threejs_0.3.1             digest_0.6.18            
##  [97] xtable_1.8-2              httpuv_1.4.4.2            stats4_3.5.1              munsell_0.5.0            
## [101] shinyjs_1.0</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="big-entropy-and-the-generalized-linear-model.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="monsters-and-mixtures.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
