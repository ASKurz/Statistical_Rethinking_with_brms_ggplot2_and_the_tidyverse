<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>11 Monsters and Mixtures | Statistical Rethinking with brms, ggplot2, and the tidyverse</title>
  <meta name="description" content="This project is an attempt to re-express the code in McElreath’s textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="11 Monsters and Mixtures | Statistical Rethinking with brms, ggplot2, and the tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This project is an attempt to re-express the code in McElreath’s textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="github-repo" content="ASKURZ/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="11 Monsters and Mixtures | Statistical Rethinking with brms, ggplot2, and the tidyverse" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This project is an attempt to re-express the code in McElreath’s textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  

<meta name="author" content="A Solomon Kurz" />


<meta name="date" content="2020-03-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="counting-and-classification.html"/>
<link rel="next" href="multilevel-models.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>This is a love letter</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-this"><i class="fa fa-check"></i>Why this?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#my-assumptions-about-you"><i class="fa fa-check"></i>My assumptions about you</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-use-and-understand-this-project"><i class="fa fa-check"></i>How to use and understand this project</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#you-can-do-this-too"><i class="fa fa-check"></i>You can do this, too</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#we-have-updates"><i class="fa fa-check"></i>We have updates</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.9.0."><i class="fa fa-check"></i>Version 0.9.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-1.0.0."><i class="fa fa-check"></i>Version 1.0.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-1.0.1."><i class="fa fa-check"></i>Version 1.0.1.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-1.1.0."><i class="fa fa-check"></i>Version 1.1.0.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#thank-yous-are-in-order"><i class="fa fa-check"></i>Thank-you’s are in order</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague</a><ul>
<li class="chapter" data-level="" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html#reference"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a><ul>
<li class="chapter" data-level="2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#the-garden-of-forking-data"><i class="fa fa-check"></i><b>2.1</b> The garden of forking data</a><ul>
<li class="chapter" data-level="2.1.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#counting-possibilities."><i class="fa fa-check"></i><b>2.1.1</b> Counting possibilities.</a></li>
<li class="chapter" data-level="2.1.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#using-prior-information."><i class="fa fa-check"></i><b>2.1.2</b> Using prior information.</a></li>
<li class="chapter" data-level="2.1.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#from-counts-to-probability."><i class="fa fa-check"></i><b>2.1.3</b> From counts to probability.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#building-a-model"><i class="fa fa-check"></i><b>2.2</b> Building a model</a><ul>
<li class="chapter" data-level="2.2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-data-story."><i class="fa fa-check"></i><b>2.2.1</b> A data story.</a></li>
<li class="chapter" data-level="2.2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayesian-updating."><i class="fa fa-check"></i><b>2.2.2</b> Bayesian updating.</a></li>
<li class="chapter" data-level="2.2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#evaluate."><i class="fa fa-check"></i><b>2.2.3</b> Evaluate.</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#components-of-the-model"><i class="fa fa-check"></i><b>2.3</b> Components of the model</a><ul>
<li class="chapter" data-level="2.3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#likelihood."><i class="fa fa-check"></i><b>2.3.1</b> Likelihood.</a></li>
<li class="chapter" data-level="2.3.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#parameters."><i class="fa fa-check"></i><b>2.3.2</b> Parameters.</a></li>
<li class="chapter" data-level="2.3.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#prior."><i class="fa fa-check"></i><b>2.3.3</b> Prior.</a></li>
<li class="chapter" data-level="2.3.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#posterior."><i class="fa fa-check"></i><b>2.3.4</b> Posterior.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#making-the-model-go"><i class="fa fa-check"></i><b>2.4</b> Making the model go</a><ul>
<li class="chapter" data-level="2.4.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#grid-approximation."><i class="fa fa-check"></i><b>2.4.1</b> Grid approximation.</a></li>
<li class="chapter" data-level="2.4.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic-approximation."><i class="fa fa-check"></i><b>2.4.2</b> Quadratic approximation.</a></li>
<li class="chapter" data-level="2.4.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#markov-chain-monte-carlo."><i class="fa fa-check"></i><b>2.4.3</b> Markov chain Monte Carlo.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#reference-1"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a><ul>
<li class="chapter" data-level="3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-like-approximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-like approximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a><ul>
<li class="chapter" data-level="3.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-boundaries."><i class="fa fa-check"></i><b>3.2.1</b> Intervals of defined boundaries.</a></li>
<li class="chapter" data-level="3.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass."><i class="fa fa-check"></i><b>3.2.2</b> Intervals of defined mass.</a></li>
<li class="chapter" data-level="3.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimates."><i class="fa fa-check"></i><b>3.2.3</b> Point estimates.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a><ul>
<li class="chapter" data-level="3.3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#dummy-data."><i class="fa fa-check"></i><b>3.3.1</b> Dummy data.</a></li>
<li class="chapter" data-level="3.3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking."><i class="fa fa-check"></i><b>3.3.2</b> Model checking.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#summary-lets-practice-in-brms"><i class="fa fa-check"></i><b>3.4</b> <del>Summary</del> Let’s practice in brms</a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#reference-2"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="linear-models.html"><a href="linear-models.html"><i class="fa fa-check"></i><b>4</b> Linear Models</a><ul>
<li class="chapter" data-level="4.1" data-path="linear-models.html"><a href="linear-models.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why normal distributions are normal</a><ul>
<li class="chapter" data-level="4.1.1" data-path="linear-models.html"><a href="linear-models.html#normal-by-addition."><i class="fa fa-check"></i><b>4.1.1</b> Normal by addition.</a></li>
<li class="chapter" data-level="4.1.2" data-path="linear-models.html"><a href="linear-models.html#normal-by-multiplication."><i class="fa fa-check"></i><b>4.1.2</b> Normal by multiplication.</a></li>
<li class="chapter" data-level="4.1.3" data-path="linear-models.html"><a href="linear-models.html#normal-by-log-multiplication."><i class="fa fa-check"></i><b>4.1.3</b> Normal by log-multiplication.</a></li>
<li class="chapter" data-level="4.1.4" data-path="linear-models.html"><a href="linear-models.html#using-gaussian-distributions."><i class="fa fa-check"></i><b>4.1.4</b> Using Gaussian distributions.</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="linear-models.html"><a href="linear-models.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>4.2</b> A language for describing models</a><ul>
<li class="chapter" data-level="4.2.1" data-path="linear-models.html"><a href="linear-models.html#re-describing-the-globe-tossing-model."><i class="fa fa-check"></i><b>4.2.1</b> Re-describing the globe tossing model.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="linear-models.html"><a href="linear-models.html#a-gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> A Gaussian model of height</a><ul>
<li class="chapter" data-level="4.3.1" data-path="linear-models.html"><a href="linear-models.html#the-data."><i class="fa fa-check"></i><b>4.3.1</b> The data.</a></li>
<li class="chapter" data-level="4.3.2" data-path="linear-models.html"><a href="linear-models.html#the-model."><i class="fa fa-check"></i><b>4.3.2</b> The model.</a></li>
<li class="chapter" data-level="4.3.3" data-path="linear-models.html"><a href="linear-models.html#grid-approximation-of-the-posterior-distribution."><i class="fa fa-check"></i><b>4.3.3</b> Grid approximation of the posterior distribution.</a></li>
<li class="chapter" data-level="4.3.4" data-path="linear-models.html"><a href="linear-models.html#sampling-from-the-posterior."><i class="fa fa-check"></i><b>4.3.4</b> Sampling from the posterior.</a></li>
<li class="chapter" data-level="4.3.5" data-path="linear-models.html"><a href="linear-models.html#fitting-the-model-with-map-brm."><i class="fa fa-check"></i><b>4.3.5</b> Fitting the model with <del><code>map</code></del> <code>brm()</code>.</a></li>
<li class="chapter" data-level="4.3.6" data-path="linear-models.html"><a href="linear-models.html#sampling-from-a-map-brm-fit."><i class="fa fa-check"></i><b>4.3.6</b> Sampling from a <del><code>map</code></del> <code>brm()</code> fit.</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="linear-models.html"><a href="linear-models.html#adding-a-predictor"><i class="fa fa-check"></i><b>4.4</b> Adding a predictor</a><ul>
<li class="chapter" data-level="4.4.1" data-path="linear-models.html"><a href="linear-models.html#the-linear-model-strategy."><i class="fa fa-check"></i><b>4.4.1</b> The linear model strategy.</a></li>
<li class="chapter" data-level="4.4.2" data-path="linear-models.html"><a href="linear-models.html#fitting-the-model."><i class="fa fa-check"></i><b>4.4.2</b> Fitting the model.</a></li>
<li class="chapter" data-level="4.4.3" data-path="linear-models.html"><a href="linear-models.html#interpreting-the-model-fit."><i class="fa fa-check"></i><b>4.4.3</b> Interpreting the model fit.</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="linear-models.html"><a href="linear-models.html#polynomial-regression"><i class="fa fa-check"></i><b>4.5</b> Polynomial regression</a></li>
<li class="chapter" data-level="" data-path="linear-models.html"><a href="linear-models.html#reference-3"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="linear-models.html"><a href="linear-models.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html"><i class="fa fa-check"></i><b>5</b> Multivariate Linear Models</a><ul>
<li class="chapter" data-level="5.1" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#spurious-associations"><i class="fa fa-check"></i><b>5.1</b> Spurious associations</a><ul>
<li class="chapter" data-level="5.1.1" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#multivariate-notation."><i class="fa fa-check"></i><b>5.1.1</b> Multivariate notation.</a></li>
<li class="chapter" data-level="5.1.2" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#fitting-the-model.-1"><i class="fa fa-check"></i><b>5.1.2</b> Fitting the model.</a></li>
<li class="chapter" data-level="5.1.3" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#plotting-multivariate-posteriors."><i class="fa fa-check"></i><b>5.1.3</b> Plotting multivariate posteriors.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#masked-relationship"><i class="fa fa-check"></i><b>5.2</b> Masked relationship</a></li>
<li class="chapter" data-level="5.3" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#multicollinearity"><i class="fa fa-check"></i><b>5.3</b> Multicollinearity</a><ul>
<li class="chapter" data-level="5.3.1" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#multicollinear-legs."><i class="fa fa-check"></i><b>5.3.1</b> Multicollinear legs.</a></li>
<li class="chapter" data-level="5.3.2" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#multicollinear-milk."><i class="fa fa-check"></i><b>5.3.2</b> Multicollinear <code>milk</code>.</a></li>
<li class="chapter" data-level="5.3.3" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#post-treatment-bias."><i class="fa fa-check"></i><b>5.3.3</b> Post-treatment bias.</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#categorical-variables"><i class="fa fa-check"></i><b>5.4</b> Categorical variables</a><ul>
<li class="chapter" data-level="5.4.1" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#binary-categories."><i class="fa fa-check"></i><b>5.4.1</b> Binary categories.</a></li>
<li class="chapter" data-level="5.4.2" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#many-categories."><i class="fa fa-check"></i><b>5.4.2</b> Many categories.</a></li>
<li class="chapter" data-level="5.4.3" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#adding-regular-predictor-variables."><i class="fa fa-check"></i><b>5.4.3</b> Adding regular predictor variables.</a></li>
<li class="chapter" data-level="5.4.4" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#another-approach-unique-intercepts."><i class="fa fa-check"></i><b>5.4.4</b> Another approach: Unique intercepts.</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#ordinary-least-squares-and-lm"><i class="fa fa-check"></i><b>5.5</b> <del>Ordinary least squares and <code>lm()</code></del></a></li>
<li class="chapter" data-level="" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#reference-4"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html"><i class="fa fa-check"></i><b>6</b> Overfitting, Regularization, and Information Criteria</a><ul>
<li class="chapter" data-level="6.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>6.1</b> The problem with parameters</a><ul>
<li class="chapter" data-level="6.1.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#more-parameters-always-improve-fit."><i class="fa fa-check"></i><b>6.1.1</b> More parameters always improve fit.</a></li>
<li class="chapter" data-level="6.1.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#too-few-parameters-hurts-too."><i class="fa fa-check"></i><b>6.1.2</b> Too few parameters hurts, too.</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#information-theory-and-model-performance"><i class="fa fa-check"></i><b>6.2</b> Information theory and model performance</a><ul>
<li class="chapter" data-level="6.2.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#firing-the-weatherperson."><i class="fa fa-check"></i><b>6.2.1</b> Firing the weatherperson.</a></li>
<li class="chapter" data-level="6.2.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#information-and-uncertainty."><i class="fa fa-check"></i><b>6.2.2</b> Information and uncertainty.</a></li>
<li class="chapter" data-level="6.2.3" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#from-entropy-to-accuracy."><i class="fa fa-check"></i><b>6.2.3</b> From entropy to accuracy.</a></li>
<li class="chapter" data-level="6.2.4" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#from-divergence-to-deviance."><i class="fa fa-check"></i><b>6.2.4</b> From divergence to deviance.</a></li>
<li class="chapter" data-level="6.2.5" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#from-deviance-to-out-of-sample."><i class="fa fa-check"></i><b>6.2.5</b> From deviance to out-of-sample.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#regularization"><i class="fa fa-check"></i><b>6.3</b> Regularization</a></li>
<li class="chapter" data-level="6.4" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#information-criteria"><i class="fa fa-check"></i><b>6.4</b> Information criteria</a><ul>
<li class="chapter" data-level="6.4.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#dic."><i class="fa fa-check"></i><b>6.4.1</b> DIC.</a></li>
<li class="chapter" data-level="6.4.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#waic."><i class="fa fa-check"></i><b>6.4.2</b> WAIC.</a></li>
<li class="chapter" data-level="6.4.3" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#dic-and-waic-as-estimates-of-deviance."><i class="fa fa-check"></i><b>6.4.3</b> DIC and WAIC as estimates of deviance.</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#using-information-criteria"><i class="fa fa-check"></i><b>6.5</b> Using information criteria</a><ul>
<li class="chapter" data-level="6.5.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#model-comparison."><i class="fa fa-check"></i><b>6.5.1</b> Model comparison.</a></li>
<li class="chapter" data-level="6.5.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#model-averaging."><i class="fa fa-check"></i><b>6.5.2</b> Model averaging.</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#summary-bonus-r2-talk"><i class="fa fa-check"></i><b>6.6</b> <del>Summary</del> Bonus: <span class="math inline">\(R^2\)</span> talk</a></li>
<li class="chapter" data-level="" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#reference-5"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="interactions.html"><a href="interactions.html"><i class="fa fa-check"></i><b>7</b> Interactions</a><ul>
<li class="chapter" data-level="7.1" data-path="interactions.html"><a href="interactions.html#building-an-interaction."><i class="fa fa-check"></i><b>7.1</b> Building an interaction.</a><ul>
<li class="chapter" data-level="7.1.1" data-path="interactions.html"><a href="interactions.html#adding-a-dummy-variable-doesnt-work."><i class="fa fa-check"></i><b>7.1.1</b> Adding a dummy variable doesn’t work.</a></li>
<li class="chapter" data-level="7.1.2" data-path="interactions.html"><a href="interactions.html#adding-a-linear-interaction-does-work."><i class="fa fa-check"></i><b>7.1.2</b> Adding a linear interaction does work.</a></li>
<li class="chapter" data-level="7.1.3" data-path="interactions.html"><a href="interactions.html#plotting-the-interaction."><i class="fa fa-check"></i><b>7.1.3</b> Plotting the interaction.</a></li>
<li class="chapter" data-level="7.1.4" data-path="interactions.html"><a href="interactions.html#interpreting-an-interaction-estimate."><i class="fa fa-check"></i><b>7.1.4</b> Interpreting an interaction estimate.</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="interactions.html"><a href="interactions.html#symmetry-of-the-linear-interaction."><i class="fa fa-check"></i><b>7.2</b> Symmetry of the linear interaction.</a><ul>
<li class="chapter" data-level="7.2.1" data-path="interactions.html"><a href="interactions.html#buridans-interaction."><i class="fa fa-check"></i><b>7.2.1</b> Buridan’s interaction.</a></li>
<li class="chapter" data-level="7.2.2" data-path="interactions.html"><a href="interactions.html#africa-depends-upon-ruggedness."><i class="fa fa-check"></i><b>7.2.2</b> Africa depends upon ruggedness.</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="interactions.html"><a href="interactions.html#continuous-interactions"><i class="fa fa-check"></i><b>7.3</b> Continuous interactions</a><ul>
<li class="chapter" data-level="7.3.1" data-path="interactions.html"><a href="interactions.html#the-data.-1"><i class="fa fa-check"></i><b>7.3.1</b> The data.</a></li>
<li class="chapter" data-level="7.3.2" data-path="interactions.html"><a href="interactions.html#the-un-centered-models."><i class="fa fa-check"></i><b>7.3.2</b> The un-centered models.</a></li>
<li class="chapter" data-level="7.3.3" data-path="interactions.html"><a href="interactions.html#center-and-re-estimate."><i class="fa fa-check"></i><b>7.3.3</b> Center and re-estimate.</a></li>
<li class="chapter" data-level="7.3.4" data-path="interactions.html"><a href="interactions.html#plotting-implied-predictions."><i class="fa fa-check"></i><b>7.3.4</b> Plotting implied predictions.</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="interactions.html"><a href="interactions.html#interactions-in-design-formulas"><i class="fa fa-check"></i><b>7.4</b> Interactions in design formulas</a></li>
<li class="chapter" data-level="7.5" data-path="interactions.html"><a href="interactions.html#summary-bonus-marginal_effectsconditional_effects"><i class="fa fa-check"></i><b>7.5</b> <del>Summary</del> Bonus: <code>marginal_effects()</code>/<code>conditional_effects()</code></a></li>
<li class="chapter" data-level="" data-path="interactions.html"><a href="interactions.html#reference-6"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="interactions.html"><a href="interactions.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>8</b> Markov Chain Monte Carlo</a><ul>
<li class="chapter" data-level="8.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#good-king-markov-and-his-island-kingdom"><i class="fa fa-check"></i><b>8.1</b> Good King Markov and His island kingdom</a></li>
<li class="chapter" data-level="8.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#markov-chain-monte-carlo-1"><i class="fa fa-check"></i><b>8.2</b> Markov chain Monte Carlo</a><ul>
<li class="chapter" data-level="8.2.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#gibbs-sampling."><i class="fa fa-check"></i><b>8.2.1</b> Gibbs sampling.</a></li>
<li class="chapter" data-level="8.2.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#hamiltonian-monte-carlo."><i class="fa fa-check"></i><b>8.2.2</b> Hamiltonian Monte Carlo.</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#easy-hmc-map2stan-brm"><i class="fa fa-check"></i><b>8.3</b> Easy HMC: <del>map2stan</del> <code>brm()</code></a><ul>
<li class="chapter" data-level="8.3.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#preparation."><i class="fa fa-check"></i><b>8.3.1</b> Preparation.</a></li>
<li class="chapter" data-level="8.3.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#estimation."><i class="fa fa-check"></i><b>8.3.2</b> Estimation.</a></li>
<li class="chapter" data-level="8.3.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#sampling-again-in-parallel."><i class="fa fa-check"></i><b>8.3.3</b> Sampling again, in parallel.</a></li>
<li class="chapter" data-level="8.3.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#visualization."><i class="fa fa-check"></i><b>8.3.4</b> Visualization.</a></li>
<li class="chapter" data-level="8.3.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#using-the-samples."><i class="fa fa-check"></i><b>8.3.5</b> Using the samples.</a></li>
<li class="chapter" data-level="8.3.6" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#checking-the-chain."><i class="fa fa-check"></i><b>8.3.6</b> Checking the chain.</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#care-and-feeding-of-your-markov-chain."><i class="fa fa-check"></i><b>8.4</b> Care and feeding of your Markov chain.</a><ul>
<li class="chapter" data-level="8.4.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>8.4.1</b> How many samples do you need?</a></li>
<li class="chapter" data-level="8.4.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-chains-do-you-need"><i class="fa fa-check"></i><b>8.4.2</b> How many chains do you need?</a></li>
<li class="chapter" data-level="8.4.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#taming-a-wild-chain."><i class="fa fa-check"></i><b>8.4.3</b> Taming a wild chain.</a></li>
<li class="chapter" data-level="8.4.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#non-identifiable-parameters."><i class="fa fa-check"></i><b>8.4.4</b> Non-identifiable parameters.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#reference-7"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>9</b> Big Entropy and the Generalized Linear Model</a><ul>
<li class="chapter" data-level="9.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>9.1</b> Maximum entropy</a><ul>
<li class="chapter" data-level="9.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#gaussian."><i class="fa fa-check"></i><b>9.1.1</b> Gaussian.</a></li>
<li class="chapter" data-level="9.1.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial."><i class="fa fa-check"></i><b>9.1.2</b> Binomial.</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>9.2</b> Generalized linear models</a><ul>
<li class="chapter" data-level="9.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family."><i class="fa fa-check"></i><b>9.2.1</b> Meet the family.</a></li>
<li class="chapter" data-level="9.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions."><i class="fa fa-check"></i><b>9.2.2</b> Linking linear models to distributions.</a></li>
<li class="chapter" data-level="9.2.3" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#absolute-and-relative-differences."><i class="fa fa-check"></i><b>9.2.3</b> Absolute and relative differences.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#reference-8"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="counting-and-classification.html"><a href="counting-and-classification.html"><i class="fa fa-check"></i><b>10</b> Counting and Classification</a><ul>
<li class="chapter" data-level="10.1" data-path="counting-and-classification.html"><a href="counting-and-classification.html#binomial-regression"><i class="fa fa-check"></i><b>10.1</b> Binomial regression</a><ul>
<li class="chapter" data-level="10.1.1" data-path="counting-and-classification.html"><a href="counting-and-classification.html#logistic-regression-prosocial-chimpanzees."><i class="fa fa-check"></i><b>10.1.1</b> Logistic regression: Prosocial chimpanzees.</a></li>
<li class="chapter" data-level="10.1.2" data-path="counting-and-classification.html"><a href="counting-and-classification.html#aggregated-binomial-chimpanzees-again-condensed."><i class="fa fa-check"></i><b>10.1.2</b> Aggregated binomial: Chimpanzees again, condensed.</a></li>
<li class="chapter" data-level="10.1.3" data-path="counting-and-classification.html"><a href="counting-and-classification.html#aggregated-binomial-graduate-school-admissions."><i class="fa fa-check"></i><b>10.1.3</b> Aggregated binomial: Graduate school admissions.</a></li>
<li class="chapter" data-level="10.1.4" data-path="counting-and-classification.html"><a href="counting-and-classification.html#fitting-binomial-regressions-with-glm."><i class="fa fa-check"></i><b>10.1.4</b> Fitting binomial regressions with <code>glm()</code>.</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="counting-and-classification.html"><a href="counting-and-classification.html#poisson-regression"><i class="fa fa-check"></i><b>10.2</b> Poisson regression</a><ul>
<li class="chapter" data-level="10.2.1" data-path="counting-and-classification.html"><a href="counting-and-classification.html#example-oceanic-tool-complexity."><i class="fa fa-check"></i><b>10.2.1</b> Example: Oceanic tool complexity.</a></li>
<li class="chapter" data-level="10.2.2" data-path="counting-and-classification.html"><a href="counting-and-classification.html#mcmc-islands."><i class="fa fa-check"></i><b>10.2.2</b> MCMC islands.</a></li>
<li class="chapter" data-level="10.2.3" data-path="counting-and-classification.html"><a href="counting-and-classification.html#example-exposure-and-the-offset."><i class="fa fa-check"></i><b>10.2.3</b> Example: Exposure and the offset.</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="counting-and-classification.html"><a href="counting-and-classification.html#other-count-regressions"><i class="fa fa-check"></i><b>10.3</b> Other count regressions</a><ul>
<li class="chapter" data-level="10.3.1" data-path="counting-and-classification.html"><a href="counting-and-classification.html#multinomial."><i class="fa fa-check"></i><b>10.3.1</b> Multinomial.</a></li>
<li class="chapter" data-level="10.3.2" data-path="counting-and-classification.html"><a href="counting-and-classification.html#geometric."><i class="fa fa-check"></i><b>10.3.2</b> Geometric.</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="counting-and-classification.html"><a href="counting-and-classification.html#summary"><i class="fa fa-check"></i><b>10.4</b> Summary</a></li>
<li class="chapter" data-level="" data-path="counting-and-classification.html"><a href="counting-and-classification.html#reference-9"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="counting-and-classification.html"><a href="counting-and-classification.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html"><i class="fa fa-check"></i><b>11</b> Monsters and Mixtures</a><ul>
<li class="chapter" data-level="11.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>11.1</b> Ordered categorical outcomes</a><ul>
<li class="chapter" data-level="11.1.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-moral-intuition."><i class="fa fa-check"></i><b>11.1.1</b> Example: Moral intuition.</a></li>
<li class="chapter" data-level="11.1.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#describing-an-ordered-distribution-with-intercepts."><i class="fa fa-check"></i><b>11.1.2</b> Describing an ordered distribution with intercepts.</a></li>
<li class="chapter" data-level="11.1.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#adding-predictor-variables."><i class="fa fa-check"></i><b>11.1.3</b> Adding predictor variables.</a></li>
<li class="chapter" data-level="11.1.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#bonus-figure-11.3-alternative."><i class="fa fa-check"></i><b>11.1.4</b> Bonus: Figure 11.3 alternative.</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>11.2</b> Zero-inflated outcomes</a><ul>
<li class="chapter" data-level="11.2.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-zero-inflated-poisson."><i class="fa fa-check"></i><b>11.2.1</b> Example: Zero-inflated Poisson.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersed-outcomes"><i class="fa fa-check"></i><b>11.3</b> Over-dispersed outcomes</a><ul>
<li class="chapter" data-level="11.3.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#beta-binomial."><i class="fa fa-check"></i><b>11.3.1</b> Beta-binomial.</a></li>
<li class="chapter" data-level="11.3.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#negative-binomial-or-gamma-poisson."><i class="fa fa-check"></i><b>11.3.2</b> Negative-binomial or gamma-Poisson.</a></li>
<li class="chapter" data-level="11.3.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersion-entropy-and-information-criteria."><i class="fa fa-check"></i><b>11.3.3</b> Over-dispersion, entropy, and information criteria.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#reference-10"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="multilevel-models.html"><a href="multilevel-models.html"><i class="fa fa-check"></i><b>12</b> Multilevel Models</a><ul>
<li class="chapter" data-level="12.1" data-path="multilevel-models.html"><a href="multilevel-models.html#example-multilevel-tadpoles"><i class="fa fa-check"></i><b>12.1</b> Example: Multilevel tadpoles</a></li>
<li class="chapter" data-level="12.2" data-path="multilevel-models.html"><a href="multilevel-models.html#varying-effects-and-the-underfittingoverfitting-trade-off"><i class="fa fa-check"></i><b>12.2</b> Varying effects and the underfitting/overfitting trade-off</a><ul>
<li class="chapter" data-level="12.2.1" data-path="multilevel-models.html"><a href="multilevel-models.html#the-model.-1"><i class="fa fa-check"></i><b>12.2.1</b> The model.</a></li>
<li class="chapter" data-level="12.2.2" data-path="multilevel-models.html"><a href="multilevel-models.html#assign-values-to-the-parameters."><i class="fa fa-check"></i><b>12.2.2</b> Assign values to the parameters.</a></li>
<li class="chapter" data-level="12.2.3" data-path="multilevel-models.html"><a href="multilevel-models.html#sumulate-survivors."><i class="fa fa-check"></i><b>12.2.3</b> Sumulate survivors.</a></li>
<li class="chapter" data-level="12.2.4" data-path="multilevel-models.html"><a href="multilevel-models.html#compute-the-no-pooling-estimates."><i class="fa fa-check"></i><b>12.2.4</b> Compute the no-pooling estimates.</a></li>
<li class="chapter" data-level="12.2.5" data-path="multilevel-models.html"><a href="multilevel-models.html#compute-the-partial-pooling-estimates."><i class="fa fa-check"></i><b>12.2.5</b> Compute the partial-pooling estimates.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="multilevel-models.html"><a href="multilevel-models.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>12.3</b> More than one type of cluster</a><ul>
<li class="chapter" data-level="12.3.1" data-path="multilevel-models.html"><a href="multilevel-models.html#multilevel-chimpanzees."><i class="fa fa-check"></i><b>12.3.1</b> Multilevel chimpanzees.</a></li>
<li class="chapter" data-level="12.3.2" data-path="multilevel-models.html"><a href="multilevel-models.html#two-types-of-cluster."><i class="fa fa-check"></i><b>12.3.2</b> Two types of cluster.</a></li>
<li class="chapter" data-level="12.3.3" data-path="multilevel-models.html"><a href="multilevel-models.html#even-more-clusters."><i class="fa fa-check"></i><b>12.3.3</b> Even more clusters.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="multilevel-models.html"><a href="multilevel-models.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>12.4</b> Multilevel posterior predictions</a><ul>
<li class="chapter" data-level="12.4.1" data-path="multilevel-models.html"><a href="multilevel-models.html#posterior-prediction-for-same-clusters."><i class="fa fa-check"></i><b>12.4.1</b> Posterior prediction for same clusters.</a></li>
<li class="chapter" data-level="12.4.2" data-path="multilevel-models.html"><a href="multilevel-models.html#posterior-prediction-for-new-clusters."><i class="fa fa-check"></i><b>12.4.2</b> Posterior prediction for new clusters.</a></li>
<li class="chapter" data-level="12.4.3" data-path="multilevel-models.html"><a href="multilevel-models.html#focus-and-multilevel-prediction."><i class="fa fa-check"></i><b>12.4.3</b> Focus and multilevel prediction.</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="multilevel-models.html"><a href="multilevel-models.html#summary-bonus-put-your-random-effects-to-work"><i class="fa fa-check"></i><b>12.5</b> <del>Summary</del> Bonus: Put your random effects to work</a><ul>
<li class="chapter" data-level="12.5.1" data-path="multilevel-models.html"><a href="multilevel-models.html#intercepts-only-models-with-one-or-two-grouping-variables."><i class="fa fa-check"></i><b>12.5.1</b> Intercepts-only models with one or two grouping variables.</a></li>
<li class="chapter" data-level="12.5.2" data-path="multilevel-models.html"><a href="multilevel-models.html#brmsposterior_samples."><i class="fa fa-check"></i><b>12.5.2</b> <code>brms::posterior_samples()</code>.</a></li>
<li class="chapter" data-level="12.5.3" data-path="multilevel-models.html"><a href="multilevel-models.html#brmscoef."><i class="fa fa-check"></i><b>12.5.3</b> <code>brms::coef()</code>.</a></li>
<li class="chapter" data-level="12.5.4" data-path="multilevel-models.html"><a href="multilevel-models.html#brmsfitted."><i class="fa fa-check"></i><b>12.5.4</b> <code>brms::fitted()</code>.</a></li>
<li class="chapter" data-level="12.5.5" data-path="multilevel-models.html"><a href="multilevel-models.html#tidybayesspread_draws."><i class="fa fa-check"></i><b>12.5.5</b> <code>tidybayes::spread_draws()</code>.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multilevel-models.html"><a href="multilevel-models.html#reference-11"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="multilevel-models.html"><a href="multilevel-models.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html"><i class="fa fa-check"></i><b>13</b> Adventures in Covariance</a><ul>
<li class="chapter" data-level="13.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>13.1</b> Varying slopes by construction</a><ul>
<li class="chapter" data-level="13.1.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-the-population."><i class="fa fa-check"></i><b>13.1.1</b> Simulate the population.</a></li>
<li class="chapter" data-level="13.1.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-observations."><i class="fa fa-check"></i><b>13.1.2</b> Simulate observations.</a></li>
<li class="chapter" data-level="13.1.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#the-varying-slopes-model."><i class="fa fa-check"></i><b>13.1.3</b> The varying slopes model.</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-admission-decisions-and-gender"><i class="fa fa-check"></i><b>13.2</b> Example: Admission decisions and gender</a><ul>
<li class="chapter" data-level="13.2.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-intercepts."><i class="fa fa-check"></i><b>13.2.1</b> Varying intercepts.</a></li>
<li class="chapter" data-level="13.2.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-effects-of-being-male."><i class="fa fa-check"></i><b>13.2.2</b> Varying effects of being <code>male</code>.</a></li>
<li class="chapter" data-level="13.2.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#shrinkage."><i class="fa fa-check"></i><b>13.2.3</b> Shrinkage.</a></li>
<li class="chapter" data-level="13.2.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#model-comparison.-1"><i class="fa fa-check"></i><b>13.2.4</b> Model comparison.</a></li>
<li class="chapter" data-level="13.2.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#more-slopes."><i class="fa fa-check"></i><b>13.2.5</b> More slopes.</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-cross-classified-chimpanzees-with-varying-slopes"><i class="fa fa-check"></i><b>13.3</b> Example: Cross-classified <code>chimpanzees</code> with varying slopes</a></li>
<li class="chapter" data-level="13.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>13.4</b> Continuous categories and the Gaussian process</a><ul>
<li class="chapter" data-level="13.4.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-spatial-autocorrelation-in-oceanic-tools."><i class="fa fa-check"></i><b>13.4.1</b> Example: Spatial autocorrelation in Oceanic tools.</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#summary-bonus-another-berkley-admissions-data-like-example."><i class="fa fa-check"></i><b>13.5</b> <del>Summary</del> Bonus: Another Berkley-admissions-data-like example.</a></li>
<li class="chapter" data-level="" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#reference-12"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#session-info-12"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html"><i class="fa fa-check"></i><b>14</b> Missing Data and Other Opportunities</a><ul>
<li class="chapter" data-level="14.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#measurement-error"><i class="fa fa-check"></i><b>14.1</b> Measurement error</a><ul>
<li class="chapter" data-level="14.1.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#error-on-the-outcome."><i class="fa fa-check"></i><b>14.1.1</b> Error on the outcome.</a></li>
<li class="chapter" data-level="14.1.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#error-on-both-outcome-and-predictor."><i class="fa fa-check"></i><b>14.1.2</b> Error on both outcome and predictor.</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#missing-data"><i class="fa fa-check"></i><b>14.2</b> Missing data</a><ul>
<li class="chapter" data-level="14.2.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#imputing-neocortex"><i class="fa fa-check"></i><b>14.2.1</b> Imputing <code>neocortex</code></a></li>
<li class="chapter" data-level="14.2.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#improving-the-imputation-model"><i class="fa fa-check"></i><b>14.2.2</b> Improving the imputation model</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#summary-bonus-meta-analysis"><i class="fa fa-check"></i><b>14.3</b> <del>Summary</del> Bonus: Meta-analysis</a></li>
<li class="chapter" data-level="" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#reference-13"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#session-info-13"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html"><i class="fa fa-check"></i><b>15</b> <del>Horoscopes</del> Insights</a><ul>
<li class="chapter" data-level="15.1" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#use-r-notebooks"><i class="fa fa-check"></i><b>15.1</b> Use R Notebooks</a></li>
<li class="chapter" data-level="15.2" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#save-your-model-fits"><i class="fa fa-check"></i><b>15.2</b> Save your model fits</a></li>
<li class="chapter" data-level="15.3" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#build-your-models-slowly"><i class="fa fa-check"></i><b>15.3</b> Build your models slowly</a></li>
<li class="chapter" data-level="15.4" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#look-at-your-data"><i class="fa fa-check"></i><b>15.4</b> Look at your data</a></li>
<li class="chapter" data-level="15.5" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#use-the-0-intercept-syntax"><i class="fa fa-check"></i><b>15.5</b> Use the <code>0 + Intercept</code> syntax</a></li>
<li class="chapter" data-level="15.6" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#annotate-your-workflow"><i class="fa fa-check"></i><b>15.6</b> Annotate your workflow</a></li>
<li class="chapter" data-level="15.7" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#annotate-your-code"><i class="fa fa-check"></i><b>15.7</b> Annotate your code</a></li>
<li class="chapter" data-level="15.8" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#break-up-your-workflow"><i class="fa fa-check"></i><b>15.8</b> Break up your workflow</a></li>
<li class="chapter" data-level="15.9" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#code-in-public"><i class="fa fa-check"></i><b>15.9</b> Code in public</a></li>
<li class="chapter" data-level="15.10" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#read-gelmans-blog"><i class="fa fa-check"></i><b>15.10</b> Read Gelman’s blog</a></li>
<li class="chapter" data-level="15.11" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#check-out-other-social-media-too"><i class="fa fa-check"></i><b>15.11</b> Check out other social media, too</a></li>
<li class="chapter" data-level="15.12" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#parting-wisdom"><i class="fa fa-check"></i><b>15.12</b> Parting wisdom</a></li>
<li class="chapter" data-level="" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#reference-14"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#session-info-14"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Statistical Rethinking</em> with brms, ggplot2, and the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="monsters-and-mixtures" class="section level1">
<h1><span class="header-section-number">11</span> Monsters and Mixtures</h1>
<blockquote>
<p>[Of these majestic creatures], we’ll consider two common and useful examples. The first type is the <strong>ordered categorical</strong> model, useful for categorical outcomes with a fixed ordering. This model is built by merging a categorical likelihood function with a special kind of link function, usually a <strong>cumulative link</strong>. The second type is a family of <strong>zero-inflated</strong> and <strong>zero-augmented</strong> models, each of which mixes a binary event within an ordinary GLM likelihood like a Poisson or binomial.</p>
<p>Both types of models help us transform our modeling to cope with the inconvenient realities of measurement, rather than transforming measurements to cope with the constraints of our models. (p. 331, <strong>emphasis</strong> in the original)</p>
</blockquote>
<div id="ordered-categorical-outcomes" class="section level2">
<h2><span class="header-section-number">11.1</span> Ordered categorical outcomes</h2>
<blockquote>
<p>It is very common in the social sciences, and occasional in the natural sciences, to have an outcome variable that is discrete, like a count, but in which the values merely indicate different ordered <em>levels</em> along some dimension. For example, if I were to ask you how much you like to eat fish, on a scale from 1 to 7, you might say 5. If I were to ask 100 people the same question, I’d end up with 100 values between 1 and 7. In modeling each outcome value, I’d have to keep in mind that these values are <em>ordered</em> because 7 is greater than 6, which is greater than 5, and so on. But unlike a count, the differences in values are not necessarily equal.</p>
<p>In principle, an ordered categorical variable is just a multinomial prediction problem (page 323). But the constraint that the categories be ordered demands special treatment…</p>
<p>The conventional solution is to use a cumulative link function. The cumulative probability of a value is the probability of that <em>value or any smaller value</em>. (pp. 331–332, <em>emphasis</em> in the original)</p>
</blockquote>
<div id="example-moral-intuition." class="section level3">
<h3><span class="header-section-number">11.1.1</span> Example: Moral intuition.</h3>
<p>Let’s get the <code>Trolley</code> data from rethinking (see <a href="https://journals.sagepub.com/doi/pdf/10.1111/j.1467-9280.2006.01834.x">Cushman, Young &amp; Hauser, 2006</a>).</p>
<div class="sourceCode" id="cb1117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1117-1" data-line-number="1"><span class="kw">library</span>(rethinking)</a>
<a class="sourceLine" id="cb1117-2" data-line-number="2"><span class="kw">data</span>(Trolley)</a>
<a class="sourceLine" id="cb1117-3" data-line-number="3">d &lt;-<span class="st"> </span>Trolley</a></code></pre></div>
<p>Unload rethinking and load brms.</p>
<div class="sourceCode" id="cb1118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1118-1" data-line-number="1"><span class="kw">rm</span>(Trolley)</a>
<a class="sourceLine" id="cb1118-2" data-line-number="2"><span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)</a>
<a class="sourceLine" id="cb1118-3" data-line-number="3"><span class="kw">library</span>(brms)</a></code></pre></div>
<p>Use the <code>dplyr::glimpse()</code> to get a sense of the dimensions of the data.</p>
<div class="sourceCode" id="cb1119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1119-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1119-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1119-3" data-line-number="3"><span class="kw">glimpse</span>(d)</a></code></pre></div>
<pre><code>## Observations: 9,930
## Variables: 12
## $ case      &lt;fct&gt; cfaqu, cfbur, cfrub, cibox, cibur, cispe, fkaqu, fkboa, fkbox, fkbur, fkcar, fkspe, fkswi…
## $ response  &lt;int&gt; 4, 3, 4, 3, 3, 3, 5, 4, 4, 4, 4, 4, 4, 5, 4, 4, 4, 4, 4, 3, 3, 3, 4, 4, 5, 4, 4, 3, 4, 4,…
## $ order     &lt;int&gt; 2, 31, 16, 32, 4, 9, 29, 12, 23, 22, 27, 19, 14, 3, 18, 15, 30, 5, 1, 13, 20, 17, 28, 10,…
## $ id        &lt;fct&gt; 96;434, 96;434, 96;434, 96;434, 96;434, 96;434, 96;434, 96;434, 96;434, 96;434, 96;434, 9…
## $ age       &lt;int&gt; 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 1…
## $ male      &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ edu       &lt;fct&gt; Middle School, Middle School, Middle School, Middle School, Middle School, Middle School,…
## $ action    &lt;int&gt; 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1,…
## $ intention &lt;int&gt; 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,…
## $ contact   &lt;int&gt; 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ story     &lt;fct&gt; aqu, bur, rub, box, bur, spe, aqu, boa, box, bur, car, spe, swi, boa, car, che, sha, swi,…
## $ action2   &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1,…</code></pre>
<p>Though we have 9,930 rows, we only have 331 unique individuals.</p>
<div class="sourceCode" id="cb1121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1121-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1121-2" data-line-number="2"><span class="st">  </span><span class="kw">distinct</span>(id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1121-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>()</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1   331</code></pre>
</div>
<div id="describing-an-ordered-distribution-with-intercepts." class="section level3">
<h3><span class="header-section-number">11.1.2</span> Describing an ordered distribution with intercepts.</h3>
<p>Before we get to plotting, in this chapter we’ll use theme settings and a color palette from the <a href="https://cran.r-project.org/package=ggthemes">ggthemes package</a>.</p>
<div class="sourceCode" id="cb1123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1123-1" data-line-number="1"><span class="kw">library</span>(ggthemes)</a></code></pre></div>
<p>We’ll take our basic theme settings from the <code>theme_hc()</code> function. We’ll use the <code>Green fields</code> color palette, which we can inspect with the <code>canva_pal()</code> function and a little help from <code>scales::show_col()</code>.</p>
<div class="sourceCode" id="cb1124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1124-1" data-line-number="1">scales<span class="op">::</span><span class="kw">show_col</span>(<span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>))</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-7-1.png" width="672" /></p>
<div class="sourceCode" id="cb1125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1125-1" data-line-number="1"><span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)</a></code></pre></div>
<pre><code>## [1] &quot;#919636&quot; &quot;#524a3a&quot; &quot;#fffae1&quot; &quot;#5a5f37&quot;</code></pre>
<div class="sourceCode" id="cb1127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1127-1" data-line-number="1"><span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">3</span>]</a></code></pre></div>
<pre><code>## [1] &quot;#fffae1&quot;</code></pre>
<p>Now we’re ready to make our version of the simple Figure 11.1 histogram of our primary variable, <code>response</code>.</p>
<div class="sourceCode" id="cb1129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1129-1" data-line-number="1">p1 &lt;-</a>
<a class="sourceLine" id="cb1129-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">data =</span> d, <span class="kw">aes</span>(<span class="dt">x =</span> response, <span class="dt">fill =</span> ..x..)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1129-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">size =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1129-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1129-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low  =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1129-6" data-line-number="6">                      <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1129-7" data-line-number="7"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1129-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1129-9" data-line-number="9">        <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>),</a>
<a class="sourceLine" id="cb1129-10" data-line-number="10">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb1129-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1129-12" data-line-number="12">p1</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-8-1.png" width="240" /></p>
<p>Our cumulative proportion plot, Figure 11.1.b, will require some pre-plot wrangling.</p>
<div class="sourceCode" id="cb1130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1130-1" data-line-number="1">p2 &lt;-</a>
<a class="sourceLine" id="cb1130-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1130-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(response) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1130-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pr_k     =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(d),</a>
<a class="sourceLine" id="cb1130-5" data-line-number="5">         <span class="dt">cum_pr_k =</span> <span class="kw">cumsum</span>(pr_k)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1130-6" data-line-number="6"><span class="st">  </span></a>
<a class="sourceLine" id="cb1130-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> response, <span class="dt">y =</span> cum_pr_k, </a>
<a class="sourceLine" id="cb1130-8" data-line-number="8">             <span class="dt">fill =</span> response)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1130-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1130-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>, </a>
<a class="sourceLine" id="cb1130-11" data-line-number="11">             <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">stroke =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1130-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1130-13" data-line-number="13"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;cumulative proportion&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1130-14" data-line-number="14"><span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low  =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1130-15" data-line-number="15">                      <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1130-16" data-line-number="16"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1130-17" data-line-number="17"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1130-18" data-line-number="18"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1130-19" data-line-number="19">        <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>),</a>
<a class="sourceLine" id="cb1130-20" data-line-number="20">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb1130-21" data-line-number="21"></a>
<a class="sourceLine" id="cb1130-22" data-line-number="22">p2</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-9-1.png" width="240" /></p>
<p>In order to make the next plot, we’ll need McElreath’s <code>logit()</code> function. Here it is, the logarithm of cumulative odds plot, Figure 11.1.c.</p>
<div class="sourceCode" id="cb1131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1131-1" data-line-number="1"><span class="co"># McElreath&#39;s convenience function from page 335</span></a>
<a class="sourceLine" id="cb1131-2" data-line-number="2">logit &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">log</span>(x <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x))</a>
<a class="sourceLine" id="cb1131-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1131-4" data-line-number="4">p3 &lt;-</a>
<a class="sourceLine" id="cb1131-5" data-line-number="5"><span class="st">  </span>d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1131-6" data-line-number="6"><span class="st">  </span><span class="kw">count</span>(response) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1131-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cum_pr_k =</span> <span class="kw">cumsum</span>(n <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(d))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1131-8" data-line-number="8"><span class="st">  </span><span class="kw">filter</span>(response <span class="op">&lt;</span><span class="st"> </span><span class="dv">7</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1131-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb1131-10" data-line-number="10"><span class="st">  </span><span class="co"># we can do the `logit()` conversion right in ggplot2</span></a>
<a class="sourceLine" id="cb1131-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> response, <span class="dt">y =</span> <span class="kw">logit</span>(cum_pr_k), </a>
<a class="sourceLine" id="cb1131-12" data-line-number="12">             <span class="dt">fill =</span> response)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1131-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1131-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">colour =</span> <span class="st">&quot;grey92&quot;</span>, </a>
<a class="sourceLine" id="cb1131-15" data-line-number="15">             <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">stroke =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1131-16" data-line-number="16"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1131-17" data-line-number="17"><span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low  =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1131-18" data-line-number="18">                      <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1131-19" data-line-number="19"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">7</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1131-20" data-line-number="20"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;log-cumulative-odds&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1131-21" data-line-number="21"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1131-22" data-line-number="22"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1131-23" data-line-number="23">        <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>),</a>
<a class="sourceLine" id="cb1131-24" data-line-number="24">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb1131-25" data-line-number="25"></a>
<a class="sourceLine" id="cb1131-26" data-line-number="26">p3</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-10-1.png" width="240" /></p>
<p>Why not combine the three subplots with patchwork?</p>
<div class="sourceCode" id="cb1132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1132-1" data-line-number="1"><span class="kw">library</span>(patchwork)</a>
<a class="sourceLine" id="cb1132-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1132-3" data-line-number="3">p1 <span class="op">|</span><span class="st"> </span>p2 <span class="op">|</span><span class="st"> </span>p3</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-11-1.png" width="672" /></p>
<p>The code for Figure 11.2 is itself something of a monster.</p>
<div class="sourceCode" id="cb1133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1133-1" data-line-number="1">d_plot &lt;-</a>
<a class="sourceLine" id="cb1133-2" data-line-number="2"><span class="st">  </span>d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1133-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(response) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1133-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pr_k     =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(d),</a>
<a class="sourceLine" id="cb1133-5" data-line-number="5">         <span class="dt">cum_pr_k =</span> <span class="kw">cumsum</span>(n <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(d))) </a>
<a class="sourceLine" id="cb1133-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1133-7" data-line-number="7"><span class="kw">ggplot</span>(<span class="dt">data =</span> d_plot,</a>
<a class="sourceLine" id="cb1133-8" data-line-number="8">       <span class="kw">aes</span>(<span class="dt">x =</span> response, <span class="dt">y =</span> cum_pr_k,</a>
<a class="sourceLine" id="cb1133-9" data-line-number="9">           <span class="dt">color =</span> cum_pr_k, <span class="dt">fill =</span> cum_pr_k)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1133-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1133-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">colour =</span> <span class="st">&quot;grey92&quot;</span>, </a>
<a class="sourceLine" id="cb1133-12" data-line-number="12">             <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">stroke =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1133-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_linerange</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> cum_pr_k),</a>
<a class="sourceLine" id="cb1133-14" data-line-number="14">                 <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1133-15" data-line-number="15"><span class="st">  </span><span class="co"># there must be more elegant ways to do this part</span></a>
<a class="sourceLine" id="cb1133-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_linerange</span>(<span class="dt">data =</span> . <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1133-17" data-line-number="17"><span class="st">                   </span><span class="kw">mutate</span>(<span class="dt">discrete_probability =</span></a>
<a class="sourceLine" id="cb1133-18" data-line-number="18">                            <span class="kw">ifelse</span>(response <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, cum_pr_k,</a>
<a class="sourceLine" id="cb1133-19" data-line-number="19">                                   cum_pr_k <span class="op">-</span><span class="st"> </span>pr_k)),</a>
<a class="sourceLine" id="cb1133-20" data-line-number="20">                 <span class="kw">aes</span>(<span class="dt">x =</span> response <span class="op">+</span><span class="st"> </span><span class="fl">.025</span>,</a>
<a class="sourceLine" id="cb1133-21" data-line-number="21">                     <span class="dt">ymin =</span> <span class="kw">ifelse</span>(response <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">0</span>, discrete_probability), </a>
<a class="sourceLine" id="cb1133-22" data-line-number="22">                     <span class="dt">ymax =</span> cum_pr_k),</a>
<a class="sourceLine" id="cb1133-23" data-line-number="23">                 <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1133-24" data-line-number="24"><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb1133-25" data-line-number="25">    <span class="dt">text     =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>,</a>
<a class="sourceLine" id="cb1133-26" data-line-number="26">    <span class="dt">response =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">1.25</span>, <span class="dt">to =</span> <span class="fl">7.25</span>, <span class="dt">by =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1133-27" data-line-number="27">    <span class="dt">cum_pr_k =</span> d_plot<span class="op">$</span>cum_pr_k <span class="op">-</span><span class="st"> </span><span class="fl">.065</span></a>
<a class="sourceLine" id="cb1133-28" data-line-number="28">  ), <span class="kw">aes</span>(<span class="dt">label =</span> text),</a>
<a class="sourceLine" id="cb1133-29" data-line-number="29">  <span class="dt">size =</span> <span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1133-30" data-line-number="30"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1133-31" data-line-number="31"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;cumulative proportion&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1133-32" data-line-number="32"><span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low  =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1133-33" data-line-number="33">                      <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1133-34" data-line-number="34"><span class="st">  </span><span class="kw">scale_color_gradient</span>(<span class="dt">low  =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1133-35" data-line-number="35">                       <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1133-36" data-line-number="36"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1133-37" data-line-number="37"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1133-38" data-line-number="38">        <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>),</a>
<a class="sourceLine" id="cb1133-39" data-line-number="39">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-12-1.png" width="336" /></p>
<p>McElreath’s convention for this first type of statistical model is</p>
<p><span class="math display">\[\begin{align*} 
R_i &amp; \sim \text{Ordered} (\mathbf p) \\
\text{logit} (p_k) &amp; = \alpha_k \\
\alpha_k           &amp; \sim \text{Normal} (0, 10).
\end{align*}\]</span></p>
<blockquote>
<p>The Ordered distribution is really just a categorical distribution that takes a vector <span class="math inline">\(\mathbf p = {p_1, p_2, p_3, p_4, p_5, p_6}\)</span> of probabilities of each response value below the maximum response (7 in this example). Each response value <span class="math inline">\(k\)</span> in this vector is defined by its link to an intercept parameter, <span class="math inline">\(\alpha_k\)</span>. Finally, some weakly regularizing priors are placed on these intercepts. (p. 335)</p>
</blockquote>
<p>Whereas in <code>rethinking::map()</code> you indicate the likelihood by <code>&lt;criterion&gt; ~ dordlogit(phi , c(&lt;the thresholds&gt;)</code>, in <code>brms::brm()</code> you code <code>family = cumulative</code>. Here’s how to fit the intercepts-only model.</p>
<div class="sourceCode" id="cb1134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1134-1" data-line-number="1"><span class="co"># define the start values</span></a>
<a class="sourceLine" id="cb1134-2" data-line-number="2">inits &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">`</span><span class="dt">Intercept[1]</span><span class="st">`</span> =<span class="st"> </span><span class="dv">-2</span>,</a>
<a class="sourceLine" id="cb1134-3" data-line-number="3">              <span class="st">`</span><span class="dt">Intercept[2]</span><span class="st">`</span> =<span class="st"> </span><span class="dv">-1</span>,</a>
<a class="sourceLine" id="cb1134-4" data-line-number="4">              <span class="st">`</span><span class="dt">Intercept[3]</span><span class="st">`</span> =<span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1134-5" data-line-number="5">              <span class="st">`</span><span class="dt">Intercept[4]</span><span class="st">`</span> =<span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1134-6" data-line-number="6">              <span class="st">`</span><span class="dt">Intercept[5]</span><span class="st">`</span> =<span class="st"> </span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb1134-7" data-line-number="7">              <span class="st">`</span><span class="dt">Intercept[6]</span><span class="st">`</span> =<span class="st"> </span><span class="fl">2.5</span>)</a>
<a class="sourceLine" id="cb1134-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1134-9" data-line-number="9">inits_list &lt;-<span class="st"> </span><span class="kw">list</span>(inits, inits)</a>
<a class="sourceLine" id="cb1134-10" data-line-number="10"></a>
<a class="sourceLine" id="cb1134-11" data-line-number="11">b11<span class="fl">.1</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1134-12" data-line-number="12"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb1134-13" data-line-number="13">      <span class="dt">family =</span> cumulative,</a>
<a class="sourceLine" id="cb1134-14" data-line-number="14">      response <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1134-15" data-line-number="15">      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb1134-16" data-line-number="16">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">cores =</span> <span class="dv">2</span>, <span class="dt">chains =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb1134-17" data-line-number="17">      <span class="dt">inits =</span> inits_list,  <span class="co"># here we add our start values</span></a>
<a class="sourceLine" id="cb1134-18" data-line-number="18">      <span class="dt">seed =</span> <span class="dv">11</span>,</a>
<a class="sourceLine" id="cb1134-19" data-line-number="19">      <span class="dt">file =</span> <span class="st">&quot;fits/b11.01&quot;</span>)</a></code></pre></div>
<p>McElreath needed to include the <code>depth=2</code> argument in the <code>rethinking::precis()</code> function to show the threshold parameters from his <code>m11.1stan</code> model (R code 11.8). With a <code>brm()</code> fit, we just use <code>print()</code> or <code>summary()</code> as usual.</p>
<div class="sourceCode" id="cb1135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1135-1" data-line-number="1"><span class="kw">print</span>(b11<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>##  Family: cumulative 
##   Links: mu = logit; disc = identity 
## Formula: response ~ 1 
##    Data: d (Number of observations: 9930) 
## Samples: 2 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 2000
## 
## Population-Level Effects: 
##              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept[1]    -1.92      0.03    -1.98    -1.86 1.00     1412     1559
## Intercept[2]    -1.27      0.02    -1.32    -1.22 1.00     2077     1577
## Intercept[3]    -0.72      0.02    -0.76    -0.68 1.01     2327     1790
## Intercept[4]     0.25      0.02     0.21     0.29 1.01     2480     1849
## Intercept[5]     0.89      0.02     0.85     0.93 1.00     2317     1619
## Intercept[6]     1.77      0.03     1.72     1.83 1.00     2268     1700
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>What McElreath’s <code>m11.1stan</code> summary termed <code>cutpoints[k]</code>, our brms summary termed <code>Intercept[k]</code>. In both cases, these are the <span class="math inline">\(\alpha_k\)</span> parameters from the equations, above (i.e., the thresholds). The summaries look like those in the text, the <span class="math inline">\(\hat R\)</span> values are great, and both measures of effective sample size are reasonably high. The model looks good.</p>
<p>Recall we use the <code>brms::inv_logit_scaled()</code> function in place of McElreath’s <code>logistic()</code> function to get these into the probability metric.</p>
<div class="sourceCode" id="cb1137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1137-1" data-line-number="1">b11<span class="fl">.1</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1137-2" data-line-number="2"><span class="st">  </span><span class="kw">fixef</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1137-3" data-line-number="3"><span class="st">  </span><span class="kw">inv_logit_scaled</span>()</a></code></pre></div>
<pre><code>##               Estimate Est.Error      Q2.5     Q97.5
## Intercept[1] 0.1282391 0.5074704 0.1218269 0.1347796
## Intercept[2] 0.2197094 0.5060889 0.2112961 0.2275291
## Intercept[3] 0.3276483 0.5053775 0.3182959 0.3365989
## Intercept[4] 0.5616142 0.5051448 0.5521704 0.5714020
## Intercept[5] 0.7089929 0.5055609 0.7002765 0.7177224
## Intercept[6] 0.8544314 0.5070249 0.8477435 0.8612121</code></pre>
<p>But recall that the posterior <span class="math inline">\(SD\)</span> (i.e., the ‘Est.Error’ values) are not valid using that approach. If you really care about them, you’ll need to work with the <code>posterior_samples()</code>.</p>
<div class="sourceCode" id="cb1139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1139-1" data-line-number="1"><span class="kw">posterior_samples</span>(b11<span class="fl">.1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1139-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;b_&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1139-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate_all</span>(inv_logit_scaled) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1139-4" data-line-number="4"><span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1139-5" data-line-number="5"><span class="st">  </span><span class="kw">group_by</span>(key) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1139-6" data-line-number="6"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(value),</a>
<a class="sourceLine" id="cb1139-7" data-line-number="7">            <span class="dt">sd   =</span> <span class="kw">sd</span>(value),</a>
<a class="sourceLine" id="cb1139-8" data-line-number="8">            <span class="dt">ll   =</span> <span class="kw">quantile</span>(value, <span class="dt">probs =</span> <span class="fl">.025</span>),</a>
<a class="sourceLine" id="cb1139-9" data-line-number="9">            <span class="dt">ul   =</span> <span class="kw">quantile</span>(value, <span class="dt">probs =</span> <span class="fl">.975</span>))</a></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   key             mean      sd    ll    ul
##   &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 b_Intercept[1] 0.128 0.00334 0.122 0.135
## 2 b_Intercept[2] 0.220 0.00417 0.211 0.228
## 3 b_Intercept[3] 0.328 0.00474 0.318 0.337
## 4 b_Intercept[4] 0.562 0.00507 0.552 0.571
## 5 b_Intercept[5] 0.709 0.00459 0.700 0.718
## 6 b_Intercept[6] 0.854 0.00349 0.848 0.861</code></pre>
<p>And just to confirm, those posterior means are centered right around the <code>cum_pr_k</code> we computed for Figure 11.2.</p>
<div class="sourceCode" id="cb1141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1141-1" data-line-number="1">d_plot <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1141-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(response, cum_pr_k)</a></code></pre></div>
<pre><code>## # A tibble: 7 x 2
##   response cum_pr_k
##      &lt;int&gt;    &lt;dbl&gt;
## 1        1    0.128
## 2        2    0.220
## 3        3    0.328
## 4        4    0.562
## 5        5    0.709
## 6        6    0.854
## 7        7    1</code></pre>
</div>
<div id="adding-predictor-variables." class="section level3">
<h3><span class="header-section-number">11.1.3</span> Adding predictor variables.</h3>
<p>Now we define the linear model as <span class="math inline">\(\phi_i = \beta x_i\)</span>. Accordingly, the formula for our cumulative logit model becomes</p>
<p><span class="math display">\[\begin{align*}
\text{log} \frac{\text{Pr} (y_i \leq k)}{1 - \text{Pr} (y_i \leq k)} &amp; = \alpha_k - \phi_i \\
\phi_i &amp; = \beta x_i.
\end{align*}\]</span></p>
<p>I’m not aware that brms has an equivalent to the <code>rethinking::dordlogit()</code> function. So here we’ll make it by hand. The code comes from McElreath’s <a href="https://github.com/rmcelreath/rethinking/blob/a309712d904d1db7af1e08a76c521ab994006fd5/R/distributions.r">GitHub page</a>.</p>
<div class="sourceCode" id="cb1143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1143-1" data-line-number="1">logistic &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1143-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb1143-3" data-line-number="3">  p &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>x))</a>
<a class="sourceLine" id="cb1143-4" data-line-number="4">  p &lt;-<span class="st"> </span><span class="kw">ifelse</span>(x <span class="op">==</span><span class="st"> </span><span class="ot">Inf</span>, <span class="dv">1</span>, p)</a>
<a class="sourceLine" id="cb1143-5" data-line-number="5">  p</a>
<a class="sourceLine" id="cb1143-6" data-line-number="6">  </a>
<a class="sourceLine" id="cb1143-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb1143-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1143-9" data-line-number="9"><span class="co"># now we get down to it</span></a>
<a class="sourceLine" id="cb1143-10" data-line-number="10">dordlogit &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1143-11" data-line-number="11"><span class="st">  </span><span class="cf">function</span>(x, phi, a, <span class="dt">log =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb1143-12" data-line-number="12">    </a>
<a class="sourceLine" id="cb1143-13" data-line-number="13">    a  &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">as.numeric</span>(a), <span class="ot">Inf</span>)</a>
<a class="sourceLine" id="cb1143-14" data-line-number="14">    p  &lt;-<span class="st"> </span><span class="kw">logistic</span>(a[x] <span class="op">-</span><span class="st"> </span>phi)</a>
<a class="sourceLine" id="cb1143-15" data-line-number="15">    na &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, a)</a>
<a class="sourceLine" id="cb1143-16" data-line-number="16">    np &lt;-<span class="st"> </span><span class="kw">logistic</span>(na[x] <span class="op">-</span><span class="st"> </span>phi)</a>
<a class="sourceLine" id="cb1143-17" data-line-number="17">    p  &lt;-<span class="st"> </span>p <span class="op">-</span><span class="st"> </span>np</a>
<a class="sourceLine" id="cb1143-18" data-line-number="18">    <span class="cf">if</span> (log <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) p &lt;-<span class="st"> </span><span class="kw">log</span>(p)</a>
<a class="sourceLine" id="cb1143-19" data-line-number="19">    p</a>
<a class="sourceLine" id="cb1143-20" data-line-number="20">    </a>
<a class="sourceLine" id="cb1143-21" data-line-number="21">  }</a></code></pre></div>
<p>The <code>dordlogit()</code> function works like this:</p>
<div class="sourceCode" id="cb1144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1144-1" data-line-number="1">(pk &lt;-<span class="st"> </span><span class="kw">dordlogit</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>, <span class="dv">0</span>, <span class="kw">fixef</span>(b11<span class="fl">.1</span>)[, <span class="dv">1</span>]))</a></code></pre></div>
<pre><code>## [1] 0.12823907 0.09147031 0.10793896 0.23396581 0.14737872 0.14543856 0.14556857</code></pre>
<p>Note the slight difference in how we used <code>dordlogit()</code> with a <code>brm()</code> fit summarized by <code>fixef()</code> than the way McElreath did with a <code>map2stan()</code> fit summarized by <code>coef()</code>. McElreath just put <code>coef(m11.1)</code> into <code>dordlogit()</code>. We, however, more specifically placed <code>fixef(b11.1)[, 1]</code> into the function. With the <code>[, 1]</code> part, we specified that we were working with the posterior means (i.e., <code>Estimate</code>) and neglecting the other summaries (i.e., the posterior <em>SD</em>s and 95% intervals). If you forget to subset, chaos ensues.</p>
<p>Next, as McElreath further noted on page 338, “these probabilities imply an average outcome of:”</p>
<div class="sourceCode" id="cb1146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1146-1" data-line-number="1"><span class="kw">sum</span>(pk <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>))</a></code></pre></div>
<pre><code>## [1] 4.199365</code></pre>
<p>I found that a bit abstract. Here’s the thing in a more elaborate tibble format.</p>
<div class="sourceCode" id="cb1148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1148-1" data-line-number="1">(</a>
<a class="sourceLine" id="cb1148-2" data-line-number="2">  explicit_example &lt;-</a>
<a class="sourceLine" id="cb1148-3" data-line-number="3"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">probability_of_a_response =</span> pk) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1148-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">the_response =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1148-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">their_product =</span> probability_of_a_response <span class="op">*</span><span class="st"> </span>the_response)</a>
<a class="sourceLine" id="cb1148-6" data-line-number="6">)</a></code></pre></div>
<pre><code>## # A tibble: 7 x 3
##   probability_of_a_response the_response their_product
##                       &lt;dbl&gt;        &lt;int&gt;         &lt;dbl&gt;
## 1                    0.128             1         0.128
## 2                    0.0915            2         0.183
## 3                    0.108             3         0.324
## 4                    0.234             4         0.936
## 5                    0.147             5         0.737
## 6                    0.145             6         0.873
## 7                    0.146             7         1.02</code></pre>
<div class="sourceCode" id="cb1150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1150-1" data-line-number="1">explicit_example <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1150-2" data-line-number="2"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">average_outcome_value =</span> <span class="kw">sum</span>(their_product))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   average_outcome_value
##                   &lt;dbl&gt;
## 1                  4.20</code></pre>
<p><strong>Aside</strong></p>
<p>This made me wonder how this would compare if we were lazy and ignored the categorical nature of the <code>response</code>. Here we refit the model with the typical Gaussian likelihood.</p>
<div class="sourceCode" id="cb1152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1152-1" data-line-number="1">b11<span class="fl">.1</span>b &lt;-</a>
<a class="sourceLine" id="cb1152-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> gaussian,</a>
<a class="sourceLine" id="cb1152-3" data-line-number="3">      response <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1152-4" data-line-number="4">      <span class="co"># in this case, 4 (i.e., the middle response) seems to be the conservative place to put the mean</span></a>
<a class="sourceLine" id="cb1152-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">4</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb1152-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">cauchy</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sigma)),</a>
<a class="sourceLine" id="cb1152-7" data-line-number="7">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">chains =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb1152-8" data-line-number="8">      <span class="dt">seed =</span> <span class="dv">11</span>,</a>
<a class="sourceLine" id="cb1152-9" data-line-number="9">      <span class="dt">file =</span> <span class="st">&quot;fits/b11.01b&quot;</span>)</a></code></pre></div>
<p>Check the summary.</p>
<div class="sourceCode" id="cb1153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1153-1" data-line-number="1"><span class="kw">print</span>(b11<span class="fl">.1</span>b)</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: response ~ 1 
##    Data: d (Number of observations: 9930) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     4.20      0.02     4.16     4.24 1.00     2633     2369
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     1.91      0.01     1.88     1.93 1.00     3077     2479
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>This yielded a posterior mean of 4.2, much like our <code>average_outcome_value</code>, above. However, the lazy Gaussian model now has a <span class="math inline">\(\sigma\)</span> parameter, whereas <span class="math inline">\(\sigma\)</span> is a function of the probability estimate in the more-appropriate <code>b11.2</code> model (see section 11.3). If you only care about mean estimates, this won’t matter much if you have a lot of data and the mean is far from the boundary. But when your posterior means get close to the upper or lower boundary, the lazy Gaussian model will yield silly estimates for the 95% intervals. Beware the lazy Gaussian model with data like this.</p>
<p><strong>End aside</strong></p>
<p>Now we’ll try it by subtracting .5 from each.</p>
<div class="sourceCode" id="cb1155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1155-1" data-line-number="1"><span class="co"># the probabilities of a given response</span></a>
<a class="sourceLine" id="cb1155-2" data-line-number="2">(pk &lt;-<span class="st"> </span><span class="kw">dordlogit</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>, <span class="dv">0</span>, <span class="kw">fixef</span>(b11<span class="fl">.1</span>)[, <span class="dv">1</span>] <span class="op">-</span><span class="st"> </span><span class="fl">.5</span>))</a></code></pre></div>
<pre><code>## [1] 0.08191416 0.06395669 0.08226970 0.20912076 0.15914120 0.18430412 0.21929337</code></pre>
<div class="sourceCode" id="cb1157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1157-1" data-line-number="1"><span class="co"># the average rating</span></a>
<a class="sourceLine" id="cb1157-2" data-line-number="2"><span class="kw">sum</span>(pk <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>))</a></code></pre></div>
<pre><code>## [1] 4.729704</code></pre>
<p>So the rule is we <em>subtract the linear model from each interecept</em>. “This way, a positive <span class="math inline">\(\beta\)</span> value indicates that an increase in the predictor variable <span class="math inline">\(x\)</span> results in an increase in the average response” (p. 338). Let’s fit our multivariable models.</p>
<div class="sourceCode" id="cb1159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1159-1" data-line-number="1"><span class="co"># start values for b11.2</span></a>
<a class="sourceLine" id="cb1159-2" data-line-number="2">inits &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">`</span><span class="dt">Intercept[1]</span><span class="st">`</span> =<span class="st"> </span><span class="fl">-1.9</span>,</a>
<a class="sourceLine" id="cb1159-3" data-line-number="3">              <span class="st">`</span><span class="dt">Intercept[2]</span><span class="st">`</span> =<span class="st"> </span><span class="fl">-1.2</span>,</a>
<a class="sourceLine" id="cb1159-4" data-line-number="4">              <span class="st">`</span><span class="dt">Intercept[3]</span><span class="st">`</span> =<span class="st"> </span><span class="fl">-0.7</span>,</a>
<a class="sourceLine" id="cb1159-5" data-line-number="5">              <span class="st">`</span><span class="dt">Intercept[4]</span><span class="st">`</span> =<span class="st">  </span><span class="fl">0.2</span>,</a>
<a class="sourceLine" id="cb1159-6" data-line-number="6">              <span class="st">`</span><span class="dt">Intercept[5]</span><span class="st">`</span> =<span class="st">  </span><span class="fl">0.9</span>,</a>
<a class="sourceLine" id="cb1159-7" data-line-number="7">              <span class="st">`</span><span class="dt">Intercept[6]</span><span class="st">`</span> =<span class="st">  </span><span class="fl">1.8</span>,</a>
<a class="sourceLine" id="cb1159-8" data-line-number="8">              <span class="dt">action         =</span>  <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1159-9" data-line-number="9">              <span class="dt">intention      =</span>  <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1159-10" data-line-number="10">              <span class="dt">contact        =</span>  <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb1159-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1159-12" data-line-number="12">b11<span class="fl">.2</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1159-13" data-line-number="13"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb1159-14" data-line-number="14">      <span class="dt">family =</span> cumulative,</a>
<a class="sourceLine" id="cb1159-15" data-line-number="15">      response <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>action <span class="op">+</span><span class="st"> </span>intention <span class="op">+</span><span class="st"> </span>contact,</a>
<a class="sourceLine" id="cb1159-16" data-line-number="16">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb1159-17" data-line-number="17">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> b)),</a>
<a class="sourceLine" id="cb1159-18" data-line-number="18">      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">cores =</span> <span class="dv">2</span>, <span class="dt">chains =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb1159-19" data-line-number="19">      <span class="dt">inits =</span> <span class="kw">list</span>(inits, inits),</a>
<a class="sourceLine" id="cb1159-20" data-line-number="20">      <span class="dt">seed =</span> <span class="dv">11</span>,</a>
<a class="sourceLine" id="cb1159-21" data-line-number="21">      <span class="dt">file =</span> <span class="st">&quot;fits/b11.02&quot;</span>)</a>
<a class="sourceLine" id="cb1159-22" data-line-number="22"></a>
<a class="sourceLine" id="cb1159-23" data-line-number="23"><span class="co"># start values for b11.3</span></a>
<a class="sourceLine" id="cb1159-24" data-line-number="24">inits &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">`</span><span class="dt">Intercept[1]</span><span class="st">`</span>      =<span class="st"> </span><span class="fl">-1.9</span>,</a>
<a class="sourceLine" id="cb1159-25" data-line-number="25">              <span class="st">`</span><span class="dt">Intercept[2]</span><span class="st">`</span>      =<span class="st"> </span><span class="fl">-1.2</span>,</a>
<a class="sourceLine" id="cb1159-26" data-line-number="26">              <span class="st">`</span><span class="dt">Intercept[3]</span><span class="st">`</span>      =<span class="st"> </span><span class="fl">-0.7</span>,</a>
<a class="sourceLine" id="cb1159-27" data-line-number="27">              <span class="st">`</span><span class="dt">Intercept[4]</span><span class="st">`</span>      =<span class="st">  </span><span class="fl">0.2</span>,</a>
<a class="sourceLine" id="cb1159-28" data-line-number="28">              <span class="st">`</span><span class="dt">Intercept[5]</span><span class="st">`</span>      =<span class="st">  </span><span class="fl">0.9</span>,</a>
<a class="sourceLine" id="cb1159-29" data-line-number="29">              <span class="st">`</span><span class="dt">Intercept[6]</span><span class="st">`</span>      =<span class="st">  </span><span class="fl">1.8</span>,</a>
<a class="sourceLine" id="cb1159-30" data-line-number="30">              <span class="dt">action              =</span>  <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1159-31" data-line-number="31">              <span class="dt">intention           =</span>  <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1159-32" data-line-number="32">              <span class="dt">contact             =</span>  <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1159-33" data-line-number="33">              <span class="st">`</span><span class="dt">action:intention</span><span class="st">`</span>  =<span class="st">  </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1159-34" data-line-number="34">              <span class="st">`</span><span class="dt">contact:intention</span><span class="st">`</span> =<span class="st">  </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb1159-35" data-line-number="35"></a>
<a class="sourceLine" id="cb1159-36" data-line-number="36">b11<span class="fl">.3</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1159-37" data-line-number="37"><span class="st">  </span><span class="kw">update</span>(b11<span class="fl">.2</span>,</a>
<a class="sourceLine" id="cb1159-38" data-line-number="38">         <span class="dt">formula =</span> response <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>action <span class="op">+</span><span class="st"> </span>intention <span class="op">+</span><span class="st"> </span>contact <span class="op">+</span><span class="st"> </span>action<span class="op">:</span>intention <span class="op">+</span><span class="st"> </span>contact<span class="op">:</span>intention,</a>
<a class="sourceLine" id="cb1159-39" data-line-number="39">         <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">cores =</span> <span class="dv">2</span>, <span class="dt">chains =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb1159-40" data-line-number="40">         <span class="dt">inits =</span> <span class="kw">list</span>(inits, inits),</a>
<a class="sourceLine" id="cb1159-41" data-line-number="41">         <span class="dt">seed =</span> <span class="dv">11</span>,</a>
<a class="sourceLine" id="cb1159-42" data-line-number="42">         <span class="dt">file =</span> <span class="st">&quot;fits/b11.03&quot;</span>)</a></code></pre></div>
<p>We don’t have a <code>coeftab()</code> function in brms like for rethinking. But <a href="overfitting-regularization-and-information-criteria.html#comparing-estimates.">as we did for Chapter 6</a>, we can reproduce it with help from the <a href="https://cran.r-project.org/package=broom">broom package</a> and a bit of data wrangling.</p>
<div class="sourceCode" id="cb1160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1160-1" data-line-number="1"><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb1160-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1160-3" data-line-number="3"><span class="kw">tibble</span>(<span class="dt">model =</span> <span class="kw">str_c</span>(<span class="st">&quot;b11.&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1160-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fit =</span> purrr<span class="op">::</span><span class="kw">map</span>(model, get)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1160-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tidy =</span> purrr<span class="op">::</span><span class="kw">map</span>(fit, tidy)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1160-6" data-line-number="6"><span class="st">  </span><span class="kw">unnest</span>(tidy) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1160-7" data-line-number="7"><span class="st">  </span><span class="kw">select</span>(model, term, estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1160-8" data-line-number="8"><span class="st">  </span><span class="kw">filter</span>(term <span class="op">!=</span><span class="st"> &quot;lp__&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1160-9" data-line-number="9"><span class="st">  </span><span class="kw">complete</span>(term, model) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1160-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">estimate =</span> <span class="kw">round</span>(estimate, <span class="dt">digits =</span> <span class="dv">2</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1160-11" data-line-number="11"><span class="st">  </span><span class="kw">spread</span>(<span class="dt">key =</span> model, <span class="dt">value =</span> estimate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1160-12" data-line-number="12"><span class="st">  </span><span class="co"># this last step isn&#39;t necessary, but it orders the rows to match the text</span></a>
<a class="sourceLine" id="cb1160-13" data-line-number="13"><span class="st">  </span><span class="kw">slice</span>(<span class="kw">c</span>(<span class="dv">6</span><span class="op">:</span><span class="dv">11</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>))</a></code></pre></div>
<pre><code>## # A tibble: 11 x 4
##    term                b11.1 b11.2 b11.3
##    &lt;chr&gt;               &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 b_Intercept[1]      -1.92 -2.84 -2.64
##  2 b_Intercept[2]      -1.27 -2.16 -1.94
##  3 b_Intercept[3]      -0.72 -1.57 -1.35
##  4 b_Intercept[4]       0.25 -0.55 -0.31
##  5 b_Intercept[5]       0.89  0.12  0.36
##  6 b_Intercept[6]       1.77  1.02  1.27
##  7 b_action            NA    -0.71 -0.47
##  8 b_intention         NA    -0.72 -0.28
##  9 b_contact           NA    -0.96 -0.34
## 10 b_action:intention  NA    NA    -0.44
## 11 b_intention:contact NA    NA    -1.27</code></pre>
<p>If you really wanted that last <code>nobs</code> row at the bottom, you could elaborate on this code: <code>b11.1$data %&gt;% count()</code>. Also, if you want a proper <code>coeftab()</code> function for brms, McElreath’s code lives <a href="https://github.com/rmcelreath/rethinking/blob/a309712d904d1db7af1e08a76c521ab994006fd5/R/coeftab.r">here</a>. Give it a whirl.</p>
<p>Here we compute the WAIC.</p>
<div class="sourceCode" id="cb1162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1162-1" data-line-number="1">b11<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b11<span class="fl">.1</span>, <span class="st">&quot;waic&quot;</span>)</a>
<a class="sourceLine" id="cb1162-2" data-line-number="2">b11<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b11<span class="fl">.2</span>, <span class="st">&quot;waic&quot;</span>)</a>
<a class="sourceLine" id="cb1162-3" data-line-number="3">b11<span class="fl">.3</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b11<span class="fl">.3</span>, <span class="st">&quot;waic&quot;</span>)</a></code></pre></div>
<p>Now compare the models.</p>
<div class="sourceCode" id="cb1163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1163-1" data-line-number="1"><span class="kw">loo_compare</span>(b11<span class="fl">.1</span>, b11<span class="fl">.2</span>, b11<span class="fl">.3</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1163-2" data-line-number="2"><span class="st">  </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</a></code></pre></div>
<pre><code>##       elpd_diff se_diff  elpd_waic se_elpd_waic p_waic   se_p_waic waic     se_waic 
## b11.3      0.0       0.0 -18464.7      40.6         11.1      0.1   36929.4     81.2
## b11.2    -80.2      12.8 -18544.9      38.1          9.0      0.0   37089.8     76.3
## b11.1   -462.5      31.3 -18927.1      28.8          5.9      0.0   37854.3     57.7</code></pre>
<p>Here are the WAIC weights.</p>
<div class="sourceCode" id="cb1165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1165-1" data-line-number="1"><span class="kw">model_weights</span>(b11<span class="fl">.1</span>, b11<span class="fl">.2</span>, b11<span class="fl">.3</span>, <span class="dt">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1165-2" data-line-number="2"><span class="st">  </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## b11.1 b11.2 b11.3 
##     0     0     1</code></pre>
<p>McElreath made Figure 11.3 by extracting the samples of his <code>m11.3</code>, saving them as <code>post</code>, and working some hairy base R <code>plot()</code> code. We’ll take a different route and use <code>brms::fitted()</code>. This will take substantial data wrangling, but hopefully it’ll be instructive. Let’s first take a look at the initial <code>fitted()</code> output for the beginnings of Figure 11.3.a.</p>
<div class="sourceCode" id="cb1167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1167-1" data-line-number="1">nd &lt;-</a>
<a class="sourceLine" id="cb1167-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">action    =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1167-3" data-line-number="3">         <span class="dt">contact   =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb1167-4" data-line-number="4">         <span class="dt">intention =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1167-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1167-6" data-line-number="6">max_iter &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb1167-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1167-8" data-line-number="8"><span class="kw">fitted</span>(b11<span class="fl">.3</span>, </a>
<a class="sourceLine" id="cb1167-9" data-line-number="9">       <span class="dt">newdata =</span> nd, </a>
<a class="sourceLine" id="cb1167-10" data-line-number="10">       <span class="dt">subset =</span> <span class="dv">1</span><span class="op">:</span>max_iter,</a>
<a class="sourceLine" id="cb1167-11" data-line-number="11">       <span class="dt">summary =</span> F) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1167-12" data-line-number="12"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1167-13" data-line-number="13"><span class="st">  </span><span class="kw">glimpse</span>()</a></code></pre></div>
<pre><code>## Observations: 100
## Variables: 14
## $ `1.1` &lt;dbl&gt; 0.07162247, 0.06338779, 0.07068255, 0.07083774, 0.07092480, 0.06631221, 0.06689340, 0.0678351…
## $ `2.1` &lt;dbl&gt; 0.08488440, 0.07925890, 0.09404759, 0.09429185, 0.09002287, 0.08973713, 0.08273952, 0.0932086…
## $ `1.2` &lt;dbl&gt; 0.06341534, 0.05809328, 0.05970624, 0.06010018, 0.05854282, 0.05727328, 0.05999789, 0.0566324…
## $ `2.2` &lt;dbl&gt; 0.07315865, 0.07031587, 0.07583498, 0.07634476, 0.07156504, 0.07395810, 0.07185583, 0.0740154…
## $ `1.3` &lt;dbl&gt; 0.08606638, 0.08590155, 0.07723122, 0.07938579, 0.07972300, 0.07696115, 0.08352846, 0.0766265…
## $ `2.3` &lt;dbl&gt; 0.09641533, 0.10012087, 0.09353790, 0.09606813, 0.09370160, 0.09457815, 0.09652008, 0.0950633…
## $ `1.4` &lt;dbl&gt; 0.2229344, 0.2161689, 0.2134367, 0.2148205, 0.2121816, 0.2172969, 0.2131465, 0.2147282, 0.211…
## $ `2.4` &lt;dbl&gt; 0.2354135, 0.2333929, 0.2347367, 0.2357648, 0.2302323, 0.2407984, 0.2292882, 0.2390650, 0.230…
## $ `1.5` &lt;dbl&gt; 0.1648621, 0.1698099, 0.1677542, 0.1665207, 0.1651815, 0.1641270, 0.1651834, 0.1606315, 0.169…
## $ `2.5` &lt;dbl&gt; 0.1619287, 0.1667702, 0.1633723, 0.1618094, 0.1621795, 0.1599161, 0.1626227, 0.1564664, 0.166…
## $ `1.6` &lt;dbl&gt; 0.1870092, 0.1931539, 0.1908156, 0.1913794, 0.1949742, 0.1852376, 0.2037272, 0.1902218, 0.195…
## $ `2.6` &lt;dbl&gt; 0.1724180, 0.1742718, 0.1669028, 0.1670487, 0.1748612, 0.1616290, 0.1847066, 0.1649165, 0.173…
## $ `1.7` &lt;dbl&gt; 0.2040901, 0.2134846, 0.2203735, 0.2169556, 0.2184722, 0.2327919, 0.2075232, 0.2333245, 0.214…
## $ `2.7` &lt;dbl&gt; 0.1757815, 0.1758695, 0.1715677, 0.1686724, 0.1774375, 0.1793831, 0.1722670, 0.1772646, 0.171…</code></pre>
<p>Hopefully by now it’s clear why we needed the <code>nd</code> tibble, which we made use of in the <code>newdata = nd</code> argument. Because we set <code>summary = F</code>, we get draws from the posterior instead of summaries. With <code>max_iter</code>, we controlled how many of those posterior draws we wanted. McElreath used 100, which he indicated at the top of page 341, so we followed suit. It took me a minute to wrap my head around the meaning of the 14 vectors, which were named by <code>brms::fitted()</code> default. Notice how each column is named by two numerals, separated by a period. That first numeral indicates which if the two <code>intention</code> values the draw is based on (i.e., 1 stands for <code>intention == 0</code>, 2, stands for <code>intention == 1</code>). The numbers on the right of the decimals are the seven response options for <code>response</code>. For each posterior draw, you get one of those for each value of <code>intention</code>. Finally, it might not be immediately apparent, but the values are in the probability scale, just like <code>pk</code> on page 338.</p>
<p>Now we know what we have in hand, it’s just a matter of careful wrangling to get those probabilities into a more useful format to feed into ggplot2. I’ve extensively annotated the code, below. If you lose track of what happens in a given step, just run the code up till that point. Go step by step.</p>
<div class="sourceCode" id="cb1169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1169-1" data-line-number="1">nd &lt;-</a>
<a class="sourceLine" id="cb1169-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">action    =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1169-3" data-line-number="3">         <span class="dt">contact   =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb1169-4" data-line-number="4">         <span class="dt">intention =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1169-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1169-6" data-line-number="6">max_iter &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb1169-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1169-8" data-line-number="8"><span class="kw">fitted</span>(b11<span class="fl">.3</span>,</a>
<a class="sourceLine" id="cb1169-9" data-line-number="9">       <span class="dt">newdata =</span> nd, </a>
<a class="sourceLine" id="cb1169-10" data-line-number="10">       <span class="dt">subset =</span> <span class="dv">1</span><span class="op">:</span>max_iter,</a>
<a class="sourceLine" id="cb1169-11" data-line-number="11">       <span class="dt">summary =</span> F) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1169-12" data-line-number="12"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1169-13" data-line-number="13"><span class="st">  </span><span class="co"># we need an variable to index which posterior iteration we&#39;re working with</span></a>
<a class="sourceLine" id="cb1169-14" data-line-number="14"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">iter =</span> <span class="dv">1</span><span class="op">:</span>max_iter) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1169-15" data-line-number="15"><span class="st">  </span><span class="co"># convert the data to the long format</span></a>
<a class="sourceLine" id="cb1169-16" data-line-number="16"><span class="st">  </span><span class="kw">gather</span>(key, pk, <span class="op">-</span>iter) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1169-17" data-line-number="17"><span class="st">  </span><span class="co"># extract the `intention` and `response` information out of the `key` vector and </span></a>
<a class="sourceLine" id="cb1169-18" data-line-number="18"><span class="st">  </span><span class="co"># spread it into two vectors.</span></a>
<a class="sourceLine" id="cb1169-19" data-line-number="19"><span class="st">  </span><span class="kw">separate</span>(key, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;intention&quot;</span>, <span class="st">&quot;rating&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1169-20" data-line-number="20"><span class="st">  </span><span class="co"># that step produced two character vectors. they’ll be more useful as numbers</span></a>
<a class="sourceLine" id="cb1169-21" data-line-number="21"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">intention =</span> intention <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.double</span>(),</a>
<a class="sourceLine" id="cb1169-22" data-line-number="22">         <span class="dt">rating    =</span> rating    <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.double</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1169-23" data-line-number="23"><span class="st">  </span><span class="co"># here we convert `intention` into its proper 0:1 metric</span></a>
<a class="sourceLine" id="cb1169-24" data-line-number="24"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">intention =</span> intention <span class="dv">-1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1169-25" data-line-number="25"><span class="st">  </span><span class="co"># this step is based on McElreath&#39;s R code 11.10 on page 338</span></a>
<a class="sourceLine" id="cb1169-26" data-line-number="26"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">pk:rating</span><span class="st">`</span> =<span class="st"> </span>pk <span class="op">*</span><span class="st"> </span>rating) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1169-27" data-line-number="27"><span class="st">  </span><span class="co"># I’m not sure how to succinctly explain this. you’re just going to have to trust me</span></a>
<a class="sourceLine" id="cb1169-28" data-line-number="28"><span class="st">  </span><span class="kw">group_by</span>(iter, intention) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1169-29" data-line-number="29"><span class="st">  </span><span class="co"># this is very important for the next step.</span></a>
<a class="sourceLine" id="cb1169-30" data-line-number="30"><span class="st">  </span><span class="kw">arrange</span>(iter, intention, rating) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1169-31" data-line-number="31"><span class="st">  </span><span class="co"># here we take our `pk` values and make culmulative sums. why? take a long hard look at Figure 11.2. </span></a>
<a class="sourceLine" id="cb1169-32" data-line-number="32"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">probability =</span> <span class="kw">cumsum</span>(pk)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1169-33" data-line-number="33"><span class="st">  </span><span class="co"># `rating == 7` is unnecessary. these `probability` values are by definition 1</span></a>
<a class="sourceLine" id="cb1169-34" data-line-number="34"><span class="st">  </span><span class="kw">filter</span>(rating <span class="op">&lt;</span><span class="st"> </span><span class="dv">7</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1169-35" data-line-number="35"><span class="st">  </span></a>
<a class="sourceLine" id="cb1169-36" data-line-number="36"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> intention, <span class="dt">y =</span> probability, </a>
<a class="sourceLine" id="cb1169-37" data-line-number="37">             <span class="dt">color =</span> probability)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1169-38" data-line-number="38"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> <span class="kw">interaction</span>(iter, rating)),</a>
<a class="sourceLine" id="cb1169-39" data-line-number="39">            <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1169-40" data-line-number="40"><span class="st">  </span><span class="co"># note how we made a new data object for `geom_text()`</span></a>
<a class="sourceLine" id="cb1169-41" data-line-number="41"><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">tibble</span>(<span class="dt">text        =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>,</a>
<a class="sourceLine" id="cb1169-42" data-line-number="42">                          <span class="dt">intention   =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">.9</span>, <span class="dt">to =</span> <span class="fl">.1</span>, <span class="dt">length.out =</span> <span class="dv">7</span>),</a>
<a class="sourceLine" id="cb1169-43" data-line-number="43">                          <span class="dt">probability =</span> <span class="kw">c</span>(.<span class="dv">05</span>, <span class="fl">.12</span>, <span class="fl">.20</span>, <span class="fl">.35</span>, <span class="fl">.53</span>, <span class="fl">.71</span>, <span class="fl">.87</span>)),</a>
<a class="sourceLine" id="cb1169-44" data-line-number="44">            <span class="kw">aes</span>(<span class="dt">label =</span> text),</a>
<a class="sourceLine" id="cb1169-45" data-line-number="45">            <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1169-46" data-line-number="46"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;intention&quot;</span>, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1169-47" data-line-number="47"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1169-48" data-line-number="48"><span class="st">  </span><span class="kw">scale_color_gradient</span>(<span class="dt">low  =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1169-49" data-line-number="49">                       <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1169-50" data-line-number="50"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;action = 0,</span><span class="ch">\n</span><span class="st">contact = 0&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1169-51" data-line-number="51"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1169-52" data-line-number="52"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>),</a>
<a class="sourceLine" id="cb1169-53" data-line-number="53">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb1169-54" data-line-number="54">        <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-27-1.png" width="240" /></p>
<p>Boom!</p>
<p>Okay, that pile of code is a bit of a mess and you’re not going to want to repeatedly cut and paste all that. Let’s condense it into a homemade function, <code>make_Figure_11.3_data()</code>.</p>
<div class="sourceCode" id="cb1170"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1170-1" data-line-number="1">make_Figure_<span class="fl">11.3</span>_data &lt;-<span class="st"> </span><span class="cf">function</span>(action, contact, max_iter) {</a>
<a class="sourceLine" id="cb1170-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb1170-3" data-line-number="3">  nd &lt;-</a>
<a class="sourceLine" id="cb1170-4" data-line-number="4"><span class="st">    </span><span class="kw">tibble</span>(<span class="dt">action    =</span> action,</a>
<a class="sourceLine" id="cb1170-5" data-line-number="5">           <span class="dt">contact   =</span> contact, </a>
<a class="sourceLine" id="cb1170-6" data-line-number="6">           <span class="dt">intention =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1170-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb1170-8" data-line-number="8">  max_iter &lt;-<span class="st"> </span>max_iter</a>
<a class="sourceLine" id="cb1170-9" data-line-number="9">  </a>
<a class="sourceLine" id="cb1170-10" data-line-number="10">  <span class="kw">fitted</span>(b11<span class="fl">.3</span>, </a>
<a class="sourceLine" id="cb1170-11" data-line-number="11">         <span class="dt">newdata =</span> nd, </a>
<a class="sourceLine" id="cb1170-12" data-line-number="12">         <span class="dt">subset =</span> <span class="dv">1</span><span class="op">:</span>max_iter,</a>
<a class="sourceLine" id="cb1170-13" data-line-number="13">         <span class="dt">summary =</span> F) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1170-14" data-line-number="14"><span class="st">    </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1170-15" data-line-number="15"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">iter =</span> <span class="dv">1</span><span class="op">:</span>max_iter) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1170-16" data-line-number="16"><span class="st">    </span><span class="kw">gather</span>(key, pk, <span class="op">-</span>iter) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1170-17" data-line-number="17"><span class="st">    </span><span class="kw">separate</span>(key, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;intention&quot;</span>, <span class="st">&quot;rating&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1170-18" data-line-number="18"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">intention =</span> intention <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.double</span>(),</a>
<a class="sourceLine" id="cb1170-19" data-line-number="19">           <span class="dt">rating    =</span> rating    <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.double</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1170-20" data-line-number="20"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">intention =</span> intention <span class="dv">-1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1170-21" data-line-number="21"><span class="st">    </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">pk:rating</span><span class="st">`</span> =<span class="st"> </span>pk <span class="op">*</span><span class="st"> </span>rating) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1170-22" data-line-number="22"><span class="st">    </span><span class="kw">group_by</span>(iter, intention) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1170-23" data-line-number="23"><span class="st">    </span><span class="kw">arrange</span>(iter, intention, rating) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1170-24" data-line-number="24"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">probability =</span> <span class="kw">cumsum</span>(pk)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1170-25" data-line-number="25"><span class="st">    </span><span class="kw">filter</span>(rating <span class="op">&lt;</span><span class="st"> </span><span class="dv">7</span>)</a>
<a class="sourceLine" id="cb1170-26" data-line-number="26">  </a>
<a class="sourceLine" id="cb1170-27" data-line-number="27">}</a></code></pre></div>
<p>Now we’ll use our sweet homemade function to make our plots.</p>
<div class="sourceCode" id="cb1171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1171-1" data-line-number="1"><span class="co"># Figure 11.3.a</span></a>
<a class="sourceLine" id="cb1171-2" data-line-number="2">p1 &lt;-</a>
<a class="sourceLine" id="cb1171-3" data-line-number="3"><span class="st">  </span><span class="kw">make_Figure_11.3_data</span>(<span class="dt">action   =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb1171-4" data-line-number="4">                        <span class="dt">contact  =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb1171-5" data-line-number="5">                        <span class="dt">max_iter =</span> <span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1171-6" data-line-number="6"><span class="st">  </span></a>
<a class="sourceLine" id="cb1171-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> intention, <span class="dt">y =</span> probability,</a>
<a class="sourceLine" id="cb1171-8" data-line-number="8">             <span class="dt">color =</span> probability)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> <span class="kw">interaction</span>(iter, rating)),</a>
<a class="sourceLine" id="cb1171-10" data-line-number="10">            <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">tibble</span>(<span class="dt">text        =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>,</a>
<a class="sourceLine" id="cb1171-12" data-line-number="12">                          <span class="dt">intention   =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">.9</span>, <span class="dt">to =</span> <span class="fl">.1</span>, <span class="dt">length.out =</span> <span class="dv">7</span>),</a>
<a class="sourceLine" id="cb1171-13" data-line-number="13">                          <span class="dt">probability =</span> <span class="kw">c</span>(.<span class="dv">05</span>, <span class="fl">.12</span>, <span class="fl">.20</span>, <span class="fl">.35</span>, <span class="fl">.53</span>, <span class="fl">.71</span>, <span class="fl">.87</span>)),</a>
<a class="sourceLine" id="cb1171-14" data-line-number="14">            <span class="kw">aes</span>(<span class="dt">label =</span> text),</a>
<a class="sourceLine" id="cb1171-15" data-line-number="15">            <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-16" data-line-number="16"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;intention&quot;</span>, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-17" data-line-number="17"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-18" data-line-number="18"><span class="st">  </span><span class="kw">scale_color_gradient</span>(<span class="dt">low  =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1171-19" data-line-number="19">                       <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-20" data-line-number="20"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;action = 0,</span><span class="ch">\n</span><span class="st">contact = 0&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-21" data-line-number="21"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-22" data-line-number="22"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1171-23" data-line-number="23">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb1171-24" data-line-number="24">        <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>))</a>
<a class="sourceLine" id="cb1171-25" data-line-number="25"></a>
<a class="sourceLine" id="cb1171-26" data-line-number="26"><span class="co"># Figure 11.3.b</span></a>
<a class="sourceLine" id="cb1171-27" data-line-number="27">p2 &lt;-</a>
<a class="sourceLine" id="cb1171-28" data-line-number="28"><span class="st">  </span><span class="kw">make_Figure_11.3_data</span>(<span class="dt">action   =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb1171-29" data-line-number="29">                        <span class="dt">contact  =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb1171-30" data-line-number="30">                        <span class="dt">max_iter =</span> <span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1171-31" data-line-number="31"><span class="st">  </span></a>
<a class="sourceLine" id="cb1171-32" data-line-number="32"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> intention, <span class="dt">y =</span> probability,</a>
<a class="sourceLine" id="cb1171-33" data-line-number="33">             <span class="dt">color =</span> probability)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-34" data-line-number="34"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> <span class="kw">interaction</span>(iter, rating)),</a>
<a class="sourceLine" id="cb1171-35" data-line-number="35">            <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-36" data-line-number="36"><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">tibble</span>(<span class="dt">text        =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>,</a>
<a class="sourceLine" id="cb1171-37" data-line-number="37">                          <span class="dt">intention   =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">.9</span>, <span class="dt">to =</span> <span class="fl">.1</span>, <span class="dt">length.out =</span> <span class="dv">7</span>),</a>
<a class="sourceLine" id="cb1171-38" data-line-number="38">                          <span class="dt">probability =</span> <span class="kw">c</span>(.<span class="dv">12</span>, <span class="fl">.24</span>, <span class="fl">.35</span>, <span class="fl">.50</span>, <span class="fl">.68</span>, <span class="fl">.80</span>, <span class="fl">.92</span>)),</a>
<a class="sourceLine" id="cb1171-39" data-line-number="39">            <span class="kw">aes</span>(<span class="dt">label =</span> text),</a>
<a class="sourceLine" id="cb1171-40" data-line-number="40">            <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-41" data-line-number="41"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;intention&quot;</span>, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-42" data-line-number="42"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-43" data-line-number="43"><span class="st">  </span><span class="kw">scale_color_gradient</span>(<span class="dt">low  =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1171-44" data-line-number="44">                       <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-45" data-line-number="45"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;action = 1,</span><span class="ch">\n</span><span class="st">contact = 0&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-46" data-line-number="46"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-47" data-line-number="47"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1171-48" data-line-number="48">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb1171-49" data-line-number="49">        <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>))</a>
<a class="sourceLine" id="cb1171-50" data-line-number="50"></a>
<a class="sourceLine" id="cb1171-51" data-line-number="51"><span class="co"># Figure 11.3.c</span></a>
<a class="sourceLine" id="cb1171-52" data-line-number="52">p3 &lt;-</a>
<a class="sourceLine" id="cb1171-53" data-line-number="53"><span class="st">  </span><span class="kw">make_Figure_11.3_data</span>(<span class="dt">action   =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb1171-54" data-line-number="54">                        <span class="dt">contact  =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb1171-55" data-line-number="55">                        <span class="dt">max_iter =</span> <span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1171-56" data-line-number="56"><span class="st">  </span></a>
<a class="sourceLine" id="cb1171-57" data-line-number="57"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> intention, <span class="dt">y =</span> probability,</a>
<a class="sourceLine" id="cb1171-58" data-line-number="58">             <span class="dt">color =</span> probability)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-59" data-line-number="59"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> <span class="kw">interaction</span>(iter, rating)),</a>
<a class="sourceLine" id="cb1171-60" data-line-number="60">            <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-61" data-line-number="61"><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">tibble</span>(<span class="dt">text        =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>,</a>
<a class="sourceLine" id="cb1171-62" data-line-number="62">                          <span class="dt">intention   =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">.9</span>, <span class="dt">to =</span> <span class="fl">.1</span>, <span class="dt">length.out =</span> <span class="dv">7</span>),</a>
<a class="sourceLine" id="cb1171-63" data-line-number="63">                          <span class="dt">probability =</span> <span class="kw">c</span>(.<span class="dv">15</span>, <span class="fl">.34</span>, <span class="fl">.44</span>, <span class="fl">.56</span>, <span class="fl">.695</span>, <span class="fl">.8</span>, <span class="fl">.92</span>)),</a>
<a class="sourceLine" id="cb1171-64" data-line-number="64">            <span class="kw">aes</span>(<span class="dt">label =</span> text),</a>
<a class="sourceLine" id="cb1171-65" data-line-number="65">            <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-66" data-line-number="66"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;intention&quot;</span>, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-67" data-line-number="67"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-68" data-line-number="68"><span class="st">  </span><span class="kw">scale_color_gradient</span>(<span class="dt">low  =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1171-69" data-line-number="69">                       <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-70" data-line-number="70"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;action = 0,</span><span class="ch">\n</span><span class="st">contact = 1&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-71" data-line-number="71"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1171-72" data-line-number="72"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1171-73" data-line-number="73">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb1171-74" data-line-number="74">        <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>))</a>
<a class="sourceLine" id="cb1171-75" data-line-number="75"></a>
<a class="sourceLine" id="cb1171-76" data-line-number="76"><span class="co"># here we combine them with patchwork</span></a>
<a class="sourceLine" id="cb1171-77" data-line-number="77">p1 <span class="op">+</span><span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span>p3 <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1171-78" data-line-number="78"><span class="st">  </span><span class="kw">plot_annotation</span>(<span class="dt">title =</span> <span class="st">&quot;Posterior predictions of the interaction model:&quot;</span>,</a>
<a class="sourceLine" id="cb1171-79" data-line-number="79">                  <span class="dt">subtitle =</span> <span class="st">&quot;Here we&#39;re focusing on the parameters.&quot;</span>,</a>
<a class="sourceLine" id="cb1171-80" data-line-number="80">                  <span class="dt">theme =</span> <span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>)))</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-29-1.png" width="672" /></p>
<p>If you’d like to learn more about using cumulative probabilities to model ordinal data in brms, check out Bürkner and Vuorre’s <a href="https://psyarxiv.com/x8swp/"><em>Ordinal Regression Models in Psychology: A Tutorial</em></a> and its <a href="https://osf.io/cu8jv/">repository</a> on the Open Science Framework. Also check out <a href="https://bookdown.org/content/3686/ordinal-predicted-variable.html">Chapter 23</a> of my sister project <a href="https://bookdown.org/content/3686/"><em>Doing Bayesian Data Analysis in brms and the tidyverse</em></a> were we model ordinal data with a series of cumulative probit models.</p>
</div>
<div id="bonus-figure-11.3-alternative." class="section level3">
<h3><span class="header-section-number">11.1.4</span> Bonus: Figure 11.3 alternative.</h3>
<p>I have a lot of respect for McElreath. But man, Figure 11.3 is the worst. I’m in clinical psychology and there’s no way a working therapist is going to look at a figure like that and have any sense of what’s going on. Happily, we can go further. Look back at McElreath’s R code 11.10 on page 338. See how he multiplied the elements of <code>pk</code> by their respective <code>response</code> values and then just summed them up to get an average outcome value? With just a little amendment to our custom <code>make_Figure_11.3_data()</code> function, we can wrangle our <code>fitted()</code> output to express average <code>response</code> values for each of our conditions of interest. Here’s the adjusted function:</p>
<div class="sourceCode" id="cb1172"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1172-1" data-line-number="1">make_alternative_data &lt;-<span class="st"> </span><span class="cf">function</span>(action, contact, max_iter) {</a>
<a class="sourceLine" id="cb1172-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb1172-3" data-line-number="3">  nd &lt;-</a>
<a class="sourceLine" id="cb1172-4" data-line-number="4"><span class="st">    </span><span class="kw">tibble</span>(<span class="dt">action    =</span> action,</a>
<a class="sourceLine" id="cb1172-5" data-line-number="5">           <span class="dt">contact   =</span> contact, </a>
<a class="sourceLine" id="cb1172-6" data-line-number="6">           <span class="dt">intention =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1172-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb1172-8" data-line-number="8">  max_iter &lt;-<span class="st"> </span>max_iter</a>
<a class="sourceLine" id="cb1172-9" data-line-number="9">  </a>
<a class="sourceLine" id="cb1172-10" data-line-number="10">  <span class="kw">fitted</span>(b11<span class="fl">.3</span>, </a>
<a class="sourceLine" id="cb1172-11" data-line-number="11">         <span class="dt">newdata =</span> nd, </a>
<a class="sourceLine" id="cb1172-12" data-line-number="12">         <span class="dt">subset =</span> <span class="dv">1</span><span class="op">:</span>max_iter,</a>
<a class="sourceLine" id="cb1172-13" data-line-number="13">         <span class="dt">summary =</span> F) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1172-14" data-line-number="14"><span class="st">    </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1172-15" data-line-number="15"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">iter =</span> <span class="dv">1</span><span class="op">:</span>max_iter) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1172-16" data-line-number="16"><span class="st">    </span><span class="kw">gather</span>(key, pk, <span class="op">-</span>iter) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1172-17" data-line-number="17"><span class="st">    </span><span class="kw">separate</span>(key, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;intention&quot;</span>, <span class="st">&quot;rating&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1172-18" data-line-number="18"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">intention =</span> intention <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.double</span>(),</a>
<a class="sourceLine" id="cb1172-19" data-line-number="19">           <span class="dt">rating    =</span> rating    <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.double</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1172-20" data-line-number="20"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">intention =</span> intention <span class="dv">-1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1172-21" data-line-number="21"><span class="st">    </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">pk:rating</span><span class="st">`</span> =<span class="st"> </span>pk <span class="op">*</span><span class="st"> </span>rating) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1172-22" data-line-number="22"><span class="st">    </span><span class="kw">group_by</span>(iter, intention) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1172-23" data-line-number="23"><span class="st">    </span></a>
<a class="sourceLine" id="cb1172-24" data-line-number="24"><span class="st">    </span><span class="co"># everything above this point is identical to the previous custom function.</span></a>
<a class="sourceLine" id="cb1172-25" data-line-number="25"><span class="st">    </span><span class="co"># all we do is replace the last few lines with this one line of code. </span></a>
<a class="sourceLine" id="cb1172-26" data-line-number="26"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">mean_rating =</span> <span class="kw">sum</span>(<span class="st">`</span><span class="dt">pk:rating</span><span class="st">`</span>))</a>
<a class="sourceLine" id="cb1172-27" data-line-number="27">  </a>
<a class="sourceLine" id="cb1172-28" data-line-number="28">}</a></code></pre></div>
<p>Our handy homemade <code>make_alternative_data()</code> function works very much like its predecessor. Before we put it to work, we might simplify our upcoming ggplot2 code. Did you notice how the last three plots, those three subplots for Figure 11.3, were all basically the same with slightly different input? Instead of copy/pasting all that plot code, we can wrap the bulk of it into a custom plotting function we’ll call <code>geom_figure11.3()</code>.</p>
<div class="sourceCode" id="cb1173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1173-1" data-line-number="1">geom_figure11<span class="fl">.3</span> &lt;-<span class="st"> </span><span class="cf">function</span>(subtitle, ...) {</a>
<a class="sourceLine" id="cb1173-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb1173-3" data-line-number="3">  <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb1173-4" data-line-number="4">    <span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>, <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb1173-5" data-line-number="5">    <span class="kw">scale_x_continuous</span>(<span class="st">&quot;intention&quot;</span>, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1173-6" data-line-number="6">    <span class="kw">scale_y_continuous</span>(<span class="st">&quot;response&quot;</span>, <span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">7</span>)),</a>
<a class="sourceLine" id="cb1173-7" data-line-number="7">    <span class="kw">labs</span>(<span class="dt">subtitle =</span> subtitle),</a>
<a class="sourceLine" id="cb1173-8" data-line-number="8">    <span class="kw">theme_hc</span>(),</a>
<a class="sourceLine" id="cb1173-9" data-line-number="9">    <span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1173-10" data-line-number="10">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb1173-11" data-line-number="11">        <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>))</a>
<a class="sourceLine" id="cb1173-12" data-line-number="12">  )</a>
<a class="sourceLine" id="cb1173-13" data-line-number="13">  </a>
<a class="sourceLine" id="cb1173-14" data-line-number="14">}</a></code></pre></div>
<p>Now we’ll use our two custom functions, <code>make_alternative_data()</code> to make the data and <code>geom_figure11.3()</code> to specify most of the ggplot2 components, to plot our alternative to Figure 11.3.</p>
<div class="sourceCode" id="cb1174"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1174-1" data-line-number="1"><span class="co"># alternative to Figure 11.3.a</span></a>
<a class="sourceLine" id="cb1174-2" data-line-number="2">p1 &lt;-</a>
<a class="sourceLine" id="cb1174-3" data-line-number="3"><span class="st">  </span><span class="kw">make_alternative_data</span>(<span class="dt">action   =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb1174-4" data-line-number="4">                        <span class="dt">contact  =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb1174-5" data-line-number="5">                        <span class="dt">max_iter =</span> <span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1174-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> intention, <span class="dt">y =</span> mean_rating, <span class="dt">group =</span> iter)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1174-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_figure11.3</span>(<span class="dt">subtitle =</span> <span class="st">&quot;action = 0,</span><span class="ch">\n</span><span class="st">contact = 0&quot;</span>)</a>
<a class="sourceLine" id="cb1174-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1174-9" data-line-number="9"><span class="co"># alternative to Figure 11.3.b</span></a>
<a class="sourceLine" id="cb1174-10" data-line-number="10">p2 &lt;-</a>
<a class="sourceLine" id="cb1174-11" data-line-number="11"><span class="st">  </span><span class="kw">make_alternative_data</span>(<span class="dt">action   =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb1174-12" data-line-number="12">                        <span class="dt">contact  =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb1174-13" data-line-number="13">                        <span class="dt">max_iter =</span> <span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1174-14" data-line-number="14"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> intention, <span class="dt">y =</span> mean_rating, <span class="dt">group =</span> iter)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1174-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_figure11.3</span>(<span class="dt">subtitle =</span> <span class="st">&quot;action = 1,</span><span class="ch">\n</span><span class="st">contact = 0&quot;</span>)</a>
<a class="sourceLine" id="cb1174-16" data-line-number="16"></a>
<a class="sourceLine" id="cb1174-17" data-line-number="17"><span class="co"># alternative to Figure 11.3.c</span></a>
<a class="sourceLine" id="cb1174-18" data-line-number="18">p3 &lt;-</a>
<a class="sourceLine" id="cb1174-19" data-line-number="19"><span class="st">  </span><span class="kw">make_alternative_data</span>(<span class="dt">action   =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb1174-20" data-line-number="20">                        <span class="dt">contact  =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb1174-21" data-line-number="21">                        <span class="dt">max_iter =</span> <span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1174-22" data-line-number="22"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> intention, <span class="dt">y =</span> mean_rating, <span class="dt">group =</span> iter)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1174-23" data-line-number="23"><span class="st">  </span><span class="kw">geom_figure11.3</span>(<span class="dt">subtitle =</span> <span class="st">&quot;action = 0,</span><span class="ch">\n</span><span class="st">contact = 1&quot;</span>)</a>
<a class="sourceLine" id="cb1174-24" data-line-number="24"></a>
<a class="sourceLine" id="cb1174-25" data-line-number="25"><span class="co"># here we combine them with patchwork</span></a>
<a class="sourceLine" id="cb1174-26" data-line-number="26">p1 <span class="op">+</span><span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span>p3 <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1174-27" data-line-number="27"><span class="st">  </span><span class="kw">plot_annotation</span>(<span class="dt">title =</span> <span class="st">&quot;Posterior predictions of the interaction model:&quot;</span>,</a>
<a class="sourceLine" id="cb1174-28" data-line-number="28">                  <span class="dt">subtitle =</span> <span class="st">&quot;This time we&#39;ll focus on the means.&quot;</span>,</a>
<a class="sourceLine" id="cb1174-29" data-line-number="29">                  <span class="dt">theme =</span> <span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>)))</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-32-1.png" width="672" /></p>
<p>Finally; now those are plots I can sell in a clinical psychology journal! We did the right thing and used a sophisticated statistical model to treat the data appropriately, but we summarized the results in a way a substantive audience might understand them in.</p>
<p>If your new to making functions with ggplot2 components, check out <a href="https://ggplot2-book.org/programming.html">Chapter 16</a> of Wickham’s <a href="https://ggplot2-book.org/index.html"><em>ggplot2: Elegant Graphics for Data Analysis</em></a>. He’ll walk you through all the steps.</p>
<div id="rethinking-staring-into-the-abyss." class="section level4">
<h4><span class="header-section-number">11.1.4.1</span> Rethinking: Staring into the abyss.</h4>
<p>“The plotting code for ordered logistic models is complicated, compared to that of models from previous chapters. But as models become more monstrous, so too does the code needed to compute predictions and display them” (p. 342). I’ll just add that I have found models and plots like this get easier with time. Just keep chipping away. You’ll get it!</p>
</div>
</div>
</div>
<div id="zero-inflated-outcomes" class="section level2">
<h2><span class="header-section-number">11.2</span> Zero-inflated outcomes</h2>
<blockquote>
<p>Very often, the things we can measure are not emissions from any pure process. Instead, they are <em>mixtures</em> of multiple processes. Whenever there are different causes for the same observation, then a mixture model may be useful. A mixture model uses more than one simple probability distribution to model a mixture of causes. In effect, these models use more than one likelihood for the same outcome variable.</p>
<p>Count variables are especially prone to needing a mixture treatment. The reason is that a count of zero can often arise more than one way. A “zero” means that nothing happened, and nothing can happen either because the rate of events is low or rather because the process that generates events failed to get started. (p. 342, <em>emphasis</em> in the original)</p>
</blockquote>
<div id="rethinking-breaking-the-law." class="section level4">
<h4><span class="header-section-number">11.2.0.1</span> Rethinking: Breaking the law.</h4>
<p>McElreath discussed how advances in computing have made it possible for working scientists to define their own data generating models. If you’d like to dive deeper into the topic, check out Bürkner’s vignette, <a href="https://cran.r-project.org/package=brms/vignettes/brms_customfamilies.html"><em>Define Custom Response Distributions with brms</em></a>. We’ll even make use of it a little further down.</p>
</div>
<div id="example-zero-inflated-poisson." class="section level3">
<h3><span class="header-section-number">11.2.1</span> Example: Zero-inflated Poisson.</h3>
<p>Do you remember the monk data from back in <a href="counting-and-classification.html#example-exposure-and-the-offset.">Chapter 10</a>? Here we simulate some more. This time we’ll work in a little alcohol.</p>
<div class="sourceCode" id="cb1175"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1175-1" data-line-number="1"><span class="co"># define parameters</span></a>
<a class="sourceLine" id="cb1175-2" data-line-number="2">prob_drink &lt;-<span class="st"> </span><span class="fl">0.2</span>  <span class="co"># 20% of days</span></a>
<a class="sourceLine" id="cb1175-3" data-line-number="3">rate_work  &lt;-<span class="st"> </span><span class="dv">1</span>    <span class="co"># average 1 manuscript per day</span></a>
<a class="sourceLine" id="cb1175-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1175-5" data-line-number="5"><span class="co"># sample one year of production</span></a>
<a class="sourceLine" id="cb1175-6" data-line-number="6">n &lt;-<span class="st"> </span><span class="dv">365</span></a>
<a class="sourceLine" id="cb1175-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1175-8" data-line-number="8"><span class="co"># simulate days monks drink</span></a>
<a class="sourceLine" id="cb1175-9" data-line-number="9"><span class="kw">set.seed</span>(<span class="dv">11</span>)</a>
<a class="sourceLine" id="cb1175-10" data-line-number="10">drink &lt;-<span class="st"> </span><span class="kw">rbinom</span>(n, <span class="dv">1</span>, prob_drink)</a>
<a class="sourceLine" id="cb1175-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1175-12" data-line-number="12"><span class="co"># simulate manuscripts completed</span></a>
<a class="sourceLine" id="cb1175-13" data-line-number="13">y &lt;-<span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>drink) <span class="op">*</span><span class="st"> </span><span class="kw">rpois</span>(n, rate_work)</a></code></pre></div>
<p>We’ll put those data in a tidy tibble before plotting.</p>
<div class="sourceCode" id="cb1176"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1176-1" data-line-number="1">d &lt;-</a>
<a class="sourceLine" id="cb1176-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">Y =</span> y) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1176-3" data-line-number="3"><span class="st">  </span><span class="kw">arrange</span>(Y) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1176-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">zeros =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;zeros_drink&quot;</span>, <span class="dt">times =</span> <span class="kw">sum</span>(drink)),</a>
<a class="sourceLine" id="cb1176-5" data-line-number="5">                   <span class="kw">rep</span>(<span class="st">&quot;zeros_work&quot;</span>,  <span class="dt">times =</span> <span class="kw">sum</span>(y <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>drink <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)),</a>
<a class="sourceLine" id="cb1176-6" data-line-number="6">                   <span class="kw">rep</span>(<span class="st">&quot;nope&quot;</span>,        <span class="dt">times =</span> n <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(y <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)))</a>
<a class="sourceLine" id="cb1176-7" data-line-number="7">         ) </a>
<a class="sourceLine" id="cb1176-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb1176-9" data-line-number="9">  <span class="kw">ggplot</span>(<span class="dt">data =</span> d, <span class="kw">aes</span>(<span class="dt">x =</span> Y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1176-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> zeros),</a>
<a class="sourceLine" id="cb1176-11" data-line-number="11">                 <span class="dt">binwidth =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>, <span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1176-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>], </a>
<a class="sourceLine" id="cb1176-13" data-line-number="13">                               <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>], </a>
<a class="sourceLine" id="cb1176-14" data-line-number="14">                               <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>])) <span class="op">+</span></a>
<a class="sourceLine" id="cb1176-15" data-line-number="15"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Manuscripts completed&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1176-16" data-line-number="16"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1176-17" data-line-number="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb1176-18" data-line-number="18">        <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>))</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-34-1.png" width="480" /></p>
<p>With these data, the likelihood of observing zero on <code>y</code>, (i.e., the likelihood zero manuscripts were completed on a given occasion) is</p>
<p><span class="math display">\[\begin{align*}
\text{Pr} (0 | p, \lambda) &amp; = \text{Pr} (\text{drink} | p) + \text{Pr} (\text{work} | p) \times \text{Pr} (0 | \lambda) \\
                           &amp; = p + (1 - p) \text{ exp} (- \lambda).
\end{align*}\]</span></p>
<p>And</p>
<blockquote>
<p>since the Poisson likelihood of <span class="math inline">\(y\)</span> is <span class="math inline">\(\text{Pr} (y | \lambda) = \lambda^y \text{exp} (- \lambda) / y!\)</span>, the likelihood of <span class="math inline">\(y = 0\)</span> is just <span class="math inline">\(\text{exp} (- \lambda)\)</span>. The above is just the mathematics for:</p>
<blockquote>
<p><em>The probability of observing a zero is the probability that the monks didn’t drink OR (<span class="math inline">\(+\)</span>) the probability that the monks worked AND (<span class="math inline">\(\times\)</span>) failed to finish anything</em>.</p>
</blockquote>
<p>And the likelihood of a non-zero value <span class="math inline">\(y\)</span> is:</p>
<p><span class="math display">\[\begin{align*}
\text{Pr} (y | p, \lambda) &amp; = \text{Pr} (\text{drink} | p) (0) + \text{Pr} (\text{work} | p) \text{Pr} (y | \lambda) \\
                           &amp; = (1 - p) \frac {\lambda^y \text{ exp} (- \lambda)}{y!}
\end{align*}\]</span></p>
<p>Since drinking monks never produce <span class="math inline">\(y &gt; 0\)</span>, the expression above is just the chance the monks both work <span class="math inline">\(1 - p\)</span>, and finish <span class="math inline">\(y\)</span> manuscripts. (p. 344, <em>emphasis</em> in the original)</p>
</blockquote>
<p>So letting <span class="math inline">\(p\)</span> be the probability <span class="math inline">\(y\)</span> is zero and <span class="math inline">\(\lambda\)</span> be the shape of the distribution, the zero-inflated Poisson (ZIPoisson) regression model takes the basic form</p>
<p><span class="math display">\[\begin{align*}
y_i &amp; \sim \text{ZIPoisson} (p_i, \lambda_i)\\
\text{logit} (p_i)     &amp; = \alpha_p + \beta_p x_i \\
\text{log} (\lambda_i) &amp; = \alpha_\lambda + \beta_\lambda x_i.
\end{align*}\]</span></p>
<p>One last thing to note is that in brms, <span class="math inline">\(p_i\)</span> is denoted <code>zi</code>. To fit a zero-inflated Poisson model with brms, make sure to specify the correct likelihood with <code>family = zero_inflated_poisson</code>. To use a non-default prior for <code>zi</code>, make sure to indicate <code>class = zi</code> within the <code>prior()</code> function.</p>
<div class="sourceCode" id="cb1177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1177-1" data-line-number="1">b11<span class="fl">.4</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb1177-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb1177-3" data-line-number="3">      <span class="dt">family =</span> zero_inflated_poisson,</a>
<a class="sourceLine" id="cb1177-4" data-line-number="4">      Y <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1177-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb1177-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">beta</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">class =</span> zi)),  <span class="co"># the brms default is beta(1, 1)</span></a>
<a class="sourceLine" id="cb1177-7" data-line-number="7">      <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb1177-8" data-line-number="8">      <span class="dt">seed =</span> <span class="dv">11</span>,</a>
<a class="sourceLine" id="cb1177-9" data-line-number="9">      <span class="dt">file =</span> <span class="st">&quot;fits/b11.04&quot;</span>) </a></code></pre></div>
<div class="sourceCode" id="cb1178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1178-1" data-line-number="1"><span class="kw">print</span>(b11<span class="fl">.4</span>)</a></code></pre></div>
<pre><code>##  Family: zero_inflated_poisson 
##   Links: mu = log; zi = identity 
## Formula: Y ~ 1 
##    Data: d (Number of observations: 365) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.10      0.08    -0.07     0.25 1.00     1259     1712
## 
## Family Specific Parameters: 
##    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## zi     0.24      0.05     0.14     0.33 1.00     1551     1874
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>The zero-inflated Poisson is <a href="https://cran.r-project.org/package=brms/vignettes/brms_families.html#zero-inflated-and-hurdle-models">parameterized in brms</a> a little differently than it is in rethinking. The different parameterization did not influence the estimate for the Intercept, <span class="math inline">\(\lambda\)</span>. In both here and in the text, <span class="math inline">\(\lambda\)</span> was about zero. However, it did influence the summary of <code>zi</code>. Note how McElreath’s <code>logistic(-1.39)</code> yielded 0.1994078. Seems rather close to our <code>zi</code> estimate of 0.236. First off, because he didn’t set his seed in the text before simulating, we couldn’t exactly reproduce his simulated drunk monk data. So our results will vary a little due to that alone. But after accounting for simulation variance, hopefully it’s clear that <code>zi</code> in brms is already in the probability metric. There’s no need to convert it.</p>
<p>In the <code>prior</code> argument, we used <code>beta(2, 2)</code> for <code>zi</code> and also mentioned in the margin that the brms default is <code>beta(1, 1)</code>. The beta distribution ranges from 0 to 1, making it a natural distribution to use for priors on probabilities. To give you a sense of what those two versions of the beta look like, let’s plot them.</p>
<div class="sourceCode" id="cb1180"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1180-1" data-line-number="1"><span class="kw">tibble</span>(<span class="st">`</span><span class="dt">zi prior</span><span class="st">`</span>=<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">length.out =</span> <span class="dv">50</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1180-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">beta(1, 1)</span><span class="st">`</span> =<span class="st"> </span><span class="kw">dbeta</span>(<span class="st">`</span><span class="dt">zi prior</span><span class="st">`</span>, <span class="dv">1</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1180-3" data-line-number="3">         <span class="st">`</span><span class="dt">beta(2, 2)</span><span class="st">`</span> =<span class="st"> </span><span class="kw">dbeta</span>(<span class="st">`</span><span class="dt">zi prior</span><span class="st">`</span>, <span class="dv">2</span>, <span class="dv">2</span>))  <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1180-4" data-line-number="4"><span class="st">  </span><span class="kw">gather</span>(prior, density, <span class="op">-</span><span class="st">`</span><span class="dt">zi prior</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1180-5" data-line-number="5"><span class="st">  </span></a>
<a class="sourceLine" id="cb1180-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">zi prior</span><span class="st">`</span>, <span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> density)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1180-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> prior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1180-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1180-9" data-line-number="9">                               <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>])) <span class="op">+</span></a>
<a class="sourceLine" id="cb1180-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;prior for zi&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1180-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1180-12" data-line-number="12"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1180-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb1180-14" data-line-number="14">        <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1180-15" data-line-number="15"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>prior)</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-36-1.png" width="576" /></p>
<p>Hopefully this clarifies that the brms default is flat, whereas our prior regularized a bit toward .5. Anyway, here’s that exponentiated <span class="math inline">\(\lambda\)</span>.</p>
<div class="sourceCode" id="cb1181"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1181-1" data-line-number="1"><span class="kw">fixef</span>(b11<span class="fl">.4</span>)[<span class="dv">1</span>, ] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1181-2" data-line-number="2"><span class="st">  </span><span class="kw">exp</span>()</a></code></pre></div>
<pre><code>##  Estimate Est.Error      Q2.5     Q97.5 
## 1.1009233 1.0860754 0.9299058 1.2864349</code></pre>
<div id="overthinking-zero-inflated-poisson-distribution-function." class="section level4">
<h4><span class="header-section-number">11.2.1.1</span> Overthinking: Zero-inflated Poisson distribution function.</h4>
<p>Define the <code>dzip()</code> function.</p>
<div class="sourceCode" id="cb1183"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1183-1" data-line-number="1">dzip &lt;-<span class="st"> </span><span class="cf">function</span>(x, p, lambda, <span class="dt">log =</span> <span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb1183-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb1183-3" data-line-number="3">  ll &lt;-<span class="st"> </span><span class="kw">ifelse</span>(</a>
<a class="sourceLine" id="cb1183-4" data-line-number="4">    x <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1183-5" data-line-number="5">    p <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p) <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>lambda),</a>
<a class="sourceLine" id="cb1183-6" data-line-number="6">    (<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p) <span class="op">*</span><span class="st"> </span><span class="kw">dpois</span>(x, lambda, <span class="dt">log =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1183-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb1183-8" data-line-number="8">  <span class="cf">if</span> (log <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) ll &lt;-<span class="st"> </span><span class="kw">log</span>(ll)</a>
<a class="sourceLine" id="cb1183-9" data-line-number="9">  <span class="kw">return</span>(ll)</a>
<a class="sourceLine" id="cb1183-10" data-line-number="10">  </a>
<a class="sourceLine" id="cb1183-11" data-line-number="11">}</a></code></pre></div>
<p>We can use McElreath’s <code>dzip()</code> to do a posterior predictive check for our model. To work with our estimates for <span class="math inline">\(p\)</span> and <span class="math inline">\(\lambda\)</span> directly, we’ll set <code>log = F</code>.</p>
<div class="sourceCode" id="cb1184"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1184-1" data-line-number="1">p_b11<span class="fl">.4</span>      &lt;-<span class="st"> </span><span class="kw">posterior_summary</span>(b11<span class="fl">.4</span>)[<span class="dv">2</span>, <span class="dv">1</span>]</a>
<a class="sourceLine" id="cb1184-2" data-line-number="2">lambda_b11<span class="fl">.4</span> &lt;-<span class="st"> </span><span class="kw">posterior_summary</span>(b11<span class="fl">.4</span>)[<span class="dv">1</span>, <span class="dv">1</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">exp</span>()</a>
<a class="sourceLine" id="cb1184-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1184-4" data-line-number="4"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1184-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">density =</span> <span class="kw">dzip</span>(<span class="dt">x =</span> x, </a>
<a class="sourceLine" id="cb1184-6" data-line-number="6">                        <span class="dt">p =</span> p_b11<span class="fl">.4</span>, </a>
<a class="sourceLine" id="cb1184-7" data-line-number="7">                        <span class="dt">lambda =</span> lambda_b11<span class="fl">.4</span>, </a>
<a class="sourceLine" id="cb1184-8" data-line-number="8">                        <span class="dt">log =</span> F)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1184-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb1184-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> density)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1184-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1184-12" data-line-number="12"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Manuscripts completed&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1184-13" data-line-number="13"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1184-14" data-line-number="14"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1184-15" data-line-number="15">        <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>))</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-39-1.png" width="480" /></p>
<p>If you look up to the histogram we made at the beginning of this section, you’ll see this isn’t a terrible approximation.</p>
<p>We can do something similar with the <code>brms::pp_check()</code> function. By setting <code>type = bars</code>, we’ll get back a series of model-based simulations summarized by mean and error bars superimposed atop a histogram of the original data. With the <code>nsamples</code> argument, we indicated we wanted those mean and error bars to be based on 100 simulations.</p>
<div class="sourceCode" id="cb1185"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1185-1" data-line-number="1"><span class="co"># this helps us set our custom color scheme</span></a>
<a class="sourceLine" id="cb1185-2" data-line-number="2">bayesplot<span class="op">::</span><span class="kw">color_scheme_set</span>(<span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">4</span>)])</a>
<a class="sourceLine" id="cb1185-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1185-4" data-line-number="4"><span class="kw">set.seed</span>(<span class="dv">11</span>)</a>
<a class="sourceLine" id="cb1185-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1185-6" data-line-number="6"><span class="kw">pp_check</span>(b11<span class="fl">.4</span>, <span class="dt">type =</span> <span class="st">&quot;bars&quot;</span>, <span class="dt">nsamples =</span> <span class="dv">100</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1185-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1185-8" data-line-number="8"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1185-9" data-line-number="9"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1185-10" data-line-number="10">        <span class="dt">legend.position =</span> <span class="kw">c</span>(.<span class="dv">91</span>, <span class="fl">.842</span>),</a>
<a class="sourceLine" id="cb1185-11" data-line-number="11">        <span class="dt">legend.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>),</a>
<a class="sourceLine" id="cb1185-12" data-line-number="12">        <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>))</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-40-1.png" width="576" /></p>
<p>Those mean and error bars suggest the model did a good job simulating data that resemble the original data.</p>
</div>
</div>
</div>
<div id="over-dispersed-outcomes" class="section level2">
<h2><span class="header-section-number">11.3</span> Over-dispersed outcomes</h2>
<blockquote>
<p>All statistical models omit something. The question is only whether that something is necessary for making useful inferences. One symptom that something important has been omitted from a count model is over-dispersion. The variance of a variable is sometimes called its <em>dispersion</em>. For a counting process like a binomial, the variance is a function of the same parameters as the expected value. For example, the expected value of a binomial is <span class="math inline">\(np\)</span> and its variance is <span class="math inline">\(np (1 - p)\)</span>. When the observed variance exceeds this amount–after conditioning on all the predictor variables–this implies that some omitted variable is producing additional dispersion in the observed counts.</p>
<p>What could go wrong, if we ignore the over-dispersion? Ignoring it can lead to all of the same problems as ignoring any predictor variable. Heterogeneity in counts can be a confound, hiding effects of interest or producing spurious inferences. (p, 346, <em>emphasis</em> in the original)</p>
</blockquote>
<p>In this chapter we’ll cope with the problem using continuous mixture models–first the beta-binomial and then the gamma-Poisson (a.k.a. negative binomial).</p>
<div id="beta-binomial." class="section level3">
<h3><span class="header-section-number">11.3.1</span> Beta-binomial.</h3>
<blockquote>
<p>A beta-binomial model assumes that each binomial count observation has its own probability of success. The model estimates the <em>distribution</em> of probabilities of success across cases, instead of a single probability of success. And predictor variables change the shape of this distribution, instead of directly determining the probability of each success. (p, 347, <em>emphasis</em> in the original)</p>
</blockquote>
<p>Unfortunately, we need to digress. As it turns out, there are multiple ways to parameterize the beta distribution and we’ve run square into two. In the text, McElreath wrote the beta distribution has two parameters, an average probability <span class="math inline">\(\bar p\)</span> and a shape parameter <span class="math inline">\(\theta\)</span>. In his R code 11.24, which we’ll reproduce in a bit, he demonstrated that parameterization with the <code>rethinking::dbeta2()</code> function. The nice thing about this parameterization is how intuitive the <code>pbar</code> parameter is. If you want a beta with an average of .2, you set <code>pbar = .2</code>. If you want the distribution to be more or less certain, make the <code>theta</code> argument more or less large, respectively.</p>
<p>However, the beta density is often defined in terms of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>. If you denote the data as <span class="math inline">\(y\)</span>, this follows the form</p>
<p><span class="math display">\[\text{Beta} (y | \alpha, \beta) = \frac{y^{\alpha - 1} (1 - y)^{\beta - 1}}{\text B (\alpha, \beta)},\]</span></p>
<p>which you can verify in the <em>Continuous Distributions on [0, 1]</em> section of the <a href="https://mc-stan.org/docs/2_21/functions-reference/beta-distribution.html">Stan Functions Reference</a>. In the formula, <span class="math inline">\(\text B\)</span> stands for the Beta function, which computes a normalizing constant, which you can learn about in the <em>Mathematical Functions</em> of the Stan reference manual. This is all important to be aware of because when we defined that beta prior for <code>zi</code> in the last model, it was using this parameterization. Also, if you look at the base R <code>dbeta()</code> function, you’ll learn it takes two parameters, <code>shape1</code> and <code>shape2</code>. Those uncreatively-named parameters are the same <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> from the density, above. They do not correspond to the <code>pbar</code> and <code>theta</code> parameters of McEreath’s <code>rethinking::dbeta2()</code> function.</p>
<p>McElreath had good reason for using <code>dbeta2()</code>. Beta’s typical <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> parameters aren’t the most intuitive to use; the parameters in McElreath’s <code>dbeta2()</code> are much nicer. But if you’re willing to dive deeper, it turns out you can find the mean of a beta distribution in terms of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> like this</p>
<p><span class="math display">\[\mu = \frac{\alpha}{\alpha + \beta}\]</span></p>
<p>We can talk about the spread of the distribution, sometimes called <span class="math inline">\(\kappa\)</span>, in terms <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> like this</p>
<p><span class="math display">\[\kappa = \alpha + \beta\]</span></p>
<p>With <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\kappa\)</span> in hand, we can even find the <span class="math inline">\(SD\)</span> of a beta distribution with</p>
<p><span class="math display">\[\sigma = \sqrt{\mu (1 - \mu) / (\kappa + 1)}\]</span></p>
<p>I explicate all this because McElreath’s <code>pbar</code> is <span class="math inline">\(\mu = \frac{\alpha}{\alpha + \beta}\)</span> and his <code>theta</code> is <span class="math inline">\(\kappa = \alpha + \beta\)</span>. This is great news because it means that we can understand what McElreath did with his <code>beta2()</code> function in terms of base R’s <code>dbeta()</code> function. Which also means that we can understand the distribution of the beta parameters used in <code>brms::brm()</code>. To demonstrate, let’s walk through McElreath’s R code 11.25.</p>
<div class="sourceCode" id="cb1186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1186-1" data-line-number="1">pbar  &lt;-<span class="st"> </span><span class="fl">0.5</span></a>
<a class="sourceLine" id="cb1186-2" data-line-number="2">theta &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb1186-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1186-4" data-line-number="4"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">.01</span>)),</a>
<a class="sourceLine" id="cb1186-5" data-line-number="5">       <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> rethinking<span class="op">::</span><span class="kw">dbeta2</span>(x, pbar, theta))) <span class="op">+</span></a>
<a class="sourceLine" id="cb1186-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1186-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;probability space&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1186-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1186-9" data-line-number="9"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">expression</span>(The<span class="op">~</span>beta<span class="op">~</span>distribution),</a>
<a class="sourceLine" id="cb1186-10" data-line-number="10">          <span class="dt">subtitle =</span> <span class="kw">expression</span>(<span class="st">&quot;Defined in terms of &quot;</span><span class="op">*</span>mu<span class="op">*</span><span class="st">&quot; (i.e., pbar) and &quot;</span><span class="op">*</span>kappa<span class="op">*</span><span class="st">&quot; (i.e., theta)&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1186-11" data-line-number="11"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1186-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>))</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-41-1.png" width="384" /></p>
<p>In his 2015 text, <a href="https://sites.google.com/site/doingbayesiandataanalysis/"><em>Doing Bayesian Data Analysis</em></a>, Kruschke provided code for a convenience function that will take <code>pbar</code> and <code>theta</code> as inputs and return the corresponding <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> values. Here’s the function:</p>
<div class="sourceCode" id="cb1187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1187-1" data-line-number="1">betaABfromMeanKappa &lt;-<span class="st"> </span><span class="cf">function</span>(mean, kappa) {</a>
<a class="sourceLine" id="cb1187-2" data-line-number="2">  <span class="cf">if</span> (mean <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>mean <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1</span>) <span class="kw">stop</span>(<span class="st">&quot;must have 0 &lt; mean &lt; 1&quot;</span>)</a>
<a class="sourceLine" id="cb1187-3" data-line-number="3">  <span class="cf">if</span> (kappa <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="kw">stop</span>(<span class="st">&quot;kappa must be &gt; 0&quot;</span>)</a>
<a class="sourceLine" id="cb1187-4" data-line-number="4">  a &lt;-<span class="st"> </span>mean <span class="op">*</span><span class="st"> </span>kappa</a>
<a class="sourceLine" id="cb1187-5" data-line-number="5">  b &lt;-<span class="st"> </span>(<span class="fl">1.0</span> <span class="op">-</span><span class="st"> </span>mean) <span class="op">*</span><span class="st"> </span>kappa</a>
<a class="sourceLine" id="cb1187-6" data-line-number="6">  <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">a =</span> a, <span class="dt">b =</span> b))</a>
<a class="sourceLine" id="cb1187-7" data-line-number="7">}</a></code></pre></div>
<p>Now we can use Kruschke’s <code>betaABfromMeanKappa()</code> to find the <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> values corresponding to <code>pbar</code> and <code>theta</code>.</p>
<div class="sourceCode" id="cb1188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1188-1" data-line-number="1"><span class="kw">betaABfromMeanKappa</span>(<span class="dt">mean =</span> pbar, <span class="dt">kappa =</span> theta)</a></code></pre></div>
<pre><code>## $a
## [1] 2.5
## 
## $b
## [1] 2.5</code></pre>
<p>And finally, we can double check that all of this works. Here’s the same distribution but defined in terms of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>.</p>
<div class="sourceCode" id="cb1190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1190-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">.01</span>)),</a>
<a class="sourceLine" id="cb1190-2" data-line-number="2">       <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> <span class="kw">dbeta</span>(x, <span class="fl">2.5</span>, <span class="fl">2.5</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb1190-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1190-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;probability space&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1190-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1190-6" data-line-number="6"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">expression</span>(The<span class="op">~</span>beta<span class="op">~</span>distribution),</a>
<a class="sourceLine" id="cb1190-7" data-line-number="7">          <span class="dt">subtitle =</span> <span class="kw">expression</span>(<span class="st">&quot;This time defined in terms of &quot;</span><span class="op">*</span>alpha<span class="op">*</span><span class="st">&quot; and &quot;</span><span class="op">*</span>beta)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1190-8" data-line-number="8"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1190-9" data-line-number="9"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>))</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-44-1.png" width="384" /></p>
<p>McElreath encouraged us to “explore different values for <code>pbar</code> and <code>theta</code>” (p. 348). Here’s a grid of plots with <code>pbar = c(.25, .5, .75)</code> and <code>theta = c(5, 10, 15)</code>.</p>
<div class="sourceCode" id="cb1191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1191-1" data-line-number="1"><span class="co"># data</span></a>
<a class="sourceLine" id="cb1191-2" data-line-number="2"><span class="kw">crossing</span>(<span class="dt">pbar  =</span> <span class="kw">c</span>(.<span class="dv">25</span>, <span class="fl">.5</span>, <span class="fl">.75</span>),</a>
<a class="sourceLine" id="cb1191-3" data-line-number="3">         <span class="dt">theta =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">15</span>, <span class="dv">30</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1191-4" data-line-number="4"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(pbar, theta), <span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">length.out =</span> <span class="dv">100</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1191-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">density =</span> rethinking<span class="op">::</span><span class="kw">dbeta2</span>(x, pbar, theta),</a>
<a class="sourceLine" id="cb1191-6" data-line-number="6">         <span class="dt">mu      =</span> <span class="kw">str_c</span>(<span class="st">&quot;mu == &quot;</span>, pbar <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_remove</span>(., <span class="st">&quot;0&quot;</span>)),</a>
<a class="sourceLine" id="cb1191-7" data-line-number="7">         <span class="dt">kappa   =</span> <span class="kw">factor</span>(<span class="kw">str_c</span>(<span class="st">&quot;kappa == &quot;</span>, theta), </a>
<a class="sourceLine" id="cb1191-8" data-line-number="8">                          <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;kappa == 30&quot;</span>, <span class="st">&quot;kappa == 15&quot;</span>, <span class="st">&quot;kappa == 5&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1191-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb1191-10" data-line-number="10"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb1191-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> density)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1191-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1191-13" data-line-number="13"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;probability space&quot;</span>, </a>
<a class="sourceLine" id="cb1191-14" data-line-number="14">                     <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;.5&quot;</span>, <span class="st">&quot;1&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1191-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">labels =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1191-16" data-line-number="16"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1191-17" data-line-number="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1191-18" data-line-number="18">        <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1191-19" data-line-number="19"><span class="st">  </span><span class="kw">facet_grid</span>(kappa <span class="op">~</span><span class="st"> </span>mu, <span class="dt">labeller =</span> label_parsed)</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-45-1.png" width="480" /></p>
<p>If you’d like to see how to make a similar plot in terms of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>, see <a href="https://bookdown.org/content/3686/inferring-a-binomial-probability-via-exact-mathematical-analysis.html">Chapter 6</a> of my project <a href="https://bookdown.org/content/3686/">recoding Kruschke’s text into tidyverse and brms code</a>.</p>
<p>But remember, we’re not fitting a beta model. We’re using the beta-binomial. “We’re going to bind our linear model to <span class="math inline">\(\bar p\)</span>, so that changes in predictor variables change the central tendency of the distribution” (p. 348). The statistical model we’ll be fitting follows the form</p>
<p><span class="math display">\[
\begin{align*}
\text{admit}_i &amp; \sim \operatorname{BetaBinomial} (n_i, \bar p_i, \theta)\\
\text{logit} (\bar p_i) &amp; = \alpha \\
\alpha                       &amp; \sim \operatorname{Normal} (0, 2) \\
\theta                       &amp; \sim \operatorname{Exponential} (1).
\end{align*}
\]</span></p>
<p>Here the size <span class="math inline">\(n = \text{applications}\)</span>. In case you’re confused, yes, our statistical model is not the one McElreath presented at the top of page 348 in the text. If you look closely, the statistical formula he presented does not match up with the one implied by his R code 11.26. Our statistical formula and the <code>brm()</code> model we’ll be fitting, below, correspond to his R code 11.26.</p>
<p>Before we fit, we have an additional complication. The beta-binomial likelihood is <a href="https://github.com/paul-buerkner/brms/issues/144">not implemented in brms at this time</a>. However, brms versions 2.2.0 and above allow users to define custom distributions. You can find the handy <a href="https://cran.r-project.org/package=brms/vignettes/brms_customfamilies.html"><em>Define Custom Response Distributions with brms</em> vignette here</a>. Happily, Bürkner even used the <a href="https://cran.r-project.org/package=brms/vignettes/brms_customfamilies.html#the-beta-binomial-distribution">beta-binomial distribution as the exemplar</a> in the vignette.</p>
<p>Before we get carried away, let’s load the data.</p>
<div class="sourceCode" id="cb1192"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1192-1" data-line-number="1"><span class="kw">library</span>(rethinking)</a>
<a class="sourceLine" id="cb1192-2" data-line-number="2"><span class="kw">data</span>(UCBadmit) </a>
<a class="sourceLine" id="cb1192-3" data-line-number="3">d &lt;-<span class="st"> </span>UCBadmit</a></code></pre></div>
<p>Unload rethinking and load brms.</p>
<div class="sourceCode" id="cb1193"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1193-1" data-line-number="1"><span class="kw">rm</span>(UCBadmit)</a>
<a class="sourceLine" id="cb1193-2" data-line-number="2"><span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)</a>
<a class="sourceLine" id="cb1193-3" data-line-number="3"><span class="kw">library</span>(brms)</a></code></pre></div>
<p>I’m not going to go into great detail explaining the ins and outs of making custom distributions for <code>brm()</code>. You’ve got Bürkner’s vignette for that. For our purposes, we need two preparatory steps. First, we need to use the <code>custom_family()</code> function to define the name and parameters of the beta-binomial distribution for use in <code>brm()</code>. Second, we have to define some functions for Stan which are not defined in Stan itself. We’ll save them as <code>stan_funs</code>. Third, we’ll make a <code>stanvar()</code> statement which will allow us to pass our <code>stan_funs</code> to <code>brm()</code>.</p>
<div class="sourceCode" id="cb1194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1194-1" data-line-number="1">beta_binomial2 &lt;-<span class="st"> </span><span class="kw">custom_family</span>(</a>
<a class="sourceLine" id="cb1194-2" data-line-number="2">  <span class="st">&quot;beta_binomial2&quot;</span>, <span class="dt">dpars =</span> <span class="kw">c</span>(<span class="st">&quot;mu&quot;</span>, <span class="st">&quot;phi&quot;</span>),</a>
<a class="sourceLine" id="cb1194-3" data-line-number="3">  <span class="dt">links =</span> <span class="kw">c</span>(<span class="st">&quot;logit&quot;</span>, <span class="st">&quot;log&quot;</span>), <span class="dt">lb =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb1194-4" data-line-number="4">  <span class="dt">type =</span> <span class="st">&quot;int&quot;</span>, <span class="dt">vars =</span> <span class="st">&quot;vint1[n]&quot;</span></a>
<a class="sourceLine" id="cb1194-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb1194-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1194-7" data-line-number="7">stan_funs &lt;-<span class="st"> &quot;</span></a>
<a class="sourceLine" id="cb1194-8" data-line-number="8"><span class="st">  real beta_binomial2_lpmf(int y, real mu, real phi, int T) {</span></a>
<a class="sourceLine" id="cb1194-9" data-line-number="9"><span class="st">    return beta_binomial_lpmf(y | T, mu * phi, (1 - mu) * phi);</span></a>
<a class="sourceLine" id="cb1194-10" data-line-number="10"><span class="st">  }</span></a>
<a class="sourceLine" id="cb1194-11" data-line-number="11"><span class="st">  int beta_binomial2_rng(real mu, real phi, int T) {</span></a>
<a class="sourceLine" id="cb1194-12" data-line-number="12"><span class="st">    return beta_binomial_rng(T, mu * phi, (1 - mu) * phi);</span></a>
<a class="sourceLine" id="cb1194-13" data-line-number="13"><span class="st">  }</span></a>
<a class="sourceLine" id="cb1194-14" data-line-number="14"><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb1194-15" data-line-number="15"></a>
<a class="sourceLine" id="cb1194-16" data-line-number="16">stanvars &lt;-<span class="st"> </span><span class="kw">stanvar</span>(<span class="dt">scode =</span> stan_funs, <span class="dt">block =</span> <span class="st">&quot;functions&quot;</span>)</a></code></pre></div>
<p>With that out of the way, we’re almost ready to test this baby out. Before we do, we should clarify two points:</p>
<p>First, what McElreath referred to as the shape parameter, <span class="math inline">\(\theta\)</span>, Bürkner called the precision parameter, <span class="math inline">\(\phi\)</span>. In our exposition, above, we followed Kruschke’s convention and called it <span class="math inline">\(\kappa\)</span>. These are all the same thing: <span class="math inline">\(\theta\)</span>, <span class="math inline">\(\phi\)</span>, and <span class="math inline">\(\kappa\)</span> are all the same thing. Perhaps less confusingly, what McElreath called the <code>pbar</code> parameter, <span class="math inline">\(\bar p\)</span>, Bürkner simply called <span class="math inline">\(\mu\)</span>.</p>
<p>Second, we’ve become accustomed to using the <code>y | trials() ~ ...</code> syntax when defining our <code>formula</code> arguments for binomial models. Here we are replacing <code>trials()</code> with <code>vint()</code>. From Bürkner’s <em>Define Custom Response Distributions with brms</em> vignette, we read:</p>
<blockquote>
<p>To provide information about the number of trials (an integer variable), we are going to use the addition argument <code>vint()</code>, which can only be used in custom families. Simiarily, if we needed to include additional vectors of real data, we would use <code>vreal()</code>. Actually, for this particular example, we could more elegantly apply the addition argument <code>trials()</code> instead of <code>vint()</code> as in the basic binomial model. However, since the present vignette is ment to give a general overview of the topic, we will go with the more general method.</p>
<p>We now have all components together to fit our custom beta-binomial model:</p>
</blockquote>
<div class="sourceCode" id="cb1195"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1195-1" data-line-number="1">b11<span class="fl">.5</span> &lt;-</a>
<a class="sourceLine" id="cb1195-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb1195-3" data-line-number="3">      <span class="dt">family =</span> beta_binomial2,  <span class="co"># here&#39;s our custom likelihood</span></a>
<a class="sourceLine" id="cb1195-4" data-line-number="4">      admit <span class="op">|</span><span class="st"> </span><span class="kw">vint</span>(applications) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1195-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb1195-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> phi)),</a>
<a class="sourceLine" id="cb1195-7" data-line-number="7">      <span class="dt">iter =</span> <span class="dv">4000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">cores =</span> <span class="dv">2</span>, <span class="dt">chains =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb1195-8" data-line-number="8">      <span class="dt">stanvars =</span> stanvars,  <span class="co"># note our `stanvars`</span></a>
<a class="sourceLine" id="cb1195-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">11</span>,</a>
<a class="sourceLine" id="cb1195-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/b11.05&quot;</span>)</a></code></pre></div>
<p>Success, our results look a lot like those in the text!</p>
<div class="sourceCode" id="cb1196"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1196-1" data-line-number="1"><span class="kw">print</span>(b11<span class="fl">.5</span>)</a></code></pre></div>
<pre><code>##  Family: beta_binomial2 
##   Links: mu = logit; phi = identity 
## Formula: admit | vint(applications) ~ 1 
##    Data: d (Number of observations: 12) 
## Samples: 2 chains, each with iter = 4000; warmup = 1000; thin = 1;
##          total post-warmup samples = 6000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -0.38      0.30    -0.97     0.21 1.00     3840     3408
## 
## Family Specific Parameters: 
##     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## phi     2.79      0.94     1.31     4.99 1.00     4068     3517
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Here’s what the corresponding <code>posterior_samples()</code> data object looks like.</p>
<div class="sourceCode" id="cb1198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1198-1" data-line-number="1">post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(b11<span class="fl">.5</span>)</a>
<a class="sourceLine" id="cb1198-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1198-3" data-line-number="3"><span class="kw">head</span>(post)</a></code></pre></div>
<pre><code>##   b_Intercept      phi      lp__
## 1 -0.36233302 3.701785 -70.39182
## 2 -0.64609608 1.772836 -71.37820
## 3 -0.11839922 2.667552 -70.43501
## 4  0.53363769 2.024830 -74.18534
## 5 -0.02124876 2.860503 -70.85063
## 6 -0.25357651 2.138199 -70.37938</code></pre>
<p>Here’s our median and percentile-based 95% interval.</p>
<div class="sourceCode" id="cb1200"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1200-1" data-line-number="1">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1200-2" data-line-number="2"><span class="st">  </span>tidybayes<span class="op">::</span><span class="kw">median_qi</span>(<span class="kw">inv_logit_scaled</span>(b_Intercept)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1200-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##   inv_logit_scaled(b_Intercept) .lower .upper .width .point .interval
## 1                         0.406  0.275  0.552   0.95 median        qi</code></pre>
<p>To stay within the tidyverse while making the many thin lines in Figure 11.5.a, we’re going to need to do a bit of data processing. First, we’ll want a variable to index the rows in <code>post</code> (i.e., to index the posterior draws). And we’ll want to convert the <code>b_Intercept</code> to the <span class="math inline">\(\bar p\)</span> metric with the <code>inv_logit_scaled()</code> function. Then we’ll use <code>sample_n()</code> to randomly draw a subset of the posterior draws. Then with the <code>expand()</code> function, we’ll insert a tightly-spaced sequence of <code>x</code> values ranging between 0 and 1–the parameter space of beta distribution. Finally, we’ll use <code>pmap_dbl()</code> to compute the density values for the <code>rethinking::dbeta2</code> distribution corresponding to the unique combination of <code>x</code>, <code>p_bar</code>, and <code>phi</code> values in each row.</p>
<div class="sourceCode" id="cb1202"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1202-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">11</span>)</a>
<a class="sourceLine" id="cb1202-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1202-3" data-line-number="3">lines &lt;-</a>
<a class="sourceLine" id="cb1202-4" data-line-number="4"><span class="st">  </span>post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1202-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">iter  =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb1202-6" data-line-number="6">         <span class="dt">p_bar =</span> <span class="kw">inv_logit_scaled</span>(b_Intercept)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1202-7" data-line-number="7"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1202-8" data-line-number="8"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(iter, p_bar, phi),</a>
<a class="sourceLine" id="cb1202-9" data-line-number="9">         <span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">.005</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1202-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">density =</span> <span class="kw">pmap_dbl</span>(<span class="kw">list</span>(x, p_bar, phi), rethinking<span class="op">::</span>dbeta2))</a>
<a class="sourceLine" id="cb1202-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1202-12" data-line-number="12"><span class="kw">str</span>(lines)</a></code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    20100 obs. of  5 variables:
##  $ iter   : int  6 6 6 6 6 6 6 6 6 6 ...
##  $ p_bar  : num  0.437 0.437 0.437 0.437 0.437 ...
##  $ phi    : num  2.14 2.14 2.14 2.14 2.14 ...
##  $ x      : num  0 0.005 0.01 0.015 0.02 0.025 0.03 0.035 0.04 0.045 ...
##  $ density: num  Inf 1.58 1.51 1.47 1.44 ...</code></pre>
<p>All that was just for the thin lines. To make the thicker line for the posterior mean, we’ll get tricky with <code>stat_function()</code>.</p>
<div class="sourceCode" id="cb1204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1204-1" data-line-number="1">lines <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1204-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> density)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1204-3" data-line-number="3"><span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> rethinking<span class="op">::</span>dbeta2,</a>
<a class="sourceLine" id="cb1204-4" data-line-number="4">                <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">prob  =</span> <span class="kw">mean</span>(<span class="kw">inv_logit_scaled</span>(post[, <span class="dv">1</span>])),</a>
<a class="sourceLine" id="cb1204-5" data-line-number="5">                            <span class="dt">theta =</span> <span class="kw">mean</span>(post[, <span class="dv">2</span>])),</a>
<a class="sourceLine" id="cb1204-6" data-line-number="6">                <span class="dt">size =</span> <span class="fl">1.5</span>, <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1204-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> iter),</a>
<a class="sourceLine" id="cb1204-8" data-line-number="8">            <span class="dt">alpha =</span> <span class="fl">.2</span>, <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1204-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">3</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1204-10" data-line-number="10"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;probability admit&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1204-11" data-line-number="11"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1204-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>))</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-53-1.png" width="384" /></p>
<p>There are other ways to do this. For ideas, check out my blog post, <a href="https://solomonkurz.netlify.com/post/make-rotated-gaussians-kruschke-style/"><em>Make rotated Gaussians, Kruschke style</em></a>.</p>
<p>Before we can do our variant of Figure 11.5.b, we’ll need to define a few more custom functions. The <code>log_lik_beta_binomial2()</code> and <code>posterior_predict_beta_binomial2()</code> functions are required for <code>brms::predict()</code> to work with our <code>family = beta_binomial2</code> brmfit object. Similarly, <code>pp_expect_beta_binomial2()</code> is required for <code>brms::fitted()</code> to work properly. And before all that, we need to throw in a line with the <code>expose_functions()</code> function. Just go with it.</p>
<div class="sourceCode" id="cb1205"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1205-1" data-line-number="1"><span class="kw">expose_functions</span>(b11<span class="fl">.5</span>, <span class="dt">vectorize =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1205-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1205-3" data-line-number="3"><span class="co"># required to use `predict()`</span></a>
<a class="sourceLine" id="cb1205-4" data-line-number="4">log_lik_beta_binomial2 &lt;-<span class="st"> </span><span class="cf">function</span>(i, draws) {</a>
<a class="sourceLine" id="cb1205-5" data-line-number="5">  mu  &lt;-<span class="st"> </span>draws<span class="op">$</span>dpars<span class="op">$</span>mu[, i]</a>
<a class="sourceLine" id="cb1205-6" data-line-number="6">  phi &lt;-<span class="st"> </span>draws<span class="op">$</span>dpars<span class="op">$</span>phi</a>
<a class="sourceLine" id="cb1205-7" data-line-number="7">  N   &lt;-<span class="st"> </span>draws<span class="op">$</span>data<span class="op">$</span>trials[i]</a>
<a class="sourceLine" id="cb1205-8" data-line-number="8">  y   &lt;-<span class="st"> </span>draws<span class="op">$</span>data<span class="op">$</span>Y[i]</a>
<a class="sourceLine" id="cb1205-9" data-line-number="9">  <span class="kw">beta_binomial2_lpmf</span>(y, mu, phi, N)</a>
<a class="sourceLine" id="cb1205-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb1205-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1205-12" data-line-number="12">posterior_predict_beta_binomial2 &lt;-<span class="st"> </span><span class="cf">function</span>(i, draws, ...) {</a>
<a class="sourceLine" id="cb1205-13" data-line-number="13">  mu     &lt;-<span class="st"> </span>draws<span class="op">$</span>dpars<span class="op">$</span>mu[, i]</a>
<a class="sourceLine" id="cb1205-14" data-line-number="14">  phi    &lt;-<span class="st"> </span>draws<span class="op">$</span>dpars<span class="op">$</span>phi</a>
<a class="sourceLine" id="cb1205-15" data-line-number="15">  trials &lt;-<span class="st"> </span>draws<span class="op">$</span>data<span class="op">$</span>vint1[i]</a>
<a class="sourceLine" id="cb1205-16" data-line-number="16">  <span class="kw">beta_binomial2_rng</span>(mu, phi, trials)</a>
<a class="sourceLine" id="cb1205-17" data-line-number="17">}</a>
<a class="sourceLine" id="cb1205-18" data-line-number="18"></a>
<a class="sourceLine" id="cb1205-19" data-line-number="19"><span class="co"># required to use `fitted()`</span></a>
<a class="sourceLine" id="cb1205-20" data-line-number="20">pp_expect_beta_binomial2 &lt;-<span class="st"> </span><span class="cf">function</span>(draws) {</a>
<a class="sourceLine" id="cb1205-21" data-line-number="21">  mu     &lt;-<span class="st"> </span>draws<span class="op">$</span>dpars<span class="op">$</span>mu</a>
<a class="sourceLine" id="cb1205-22" data-line-number="22">  trials &lt;-<span class="st"> </span>draws<span class="op">$</span>data<span class="op">$</span>vint1</a>
<a class="sourceLine" id="cb1205-23" data-line-number="23">  trials &lt;-<span class="st"> </span><span class="kw">matrix</span>(trials, <span class="dt">nrow =</span> <span class="kw">nrow</span>(mu), <span class="dt">ncol =</span> <span class="kw">ncol</span>(mu), <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1205-24" data-line-number="24">  mu <span class="op">*</span><span class="st"> </span>trials</a>
<a class="sourceLine" id="cb1205-25" data-line-number="25">}</a></code></pre></div>
<p>With those intermediary steps out of the way, we’re ready to make Figure 11.5.b.</p>
<div class="sourceCode" id="cb1206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1206-1" data-line-number="1"><span class="co"># the prediction intervals</span></a>
<a class="sourceLine" id="cb1206-2" data-line-number="2"><span class="kw">predict</span>(b11<span class="fl">.5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1206-3" data-line-number="3"><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1206-4" data-line-number="4"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">ll =</span> Q2<span class="fl">.5</span>,</a>
<a class="sourceLine" id="cb1206-5" data-line-number="5">            <span class="dt">ul =</span> Q97<span class="fl">.5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1206-6" data-line-number="6"><span class="st">  </span><span class="co"># the fitted intervals</span></a>
<a class="sourceLine" id="cb1206-7" data-line-number="7"><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">fitted</span>(b11<span class="fl">.5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1206-8" data-line-number="8"><span class="st">  </span><span class="co"># the original data used to fit the model</span></a>
<a class="sourceLine" id="cb1206-9" data-line-number="9"><span class="st">  </span><span class="kw">bind_cols</span>(b11<span class="fl">.5</span><span class="op">$</span>data) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1206-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">case =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1206-11" data-line-number="11"><span class="st">  </span></a>
<a class="sourceLine" id="cb1206-12" data-line-number="12"><span class="st">  </span><span class="co"># plot!</span></a>
<a class="sourceLine" id="cb1206-13" data-line-number="13"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> case)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1206-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_linerange</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> ll <span class="op">/</span><span class="st"> </span>applications, </a>
<a class="sourceLine" id="cb1206-15" data-line-number="15">                     <span class="dt">ymax =</span> ul <span class="op">/</span><span class="st"> </span>applications),</a>
<a class="sourceLine" id="cb1206-16" data-line-number="16">                 <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>], </a>
<a class="sourceLine" id="cb1206-17" data-line-number="17">                 <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1206-18" data-line-number="18"><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2<span class="fl">.5</span>  <span class="op">/</span><span class="st"> </span>applications, </a>
<a class="sourceLine" id="cb1206-19" data-line-number="19">                      <span class="dt">ymax =</span> Q97<span class="fl">.5</span> <span class="op">/</span><span class="st"> </span>applications, </a>
<a class="sourceLine" id="cb1206-20" data-line-number="20">                      <span class="dt">y =</span> Estimate<span class="op">/</span>applications),</a>
<a class="sourceLine" id="cb1206-21" data-line-number="21">                  <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb1206-22" data-line-number="22">                  <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">shape =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1206-23" data-line-number="23"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> admit<span class="op">/</span>applications),</a>
<a class="sourceLine" id="cb1206-24" data-line-number="24">             <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb1206-25" data-line-number="25">             <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1206-26" data-line-number="26"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1206-27" data-line-number="27"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.5</span>, <span class="dv">1</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1206-28" data-line-number="28"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Posterior validation check&quot;</span>,</a>
<a class="sourceLine" id="cb1206-29" data-line-number="29">       <span class="dt">y =</span> <span class="st">&quot;Admittance probability&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1206-30" data-line-number="30"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1206-31" data-line-number="31"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.x =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1206-32" data-line-number="32">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,</a>
<a class="sourceLine" id="cb1206-33" data-line-number="33">        <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>))</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-55-1.png" width="384" /></p>
<p>As in the text, the raw data are consistent with the prediction intervals. But those intervals are so incredibly wide, they’re hardly an endorsement of the model. Once we learn about hierarchical models, we’ll be able to do much better.</p>
</div>
<div id="negative-binomial-or-gamma-poisson." class="section level3">
<h3><span class="header-section-number">11.3.2</span> Negative-binomial or gamma-Poisson.</h3>
<p>Recall the Poisson distribution presumes <span class="math inline">\(\sigma^2\)</span> scales with <span class="math inline">\(\mu\)</span>. The negative binomial distribution relaxes this assumption and presumes “each Poisson count observation has its own rate. It estimates the shape of a gamma distribution to describe the Poisson rates across cases” (p. 350).</p>
<p>Here’s a look at the <span class="math inline">\(\gamma\)</span> distribution.</p>
<div class="sourceCode" id="cb1207"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1207-1" data-line-number="1">mu    &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb1207-2" data-line-number="2">theta &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb1207-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1207-4" data-line-number="4"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">12</span>, <span class="dt">by =</span> <span class="fl">.01</span>)),</a>
<a class="sourceLine" id="cb1207-5" data-line-number="5">       <span class="kw">aes</span>(<span class="dt">x =</span> x)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1207-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> rethinking<span class="op">::</span><span class="kw">dgamma2</span>(x, mu, theta)),</a>
<a class="sourceLine" id="cb1207-7" data-line-number="7">              <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>, </a>
<a class="sourceLine" id="cb1207-8" data-line-number="8">              <span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1207-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> mu, <span class="dt">linetype =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb1207-10" data-line-number="10">             <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">3</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1207-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, mu, <span class="dv">10</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1207-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1207-13" data-line-number="13"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Our sweet &quot;</span>, gamma, <span class="st">&quot;(3, 1)&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb1207-14" data-line-number="14"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1207-15" data-line-number="15"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1207-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>))</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-56-1.png" width="336" /></p>
<p>McElreath encouraged us to fool around with plotting gamma distributions with different combinations of <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\theta\)</span>. Here’s a small attempt with different combinations of each taking on 1, 5, and 9.</p>
<div class="sourceCode" id="cb1208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1208-1" data-line-number="1"><span class="co"># data</span></a>
<a class="sourceLine" id="cb1208-2" data-line-number="2"><span class="kw">crossing</span>(<span class="dt">mu    =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">9</span>),</a>
<a class="sourceLine" id="cb1208-3" data-line-number="3">         <span class="dt">theta =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">9</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1208-4" data-line-number="4"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(mu, theta), </a>
<a class="sourceLine" id="cb1208-5" data-line-number="5">         <span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">27</span>, <span class="dt">length.out =</span> <span class="dv">100</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1208-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">density    =</span> rethinking<span class="op">::</span><span class="kw">dgamma2</span>(x, mu, theta),</a>
<a class="sourceLine" id="cb1208-7" data-line-number="7">         <span class="dt">mu_char    =</span> <span class="kw">str_c</span>(<span class="st">&quot;mu==&quot;</span>, mu),</a>
<a class="sourceLine" id="cb1208-8" data-line-number="8">         <span class="dt">theta_char =</span> <span class="kw">str_c</span>(<span class="st">&quot;theta==&quot;</span>, theta)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1208-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1208-10" data-line-number="10"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb1208-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1208-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> density),</a>
<a class="sourceLine" id="cb1208-13" data-line-number="13">              <span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1208-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> mu),</a>
<a class="sourceLine" id="cb1208-15" data-line-number="15">             <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>], <span class="dt">linetype =</span> <span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1208-16" data-line-number="16"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">labels =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1208-17" data-line-number="17"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Gamma can take many shapes&quot;</span>,</a>
<a class="sourceLine" id="cb1208-18" data-line-number="18">       <span class="dt">subtitle =</span> <span class="st">&quot;(dotted vertical lines mark off the means)&quot;</span>,</a>
<a class="sourceLine" id="cb1208-19" data-line-number="19">       <span class="dt">x =</span> <span class="st">&quot;parameter space&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1208-20" data-line-number="20"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">25</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1208-21" data-line-number="21"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1208-22" data-line-number="22"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb1208-23" data-line-number="23">        <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1208-24" data-line-number="24"><span class="st">  </span><span class="kw">facet_grid</span>(theta_char<span class="op">~</span>mu_char, <span class="dt">labeller =</span> label_parsed)</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-57-1.png" width="432" /></p>
<div id="bonus-lets-fit-a-negative-binomial-model." class="section level4">
<h4><span class="header-section-number">11.3.2.1</span> Bonus: Let’s fit a negative-binomial model.</h4>
<p>McElreath didn’t give an example of negative-binomial regression in the text. This can be a useful but somewhat perplexing model type, so let’s take a detour for an extended example with the <code>UCBadmit</code> data. As in other examples, we will be modeling the <code>admit</code> rates. We’ll keep things simple and leave out predictor variables.</p>
<div class="sourceCode" id="cb1209"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1209-1" data-line-number="1">b11<span class="fl">.6</span> &lt;-</a>
<a class="sourceLine" id="cb1209-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, </a>
<a class="sourceLine" id="cb1209-3" data-line-number="3">      <span class="dt">family =</span> negbinomial,</a>
<a class="sourceLine" id="cb1209-4" data-line-number="4">      admit <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb1209-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb1209-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">gamma</span>(<span class="fl">0.01</span>, <span class="fl">0.01</span>), <span class="dt">class =</span> shape)),  <span class="co"># this is the brms default</span></a>
<a class="sourceLine" id="cb1209-7" data-line-number="7">      <span class="dt">iter =</span> <span class="dv">4000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">cores =</span> <span class="dv">2</span>, <span class="dt">chains =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb1209-8" data-line-number="8">      <span class="dt">seed =</span> <span class="dv">11</span>,</a>
<a class="sourceLine" id="cb1209-9" data-line-number="9">      <span class="dt">file =</span> <span class="st">&quot;fits/b11.06&quot;</span>)</a></code></pre></div>
<p>You may have noticed we used the brms default <code>prior(gamma(0.01, 0.01), class = shape)</code> for the shape parameter. Here’s what that prior looks like.</p>
<div class="sourceCode" id="cb1210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1210-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">60</span>, <span class="dt">by =</span> <span class="fl">.1</span>)),</a>
<a class="sourceLine" id="cb1210-2" data-line-number="2">       <span class="kw">aes</span>(<span class="dt">x =</span> x)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1210-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> <span class="kw">dgamma</span>(x, <span class="fl">0.01</span>, <span class="fl">0.01</span>)),</a>
<a class="sourceLine" id="cb1210-4" data-line-number="4">              <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>, </a>
<a class="sourceLine" id="cb1210-5" data-line-number="5">              <span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1210-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1210-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1210-8" data-line-number="8"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">50</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1210-9" data-line-number="9"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">expression</span>(brms<span class="op">~</span>default<span class="op">~</span><span class="kw">gamma</span>(<span class="fl">0.01</span><span class="op">*</span><span class="st">&quot;, &quot;</span><span class="op">*</span><span class="fl">0.01</span>)<span class="op">~</span>shape<span class="op">~</span>prior)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1210-10" data-line-number="10"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1210-11" data-line-number="11"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>))</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-58-1.png" width="336" /></p>
<p>Before we even look at the summary of the model parameters, we’ll use the <code>brms::predict()</code> function to return random samples of the poster predictive distribution. This will help us get a sense of what this model is. Because we want random samples instead of summary values, we will specify <code>summary = F</code>. Let’s take a look of what this returns.</p>
<div class="sourceCode" id="cb1211"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1211-1" data-line-number="1">p &lt;-</a>
<a class="sourceLine" id="cb1211-2" data-line-number="2"><span class="st">  </span><span class="kw">predict</span>(b11<span class="fl">.6</span>,</a>
<a class="sourceLine" id="cb1211-3" data-line-number="3">        <span class="dt">summary =</span> F)</a>
<a class="sourceLine" id="cb1211-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1211-5" data-line-number="5">p <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1211-6" data-line-number="6"><span class="st">  </span><span class="kw">str</span>()</a></code></pre></div>
<pre><code>##  num [1:6000, 1:12] 52 23 23 139 366 106 206 75 48 270 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : NULL
##   ..$ : NULL</code></pre>
<p>Because we have 6,000 posterior iterations, we also get back 6,000 rows. We have 12 columns, which correspond to the 12 rows (i.e., cases) in the original data. In the next block, we’ll put convert that output to a data frame and wrangle a little before plotting the results.</p>
<div class="sourceCode" id="cb1213"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1213-1" data-line-number="1">p <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1213-2" data-line-number="2"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1213-3" data-line-number="3"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">c</span>(<span class="kw">str_c</span>(<span class="dv">0</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">9</span>), <span class="dv">10</span><span class="op">:</span><span class="dv">12</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1213-4" data-line-number="4"><span class="st">  </span><span class="kw">gather</span>(case, lambda) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1213-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">case =</span> <span class="kw">str_c</span>(<span class="st">&quot;case: &quot;</span>, case)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1213-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1213-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> lambda)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1213-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>, <span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1213-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1213-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="kw">expression</span>(lambda[<span class="st">&quot;[case]&quot;</span>]), <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">200</span>, <span class="dv">400</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1213-11" data-line-number="11"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">500</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1213-12" data-line-number="12"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1213-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1213-14" data-line-number="14"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>case, <span class="dt">nrow =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-60-1.png" width="672" /></p>
<p>Because this model had no predictors, we have similar posterior-predictive distributions for each case in the data. It’s important, however, to be very clear of what these posterior-predictive distributions are of. They are not of the data, per se. Let’s look back at the text:</p>
<blockquote>
<p>A <strong>negative-binomial</strong> model, more usefully called a <strong>gamma-Poisson</strong> model, assumes that each Poisson count observation has its own rate. It estimates the shape of the gamma distribution to describe the Poisson rates across cases. (p. 350, <strong>emphasis</strong> in the original)</p>
</blockquote>
<p>As a reminder, the “rate” for the Poisson distribution is just another word for the mean, also called <span class="math inline">\(\lambda\)</span>. So unlike a simple Poisson model where we use the individual cases to estimate one overall <span class="math inline">\(\lambda\)</span>, here we’re presuming each case has it’s own <span class="math inline">\(\lambda_i\)</span>. So there are 12 <span class="math inline">\(\lambda_i\)</span> values that generated our data and if we look at those <span class="math inline">\(\lambda_i\)</span> values on the whole, their distribution can be described with a gamma distribution.</p>
<p>And again, this is not a gamma distribution for our data. This is a gamma distribution of the <span class="math inline">\(\lambda_i\)</span> values from the 12 separate Poisson distributions that presumably made our data.</p>
<p>It turns out there are several ways to parameterize the gamma distribution. When we have the mean and shape parameters, we can define the gamma density for some variable <span class="math inline">\(y\)</span> as</p>
<p><span class="math display">\[\text{Gamma} (y | \mu, \alpha) = \frac{(\frac{\alpha}{\mu})^\alpha}{\Gamma (\alpha)} y^{\alpha - 1} \exp (- \frac{\alpha y}{\mu}),\]</span></p>
<p>where <span class="math inline">\(\mu\)</span> is the mean, <span class="math inline">\(\alpha\)</span> is the shape, and <span class="math inline">\(\Gamma\)</span> is the <a href="https://en.wikipedia.org/wiki/Gamma_function">gamma function</a>. If you look through Bürkner’s <a href="https://cran.r-project.org/web/packages/brms/vignettes/brms_families.html#survival-models"><em>Parameterization of Response Distributions in brms</em> vignette</a>, you’ll see this is the way the gamma likelihood is parameterized in brms. Now let’s finally take a look at the model output for <code>b11.6</code>.</p>
<div class="sourceCode" id="cb1214"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1214-1" data-line-number="1"><span class="kw">print</span>(b11<span class="fl">.6</span>)</a></code></pre></div>
<pre><code>##  Family: negbinomial 
##   Links: mu = log; shape = identity 
## Formula: admit ~ 1 
##    Data: d (Number of observations: 12) 
## Samples: 2 chains, each with iter = 4000; warmup = 1000; thin = 1;
##          total post-warmup samples = 6000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     5.02      0.30     4.47     5.67 1.00     3355     2428
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## shape     1.12      0.42     0.47     2.11 1.00     3124     3455
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>We have a shape (i.e., <span class="math inline">\(\alpha\)</span>) and an intercept (i.e., <span class="math inline">\(\log \mu\)</span>). After exponentiating the intercept parameter, here are the posterior distributions for those two gamma parameters.</p>
<div class="sourceCode" id="cb1216"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1216-1" data-line-number="1">post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(b11<span class="fl">.6</span>)</a>
<a class="sourceLine" id="cb1216-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1216-3" data-line-number="3">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1216-4" data-line-number="4"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">mu    =</span> <span class="kw">exp</span>(b_Intercept),</a>
<a class="sourceLine" id="cb1216-5" data-line-number="5">            <span class="dt">alpha =</span> shape) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1216-6" data-line-number="6"><span class="st">  </span><span class="kw">gather</span>(parameter, value) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1216-7" data-line-number="7"><span class="st">  </span></a>
<a class="sourceLine" id="cb1216-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1216-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>, <span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1216-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1216-11" data-line-number="11"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;posterior&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1216-12" data-line-number="12"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1216-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1216-14" data-line-number="14"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>parameter, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">labeller =</span> label_parsed)</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-62-1.png" width="576" /></p>
<p>There is a difficulty, however, if we would like to use McElreath’s <code>rethinking::dgamma2()</code> to visualize what gamma distributions based on those parameters might look like. The <code>dgamma2()</code> function has arguments for <code>mu</code> and the <code>scale</code>, not the shape. As it turns out, we can express the mean of the gamma density in terms of the shape and scale with the equation</p>
<p><span class="math display">\[\mu = \alpha \theta,\]</span></p>
<p>where the scale is termed <span class="math inline">\(\theta\)</span>. By simple algebra, then, we can solve for the scale with</p>
<p><span class="math display">\[\theta = \frac{\mu}{\alpha}.\]</span></p>
<p>Using that formulation, here are the posterior means for <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\theta\)</span>.</p>
<div class="sourceCode" id="cb1217"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1217-1" data-line-number="1">(mu &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">exp</span>(post<span class="op">$</span>b_Intercept)))</a></code></pre></div>
<pre><code>## [1] 158.4089</code></pre>
<div class="sourceCode" id="cb1219"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1219-1" data-line-number="1">(theta &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">exp</span>(post<span class="op">$</span>b_Intercept) <span class="op">/</span><span class="st"> </span>post<span class="op">$</span>shape))</a></code></pre></div>
<pre><code>## [1] 166.0334</code></pre>
<p>Much like we did in Figure 11.5 for the beta binomial model, here is the plot of that posterior mean gamma distribution accompanied by an additional 100 combinations of <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\theta\)</span> values sampled from the posterior.</p>
<div class="sourceCode" id="cb1221"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1221-1" data-line-number="1"><span class="co"># this makes `sample_n()` reproducible</span></a>
<a class="sourceLine" id="cb1221-2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">11</span>)</a>
<a class="sourceLine" id="cb1221-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1221-4" data-line-number="4"><span class="co"># wrangle to get the 100 draws</span></a>
<a class="sourceLine" id="cb1221-5" data-line-number="5">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1221-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">iter  =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb1221-7" data-line-number="7">         <span class="dt">mu    =</span> <span class="kw">exp</span>(b_Intercept),</a>
<a class="sourceLine" id="cb1221-8" data-line-number="8">         <span class="dt">theta =</span> <span class="kw">exp</span>(b_Intercept) <span class="op">/</span><span class="st"> </span>shape) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1221-9" data-line-number="9"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1221-10" data-line-number="10"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(iter, mu, theta),</a>
<a class="sourceLine" id="cb1221-11" data-line-number="11">         <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">550</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1221-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">density =</span> rethinking<span class="op">::</span><span class="kw">dgamma2</span>(x, mu, theta)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1221-13" data-line-number="13"><span class="st">  </span></a>
<a class="sourceLine" id="cb1221-14" data-line-number="14"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb1221-15" data-line-number="15"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> density)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1221-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> iter),</a>
<a class="sourceLine" id="cb1221-17" data-line-number="17">            <span class="dt">alpha =</span> <span class="fl">.1</span>, <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1221-18" data-line-number="18"><span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> rethinking<span class="op">::</span>dgamma2,</a>
<a class="sourceLine" id="cb1221-19" data-line-number="19">                <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">mu    =</span> mu,</a>
<a class="sourceLine" id="cb1221-20" data-line-number="20">                            <span class="dt">scale =</span> theta),</a>
<a class="sourceLine" id="cb1221-21" data-line-number="21">                <span class="dt">size =</span> <span class="fl">1.5</span>, <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1221-22" data-line-number="22"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1221-23" data-line-number="23"><span class="st">  </span><span class="kw">xlab</span>(<span class="kw">expression</span>(distribution<span class="op">~</span>of<span class="op">~</span>lambda<span class="op">~</span>values)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1221-24" data-line-number="24"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">500</span>,</a>
<a class="sourceLine" id="cb1221-25" data-line-number="25">                  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.01</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1221-26" data-line-number="26"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1221-27" data-line-number="27"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>))</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-64-1.png" width="336" /></p>
<p>But what if you wanted to use the base R <code>dgamma()</code> function instead of McElreath’s <code>rethinking::dgamma2()</code>? Well, the <code>dgamma()</code> function parameterizes the gamma density in terms of <code>shape</code> and <code>scale</code>, following the equation</p>
<p><span class="math display">\[\text{Gamma} (y | \alpha, \theta) = \frac{y^{\alpha - 1} e^{-x /\theta}}{\theta^\alpha \Gamma (\alpha)},\]</span></p>
<p>where <span class="math inline">\(\alpha\)</span> is the shape, <span class="math inline">\(\theta\)</span> is the scale, <span class="math inline">\(e\)</span> is base of the natural logarithm, and <span class="math inline">\(\Gamma\)</span> is the gamma function. And just in case you were worried you life wasn’t complicated enough, the base R <code>dgamma()</code> function will also allow you to define the gamma density with a <code>rate</code> parameter, rather than with <code>scale</code>. As it turns out, the “rate” in this context is just the inverse of the scale. When one parameterizes gamma this way, it follows the formula</p>
<p><span class="math display">\[\text{Gamma} (y | \alpha, \beta) = \frac{\beta^\alpha y^{\alpha - 1} e^{-\beta y}}{\Gamma (\alpha)},\]</span></p>
<p>where <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(e\)</span>, and <span class="math inline">\(\Gamma\)</span> are all as they were before and <span class="math inline">\(\beta\)</span> is the rate parameter. Let’s say we wanted to use the <span class="math inline">\(\text{Gamma} (y | \alpha, \theta)\)</span> parameterization with the <code>dgamma()</code> function. Here are the posterior means for our <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\theta\)</span> parameters.</p>
<div class="sourceCode" id="cb1222"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1222-1" data-line-number="1">(alpha &lt;-<span class="st"> </span><span class="kw">mean</span>(post<span class="op">$</span>shape))</a></code></pre></div>
<pre><code>## [1] 1.12113</code></pre>
<div class="sourceCode" id="cb1224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1224-1" data-line-number="1">(theta &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">exp</span>(post<span class="op">$</span>b_Intercept) <span class="op">/</span><span class="st"> </span>post<span class="op">$</span>shape))</a></code></pre></div>
<pre><code>## [1] 166.0334</code></pre>
<p>And here’s a remake of the plot from above, but with the <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\theta\)</span> parameterization.</p>
<div class="sourceCode" id="cb1226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1226-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">11</span>)</a>
<a class="sourceLine" id="cb1226-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1226-3" data-line-number="3"><span class="co"># wrangle to get the 100 draws</span></a>
<a class="sourceLine" id="cb1226-4" data-line-number="4">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1226-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">iter  =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb1226-6" data-line-number="6">         <span class="dt">alpha =</span> shape,</a>
<a class="sourceLine" id="cb1226-7" data-line-number="7">         <span class="dt">theta =</span> <span class="kw">exp</span>(b_Intercept) <span class="op">/</span><span class="st"> </span>shape) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1226-8" data-line-number="8"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1226-9" data-line-number="9"><span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(iter, alpha, theta),</a>
<a class="sourceLine" id="cb1226-10" data-line-number="10">         <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">550</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1226-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">density =</span> <span class="kw">dgamma</span>(x, <span class="dt">shape =</span> alpha, <span class="dt">scale =</span> theta)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1226-12" data-line-number="12"><span class="st">  </span></a>
<a class="sourceLine" id="cb1226-13" data-line-number="13"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb1226-14" data-line-number="14"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> density)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1226-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> iter),</a>
<a class="sourceLine" id="cb1226-16" data-line-number="16">            <span class="dt">alpha =</span> <span class="fl">.1</span>, <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1226-17" data-line-number="17"><span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> dgamma,</a>
<a class="sourceLine" id="cb1226-18" data-line-number="18">                <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">shape =</span> alpha,</a>
<a class="sourceLine" id="cb1226-19" data-line-number="19">                            <span class="dt">scale =</span> theta),</a>
<a class="sourceLine" id="cb1226-20" data-line-number="20">                <span class="dt">size =</span> <span class="fl">1.5</span>, <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1226-21" data-line-number="21"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1226-22" data-line-number="22"><span class="st">  </span><span class="kw">xlab</span>(<span class="kw">expression</span>(distribution<span class="op">~</span>of<span class="op">~</span>lambda<span class="op">~</span>values)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1226-23" data-line-number="23"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">500</span>,</a>
<a class="sourceLine" id="cb1226-24" data-line-number="24">                  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.01</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1226-25" data-line-number="25"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1226-26" data-line-number="26"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>))</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-66-1.png" width="336" /></p>
<p>It turns out it’s possible to get the variance of a gamma distribution with <span class="math inline">\(\alpha \theta^2\)</span>. Here’s that posterior.</p>
<div class="sourceCode" id="cb1227"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1227-1" data-line-number="1">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1227-2" data-line-number="2"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">var =</span> shape <span class="op">*</span><span class="st"> </span>(<span class="kw">exp</span>(b_Intercept) <span class="op">/</span><span class="st"> </span>shape)<span class="op">^</span><span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1227-3" data-line-number="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb1227-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> var)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1227-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>, <span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>]) <span class="op">+</span></a>
<a class="sourceLine" id="cb1227-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1227-7" data-line-number="7"><span class="st">  </span><span class="kw">xlab</span>(<span class="kw">expression</span>(<span class="st">&quot;the variance (i.e., &quot;</span><span class="op">*</span>alpha<span class="op">*</span>theta<span class="op">^</span><span class="dv">2</span><span class="op">*</span><span class="st">&quot;)&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1227-8" data-line-number="8"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">150000</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1227-9" data-line-number="9"><span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1227-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>))</a></code></pre></div>
<p><img src="11_files/figure-gfm/unnamed-chunk-67-1.png" width="576" /></p>
<p>Here’s the posterior mean for the gamma variance.</p>
<div class="sourceCode" id="cb1228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1228-1" data-line-number="1">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1228-2" data-line-number="2"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">var =</span> shape <span class="op">*</span><span class="st"> </span>(<span class="kw">exp</span>(b_Intercept) <span class="op">/</span><span class="st"> </span>shape)<span class="op">^</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1228-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(var))</a></code></pre></div>
<pre><code>##       mean
## 1 30207.08</code></pre>
<p>And just to round things out, here are the mean and variance values for those 12 distributions of draws from the <code>predict()</code> output.</p>
<div class="sourceCode" id="cb1230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1230-1" data-line-number="1">p <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1230-2" data-line-number="2"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1230-3" data-line-number="3"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">c</span>(<span class="kw">str_c</span>(<span class="dv">0</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">9</span>), <span class="dv">10</span><span class="op">:</span><span class="dv">12</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1230-4" data-line-number="4"><span class="st">  </span><span class="kw">gather</span>(case, lambda) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1230-5" data-line-number="5"><span class="st">  </span><span class="kw">group_by</span>(case) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1230-6" data-line-number="6"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean     =</span> <span class="kw">mean</span>(lambda),</a>
<a class="sourceLine" id="cb1230-7" data-line-number="7">            <span class="dt">variance =</span> <span class="kw">var</span>(lambda))</a></code></pre></div>
<pre><code>## # A tibble: 12 x 3
##    case   mean variance
##    &lt;chr&gt; &lt;dbl&gt;    &lt;dbl&gt;
##  1 01     153.   29359.
##  2 02     157.   32376.
##  3 03     157.   35294.
##  4 04     156.   32113.
##  5 05     160.   33441.
##  6 06     160.   35589.
##  7 07     158.   32927.
##  8 08     161.   33267.
##  9 09     159.   30264.
## 10 10     160.   32045.
## 11 11     160.   32683.
## 12 12     159.   33647.</code></pre>
<p>Finally, here are the mean and variance for the <code>admit</code> data.</p>
<div class="sourceCode" id="cb1232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1232-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1232-2" data-line-number="2"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean     =</span> <span class="kw">mean</span>(admit),</a>
<a class="sourceLine" id="cb1232-3" data-line-number="3">            <span class="dt">variance =</span> <span class="kw">var</span>(admit))</a></code></pre></div>
<pre><code>##     mean variance
## 1 146.25 22037.11</code></pre>
<p>If you’d like more practice with the negative-binomial model and some of the others models for categorical data we covered in this chapter and in <a href="counting-and-classification.html#counting-and-classification">Chapter 10</a>, Alan Agresti covered them extensively in his (2015) text, <a href="https://www.wiley.com/en-us/Foundations+of+Linear+and+Generalized+Linear+Models-p-9781118730034"><em>Foundations of linear and generalized linear models</em></a>.</p>
</div>
</div>
<div id="over-dispersion-entropy-and-information-criteria." class="section level3">
<h3><span class="header-section-number">11.3.3</span> Over-dispersion, entropy, and information criteria.</h3>
<blockquote>
<p>Both the beta-binomial and the gamma-Poisson models are maximum entropy for the same constraints as the regular binomial and Poisson. They just try to account for unobserved heterogeneity in probabilities and rates. So while they can be a lot harder to fit to data, they can be usefully conceptualized much like ordinary binomial and Poisson GLMs. So in terms of model comparison using information criteria, a beta-binomial model is a binomial model, and a gamma-Poisson (negative-binomial) is a Poisson model. (pp. 350–351)</p>
</blockquote>
</div>
</div>
<div id="reference-10" class="section level2 unnumbered">
<h2>Reference</h2>
<p><a href="https://xcelab.net/rm/statistical-rethinking/">McElreath, R. (2015). <em>Statistical rethinking: A Bayesian course with examples in R and Stan.</em> Chapman &amp; Hall/CRC Press.</a></p>
</div>
<div id="session-info-10" class="section level2 unnumbered">
<h2>Session info</h2>
<div class="sourceCode" id="cb1234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1234-1" data-line-number="1"><span class="kw">sessionInfo</span>()</a></code></pre></div>
<pre><code>## R version 3.6.2 (2019-12-12)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS High Sierra 10.13.6
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] parallel  stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] broom_0.5.3        patchwork_1.0.0    ggthemes_4.2.0     forcats_0.4.0      stringr_1.4.0     
##  [6] dplyr_0.8.4        purrr_0.3.3        readr_1.3.1        tidyr_1.0.2        tibble_2.1.3      
## [11] tidyverse_1.3.0    brms_2.12.0        Rcpp_1.0.3         rstan_2.19.2       ggplot2_3.2.1     
## [16] StanHeaders_2.19.0
## 
## loaded via a namespace (and not attached):
##   [1] colorspace_1.4-1          ellipsis_0.3.0            ggridges_0.5.2            rsconnect_0.8.16         
##   [5] markdown_1.1              rethinking_1.59           base64enc_0.1-3           fs_1.3.1                 
##   [9] rstudioapi_0.10           farver_2.0.3              svUnit_0.7-12             DT_0.11                  
##  [13] fansi_0.4.1               mvtnorm_1.0-12            lubridate_1.7.4           xml2_1.2.2               
##  [17] bridgesampling_0.8-1      knitr_1.26                shinythemes_1.1.2         bayesplot_1.7.1          
##  [21] jsonlite_1.6.1            dbplyr_1.4.2              shiny_1.4.0               compiler_3.6.2           
##  [25] httr_1.4.1                backports_1.1.5           assertthat_0.2.1          Matrix_1.2-18            
##  [29] fastmap_1.0.1             lazyeval_0.2.2            cli_2.0.1                 later_1.0.0              
##  [33] htmltools_0.4.0           prettyunits_1.1.1         tools_3.6.2               igraph_1.2.4.2           
##  [37] coda_0.19-3               gtable_0.3.0              glue_1.3.1                reshape2_1.4.3           
##  [41] cellranger_1.1.0          vctrs_0.2.2               nlme_3.1-142              crosstalk_1.0.0          
##  [45] xfun_0.12                 ps_1.3.0                  rvest_0.3.5               mime_0.8                 
##  [49] miniUI_0.1.1.1            lifecycle_0.1.0           tidybayes_2.0.1.9000      gtools_3.8.1             
##  [53] MASS_7.3-51.4             zoo_1.8-7                 scales_1.1.0              colourpicker_1.0         
##  [57] hms_0.5.3                 promises_1.1.0            Brobdingnag_1.2-6         inline_0.3.15            
##  [61] shinystan_2.5.0           yaml_2.2.1                gridExtra_2.3             loo_2.2.0                
##  [65] stringi_1.4.5             dygraphs_1.1.1.6          pkgbuild_1.0.6            rlang_0.4.4              
##  [69] pkgconfig_2.0.3           matrixStats_0.55.0        evaluate_0.14             lattice_0.20-38          
##  [73] rstantools_2.0.0          htmlwidgets_1.5.1         labeling_0.3              processx_3.4.1           
##  [77] tidyselect_1.0.0          plyr_1.8.5                magrittr_1.5              R6_2.4.1                 
##  [81] generics_0.0.2            DBI_1.1.0                 pillar_1.4.3              haven_2.2.0              
##  [85] withr_2.1.2               xts_0.12-0                abind_1.4-5               modelr_0.1.5             
##  [89] crayon_1.3.4              arrayhelpers_1.0-20160527 utf8_1.1.4                rmarkdown_2.0            
##  [93] grid_3.6.2                readxl_1.3.1              callr_3.4.1               threejs_0.3.3            
##  [97] reprex_0.3.0              digest_0.6.23             xtable_1.8-4              httpuv_1.5.2             
## [101] stats4_3.6.2              munsell_0.5.0             shinyjs_1.1</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="counting-and-classification.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="multilevel-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
