<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>11 Monsters and Mixtures | Statistical Rethinking with brms, ggplot2, and the tidyverse</title>
  <meta name="description" content="This project is an attempt to re-express the code in McElreath’s textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="11 Monsters and Mixtures | Statistical Rethinking with brms, ggplot2, and the tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This project is an attempt to re-express the code in McElreath’s textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="github-repo" content="ASKURZ/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="11 Monsters and Mixtures | Statistical Rethinking with brms, ggplot2, and the tidyverse" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This project is an attempt to re-express the code in McElreath’s textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  

<meta name="author" content="A Solomon Kurz">


<meta name="date" content="2019-05-05">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="counting-and-classification.html">
<link rel="next" href="multilevel-models.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>This is a love letter</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-this"><i class="fa fa-check"></i>Why this?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#my-assumptions-about-you"><i class="fa fa-check"></i>My assumptions about you</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-use-and-understand-this-project"><i class="fa fa-check"></i>How to use and understand this project</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#you-can-do-this-too"><i class="fa fa-check"></i>You can do this, too</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#we-have-updates"><i class="fa fa-check"></i>We have updates</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague</a><ul>
<li class="chapter" data-level="" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html#reference"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a><ul>
<li class="chapter" data-level="2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#the-garden-of-forking-data"><i class="fa fa-check"></i><b>2.1</b> The garden of forking data</a><ul>
<li class="chapter" data-level="2.1.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#counting-possibilities."><i class="fa fa-check"></i><b>2.1.1</b> Counting possibilities.</a></li>
<li class="chapter" data-level="2.1.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#using-prior-information."><i class="fa fa-check"></i><b>2.1.2</b> Using prior information.</a></li>
<li class="chapter" data-level="2.1.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#from-counts-to-probability."><i class="fa fa-check"></i><b>2.1.3</b> From counts to probability.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#building-a-model"><i class="fa fa-check"></i><b>2.2</b> Building a model</a><ul>
<li class="chapter" data-level="2.2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-data-story."><i class="fa fa-check"></i><b>2.2.1</b> A data story.</a></li>
<li class="chapter" data-level="2.2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayesian-updating."><i class="fa fa-check"></i><b>2.2.2</b> Bayesian updating.</a></li>
<li class="chapter" data-level="2.2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#evaluate."><i class="fa fa-check"></i><b>2.2.3</b> Evaluate.</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#components-of-the-model"><i class="fa fa-check"></i><b>2.3</b> Components of the model</a><ul>
<li class="chapter" data-level="2.3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#likelihood."><i class="fa fa-check"></i><b>2.3.1</b> Likelihood.</a></li>
<li class="chapter" data-level="2.3.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#parameters."><i class="fa fa-check"></i><b>2.3.2</b> Parameters.</a></li>
<li class="chapter" data-level="2.3.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#prior."><i class="fa fa-check"></i><b>2.3.3</b> Prior.</a></li>
<li class="chapter" data-level="2.3.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#posterior."><i class="fa fa-check"></i><b>2.3.4</b> Posterior.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#making-the-model-go"><i class="fa fa-check"></i><b>2.4</b> Making the model go</a><ul>
<li class="chapter" data-level="2.4.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#grid-approximation."><i class="fa fa-check"></i><b>2.4.1</b> Grid approximation.</a></li>
<li class="chapter" data-level="2.4.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic-approximation."><i class="fa fa-check"></i><b>2.4.2</b> Quadratic approximation.</a></li>
<li class="chapter" data-level="2.4.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#markov-chain-monte-carlo."><i class="fa fa-check"></i><b>2.4.3</b> Markov chain Monte Carlo.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#reference-1"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a><ul>
<li class="chapter" data-level="3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-like-approximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-like approximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a><ul>
<li class="chapter" data-level="3.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-boundaries."><i class="fa fa-check"></i><b>3.2.1</b> Intervals of defined boundaries.</a></li>
<li class="chapter" data-level="3.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass."><i class="fa fa-check"></i><b>3.2.2</b> Intervals of defined mass.</a></li>
<li class="chapter" data-level="3.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimates."><i class="fa fa-check"></i><b>3.2.3</b> Point estimates.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a><ul>
<li class="chapter" data-level="3.3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#dummy-data."><i class="fa fa-check"></i><b>3.3.1</b> Dummy data.</a></li>
<li class="chapter" data-level="3.3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking."><i class="fa fa-check"></i><b>3.3.2</b> Model checking.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#summary-lets-practice-in-brms"><i class="fa fa-check"></i><b>3.4</b> <del>Summary</del> Let’s practice in brms</a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#reference-2"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="linear-models.html"><a href="linear-models.html"><i class="fa fa-check"></i><b>4</b> Linear Models</a><ul>
<li class="chapter" data-level="4.1" data-path="linear-models.html"><a href="linear-models.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why normal distributions are normal</a><ul>
<li class="chapter" data-level="4.1.1" data-path="linear-models.html"><a href="linear-models.html#normal-by-addition."><i class="fa fa-check"></i><b>4.1.1</b> Normal by addition.</a></li>
<li class="chapter" data-level="4.1.2" data-path="linear-models.html"><a href="linear-models.html#normal-by-multiplication."><i class="fa fa-check"></i><b>4.1.2</b> Normal by multiplication.</a></li>
<li class="chapter" data-level="4.1.3" data-path="linear-models.html"><a href="linear-models.html#normal-by-log-multiplication."><i class="fa fa-check"></i><b>4.1.3</b> Normal by log-multiplication.</a></li>
<li class="chapter" data-level="4.1.4" data-path="linear-models.html"><a href="linear-models.html#using-gaussian-distributions."><i class="fa fa-check"></i><b>4.1.4</b> Using Gaussian distributions.</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="linear-models.html"><a href="linear-models.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>4.2</b> A language for describing models</a><ul>
<li class="chapter" data-level="4.2.1" data-path="linear-models.html"><a href="linear-models.html#re-describing-the-globe-tossing-model."><i class="fa fa-check"></i><b>4.2.1</b> Re-describing the globe tossing model.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="linear-models.html"><a href="linear-models.html#a-gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> A Gaussian model of height</a><ul>
<li class="chapter" data-level="4.3.1" data-path="linear-models.html"><a href="linear-models.html#the-data."><i class="fa fa-check"></i><b>4.3.1</b> The data.</a></li>
<li class="chapter" data-level="4.3.2" data-path="linear-models.html"><a href="linear-models.html#the-model."><i class="fa fa-check"></i><b>4.3.2</b> The model.</a></li>
<li class="chapter" data-level="4.3.3" data-path="linear-models.html"><a href="linear-models.html#grid-approximation-of-the-posterior-distribution."><i class="fa fa-check"></i><b>4.3.3</b> Grid approximation of the posterior distribution.</a></li>
<li class="chapter" data-level="4.3.4" data-path="linear-models.html"><a href="linear-models.html#sampling-from-the-posterior."><i class="fa fa-check"></i><b>4.3.4</b> Sampling from the posterior.</a></li>
<li class="chapter" data-level="4.3.5" data-path="linear-models.html"><a href="linear-models.html#fitting-the-model-with-map-brm."><i class="fa fa-check"></i><b>4.3.5</b> Fitting the model with <del><code>map()</code></del> <code>brm()</code>.</a></li>
<li class="chapter" data-level="4.3.6" data-path="linear-models.html"><a href="linear-models.html#sampling-from-a-map-brm-fit."><i class="fa fa-check"></i><b>4.3.6</b> Sampling from a <del><code>map()</code></del> <code>brm()</code> fit.</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="linear-models.html"><a href="linear-models.html#adding-a-predictor"><i class="fa fa-check"></i><b>4.4</b> Adding a predictor</a><ul>
<li class="chapter" data-level="4.4.1" data-path="linear-models.html"><a href="linear-models.html#the-linear-model-strategy"><i class="fa fa-check"></i><b>4.4.1</b> The linear model strategy</a></li>
<li class="chapter" data-level="4.4.2" data-path="linear-models.html"><a href="linear-models.html#fitting-the-model."><i class="fa fa-check"></i><b>4.4.2</b> Fitting the model.</a></li>
<li class="chapter" data-level="4.4.3" data-path="linear-models.html"><a href="linear-models.html#interpreting-the-model-fit."><i class="fa fa-check"></i><b>4.4.3</b> Interpreting the model fit.</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="linear-models.html"><a href="linear-models.html#polynomial-regression"><i class="fa fa-check"></i><b>4.5</b> Polynomial regression</a></li>
<li class="chapter" data-level="" data-path="linear-models.html"><a href="linear-models.html#reference-3"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="linear-models.html"><a href="linear-models.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html"><i class="fa fa-check"></i><b>5</b> Multivariate Linear Models</a><ul>
<li class="chapter" data-level="5.1" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#spurious-associations"><i class="fa fa-check"></i><b>5.1</b> Spurious associations</a><ul>
<li class="chapter" data-level="5.1.1" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#multivariate-notation."><i class="fa fa-check"></i><b>5.1.1</b> Multivariate notation.</a></li>
<li class="chapter" data-level="5.1.2" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#fitting-the-model.-1"><i class="fa fa-check"></i><b>5.1.2</b> Fitting the model.</a></li>
<li class="chapter" data-level="5.1.3" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#plotting-multivariate-posteriors."><i class="fa fa-check"></i><b>5.1.3</b> Plotting multivariate posteriors.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#masked-relationship"><i class="fa fa-check"></i><b>5.2</b> Masked relationship</a></li>
<li class="chapter" data-level="5.3" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#multicollinearity"><i class="fa fa-check"></i><b>5.3</b> Multicollinearity</a><ul>
<li class="chapter" data-level="5.3.1" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#multicollinear-legs."><i class="fa fa-check"></i><b>5.3.1</b> Multicollinear legs.</a></li>
<li class="chapter" data-level="5.3.2" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#multicollinear-milk."><i class="fa fa-check"></i><b>5.3.2</b> Multicollinear <code>milk</code>.</a></li>
<li class="chapter" data-level="5.3.3" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#post-treatment-bias."><i class="fa fa-check"></i><b>5.3.3</b> Post-treatment bias.</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#categorical-varaibles"><i class="fa fa-check"></i><b>5.4</b> Categorical varaibles</a><ul>
<li class="chapter" data-level="5.4.1" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#binary-categories."><i class="fa fa-check"></i><b>5.4.1</b> Binary categories.</a></li>
<li class="chapter" data-level="5.4.2" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#many-categories."><i class="fa fa-check"></i><b>5.4.2</b> Many categories.</a></li>
<li class="chapter" data-level="5.4.3" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#adding-regular-predictor-variables."><i class="fa fa-check"></i><b>5.4.3</b> Adding regular predictor variables.</a></li>
<li class="chapter" data-level="5.4.4" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#another-approach-unique-intercepts."><i class="fa fa-check"></i><b>5.4.4</b> Another approach: Unique intercepts.</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#ordinary-least-squares-and-lm"><i class="fa fa-check"></i><b>5.5</b> <del>Ordinary least squares and <code>lm()</code></del></a></li>
<li class="chapter" data-level="" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#reference-4"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html"><i class="fa fa-check"></i><b>6</b> Overfitting, Regularization, and Information Criteria</a><ul>
<li class="chapter" data-level="6.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>6.1</b> The problem with parameters</a><ul>
<li class="chapter" data-level="6.1.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#more-parameters-always-improve-fit."><i class="fa fa-check"></i><b>6.1.1</b> More parameters always improve fit.</a></li>
<li class="chapter" data-level="6.1.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#too-few-parameters-hurts-too."><i class="fa fa-check"></i><b>6.1.2</b> Too few parameters hurts, too.</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#information-theory-and-model-performance"><i class="fa fa-check"></i><b>6.2</b> Information theory and model performance</a><ul>
<li class="chapter" data-level="6.2.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#firing-the-weatherperson."><i class="fa fa-check"></i><b>6.2.1</b> Firing the weatherperson.</a></li>
<li class="chapter" data-level="6.2.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#information-and-uncertainty."><i class="fa fa-check"></i><b>6.2.2</b> Information and uncertainty.</a></li>
<li class="chapter" data-level="6.2.3" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#from-entropy-to-accuracy."><i class="fa fa-check"></i><b>6.2.3</b> From entropy to accuracy.</a></li>
<li class="chapter" data-level="6.2.4" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#from-divergence-to-deviance."><i class="fa fa-check"></i><b>6.2.4</b> From divergence to deviance.</a></li>
<li class="chapter" data-level="6.2.5" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#from-deviance-to-out-of-sample."><i class="fa fa-check"></i><b>6.2.5</b> From deviance to out-of-sample.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#regularization"><i class="fa fa-check"></i><b>6.3</b> Regularization</a></li>
<li class="chapter" data-level="6.4" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#information-criteria"><i class="fa fa-check"></i><b>6.4</b> Information criteria</a><ul>
<li class="chapter" data-level="6.4.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#dic."><i class="fa fa-check"></i><b>6.4.1</b> DIC.</a></li>
<li class="chapter" data-level="6.4.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#waic."><i class="fa fa-check"></i><b>6.4.2</b> WAIC.</a></li>
<li class="chapter" data-level="6.4.3" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#dic-and-waic-as-estimates-of-deviance."><i class="fa fa-check"></i><b>6.4.3</b> DIC and WAIC as estimates of deviance.</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#using-information-criteria"><i class="fa fa-check"></i><b>6.5</b> Using information criteria</a><ul>
<li class="chapter" data-level="6.5.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#model-comparison."><i class="fa fa-check"></i><b>6.5.1</b> Model comparison.</a></li>
<li class="chapter" data-level="6.5.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#model-averaging."><i class="fa fa-check"></i><b>6.5.2</b> Model averaging.</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#summary-bonus-r2-talk"><i class="fa fa-check"></i><b>6.6</b> <del>Summary</del> Bonus: <span class="math inline">\(R^2\)</span> talk</a></li>
<li class="chapter" data-level="" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#reference-5"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="interactions.html"><a href="interactions.html"><i class="fa fa-check"></i><b>7</b> Interactions</a><ul>
<li class="chapter" data-level="7.1" data-path="interactions.html"><a href="interactions.html#building-an-interaction."><i class="fa fa-check"></i><b>7.1</b> Building an interaction.</a><ul>
<li class="chapter" data-level="7.1.1" data-path="interactions.html"><a href="interactions.html#adding-a-dummy-variable-doesnt-work."><i class="fa fa-check"></i><b>7.1.1</b> Adding a dummy variable doesn’t work.</a></li>
<li class="chapter" data-level="7.1.2" data-path="interactions.html"><a href="interactions.html#adding-a-linear-interaction-does-work."><i class="fa fa-check"></i><b>7.1.2</b> Adding a linear interaction does work.</a></li>
<li class="chapter" data-level="7.1.3" data-path="interactions.html"><a href="interactions.html#plotting-the-interaction."><i class="fa fa-check"></i><b>7.1.3</b> Plotting the interaction.</a></li>
<li class="chapter" data-level="7.1.4" data-path="interactions.html"><a href="interactions.html#interpreting-an-interaction-estimate."><i class="fa fa-check"></i><b>7.1.4</b> Interpreting an interaction estimate.</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="interactions.html"><a href="interactions.html#symmetry-of-the-linear-interaction."><i class="fa fa-check"></i><b>7.2</b> Symmetry of the linear interaction.</a><ul>
<li class="chapter" data-level="7.2.1" data-path="interactions.html"><a href="interactions.html#buridans-interaction."><i class="fa fa-check"></i><b>7.2.1</b> Buridan’s interaction.</a></li>
<li class="chapter" data-level="7.2.2" data-path="interactions.html"><a href="interactions.html#africa-depends-upon-ruggedness."><i class="fa fa-check"></i><b>7.2.2</b> Africa depends upon ruggedness.</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="interactions.html"><a href="interactions.html#continuous-interactions"><i class="fa fa-check"></i><b>7.3</b> Continuous interactions</a><ul>
<li class="chapter" data-level="7.3.1" data-path="interactions.html"><a href="interactions.html#the-data.-1"><i class="fa fa-check"></i><b>7.3.1</b> The data.</a></li>
<li class="chapter" data-level="7.3.2" data-path="interactions.html"><a href="interactions.html#the-un-centered-models."><i class="fa fa-check"></i><b>7.3.2</b> The un-centered models.</a></li>
<li class="chapter" data-level="7.3.3" data-path="interactions.html"><a href="interactions.html#center-and-re-estimate."><i class="fa fa-check"></i><b>7.3.3</b> Center and re-estimate.</a></li>
<li class="chapter" data-level="7.3.4" data-path="interactions.html"><a href="interactions.html#plotting-implied-predictions."><i class="fa fa-check"></i><b>7.3.4</b> Plotting implied predictions.</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="interactions.html"><a href="interactions.html#interactions-in-design-formulas"><i class="fa fa-check"></i><b>7.4</b> Interactions in design formulas</a></li>
<li class="chapter" data-level="7.5" data-path="interactions.html"><a href="interactions.html#summary-bonus-marginal_effects"><i class="fa fa-check"></i><b>7.5</b> <del>Summary</del> Bonus: <code>marginal_effects()</code></a></li>
<li class="chapter" data-level="" data-path="interactions.html"><a href="interactions.html#reference-6"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="interactions.html"><a href="interactions.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>8</b> Markov Chain Monte Carlo</a><ul>
<li class="chapter" data-level="8.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#good-king-markov-and-his-island-kingdom"><i class="fa fa-check"></i><b>8.1</b> Good King Markov and His island kingdom</a></li>
<li class="chapter" data-level="8.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#markov-chain-monte-carlo-1"><i class="fa fa-check"></i><b>8.2</b> Markov chain Monte Carlo</a></li>
<li class="chapter" data-level="8.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#easy-hmc-map2stan-brm"><i class="fa fa-check"></i><b>8.3</b> Easy HMC: <del>map2stan</del> <code>brm()</code></a><ul>
<li class="chapter" data-level="8.3.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#preparation."><i class="fa fa-check"></i><b>8.3.1</b> Preparation.</a></li>
<li class="chapter" data-level="8.3.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#estimation."><i class="fa fa-check"></i><b>8.3.2</b> Estimation.</a></li>
<li class="chapter" data-level="8.3.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#sampling-again-in-parallel."><i class="fa fa-check"></i><b>8.3.3</b> Sampling again, in parallel.</a></li>
<li class="chapter" data-level="8.3.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#visualization."><i class="fa fa-check"></i><b>8.3.4</b> Visualization.</a></li>
<li class="chapter" data-level="8.3.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#using-the-samples."><i class="fa fa-check"></i><b>8.3.5</b> Using the samples.</a></li>
<li class="chapter" data-level="8.3.6" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#checking-the-chain."><i class="fa fa-check"></i><b>8.3.6</b> Checking the chain.</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#care-and-feeding-of-your-markov-chain."><i class="fa fa-check"></i><b>8.4</b> Care and feeding of your Markov chain.</a><ul>
<li class="chapter" data-level="8.4.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>8.4.1</b> How many samples do you need?</a></li>
<li class="chapter" data-level="8.4.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-chains-do-you-need"><i class="fa fa-check"></i><b>8.4.2</b> How many chains do you need?</a></li>
<li class="chapter" data-level="8.4.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#taming-a-wild-chain."><i class="fa fa-check"></i><b>8.4.3</b> Taming a wild chain.</a></li>
<li class="chapter" data-level="8.4.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#non-identifiable-parameters."><i class="fa fa-check"></i><b>8.4.4</b> Non-identifiable parameters.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#reference-7"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>9</b> Big Entropy and the Generalized Linear Model</a><ul>
<li class="chapter" data-level="9.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>9.1</b> Maximum entropy</a><ul>
<li class="chapter" data-level="9.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#gaussian."><i class="fa fa-check"></i><b>9.1.1</b> Gaussian.</a></li>
<li class="chapter" data-level="9.1.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial."><i class="fa fa-check"></i><b>9.1.2</b> Binomial.</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>9.2</b> Generalized linear models</a><ul>
<li class="chapter" data-level="9.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family."><i class="fa fa-check"></i><b>9.2.1</b> Meet the family.</a></li>
<li class="chapter" data-level="9.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions."><i class="fa fa-check"></i><b>9.2.2</b> Linking linear models to distributions.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#reference-8"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="counting-and-classification.html"><a href="counting-and-classification.html"><i class="fa fa-check"></i><b>10</b> Counting and Classification</a><ul>
<li class="chapter" data-level="10.1" data-path="counting-and-classification.html"><a href="counting-and-classification.html#binomial-regression"><i class="fa fa-check"></i><b>10.1</b> Binomial regression</a><ul>
<li class="chapter" data-level="10.1.1" data-path="counting-and-classification.html"><a href="counting-and-classification.html#logistic-regression-prosocial-chimpanzees."><i class="fa fa-check"></i><b>10.1.1</b> Logistic regression: Prosocial chimpanzees.</a></li>
<li class="chapter" data-level="10.1.2" data-path="counting-and-classification.html"><a href="counting-and-classification.html#aggregated-binomial-chimpanzees-again-condensed."><i class="fa fa-check"></i><b>10.1.2</b> Aggregated binomial: Chimpanzees again, condensed.</a></li>
<li class="chapter" data-level="10.1.3" data-path="counting-and-classification.html"><a href="counting-and-classification.html#aggregated-binomial-graduate-school-admissions."><i class="fa fa-check"></i><b>10.1.3</b> Aggregated binomial: Graduate school admissions.</a></li>
<li class="chapter" data-level="10.1.4" data-path="counting-and-classification.html"><a href="counting-and-classification.html#fitting-binomial-regressions-with-glm."><i class="fa fa-check"></i><b>10.1.4</b> Fitting binomial regressions with <code>glm()</code>.</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="counting-and-classification.html"><a href="counting-and-classification.html#poisson-regression"><i class="fa fa-check"></i><b>10.2</b> Poisson regression</a><ul>
<li class="chapter" data-level="10.2.1" data-path="counting-and-classification.html"><a href="counting-and-classification.html#example-oceanic-tool-complexity."><i class="fa fa-check"></i><b>10.2.1</b> Example: Oceanic tool complexity.</a></li>
<li class="chapter" data-level="10.2.2" data-path="counting-and-classification.html"><a href="counting-and-classification.html#mcmc-islands."><i class="fa fa-check"></i><b>10.2.2</b> MCMC islands.</a></li>
<li class="chapter" data-level="10.2.3" data-path="counting-and-classification.html"><a href="counting-and-classification.html#example-exposure-and-the-offset."><i class="fa fa-check"></i><b>10.2.3</b> Example: Exposure and the offset.</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="counting-and-classification.html"><a href="counting-and-classification.html#other-count-regressions"><i class="fa fa-check"></i><b>10.3</b> Other count regressions</a><ul>
<li class="chapter" data-level="10.3.1" data-path="counting-and-classification.html"><a href="counting-and-classification.html#multinomial."><i class="fa fa-check"></i><b>10.3.1</b> Multinomial.</a></li>
<li class="chapter" data-level="10.3.2" data-path="counting-and-classification.html"><a href="counting-and-classification.html#geometric."><i class="fa fa-check"></i><b>10.3.2</b> Geometric.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="counting-and-classification.html"><a href="counting-and-classification.html#reference-9"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="counting-and-classification.html"><a href="counting-and-classification.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html"><i class="fa fa-check"></i><b>11</b> Monsters and Mixtures</a><ul>
<li class="chapter" data-level="11.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>11.1</b> Ordered categorical outcomes</a><ul>
<li class="chapter" data-level="11.1.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-moral-intuition."><i class="fa fa-check"></i><b>11.1.1</b> Example: Moral intuition.</a></li>
<li class="chapter" data-level="11.1.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#describing-an-ordered-distribution-with-intercepts."><i class="fa fa-check"></i><b>11.1.2</b> Describing an ordered distribution with intercepts.</a></li>
<li class="chapter" data-level="11.1.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#adding-predictor-variables."><i class="fa fa-check"></i><b>11.1.3</b> Adding predictor variables.</a></li>
<li class="chapter" data-level="11.1.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#bonus-figure-11.3-alternative."><i class="fa fa-check"></i><b>11.1.4</b> Bonus: Figure 11.3 alternative.</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>11.2</b> Zero-inflated outcomes</a><ul>
<li class="chapter" data-level="11.2.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-zero-inflated-poisson."><i class="fa fa-check"></i><b>11.2.1</b> Example: Zero-inflated Poisson.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersed-outcomes"><i class="fa fa-check"></i><b>11.3</b> Over-dispersed outcomes</a><ul>
<li class="chapter" data-level="11.3.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#beta-binomial."><i class="fa fa-check"></i><b>11.3.1</b> Beta-binomial.</a></li>
<li class="chapter" data-level="11.3.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#negative-binomial-or-gamma-poisson."><i class="fa fa-check"></i><b>11.3.2</b> Negative-binomial or gamma-Poisson.</a></li>
<li class="chapter" data-level="11.3.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersion-entropy-and-information-criteria."><i class="fa fa-check"></i><b>11.3.3</b> Over-dispersion, entropy, and information criteria.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#reference-10"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="multilevel-models.html"><a href="multilevel-models.html"><i class="fa fa-check"></i><b>12</b> Multilevel Models</a><ul>
<li class="chapter" data-level="12.1" data-path="multilevel-models.html"><a href="multilevel-models.html#example-multilevel-tadpoles"><i class="fa fa-check"></i><b>12.1</b> Example: Multilevel tadpoles</a></li>
<li class="chapter" data-level="12.2" data-path="multilevel-models.html"><a href="multilevel-models.html#varying-effects-and-the-underfittingoverfitting-trade-off"><i class="fa fa-check"></i><b>12.2</b> Varying effects and the underfitting/overfitting trade-off</a><ul>
<li class="chapter" data-level="12.2.1" data-path="multilevel-models.html"><a href="multilevel-models.html#the-model.-1"><i class="fa fa-check"></i><b>12.2.1</b> The model.</a></li>
<li class="chapter" data-level="12.2.2" data-path="multilevel-models.html"><a href="multilevel-models.html#assign-values-to-the-parameters."><i class="fa fa-check"></i><b>12.2.2</b> Assign values to the parameters.</a></li>
<li class="chapter" data-level="12.2.3" data-path="multilevel-models.html"><a href="multilevel-models.html#sumulate-survivors."><i class="fa fa-check"></i><b>12.2.3</b> Sumulate survivors.</a></li>
<li class="chapter" data-level="12.2.4" data-path="multilevel-models.html"><a href="multilevel-models.html#compute-the-no-pooling-estimates."><i class="fa fa-check"></i><b>12.2.4</b> Compute the no-pooling estimates.</a></li>
<li class="chapter" data-level="12.2.5" data-path="multilevel-models.html"><a href="multilevel-models.html#compute-the-partial-pooling-estimates."><i class="fa fa-check"></i><b>12.2.5</b> Compute the partial-pooling estimates.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="multilevel-models.html"><a href="multilevel-models.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>12.3</b> More than one type of cluster</a><ul>
<li class="chapter" data-level="12.3.1" data-path="multilevel-models.html"><a href="multilevel-models.html#multilevel-chimpanzees."><i class="fa fa-check"></i><b>12.3.1</b> Multilevel chimpanzees.</a></li>
<li class="chapter" data-level="12.3.2" data-path="multilevel-models.html"><a href="multilevel-models.html#two-types-of-cluster."><i class="fa fa-check"></i><b>12.3.2</b> Two types of cluster.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="multilevel-models.html"><a href="multilevel-models.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>12.4</b> Multilevel posterior predictions</a><ul>
<li class="chapter" data-level="12.4.1" data-path="multilevel-models.html"><a href="multilevel-models.html#posterior-prediction-for-same-clusters."><i class="fa fa-check"></i><b>12.4.1</b> Posterior prediction for same clusters.</a></li>
<li class="chapter" data-level="12.4.2" data-path="multilevel-models.html"><a href="multilevel-models.html#posterior-prediction-for-new-clusters."><i class="fa fa-check"></i><b>12.4.2</b> Posterior prediction for new clusters.</a></li>
<li class="chapter" data-level="12.4.3" data-path="multilevel-models.html"><a href="multilevel-models.html#focus-and-multilevel-prediction."><i class="fa fa-check"></i><b>12.4.3</b> Focus and multilevel prediction.</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="multilevel-models.html"><a href="multilevel-models.html#summary-bonus-tidybayesspread_draws"><i class="fa fa-check"></i><b>12.5</b> <del>Summary</del> Bonus: <code>tidybayes::spread_draws()</code></a><ul>
<li class="chapter" data-level="12.5.1" data-path="multilevel-models.html"><a href="multilevel-models.html#intercepts-only-models-with-one-or-two-grouping-variables"><i class="fa fa-check"></i><b>12.5.1</b> Intercepts-only models with one or two grouping variables</a></li>
<li class="chapter" data-level="12.5.2" data-path="multilevel-models.html"><a href="multilevel-models.html#brmsposterior_samples"><i class="fa fa-check"></i><b>12.5.2</b> <code>brms::posterior_samples()</code></a></li>
<li class="chapter" data-level="12.5.3" data-path="multilevel-models.html"><a href="multilevel-models.html#brmscoef"><i class="fa fa-check"></i><b>12.5.3</b> <code>brms::coef()</code></a></li>
<li class="chapter" data-level="12.5.4" data-path="multilevel-models.html"><a href="multilevel-models.html#brmsfitted"><i class="fa fa-check"></i><b>12.5.4</b> <code>brms::fitted()</code></a></li>
<li class="chapter" data-level="12.5.5" data-path="multilevel-models.html"><a href="multilevel-models.html#tidybayesspread_draws"><i class="fa fa-check"></i><b>12.5.5</b> <code>tidybayes::spread_draws()</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multilevel-models.html"><a href="multilevel-models.html#reference-11"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="multilevel-models.html"><a href="multilevel-models.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html"><i class="fa fa-check"></i><b>13</b> Adventures in Covariance</a><ul>
<li class="chapter" data-level="13.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>13.1</b> Varying slopes by construction</a><ul>
<li class="chapter" data-level="13.1.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-the-population."><i class="fa fa-check"></i><b>13.1.1</b> Simulate the population.</a></li>
<li class="chapter" data-level="13.1.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-observations."><i class="fa fa-check"></i><b>13.1.2</b> Simulate observations.</a></li>
<li class="chapter" data-level="13.1.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#the-varying-slopes-model."><i class="fa fa-check"></i><b>13.1.3</b> The varying slopes model.</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-admission-decisions-and-gender"><i class="fa fa-check"></i><b>13.2</b> Example: Admission decisions and gender</a><ul>
<li class="chapter" data-level="13.2.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-intercepts."><i class="fa fa-check"></i><b>13.2.1</b> Varying intercepts.</a></li>
<li class="chapter" data-level="13.2.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-effects-of-being-male."><i class="fa fa-check"></i><b>13.2.2</b> Varying effects of being <code>male</code>.</a></li>
<li class="chapter" data-level="13.2.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#shrinkage."><i class="fa fa-check"></i><b>13.2.3</b> Shrinkage.</a></li>
<li class="chapter" data-level="13.2.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#model-comparison.-1"><i class="fa fa-check"></i><b>13.2.4</b> Model comparison.</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-cross-classified-chimpanzees-with-varying-slopes"><i class="fa fa-check"></i><b>13.3</b> Example: Cross-classified <code>chimpanzees</code> with varying slopes</a></li>
<li class="chapter" data-level="13.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>13.4</b> Continuous categories and the Gaussian process</a><ul>
<li class="chapter" data-level="13.4.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-spatial-autocorrelation-in-oceanic-tools."><i class="fa fa-check"></i><b>13.4.1</b> Example: Spatial autocorrelation in Oceanic tools.</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#summary-bonus-another-berkley-admissions-data-like-example."><i class="fa fa-check"></i><b>13.5</b> <del>Summary</del> Bonus: Another Berkley-admissions-data-like example.</a></li>
<li class="chapter" data-level="" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#reference-12"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#session-info-12"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html"><i class="fa fa-check"></i><b>14</b> Missing Data and Other Opportunities</a><ul>
<li class="chapter" data-level="14.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#measurement-error"><i class="fa fa-check"></i><b>14.1</b> Measurement error</a><ul>
<li class="chapter" data-level="14.1.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#error-on-the-outcome."><i class="fa fa-check"></i><b>14.1.1</b> Error on the outcome.</a></li>
<li class="chapter" data-level="14.1.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#error-on-both-outcome-and-predictor."><i class="fa fa-check"></i><b>14.1.2</b> Error on both outcome and predictor.</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#missing-data"><i class="fa fa-check"></i><b>14.2</b> Missing data</a><ul>
<li class="chapter" data-level="14.2.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#imputing-neocortex"><i class="fa fa-check"></i><b>14.2.1</b> Imputing <code>neocortex</code></a></li>
<li class="chapter" data-level="14.2.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#improving-the-imputation-model"><i class="fa fa-check"></i><b>14.2.2</b> Improving the imputation model</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#summary-bonus-meta-analysis"><i class="fa fa-check"></i><b>14.3</b> <del>Summary</del> Bonus: Meta-analysis</a></li>
<li class="chapter" data-level="" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#reference-13"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#session-info-13"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html"><i class="fa fa-check"></i><b>15</b> <del>Horoscopes</del> Insights</a><ul>
<li class="chapter" data-level="15.1" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#use-r-notebooks"><i class="fa fa-check"></i><b>15.1</b> Use R Notebooks</a></li>
<li class="chapter" data-level="15.2" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#save-your-model-fits"><i class="fa fa-check"></i><b>15.2</b> Save your model fits</a></li>
<li class="chapter" data-level="15.3" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#build-your-models-slowly"><i class="fa fa-check"></i><b>15.3</b> Build your models slowly</a></li>
<li class="chapter" data-level="15.4" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#look-at-your-data"><i class="fa fa-check"></i><b>15.4</b> Look at your data</a></li>
<li class="chapter" data-level="15.5" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#use-the-0-intercept-syntax"><i class="fa fa-check"></i><b>15.5</b> Use the <code>0 + intercept</code> syntax</a></li>
<li class="chapter" data-level="15.6" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#annotate-your-workflow"><i class="fa fa-check"></i><b>15.6</b> Annotate your workflow</a></li>
<li class="chapter" data-level="15.7" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#annotate-your-code"><i class="fa fa-check"></i><b>15.7</b> Annotate your code</a></li>
<li class="chapter" data-level="15.8" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#break-up-your-workflow"><i class="fa fa-check"></i><b>15.8</b> Break up your workflow</a></li>
<li class="chapter" data-level="15.9" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#read-gelmans-blog"><i class="fa fa-check"></i><b>15.9</b> Read Gelman’s blog</a></li>
<li class="chapter" data-level="15.10" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#check-out-other-social-media-too"><i class="fa fa-check"></i><b>15.10</b> Check out other social media, too</a></li>
<li class="chapter" data-level="15.11" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#parting-wisdom"><i class="fa fa-check"></i><b>15.11</b> Parting wisdom</a></li>
<li class="chapter" data-level="" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#reference-14"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#session-info-14"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Statistical Rethinking</em> with brms, ggplot2, and the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="monsters-and-mixtures" class="section level1">
<h1><span class="header-section-number">11</span> Monsters and Mixtures</h1>
<blockquote>
<p>[Of these majestic creatures], we’ll consider two common and useful examples. The first type is the ordered categorical model, useful for categorical outcomes with a fixed ordering. This model is built by merging a categorical likelihood function with a special kind of link function, usually a cumulative link. The second type is a family of zero-inflated and zero-augmented models, each of which mixes a binary event within an ordinary GLM likelihood like a Poisson or binomial.</p>
<p>Both types of models help us transform our modeling to cope with the inconvenient realities of measurement, rather than transforming measurements to cope with the constraints of our models. (p. 331)</p>
</blockquote>
<div id="ordered-categorical-outcomes" class="section level2">
<h2><span class="header-section-number">11.1</span> Ordered categorical outcomes</h2>
<blockquote>
<p>It is very common in the social sciences, and occasional in the natural sciences, to have an outcome variable that is discrete, like a count, but in which the values merely indicate different ordered <em>levels</em> along some dimension. For example, if I were to ask you how much you like to eat fish, on a scale from 1 to 7, you might say 5. If I were to ask 100 people the same question, I’d end up with 100 values between 1 and 7. In modeling each outcome value, I’d have to keep in mind that these values are <em>ordered</em> because 7 is greater than 6, which is greater than 5, and so on. But unlike a count, the differences in values are not necessarily equal.</p>
<p>In principle, an ordered categorical variable is just a multinomial prediction problem (page 323). But the constraint that the categories be ordered demands special treatment…</p>
<p>The conventional solution is to use a cumulative link function. The cumulative probability of a value is the probability of that <em>value or any smaller value</em>. (pp. 331–332, <em>emphasis</em> in the original)</p>
</blockquote>
<div id="example-moral-intuition." class="section level3">
<h3><span class="header-section-number">11.1.1</span> Example: Moral intuition.</h3>
<p>Let’s get the <code>Trolley</code> data from rethinking.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rethinking)</code></pre></div>
<pre><code>## Warning: package &#39;ggplot2&#39; was built under R version 3.5.2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(Trolley)
d &lt;-<span class="st"> </span>Trolley</code></pre></div>
<p>Unload rethinking and load brms.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rm</span>(Trolley)
<span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)
<span class="kw">library</span>(brms)</code></pre></div>
<pre><code>## Warning: package &#39;Rcpp&#39; was built under R version 3.5.2</code></pre>
<p>Use the tidyverse to get a sense of the dimensions of the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)

<span class="kw">glimpse</span>(d)</code></pre></div>
<pre><code>## Observations: 9,930
## Variables: 12
## $ case      &lt;fct&gt; cfaqu, cfbur, cfrub, cibox, cibur, cispe, fkaqu, fkboa…
## $ response  &lt;int&gt; 4, 3, 4, 3, 3, 3, 5, 4, 4, 4, 4, 4, 4, 5, 4, 4, 4, 4, …
## $ order     &lt;int&gt; 2, 31, 16, 32, 4, 9, 29, 12, 23, 22, 27, 19, 14, 3, 18…
## $ id        &lt;fct&gt; 96;434, 96;434, 96;434, 96;434, 96;434, 96;434, 96;434…
## $ age       &lt;int&gt; 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14…
## $ male      &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ edu       &lt;fct&gt; Middle School, Middle School, Middle School, Middle Sc…
## $ action    &lt;int&gt; 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, …
## $ intention &lt;int&gt; 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ contact   &lt;int&gt; 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ story     &lt;fct&gt; aqu, bur, rub, box, bur, spe, aqu, boa, box, bur, car,…
## $ action2   &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, …</code></pre>
<p>Though we have 9,930 rows, we only have 331 unique individuals.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">distinct</span>(id) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>()</code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1   331</code></pre>
</div>
<div id="describing-an-ordered-distribution-with-intercepts." class="section level3">
<h3><span class="header-section-number">11.1.2</span> Describing an ordered distribution with intercepts.</h3>
<p>Before we get to plotting, in this chapter we’ll use theme settings and a color palette from the <a href="https://cran.r-project.org/web/packages/ggthemes/index.html">ggthemes package</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggthemes)</code></pre></div>
<p>We’ll take our basic theme settings from the <code>theme_hc()</code> function. We’ll use the <code>Green fields</code> color palette, which we can inspect with the <code>canva_pal()</code> function and a little help from <code>scales::show_col()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scales<span class="op">::</span><span class="kw">show_col</span>(<span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>))</code></pre></div>
<p><img src="11_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)</code></pre></div>
<pre><code>## [1] &quot;#919636&quot; &quot;#524a3a&quot; &quot;#fffae1&quot; &quot;#5a5f37&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">3</span>]</code></pre></div>
<pre><code>## [1] &quot;#fffae1&quot;</code></pre>
<p>Now we’re ready to make our ggplot2 version of the simple histogram, Figure 11.1.a.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> d, <span class="kw">aes</span>(<span class="dt">x =</span> response, <span class="dt">fill =</span> ..x..)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">size =</span> <span class="dv">0</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low  =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],
                      <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.x    =</span> <span class="kw">element_blank</span>(),
        <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>),
        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</code></pre></div>
<p><img src="11_files/figure-html/unnamed-chunk-7-1.png" width="240" /></p>
<p>Our cumulative proportion plot, Figure 11.1.b, will require some pre-plot wrangling.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(response) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pr_k     =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(d)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cum_pr_k =</span> <span class="kw">cumsum</span>(pr_k)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> response, <span class="dt">y =</span> cum_pr_k, 
             <span class="dt">fill =</span> response)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">colour =</span> <span class="st">&quot;grey92&quot;</span>, 
             <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">stroke =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;cumulative proportion&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low  =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],
                      <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.x    =</span> <span class="kw">element_blank</span>(),
        <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>),
        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</code></pre></div>
<p><img src="11_files/figure-html/unnamed-chunk-8-1.png" width="240" /></p>
<p>In order to make the next plot, we’ll need McElreath’s <code>logit()</code> function. Here it is, the logarithm of cumulative odds plot, Figure 11.1.c.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># McElreath&#39;s convenience function from page 335</span>
logit &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">log</span>(x <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x))

d <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(response) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pr_k     =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(d)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cum_pr_k =</span> <span class="kw">cumsum</span>(pr_k)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(response <span class="op">&lt;</span><span class="st"> </span><span class="dv">7</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="co"># we can do the `logit()` conversion right in ggplot2</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> response, <span class="dt">y =</span> <span class="kw">logit</span>(cum_pr_k), 
             <span class="dt">fill =</span> response)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">colour =</span> <span class="st">&quot;grey92&quot;</span>, 
             <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">stroke =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low  =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],
                      <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">7</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;log-cumulative-odds&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.x    =</span> <span class="kw">element_blank</span>(),
        <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>),
        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</code></pre></div>
<p><img src="11_files/figure-html/unnamed-chunk-9-1.png" width="240" /></p>
<p>The code for Figure 11.2 is itself something of a monster.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d_plot &lt;-
<span class="st">  </span>d <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(response) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pr_k     =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(d)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cum_pr_k =</span> <span class="kw">cumsum</span>(pr_k)) 

<span class="kw">ggplot</span>(<span class="dt">data =</span> d_plot,
       <span class="kw">aes</span>(<span class="dt">x =</span> response, <span class="dt">y =</span> cum_pr_k,
           <span class="dt">color =</span> cum_pr_k, <span class="dt">fill =</span> cum_pr_k)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">colour =</span> <span class="st">&quot;grey92&quot;</span>, 
             <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">stroke =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_linerange</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> cum_pr_k),
                 <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span>
<span class="st">  </span><span class="co"># there must be more elegant ways to do this part</span>
<span class="st">  </span><span class="kw">geom_linerange</span>(<span class="dt">data =</span> . <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                   </span><span class="kw">mutate</span>(<span class="dt">discrete_probability =</span>
                            <span class="kw">ifelse</span>(response <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, cum_pr_k,
                                   cum_pr_k <span class="op">-</span><span class="st"> </span>pr_k)),
                 <span class="kw">aes</span>(<span class="dt">x    =</span> response <span class="op">+</span><span class="st"> </span>.<span class="dv">025</span>,
                     <span class="dt">ymin =</span> <span class="kw">ifelse</span>(response <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">0</span>, discrete_probability), 
                     <span class="dt">ymax =</span> cum_pr_k),
                 <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">tibble</span>(<span class="dt">text     =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>,
                          <span class="dt">response =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">1.25</span>, <span class="dt">to =</span> <span class="fl">7.25</span>, <span class="dt">by =</span> <span class="dv">1</span>),
                          <span class="dt">cum_pr_k =</span> d_plot<span class="op">$</span>cum_pr_k <span class="op">-</span><span class="st"> </span>.<span class="dv">065</span>),
            <span class="kw">aes</span>(<span class="dt">label =</span> text),
            <span class="dt">size =</span> <span class="dv">4</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;cumulative proportion&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low  =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],
                      <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_gradient</span>(<span class="dt">low  =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],
                       <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.x    =</span> <span class="kw">element_blank</span>(),
        <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>),
        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</code></pre></div>
<p><img src="11_files/figure-html/unnamed-chunk-10-1.png" width="336" /></p>
<p>McElreath’s convention for this first type of statistical model is</p>
<span class="math display">\[\begin{align*} 
R_i &amp; \sim \text{Ordered} (\mathbf p) \\
\text{logit} (p_k) &amp; = \alpha_k \\
\alpha_k           &amp; \sim \text{Normal} (0, 10)
\end{align*}\]</span>
<blockquote>
<p>The Ordered distribution is really just a categorical distribution that takes a vector <span class="math inline">\(\mathbf p = {p_1, p_2, p_3, p_4, p_5, p_6}\)</span> of probabilities of each response value below the maximum response (7 in this example). Each response value <span class="math inline">\(k\)</span> in this vector is defined by its link to an intercept parameter, <span class="math inline">\(\alpha_k\)</span>. Finally, some weakly regularizing priors are placed on these intercepts. (p. 335)</p>
</blockquote>
<p>Whereas in <code>rethinking::map()</code> you indicate the likelihood by <code>&lt;criterion&gt; ~ dordlogit(phi , c(&lt;the thresholds&gt;)</code>, in <code>brms::brm()</code> you code <code>family = cumulative</code>. Here’s the intercepts-only model:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># define the start values</span>
inits &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">`</span><span class="dt">Intercept[1]</span><span class="st">`</span> =<span class="st"> </span><span class="op">-</span><span class="dv">2</span>,
              <span class="st">`</span><span class="dt">Intercept[2]</span><span class="st">`</span> =<span class="st"> </span><span class="op">-</span><span class="dv">1</span>,
              <span class="st">`</span><span class="dt">Intercept[3]</span><span class="st">`</span> =<span class="st"> </span><span class="dv">0</span>,
              <span class="st">`</span><span class="dt">Intercept[4]</span><span class="st">`</span> =<span class="st"> </span><span class="dv">1</span>,
              <span class="st">`</span><span class="dt">Intercept[5]</span><span class="st">`</span> =<span class="st"> </span><span class="dv">2</span>,
              <span class="st">`</span><span class="dt">Intercept[6]</span><span class="st">`</span> =<span class="st"> </span><span class="fl">2.5</span>)

inits_list &lt;-<span class="st"> </span><span class="kw">list</span>(inits, inits)

b11.<span class="dv">1</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> cumulative,
      response <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,
      <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),
      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">cores =</span> <span class="dv">2</span>, <span class="dt">chains =</span> <span class="dv">2</span>,
      <span class="dt">inits =</span> inits_list,  <span class="co"># here we add our start values</span>
      <span class="dt">seed =</span> <span class="dv">11</span>)</code></pre></div>
<p>McElreath needed to include the <code>depth=2</code> argument in the <code>rethinking::precis()</code> function to show the threshold parameters from his <code>m11.1stan</code> model. With a <code>brm()</code> fit, we just use <code>print()</code> or <code>summary()</code> as usual.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b11.<span class="dv">1</span>)</code></pre></div>
<pre><code>##  Family: cumulative 
##   Links: mu = logit; disc = identity 
## Formula: response ~ 1 
##    Data: d (Number of observations: 9930) 
## Samples: 2 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 2000
## 
## Population-Level Effects: 
##              Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept[1]    -1.92      0.03    -1.97    -1.86       1476 1.00
## Intercept[2]    -1.27      0.02    -1.31    -1.22       1821 1.00
## Intercept[3]    -0.72      0.02    -0.76    -0.68       2021 1.00
## Intercept[4]     0.25      0.02     0.21     0.29       2216 1.00
## Intercept[5]     0.89      0.02     0.85     0.93       2327 1.00
## Intercept[6]     1.77      0.03     1.72     1.83       2482 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>What McElreath’s <code>m11.1stan</code> summary termed <code>cutpoints[k]</code>, ours termed <code>Intercept[k]</code>. In both cases, these are the <span class="math inline">\(\alpha_k\)</span> parameters from the equations, above. The summaries look like those in the text, number of effective samples are high, and the <span class="math inline">\(\hat{R}\)</span> values are great. The model looks good.</p>
<p>Recall we use the <code>brms::inv_logit_scaled()</code> function in place of McElreath’s <code>logistic()</code> function to get these into the probability metric.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b11.<span class="dv">1</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">fixef</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">inv_logit_scaled</span>()</code></pre></div>
<pre><code>##               Estimate Est.Error      Q2.5     Q97.5
## Intercept[1] 0.1282430 0.5072421 0.1222287 0.1346667
## Intercept[2] 0.2197474 0.5058551 0.2120979 0.2277862
## Intercept[3] 0.3277541 0.5053708 0.3181448 0.3369461
## Intercept[4] 0.5616313 0.5051667 0.5515424 0.5715200
## Intercept[5] 0.7090137 0.5054678 0.7006442 0.7176885
## Intercept[6] 0.8545209 0.5071545 0.8475148 0.8613844</code></pre>
<p>But recall that the posterior <span class="math inline">\(SD\)</span> (i.e., the ‘Est.Error’ values) are not valid using that approach. If you really care about them, you’ll need to work with the <code>posterior_samples()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">posterior_samples</span>(b11.<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;b_&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate_all</span>(inv_logit_scaled) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(key) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(value),
            <span class="dt">sd   =</span> <span class="kw">sd</span>(value),
            <span class="dt">ll   =</span> <span class="kw">quantile</span>(value, <span class="dt">probs =</span> .<span class="dv">025</span>),
            <span class="dt">ul   =</span> <span class="kw">quantile</span>(value, <span class="dt">probs =</span> .<span class="dv">975</span>))</code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   key             mean      sd    ll    ul
##   &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 b_Intercept[1] 0.128 0.00324 0.122 0.135
## 2 b_Intercept[2] 0.220 0.00402 0.212 0.228
## 3 b_Intercept[3] 0.328 0.00473 0.318 0.337
## 4 b_Intercept[4] 0.562 0.00509 0.552 0.572
## 5 b_Intercept[5] 0.709 0.00451 0.701 0.718
## 6 b_Intercept[6] 0.854 0.00356 0.848 0.861</code></pre>
</div>
<div id="adding-predictor-variables." class="section level3">
<h3><span class="header-section-number">11.1.3</span> Adding predictor variables.</h3>
<p>Now we define the linear model as <span class="math inline">\(\phi_i = \beta x_i\)</span>. Accordingly, the formula for our cumulative logit model becomes</p>
<span class="math display">\[\begin{align*}
\text{log} \frac{\text{Pr} (y_i \leq k)}{1 - \text{Pr} (y_i \leq k)} &amp; = \alpha_k - \phi_i \\
\phi_i &amp; = \beta x_i
\end{align*}\]</span>
<p>I’m not aware that brms has an equivalent to the <code>rethinking::dordlogit()</code> function. So here we’ll make it by hand. The code comes from McElreath’s <a href="https://github.com/rmcelreath/rethinking/blob/a309712d904d1db7af1e08a76c521ab994006fd5/R/distributions.r">GitHub page</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># first, we needed to specify the `logistic()` function, which is apart of the `dordlogit()` function</span>
logistic &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
    p &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>x))
    p &lt;-<span class="st"> </span><span class="kw">ifelse</span>(x <span class="op">==</span><span class="st"> </span><span class="ot">Inf</span>, <span class="dv">1</span>, p)
    p
    }

<span class="co"># now we get down to it</span>
dordlogit &lt;-<span class="st"> </span>
<span class="st">  </span><span class="cf">function</span>(x, phi, a, <span class="dt">log =</span> <span class="ot">FALSE</span>) {
    a  &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">as.numeric</span>(a), <span class="ot">Inf</span>)
    p  &lt;-<span class="st"> </span><span class="kw">logistic</span>(a[x] <span class="op">-</span><span class="st"> </span>phi)
    na &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, a)
    np &lt;-<span class="st"> </span><span class="kw">logistic</span>(na[x] <span class="op">-</span><span class="st"> </span>phi)
    p  &lt;-<span class="st"> </span>p <span class="op">-</span><span class="st"> </span>np
    <span class="cf">if</span> (log <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) p &lt;-<span class="st"> </span><span class="kw">log</span>(p)
    p
    }</code></pre></div>
<p>The <code>dordlogit()</code> function works like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(pk &lt;-<span class="st"> </span><span class="kw">dordlogit</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>, <span class="dv">0</span>, <span class="kw">fixef</span>(b11.<span class="dv">1</span>)[, <span class="dv">1</span>]))</code></pre></div>
<pre><code>## [1] 0.12824305 0.09150433 0.10800668 0.23387727 0.14738234 0.14550720
## [7] 0.14547915</code></pre>
<p>Note the slight difference in how we used <code>dordlogit()</code> with a <code>brm()</code> fit summarized by <code>fixef()</code> than the way McElreath did with a <code>map2stan()</code> fit summarized by <code>coef()</code>. McElreath just put <code>coef(m11.1)</code> into <code>dordlogit()</code>. We, however, more specifically placed <code>fixef(b11.1)[, 1]</code> into the function. With the <code>[, 1]</code> part, we specified that we were working with the posterior means (i.e., <code>Estimate</code>) and neglecting the other summaries (i.e., the posterior <em>SD</em>s and 95% intervals). If you forget to subset, chaos ensues.</p>
<p>Next, as McElreath further noted in the text, “these probabilities imply an average outcome of:”</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(pk <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>))</code></pre></div>
<pre><code>## [1] 4.19909</code></pre>
<p>I found that a bit abstract. Here’s the thing in a more elaborate tibble format.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(
  explicit_example &lt;-
<span class="st">  </span><span class="kw">tibble</span>(<span class="dt">probability_of_a_response =</span> pk) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">the_response  =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">their_product =</span> probability_of_a_response <span class="op">*</span><span class="st"> </span>the_response)
)</code></pre></div>
<pre><code>## # A tibble: 7 x 3
##   probability_of_a_response the_response their_product
##                       &lt;dbl&gt;        &lt;int&gt;         &lt;dbl&gt;
## 1                    0.128             1         0.128
## 2                    0.0915            2         0.183
## 3                    0.108             3         0.324
## 4                    0.234             4         0.936
## 5                    0.147             5         0.737
## 6                    0.146             6         0.873
## 7                    0.145             7         1.02</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">explicit_example <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">average_outcome_value =</span> <span class="kw">sum</span>(their_product))</code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   average_outcome_value
##                   &lt;dbl&gt;
## 1                  4.20</code></pre>
<p><strong>Aside</strong></p>
<p>This made me wonder how this would compare if we were lazy and ignored the categorical nature of the <code>response</code>. Here we refit the model with the typical Gaussian likelihood.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> gaussian,
    response <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,
    <span class="co"># in this case, 4 (i.e., the middle response) seems to be the conservative place to put the mean</span>
    <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">4</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),
              <span class="kw">prior</span>(<span class="kw">cauchy</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sigma)),
    <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">chains =</span> <span class="dv">4</span>,
    <span class="dt">seed =</span> <span class="dv">11</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">print</span>()</code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: response ~ 1 
##    Data: d (Number of observations: 9930) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept     4.20      0.02     4.16     4.24       2600 1.00
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sigma     1.91      0.01     1.88     1.93       3102 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Happily, this yielded a mean estimate of 4.2, much like our <code>average_outcome_value</code>, above.</p>
<p><strong>End aside</strong></p>
<p>Now we’ll try it by subtracting .5 from each.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># the probabilities of a given response</span>
(pk &lt;-<span class="st"> </span><span class="kw">dordlogit</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>, <span class="dv">0</span>, <span class="kw">fixef</span>(b11.<span class="dv">1</span>)[, <span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>.<span class="dv">5</span>))</code></pre></div>
<pre><code>## [1] 0.08191684 0.06398163 0.08232659 0.20905342 0.15914829 0.18440296
## [7] 0.21917028</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># the average rating</span>
<span class="kw">sum</span>(pk <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>))</code></pre></div>
<pre><code>## [1] 4.729425</code></pre>
<p>So the rule is we <em>subtract the linear model from each interecept</em>. Let’s fit our multivariable models.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># start values for b11.2</span>
inits &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">`</span><span class="dt">Intercept[1]</span><span class="st">`</span> =<span class="st"> </span><span class="op">-</span><span class="fl">1.9</span>,
              <span class="st">`</span><span class="dt">Intercept[2]</span><span class="st">`</span> =<span class="st"> </span><span class="op">-</span><span class="fl">1.2</span>,
              <span class="st">`</span><span class="dt">Intercept[3]</span><span class="st">`</span> =<span class="st"> </span><span class="op">-</span><span class="fl">0.7</span>,
              <span class="st">`</span><span class="dt">Intercept[4]</span><span class="st">`</span> =<span class="st">  </span><span class="fl">0.2</span>,
              <span class="st">`</span><span class="dt">Intercept[5]</span><span class="st">`</span> =<span class="st">  </span><span class="fl">0.9</span>,
              <span class="st">`</span><span class="dt">Intercept[6]</span><span class="st">`</span> =<span class="st">  </span><span class="fl">1.8</span>,
              <span class="dt">action         =</span>  <span class="dv">0</span>,
              <span class="dt">intention      =</span>  <span class="dv">0</span>,
              <span class="dt">contact        =</span>  <span class="dv">0</span>)

b11.<span class="dv">2</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> cumulative,
      response <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>action <span class="op">+</span><span class="st"> </span>intention <span class="op">+</span><span class="st"> </span>contact,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> b)),
      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">cores =</span> <span class="dv">2</span>, <span class="dt">chains =</span> <span class="dv">2</span>,
      <span class="dt">inits =</span> <span class="kw">list</span>(inits, inits),
      <span class="dt">seed =</span> <span class="dv">11</span>)

<span class="co"># start values for b11.3</span>
inits &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">`</span><span class="dt">Intercept[1]</span><span class="st">`</span>      =<span class="st"> </span><span class="op">-</span><span class="fl">1.9</span>,
              <span class="st">`</span><span class="dt">Intercept[2]</span><span class="st">`</span>      =<span class="st"> </span><span class="op">-</span><span class="fl">1.2</span>,
              <span class="st">`</span><span class="dt">Intercept[3]</span><span class="st">`</span>      =<span class="st"> </span><span class="op">-</span><span class="fl">0.7</span>,
              <span class="st">`</span><span class="dt">Intercept[4]</span><span class="st">`</span>      =<span class="st">  </span><span class="fl">0.2</span>,
              <span class="st">`</span><span class="dt">Intercept[5]</span><span class="st">`</span>      =<span class="st">  </span><span class="fl">0.9</span>,
              <span class="st">`</span><span class="dt">Intercept[6]</span><span class="st">`</span>      =<span class="st">  </span><span class="fl">1.8</span>,
              <span class="dt">action              =</span>  <span class="dv">0</span>,
              <span class="dt">intention           =</span>  <span class="dv">0</span>,
              <span class="dt">contact             =</span>  <span class="dv">0</span>,
              <span class="st">`</span><span class="dt">action:intention</span><span class="st">`</span>  =<span class="st">  </span><span class="dv">0</span>,
              <span class="st">`</span><span class="dt">contact:intention</span><span class="st">`</span> =<span class="st">  </span><span class="dv">0</span>)

b11.<span class="dv">3</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">update</span>(b11.<span class="dv">2</span>,
         <span class="dt">formula =</span> response <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>action <span class="op">+</span><span class="st"> </span>intention <span class="op">+</span><span class="st"> </span>contact <span class="op">+</span><span class="st"> </span>action<span class="op">:</span>intention <span class="op">+</span><span class="st"> </span>contact<span class="op">:</span>intention,
         <span class="dt">inits =</span> <span class="kw">list</span>(inits, inits))</code></pre></div>
<p>We don’t have a <code>coeftab()</code> function in brms like for rethinking. But as we did for Chapter 6, we can reproduce it with help from the <a href="https://cran.r-project.org/web/packages/broom/index.html">broom package</a> and a bit of data wrangling.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(broom)

<span class="kw">tibble</span>(<span class="dt">model  =</span> <span class="kw">str_c</span>(<span class="st">&quot;b11.&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fit  =</span> purrr<span class="op">::</span><span class="kw">map</span>(model, get)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tidy =</span> purrr<span class="op">::</span><span class="kw">map</span>(fit, tidy)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unnest</span>(tidy) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(model, term, estimate) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(term <span class="op">!=</span><span class="st"> &quot;lp__&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">complete</span>(<span class="dt">term =</span> <span class="kw">distinct</span>(., term), model) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">estimate =</span> <span class="kw">round</span>(estimate, <span class="dt">digits =</span> <span class="dv">2</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread</span>(<span class="dt">key =</span> model, <span class="dt">value =</span> estimate) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># this last step isn&#39;t necessary, but it orders the rows to match the text</span>
<span class="st">  </span><span class="kw">slice</span>(<span class="kw">c</span>(<span class="dv">6</span><span class="op">:</span><span class="dv">11</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>))</code></pre></div>
<pre><code>## # A tibble: 11 x 4
##    term                 b11.1  b11.2 b11.3
##    &lt;chr&gt;                &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1 b_Intercept[1]       -1.92  -2.84 -2.64
##  2 b_Intercept[2]       -1.27  -2.16 -1.94
##  3 b_Intercept[3]       -0.72  -1.57 -1.35
##  4 b_Intercept[4]        0.25  -0.55 -0.31
##  5 b_Intercept[5]        0.89   0.12  0.36
##  6 b_Intercept[6]        1.77   1.02  1.27
##  7 b_action             NA     -0.71 -0.47
##  8 b_intention          NA     -0.72 -0.28
##  9 b_contact            NA     -0.96 -0.33
## 10 b_action:intention   NA     NA    -0.44
## 11 b_intention:contact  NA     NA    -1.27</code></pre>
<p>If you really wanted that last <code>nobs</code> row at the bottom, you could elaborate on this code: <code>b11.1$data %&gt;% count()</code>. Also, if you want a proper <code>coeftab()</code> function for brms, McElreath’s code lives <a href="https://github.com/rmcelreath/rethinking/blob/a309712d904d1db7af1e08a76c521ab994006fd5/R/coeftab.r">here</a>. Give it a whirl.</p>
<p>Here we compute the WAIC. <em>Caution: This took some time to compute.</em></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b11.<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b11.<span class="dv">1</span>, <span class="st">&quot;waic&quot;</span>)
b11.<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b11.<span class="dv">2</span>, <span class="st">&quot;waic&quot;</span>)
b11.<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">add_criterion</span>(b11.<span class="dv">3</span>, <span class="st">&quot;waic&quot;</span>)</code></pre></div>
<p>Now compare the models.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">loo_compare</span>(b11.<span class="dv">1</span>, b11.<span class="dv">2</span>, b11.<span class="dv">3</span>, <span class="dt">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">print</span>(<span class="dt">simplify =</span> F)</code></pre></div>
<pre><code>##       elpd_diff se_diff  elpd_waic se_elpd_waic p_waic   se_p_waic
## b11.3      0.0       0.0 -18464.5      40.6         10.9      0.1 
## b11.2    -80.4      12.8 -18544.9      38.1          9.0      0.0 
## b11.1   -462.7      31.3 -18927.2      28.8          6.0      0.0 
##       waic     se_waic 
## b11.3  36929.0     81.3
## b11.2  37089.9     76.3
## b11.1  37854.4     57.6</code></pre>
<p>Here are the WAIC weights.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">model_weights</span>(b11.<span class="dv">1</span>, b11.<span class="dv">2</span>, b11.<span class="dv">3</span>,
              <span class="dt">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</code></pre></div>
<pre><code>## b11.1 b11.2 b11.3 
##     0     0     1</code></pre>
<p>McElreath made Figure 11.3 by extracting the samples of his <code>m11.3</code>, saving them as <code>post</code>, and working some hairy base R <code>plot()</code> code. We’ll take a different route and use <code>brms::fitted()</code>. This will take substantial data wrangling, but hopefully it’ll be instructive. Let’s first take a look at the initial <code>fitted()</code> output for the beginnings of Figure 11.3.a.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nd &lt;-
<span class="st">  </span><span class="kw">tibble</span>(<span class="dt">action    =</span> <span class="dv">0</span>,
         <span class="dt">contact   =</span> <span class="dv">0</span>, 
         <span class="dt">intention =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>)

max_iter &lt;-<span class="st"> </span><span class="dv">100</span>

<span class="kw">fitted</span>(b11.<span class="dv">3</span>, 
        <span class="dt">newdata =</span> nd, 
        <span class="dt">subset  =</span> <span class="dv">1</span><span class="op">:</span>max_iter,
        <span class="dt">summary =</span> F) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">glimpse</span>()</code></pre></div>
<pre><code>## Observations: 100
## Variables: 14
## $ `1.1` &lt;dbl&gt; 0.06431154, 0.06654538, 0.06539877, 0.06865674, 0.07194016…
## $ `2.1` &lt;dbl&gt; 0.08606223, 0.09177197, 0.08797653, 0.09108951, 0.09013832…
## $ `1.2` &lt;dbl&gt; 0.05476174, 0.06128931, 0.05620629, 0.06030583, 0.06191991…
## $ `2.2` &lt;dbl&gt; 0.07018978, 0.08024188, 0.07228319, 0.07646513, 0.07479958…
## $ `1.3` &lt;dbl&gt; 0.07845195, 0.08089936, 0.07992199, 0.08131879, 0.08317862…
## $ `2.3` &lt;dbl&gt; 0.09593491, 0.10013379, 0.09786148, 0.09822813, 0.09665743…
## $ `1.4` &lt;dbl&gt; 0.2181005, 0.2124984, 0.2160383, 0.2177055, 0.2116564, 0.2…
## $ `2.4` &lt;dbl&gt; 0.2413372, 0.2356276, 0.2389400, 0.2384760, 0.2279406, 0.2…
## $ `1.5` &lt;dbl&gt; 0.1700717, 0.1635829, 0.1701502, 0.1637571, 0.1704034, 0.1…
## $ `2.5` &lt;dbl&gt; 0.1659739, 0.1585014, 0.1656836, 0.1590970, 0.1668038, 0.1…
## $ `1.6` &lt;dbl&gt; 0.1935246, 0.1922405, 0.1892956, 0.1900185, 0.1902459, 0.1…
## $ `2.6` &lt;dbl&gt; 0.1691378, 0.1653796, 0.1649466, 0.1662835, 0.1709148, 0.1…
## $ `1.7` &lt;dbl&gt; 0.2207780, 0.2229442, 0.2229889, 0.2182374, 0.2106555, 0.2…
## $ `2.7` &lt;dbl&gt; 0.1713642, 0.1683438, 0.1723086, 0.1703608, 0.1727455, 0.1…</code></pre>
<p>Hopefully by now it’s clear why we needed the <code>nd</code> tibble, which we made use of in the <code>newdata = nd</code> argument. Because we set <code>summary = F</code>, we get draws from the posterior instead of summaries. With <code>max_iter</code>, we controlled how many of those posterior draws we wanted. McElreath used 100, which he indicated at the top of page 341, so we followed suit. It took me a minute to wrap my head around the meaning of the 14 vectors, which were named by <code>brms::fitted()</code> default. Notice how each column is named by two numerals, separated by a period. That first numeral indicates which if the two <code>intention</code> values the draw is based on (i.e., 1 stands for <code>intention == 0</code>, 2, stands for <code>intention == 1</code>). The numbers on the right of the decimals are the seven response options for <code>response</code>. For each posterior draw, you get one of those for each value of <code>intention</code>. Finally, it might not be immediately apparent, but the values are in the probability scale, just like <code>pk</code> on page 338.</p>
<p>Now we know what we have in hand, it’s just a matter of careful wrangling to get those probabilities into a more useful format to feed into ggplot2. I’ve extensively annotated the code, below. If you lose track of happens in a given step, just run the code up till that point. Go step by step.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nd &lt;-
<span class="st">  </span><span class="kw">tibble</span>(<span class="dt">action    =</span> <span class="dv">0</span>,
         <span class="dt">contact   =</span> <span class="dv">0</span>, 
         <span class="dt">intention =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>)

max_iter &lt;-<span class="st"> </span><span class="dv">100</span>

<span class="kw">fitted</span>(b11.<span class="dv">3</span>, 
        <span class="dt">newdata =</span> nd, 
        <span class="dt">subset  =</span> <span class="dv">1</span><span class="op">:</span>max_iter,
        <span class="dt">summary =</span> F) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># we convert the data to the long format</span>
<span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># we need an variable to index which posterior iteration we&#39;re working with</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">iter =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>max_iter, <span class="dt">times =</span> <span class="dv">14</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># this step isn’t technically necessary, but I prefer my `iter` index at the far left.</span>
<span class="st">  </span><span class="kw">select</span>(iter, <span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># here we extract the `intention` and `response` information out of the `key` vector and </span>
<span class="st">  </span><span class="co"># spread it into two vectors.</span>
<span class="st">  </span><span class="kw">separate</span>(key, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;intention&quot;</span>, <span class="st">&quot;rating&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># that step produced two character vectors. they’ll be more useful as numbers</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">intention =</span> intention <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.double</span>(),
         <span class="dt">rating    =</span>  rating <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.double</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># here we convert `intention` into its proper 0:1 metric</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">intention =</span> intention <span class="op">-</span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># this isn&#39;t necessary, but it helps me understand exactly what metric the values are currently in</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">pk =</span> value) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># this step is based on McElreath&#39;s R code 11.10 on page 338</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">pk:rating</span><span class="st">`</span> =<span class="st"> </span>pk <span class="op">*</span><span class="st"> </span>rating) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># I’m not sure how to succinctly explain this. you’re just going to have to trust me</span>
<span class="st">  </span><span class="kw">group_by</span>(iter, intention) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># this is very important for the next step.</span>
<span class="st">  </span><span class="kw">arrange</span>(iter, intention, rating) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># here we take our `pk` values and make culmulative sums. why? take a long hard look at Figure 11.2. </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">probability =</span> <span class="kw">cumsum</span>(pk)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># `rating == 7` is unnecessary. these `probability` values are by definition 1</span>
<span class="st">  </span><span class="kw">filter</span>(rating <span class="op">&lt;</span><span class="st"> </span><span class="dv">7</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> intention, 
             <span class="dt">y =</span> probability, 
             <span class="dt">color =</span> probability)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> <span class="kw">interaction</span>(iter, rating)),
            <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>) <span class="op">+</span>
<span class="st">  </span><span class="co"># note how we made a new data object for `geom_text()`</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">tibble</span>(<span class="dt">text        =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>,
                          <span class="dt">intention   =</span> <span class="kw">seq</span>(<span class="dt">from =</span> .<span class="dv">9</span>, <span class="dt">to =</span> .<span class="dv">1</span>, <span class="dt">length.out =</span> <span class="dv">7</span>),
                          <span class="dt">probability =</span> <span class="kw">c</span>(.<span class="dv">05</span>, .<span class="dv">12</span>, .<span class="dv">20</span>, .<span class="dv">35</span>, .<span class="dv">53</span>, .<span class="dv">71</span>, .<span class="dv">87</span>)),
            <span class="kw">aes</span>(<span class="dt">label =</span> text),
            <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_gradient</span>(<span class="dt">low  =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],
                       <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;action = 0,</span><span class="ch">\n</span><span class="st">contact = 0&quot;</span>,
       <span class="dt">x        =</span> <span class="st">&quot;intention&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>),
        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</code></pre></div>
<p><img src="11_files/figure-html/unnamed-chunk-23-1.png" width="240" /></p>
<p>Boom!</p>
<p>Okay, that pile of code is a bit of a mess and you’re not going to want to repeatedly cut and paste all that. Let’s condense it into a homemade function, <code>make_Figure_11.3_data()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">make_Figure_<span class="fl">11.</span>3_data &lt;-<span class="st"> </span><span class="cf">function</span>(action, contact, max_iter){
  
  nd &lt;-
<span class="st">    </span><span class="kw">tibble</span>(<span class="dt">action    =</span> action,
           <span class="dt">contact   =</span> contact, 
           <span class="dt">intention =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>)
  
  max_iter &lt;-<span class="st"> </span>max_iter
  
  <span class="kw">fitted</span>(b11.<span class="dv">3</span>, 
         <span class="dt">newdata =</span> nd, 
         <span class="dt">subset  =</span> <span class="dv">1</span><span class="op">:</span>max_iter,
         <span class="dt">summary =</span> F) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">gather</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">iter =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>max_iter, <span class="dt">times =</span> <span class="dv">14</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(iter, <span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">separate</span>(key, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;intention&quot;</span>, <span class="st">&quot;rating&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">intention =</span> intention <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.double</span>(),
           <span class="dt">rating    =</span>  rating <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.double</span>()) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">intention =</span> intention <span class="op">-</span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">rename</span>(<span class="dt">pk =</span> value) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">pk:rating</span><span class="st">`</span> =<span class="st"> </span>pk <span class="op">*</span><span class="st"> </span>rating) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(iter, intention) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">arrange</span>(iter, intention, rating) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">probability =</span> <span class="kw">cumsum</span>(pk)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">filter</span>(rating <span class="op">&lt;</span><span class="st"> </span><span class="dv">7</span>) 
}</code></pre></div>
<p>Now we’ll use our sweet homemade function to make our plots.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Figure 11.3.a</span>
p1 &lt;-
<span class="st">  </span><span class="kw">make_Figure_11.3_data</span>(<span class="dt">action   =</span> <span class="dv">0</span>, 
                        <span class="dt">contact  =</span> <span class="dv">0</span>, 
                        <span class="dt">max_iter =</span> <span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> intention, 
             <span class="dt">y =</span> probability,
             <span class="dt">color =</span> probability)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> <span class="kw">interaction</span>(iter, rating)),
            <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">tibble</span>(<span class="dt">text        =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>,
                          <span class="dt">intention   =</span> <span class="kw">seq</span>(<span class="dt">from =</span> .<span class="dv">9</span>, <span class="dt">to =</span> .<span class="dv">1</span>, <span class="dt">length.out =</span> <span class="dv">7</span>),
                          <span class="dt">probability =</span> <span class="kw">c</span>(.<span class="dv">05</span>, .<span class="dv">12</span>, .<span class="dv">20</span>, .<span class="dv">35</span>, .<span class="dv">53</span>, .<span class="dv">71</span>, .<span class="dv">87</span>)),
            <span class="kw">aes</span>(<span class="dt">label =</span> text),
            <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_gradient</span>(<span class="dt">low  =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],
                       <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;action = 0,</span><span class="ch">\n</span><span class="st">contact = 0&quot;</span>,
       <span class="dt">x        =</span> <span class="st">&quot;intention&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>),
        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)

<span class="co"># Figure 11.3.b</span>
p2 &lt;-
<span class="st">  </span><span class="kw">make_Figure_11.3_data</span>(<span class="dt">action   =</span> <span class="dv">1</span>, 
                        <span class="dt">contact  =</span> <span class="dv">0</span>, 
                        <span class="dt">max_iter =</span> <span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> intention, 
             <span class="dt">y =</span> probability,
             <span class="dt">color =</span> probability)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> <span class="kw">interaction</span>(iter, rating)),
            <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">tibble</span>(<span class="dt">text        =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>,
                          <span class="dt">intention   =</span> <span class="kw">seq</span>(<span class="dt">from =</span> .<span class="dv">9</span>, <span class="dt">to =</span> .<span class="dv">1</span>, <span class="dt">length.out =</span> <span class="dv">7</span>),
                          <span class="dt">probability =</span> <span class="kw">c</span>(.<span class="dv">12</span>, .<span class="dv">24</span>, .<span class="dv">35</span>, .<span class="dv">50</span>, .<span class="dv">68</span>, .<span class="dv">80</span>, .<span class="dv">92</span>)),
            <span class="kw">aes</span>(<span class="dt">label =</span> text),
            <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_gradient</span>(<span class="dt">low  =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],
                       <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;action = 1,</span><span class="ch">\n</span><span class="st">contact = 0&quot;</span>,
       <span class="dt">x        =</span> <span class="st">&quot;intention&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>),
        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)

<span class="co"># Figure 11.3.c</span>
p3 &lt;-
<span class="st">  </span><span class="kw">make_Figure_11.3_data</span>(<span class="dt">action   =</span> <span class="dv">0</span>, 
                        <span class="dt">contact  =</span> <span class="dv">1</span>, 
                        <span class="dt">max_iter =</span> <span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> intention, 
             <span class="dt">y =</span> probability,
             <span class="dt">color =</span> probability)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> <span class="kw">interaction</span>(iter, rating)),
            <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> <span class="kw">tibble</span>(<span class="dt">text        =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>,
                          <span class="dt">intention   =</span> <span class="kw">seq</span>(<span class="dt">from =</span> .<span class="dv">9</span>, <span class="dt">to =</span> .<span class="dv">1</span>, <span class="dt">length.out =</span> <span class="dv">7</span>),
                          <span class="dt">probability =</span> <span class="kw">c</span>(.<span class="dv">15</span>, .<span class="dv">34</span>, .<span class="dv">44</span>, .<span class="dv">56</span>, .<span class="dv">695</span>, .<span class="dv">8</span>, .<span class="dv">92</span>)),
            <span class="kw">aes</span>(<span class="dt">label =</span> text),
            <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_gradient</span>(<span class="dt">low  =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],
                       <span class="dt">high =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;action = 0,</span><span class="ch">\n</span><span class="st">contact = 1&quot;</span>,
       <span class="dt">x        =</span> <span class="st">&quot;intention&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>),
        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)

<span class="co"># here we stitch them together with `grid.arrange()`</span>
<span class="kw">library</span>(gridExtra)

<span class="kw">grid.arrange</span>(p1, p2, p3, <span class="dt">ncol =</span> <span class="dv">3</span>)</code></pre></div>
<p><img src="11_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>If you’d like to learn more about these kinds of models and how to fit them in brms, check out Bürkner and Vuorre’s <a href="https://psyarxiv.com/x8swp/"><em>Ordinal Regression Models in Psychology: A Tutorial</em></a>.</p>
</div>
<div id="bonus-figure-11.3-alternative." class="section level3">
<h3><span class="header-section-number">11.1.4</span> Bonus: Figure 11.3 alternative.</h3>
<p>I have a lot of respect for McElreath. But man, Figure 11.3 is the worst. I’m in clinical psychology and there’s no way a working therapist is going to look at a figure like that and have any sense of what’s going on. Nobody’s got time for that. We’ve have clients to serve! Happily, we can go further. Look back at McElreath’s R code 11.10 on page 338. See how he multiplied the elements of <code>pk</code> by their respective <code>response</code> values and then just summed them up to get an average outcome value? With just a little amendment to our custom <code>make_Figure_11.3_data()</code> function, we can wrangle our <code>fitted()</code> output to express average <code>response</code> values for each of our conditions of interest. Here’s the adjusted function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">make_data_for_an_alternative_fiture &lt;-<span class="st"> </span><span class="cf">function</span>(action, contact, max_iter){
  
  nd &lt;-
<span class="st">    </span><span class="kw">tibble</span>(<span class="dt">action    =</span> action,
           <span class="dt">contact   =</span> contact, 
           <span class="dt">intention =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>)
  
  max_iter &lt;-<span class="st"> </span>max_iter
  
  <span class="kw">fitted</span>(b11.<span class="dv">3</span>, 
         <span class="dt">newdata =</span> nd, 
         <span class="dt">subset  =</span> <span class="dv">1</span><span class="op">:</span>max_iter,
         <span class="dt">summary =</span> F) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">gather</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">iter =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>max_iter, <span class="dt">times =</span> <span class="dv">14</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(iter, <span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">separate</span>(key, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;intention&quot;</span>, <span class="st">&quot;rating&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">intention =</span> intention <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.double</span>(),
           <span class="dt">rating    =</span>  rating <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.double</span>()) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">intention =</span> intention <span class="op">-</span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">rename</span>(<span class="dt">pk =</span> value) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">pk:rating</span><span class="st">`</span> =<span class="st"> </span>pk <span class="op">*</span><span class="st"> </span>rating) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(iter, intention) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span>
<span class="st">    </span><span class="co"># everything above this point is identical to the previous custom function.</span>
<span class="st">    </span><span class="co"># all we do is replace the last few lines with this one line of code. </span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">mean_rating =</span> <span class="kw">sum</span>(<span class="st">`</span><span class="dt">pk:rating</span><span class="st">`</span>))
}</code></pre></div>
<p>Our handy homemade but monstrously-named <code>make_data_for_an_alternative_fiture()</code> function works very much like its predecessor. You’ll see.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># alternative to Figure 11.3.a</span>
p1 &lt;-
<span class="st">  </span><span class="kw">make_data_for_an_alternative_fiture</span>(<span class="dt">action   =</span> <span class="dv">0</span>, 
                                      <span class="dt">contact  =</span> <span class="dv">0</span>, 
                                      <span class="dt">max_iter =</span> <span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> intention, <span class="dt">y =</span> mean_rating, <span class="dt">group =</span> iter)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>, <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;intention&quot;</span>, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;response&quot;</span>, <span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;action = 0,</span><span class="ch">\n</span><span class="st">contact = 0&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>),
        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)

<span class="co"># alternative to Figure 11.3.b</span>
p2 &lt;-
<span class="st">  </span><span class="kw">make_data_for_an_alternative_fiture</span>(<span class="dt">action   =</span> <span class="dv">1</span>, 
                                      <span class="dt">contact  =</span> <span class="dv">0</span>, 
                                      <span class="dt">max_iter =</span> <span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> intention, <span class="dt">y =</span> mean_rating, <span class="dt">group =</span> iter)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>, <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;intention&quot;</span>, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;response&quot;</span>, <span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;action = 1,</span><span class="ch">\n</span><span class="st">contact = 0&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>),
        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)

<span class="co"># alternative to Figure 11.3.c</span>
p3 &lt;-
<span class="st">  </span><span class="kw">make_data_for_an_alternative_fiture</span>(<span class="dt">action   =</span> <span class="dv">0</span>, 
                                      <span class="dt">contact  =</span> <span class="dv">1</span>, 
                                      <span class="dt">max_iter =</span> <span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> intention, <span class="dt">y =</span> mean_rating, <span class="dt">group =</span> iter)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>, <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;intention&quot;</span>, <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;response&quot;</span>, <span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;action = 0,</span><span class="ch">\n</span><span class="st">contact = 1&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>),
        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)

<span class="kw">grid.arrange</span>(p1, p2, p3, <span class="dt">ncol =</span> <span class="dv">3</span>)</code></pre></div>
<p><img src="11_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Finally; now those are plots I can sell in a clinical psychology journal!</p>
</div>
</div>
<div id="zero-inflated-outcomes" class="section level2">
<h2><span class="header-section-number">11.2</span> Zero-inflated outcomes</h2>
<blockquote>
<p>Very often, the things we can measure are not emissions from any pure process. Instead, they are <em>mixtures</em> of multiple processes. Whenever there are different causes for the same observation, then a mixture model may be useful. A mixture model uses more than one simple probability distribution to model a mixture of causes. In effect, these models use more than one likelihood for the same outcome variable.</p>
<p>Count variables are especially prone to needing a mixture treatment. The reason is that a count of zero can often arise more than one way. A “zero” means that nothing happened, and nothing can happen either because the rate of events is low or rather because the process that generates events failed to get started. (p. 342, <em>emphasis</em> in the original)</p>
</blockquote>
<p>In his <strong>Rethinking: Breaking the law</strong> box, McElreath discussed how advances in computing have made it possible for working scientists to define their own data generating models. If you’d like to dive deeper into the topic, check out Bürkner’s vignette, <a href="https://cran.r-project.org/web/packages/brms/vignettes/brms_customfamilies.html"><em>Define Custom Response Distributions with brms</em></a>. We’ll even make use of it a little further down.</p>
<div id="example-zero-inflated-poisson." class="section level3">
<h3><span class="header-section-number">11.2.1</span> Example: Zero-inflated Poisson.</h3>
<p>Here we simulate our drunk monk data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># define parameters</span>
prob_drink &lt;-<span class="st"> </span><span class="fl">0.2</span>  <span class="co"># 20% of days</span>
rate_work  &lt;-<span class="st"> </span><span class="dv">1</span>    <span class="co"># average 1 manuscript per day</span>

<span class="co"># sample one year of production</span>
n &lt;-<span class="st"> </span><span class="dv">365</span>

<span class="co"># simulate days monks drink</span>
<span class="kw">set.seed</span>(<span class="dv">11</span>)
drink &lt;-<span class="st"> </span><span class="kw">rbinom</span>(n, <span class="dv">1</span>, prob_drink)

<span class="co"># simulate manuscripts completed</span>
y &lt;-<span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>drink) <span class="op">*</span><span class="st"> </span><span class="kw">rpois</span>(n, rate_work)</code></pre></div>
<p>We’ll put those data in a tidy tibble before plotting.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-
<span class="st">  </span><span class="kw">tibble</span>(<span class="dt">Y =</span> y) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(Y) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">zeros =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;zeros_drink&quot;</span>, <span class="dt">times =</span> <span class="kw">sum</span>(drink)),
                   <span class="kw">rep</span>(<span class="st">&quot;zeros_work&quot;</span>,  <span class="dt">times =</span> <span class="kw">sum</span>(y <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>drink <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)),
                   <span class="kw">rep</span>(<span class="st">&quot;nope&quot;</span>,        <span class="dt">times =</span> n <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(y <span class="op">==</span><span class="st"> </span><span class="dv">0</span>))
                   )) 
  
  <span class="kw">ggplot</span>(<span class="dt">data =</span> d, <span class="kw">aes</span>(<span class="dt">x =</span> Y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> zeros),
                 <span class="dt">binwidth =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>, <span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>], 
                               <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>], 
                               <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>])) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Manuscripts completed&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>),
        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</code></pre></div>
<p><img src="11_files/figure-html/unnamed-chunk-29-1.png" width="480" /></p>
<p>With these data, the likelihood of observing zero on <code>y</code>, (i.e., the likelihood zero manuscripts were completed on a given occasion) is</p>
<span class="math display">\[\begin{align*}
\text{Pr} (0 | p, \lambda) &amp; = \text{Pr} (\text{drink} | p) + \text{Pr} (\text{work} | p) \times \text{Pr} (0 | \lambda) \\
                           &amp; = p + (1 - p) \text{ exp} (- \lambda)
\end{align*}\]</span>
<p>And</p>
<blockquote>
<p>since the Poisson likelihood of <span class="math inline">\(y\)</span> is <span class="math inline">\(\text{Pr} (y | \lambda) = \lambda^y \text{exp} (- \lambda) / y!\)</span>, the likelihood of <span class="math inline">\(y = 0\)</span> is just <span class="math inline">\(\text{exp} (- \lambda)\)</span>. The above is just the mathematics for:</p>
<blockquote>
<p><em>The probability of observing a zero is the probability that the monks didn’t drink OR (<span class="math inline">\(+\)</span>) the probability that the monks worked AND (<span class="math inline">\(\times\)</span>) failed to finish anything</em>.</p>
</blockquote>
<p>And the likelihood of a non-zero value <span class="math inline">\(y\)</span> is:</p>
<span class="math display">\[\begin{align*}
\text{Pr} (y | p, \lambda) &amp; = \text{Pr} (\text{drink} | p) (0) + \text{Pr} (\text{work} | p) \text{Pr} (y | \lambda) \\
                           &amp; = (1 - p) \frac {\lambda^y \text{ exp} (- \lambda)}{y!}
\end{align*}\]</span>
<p>Since drinking monks never produce <span class="math inline">\(y &gt; 0\)</span>, the expression above is just the chance the monks both work <span class="math inline">\(1 - p\)</span>, and finish <span class="math inline">\(y\)</span> manuscripts. (p. 344, <em>emphasis</em> in the original)</p>
</blockquote>
<p>So letting <span class="math inline">\(p\)</span> be the probability <span class="math inline">\(y\)</span> is zero and <span class="math inline">\(\lambda\)</span> be the shape of the distribution, the zero-inflated Poisson (ZIPoisson) regression model takes the basic form</p>
<span class="math display">\[\begin{align*}
y_i &amp; \sim \text{ZIPoisson} (p_i, \lambda_i)\\
\text{logit} (p_i)     &amp; = \alpha_p + \beta_p x_i \\
\text{log} (\lambda_i) &amp; = \alpha_\lambda + \beta_\lambda x_i
\end{align*}\]</span>
<p>One last thing to note is that in brms, <span class="math inline">\(p_i\)</span> is denoted <code>zi</code>. So the intercept [and zi] only zero-inflated Poisson model in brms looks like this.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b11.<span class="dv">4</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> zero_inflated_poisson,
      Y <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">beta</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">class =</span> zi)),  <span class="co"># the brms default is beta(1, 1)</span>
      <span class="dt">cores =</span> <span class="dv">4</span>,
      <span class="dt">seed =</span> <span class="dv">11</span>) </code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b11.<span class="dv">4</span>)</code></pre></div>
<pre><code>##  Family: zero_inflated_poisson 
##   Links: mu = log; zi = identity 
## Formula: Y ~ 1 
##    Data: d (Number of observations: 365) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept     0.10      0.08    -0.08     0.26       1179 1.00
## 
## Family Specific Parameters: 
##    Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## zi     0.24      0.05     0.13     0.33       1354 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>The zero-inflated Poisson is <a href="https://cran.r-project.org/web/packages/brms/vignettes/brms_families.html#zero-inflated-and-hurdle-models">parameterized in brms</a> a little differently than it is in rethinking. The different parameterization did not influence the estimate for the Intercept, <span class="math inline">\(\lambda\)</span>. In both here and in the text, <span class="math inline">\(\lambda\)</span> was about zero. However, it did influence the summary of <code>zi</code>. Note how McElreath’s <code>logistic(-1.39)</code> yielded 0.1994078. Seems rather close to our <code>zi</code> estimate of 0.235. First off, because he didn’t set his seed in the text before simulating, we couldn’t exactly reproduce his simulated drunk monk data. So our results will vary a little due to that alone. But after accounting for simulation variance, hopefully it’s clear that <code>zi</code> in brms is already in the probability metric. There’s no need to convert it.</p>
<p>In the <code>prior</code> argument, we used <code>beta(2, 2)</code> for <code>zi</code> and also mentioned in the margin that the brms default is <code>beta(1, 1)</code>. To give you a sense of the priors, let’s plot them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(<span class="st">`</span><span class="dt">zi prior</span><span class="st">`</span>=<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">length.out =</span> <span class="dv">50</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">beta(1, 1)</span><span class="st">`</span> =<span class="st"> </span><span class="kw">dbeta</span>(<span class="st">`</span><span class="dt">zi prior</span><span class="st">`</span>, <span class="dv">1</span>, <span class="dv">1</span>),
         <span class="st">`</span><span class="dt">beta(2, 2)</span><span class="st">`</span> =<span class="st"> </span><span class="kw">dbeta</span>(<span class="st">`</span><span class="dt">zi prior</span><span class="st">`</span>, <span class="dv">2</span>, <span class="dv">2</span>))  <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(prior, density, <span class="op">-</span><span class="st">`</span><span class="dt">zi prior</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x    =</span> <span class="st">`</span><span class="dt">zi prior</span><span class="st">`</span>, 
             <span class="dt">ymin =</span> <span class="dv">0</span>,
             <span class="dt">ymax =</span> density)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> prior)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],
                               <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>])) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;prior for zi&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>),
        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>prior)</code></pre></div>
<p><img src="11_files/figure-html/unnamed-chunk-31-1.png" width="576" /></p>
<p>Hopefully this clarifies that the brms default is flat, whereas our prior regularized a bit toward .5. Anyway, here’s that exponentiated <span class="math inline">\(\lambda\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fixef</span>(b11.<span class="dv">4</span>)[<span class="dv">1</span>, ] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">exp</span>()</code></pre></div>
<pre><code>##  Estimate Est.Error      Q2.5     Q97.5 
## 1.0998806 1.0881350 0.9271772 1.2984891</code></pre>
<div id="overthinking-zero-inflated-poisson-distribution-function." class="section level4">
<h4><span class="header-section-number">11.2.1.1</span> Overthinking: Zero-inflated Poisson distribution function.</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dzip &lt;-<span class="st"> </span><span class="cf">function</span>(x, p, lambda, <span class="dt">log =</span> <span class="ot">TRUE</span>) {
    ll &lt;-<span class="st"> </span><span class="kw">ifelse</span>(
        x <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,
        p <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p) <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>lambda),
        (<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p) <span class="op">*</span><span class="st"> </span><span class="kw">dpois</span>(x, lambda, <span class="dt">log =</span> <span class="ot">FALSE</span>)
    )
    <span class="cf">if</span> (log <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) ll &lt;-<span class="st"> </span><span class="kw">log</span>(ll)
    <span class="kw">return</span>(ll)
}</code></pre></div>
<p>We can use McElreath’s <code>dzip()</code> to do a posterior predictive check for our model. To work with our estimates for <span class="math inline">\(p\)</span> and <span class="math inline">\(\lambda\)</span> directly, we’ll set <code>log = F</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p_b11.<span class="dv">4</span>      &lt;-<span class="st"> </span><span class="kw">posterior_summary</span>(b11.<span class="dv">4</span>)[<span class="dv">2</span>, <span class="dv">1</span>]
lambda_b11.<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">posterior_summary</span>(b11.<span class="dv">4</span>)[<span class="dv">1</span>, <span class="dv">1</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">exp</span>()

<span class="kw">tibble</span>(<span class="dt">x =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">density =</span> <span class="kw">dzip</span>(<span class="dt">x =</span> x, 
                        <span class="dt">p =</span> p_b11.<span class="dv">4</span>, 
                        <span class="dt">lambda =</span> lambda_b11.<span class="dv">4</span>, 
                        <span class="dt">log =</span> F)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> density)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Manuscripts completed&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>))</code></pre></div>
<p><img src="11_files/figure-html/unnamed-chunk-34-1.png" width="480" /></p>
<p>If you look up to the histogram we made at the beginning of this section, you’ll see this isn’t a terrible approximation.</p>
</div>
</div>
</div>
<div id="over-dispersed-outcomes" class="section level2">
<h2><span class="header-section-number">11.3</span> Over-dispersed outcomes</h2>
<blockquote>
<p>All statistical models omit something. The question is only whether that something is necessary for making useful inferences. One symptom that something important has been omitted from a count model is over-dispersion. The variance of a variable is sometimes called its <em>dispersion</em>. For a counting process like a binomial, the variance is a function of the same parameters as the expected value. For example, the expected value of a binomial is <span class="math inline">\(np\)</span> and its variance is <span class="math inline">\(np (1 - p)\)</span>. When the observed variance exceeds this amount—after conditioning on all the predictor variables—this implies that some omitted variable is producing additional dispersion in the observed counts.</p>
<p>What could go wrong, if we ignore the over-dispersion? Ignoring it can lead to all of the same problems as ignoring any predictor variable. Heterogeneity in counts can be a confound, hiding effects of interest or producing spurious inferences. (p, 346, <em>emphasis</em> in the original)</p>
</blockquote>
<p>In this chapter we’ll cope with the problem using continuous mixture models—first the beta-binomial and then the gamma-Poisson (a.k.a. negative binomial).</p>
<div id="beta-binomial." class="section level3">
<h3><span class="header-section-number">11.3.1</span> Beta-binomial.</h3>
<blockquote>
<p>A beta-binomial model assumes that each binomial count observation has its own probability of success. The model estimates the <em>distribution</em> of probabilities of success across cases, instead of a single probability of success. And predictor variables change the shape of this distribution, instead of directly determining the probability of each success. (p, 347, <em>emphasis</em> in the original)</p>
</blockquote>
<p>Unfortunately, we need to digress. As it turns out, there are multiple ways to parameterize the beta distribution and we’ve run square into two. In the text, McElreath wrote the beta distribution has two parameters, an average probability <span class="math inline">\(\overline{p}\)</span> and a shape parameter <span class="math inline">\(\theta\)</span>. In his R code 11.24, which we’ll reproduce in a bit, he demonstrated that parameterization with the <code>rethinking::dbeta2()</code> function. The nice thing about this parameterization is how intuitive the <code>pbar</code> parameter is. If you want a beta with an average of .2, you set <code>pbar &lt;- .2</code>. If you want the distribution to be more or less certain, make the <code>theta</code> argument more or less large, respectively.</p>
<p>However, the beta density is typically defined in terms of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>. If you denote the data as <span class="math inline">\(y\)</span>, this follows the form</p>
<p><span class="math display">\[\text{Beta} (y | \alpha, \beta) = \frac{y^{\alpha - 1} (1 - y)^{\beta - 1}}{\text B (\alpha, \beta)}\]</span></p>
<p>which you can verify in the <em>Continuous Distributions on [0, 1]</em> section of the <a href="https://mc-stan.org/docs/2_18/functions-reference/beta-distribution.html">Stan Functions Reference</a>. In the formula, <span class="math inline">\(\text B\)</span> stands for the Beta function, which computes a normalizing constant, which you can learn about in the <em>Mathematical Functions</em> of the Stan reference manual. This is all important to be aware of because when we defined that beta prior for <code>zi</code> in the last model, it was using this parameterization. Also, if you look at the base R <code>dbeta()</code> function, you’ll learn it takes two parameters, <code>shape1</code> and <code>shape2</code>. Those uncreatively-named parameters are the same <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> from the density, above. They do not correspond to the <code>pbar</code> and <code>theta</code> parameters of McEreath’s <code>rethinking::dbeta2()</code>.</p>
<p>McElreath had good reason for using <code>dbeta2()</code>. Beta’s typical <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> parameters aren’t the most intuitive to use; the parameters in McElreath’s <code>dbeta2()</code> are much nicer. But if you’re willing to dive deeper, it turns out you can find the mean of a beta distribution in terms of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> like this</p>
<p><span class="math display">\[\mu = \frac{\alpha}{\alpha + \beta}\]</span></p>
<p>We can talk about the spread of the distribution, sometimes called <span class="math inline">\(\kappa\)</span>, in terms <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> like this</p>
<p><span class="math display">\[\kappa = \alpha + \beta\]</span></p>
<p>With <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\kappa\)</span> in hand, we can even find the <span class="math inline">\(SD\)</span> of a beta distribution with</p>
<p><span class="math display">\[\sigma = \sqrt{\mu (1 - \mu) / (\kappa + 1)}\]</span></p>
<p>I explicate all this because McElreath’s <code>pbar</code> is <span class="math inline">\(\mu = \frac{\alpha}{\alpha + \beta}\)</span> and his <code>theta</code> is <span class="math inline">\(\kappa = \alpha + \beta\)</span>. This is great news because it means that we can understand what McElreath did with his <code>beta2()</code> function in terms of base R’s <code>dbeta()</code> function. Which also means that we can understand the distribution of the beta parameters used in <code>brms::brm()</code>. To demonstrate, let’s walk through McElreath’s R code 11.25.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pbar  &lt;-<span class="st"> </span><span class="fl">0.5</span>
theta &lt;-<span class="st"> </span><span class="dv">5</span>

<span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">by =</span> .<span class="dv">01</span>))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x    =</span> x, 
                  <span class="dt">ymin =</span> <span class="dv">0</span>, 
                  <span class="dt">ymax =</span> rethinking<span class="op">::</span><span class="kw">dbeta2</span>(x, pbar, theta)),
              <span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;probability space&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;The &quot;</span>, beta, <span class="st">&quot; distribution&quot;</span>)),
          <span class="dt">subtitle =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Defined in terms of &quot;</span>, mu, <span class="st">&quot; (i.e., pbar) and &quot;</span>, kappa, <span class="st">&quot; (i.e., theta)&quot;</span>))) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>))</code></pre></div>
<p><img src="11_files/figure-html/unnamed-chunk-35-1.png" width="384" /></p>
<p>In his 2014 text, <a href="https://sites.google.com/site/doingbayesiandataanalysis/"><em>Doing Bayesian Data Analysis</em></a>, Kruschke provided code for a convenience function that will take <code>pbar</code> and <code>theta</code> as inputs and return the corresponding <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> values. Here’s the function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">betaABfromMeanKappa &lt;-<span class="st"> </span><span class="cf">function</span>(mean, kappa) {
  <span class="cf">if</span> (mean <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>mean <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1</span>) <span class="kw">stop</span>(<span class="st">&quot;must have 0 &lt; mean &lt; 1&quot;</span>)
  <span class="cf">if</span> (kappa <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="kw">stop</span>(<span class="st">&quot;kappa must be &gt; 0&quot;</span>)
  a &lt;-<span class="st"> </span>mean <span class="op">*</span><span class="st"> </span>kappa
  b &lt;-<span class="st"> </span>(<span class="fl">1.0</span> <span class="op">-</span><span class="st"> </span>mean) <span class="op">*</span><span class="st"> </span>kappa
  <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">a =</span> a, <span class="dt">b =</span> b))
}</code></pre></div>
<p>Now we can use Kruschke’s <code>betaABfromMeanKappa()</code> to find the <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> values corresponding to <code>pbar</code> and <code>theta</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">betaABfromMeanKappa</span>(<span class="dt">mean =</span> pbar, <span class="dt">kappa =</span> theta)</code></pre></div>
<pre><code>## $a
## [1] 2.5
## 
## $b
## [1] 2.5</code></pre>
<p>And finally, we can double check that all of this works. Here’s the same distribution but defined in terms of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">by =</span> .<span class="dv">01</span>))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x    =</span> x, 
                  <span class="dt">ymin =</span> <span class="dv">0</span>, 
                  <span class="dt">ymax =</span> <span class="kw">dbeta</span>(x, <span class="fl">2.5</span>, <span class="fl">2.5</span>)),
              <span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;probability space&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;The &quot;</span>, beta, <span class="st">&quot; distribution&quot;</span>)),
          <span class="dt">subtitle =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;This time defined in terms of &quot;</span>, alpha, <span class="st">&quot; and &quot;</span>, beta))) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>))</code></pre></div>
<p><img src="11_files/figure-html/unnamed-chunk-38-1.png" width="384" /></p>
<p>McElreath encouraged us to “explore different values for <code>pbar</code> and <code>theta</code>” (p. 348). Here’s a grid of plots with <code>pbar = c(.25, .5, .75)</code> and <code>theta = c(5, 10, 15)</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># data</span>
<span class="kw">tibble</span>(<span class="dt">pbar =</span> <span class="kw">c</span>(.<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">expand</span>(pbar, <span class="dt">theta =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">15</span>, <span class="dv">30</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(pbar, theta), <span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">length.out =</span> <span class="dv">100</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">density =</span> rethinking<span class="op">::</span><span class="kw">dbeta2</span>(x, pbar, theta),
         <span class="dt">mu      =</span> <span class="kw">str_c</span>(<span class="st">&quot;mu == &quot;</span>, pbar <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_remove</span>(., <span class="st">&quot;0&quot;</span>)),
         <span class="dt">kappa   =</span> <span class="kw">str_c</span>(<span class="st">&quot;kappa == &quot;</span>, theta)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">kappa =</span> <span class="kw">factor</span>(kappa, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;kappa == 30&quot;</span>, <span class="st">&quot;kappa == 15&quot;</span>, <span class="st">&quot;kappa == 5&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="co"># plot</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x    =</span> x, 
                  <span class="dt">ymin =</span> <span class="dv">0</span>, 
                  <span class="dt">ymax =</span> density),
              <span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;probability space&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">labels =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>),
        <span class="dt">axis.ticks.y    =</span> <span class="kw">element_blank</span>()) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(kappa <span class="op">~</span><span class="st"> </span>mu, <span class="dt">labeller =</span> label_parsed)</code></pre></div>
<p><img src="11_files/figure-html/unnamed-chunk-39-1.png" width="480" /></p>
<p>If you’d like to see how to make a similar plot in terms of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>, see <a href="https://github.com/ASKurz/Doing-Bayesian-Data-Analysis-in-brms-and-the-tidyverse/blob/master/06.md">the chapter 6 document</a> of my project <a href="https://github.com/ASKurz/Doing-Bayesian-Data-Analysis-in-brms-and-the-tidyverse">recoding Kruschke’s text into tidyverse and brms code</a>.</p>
<p>But remember, we’re not fitting a beta model. We’re using the beta-binomial. “We’re going to bind our linear model to <span class="math inline">\(\overline p\)</span>, so that changes in predictor variables change the central tendency of the distribution” (p. 348). The statistical model we’ll be fitting follows the form</p>
<span class="math display">\[\begin{align*}
\text{admit}_i &amp; \sim \text{BetaBinomial} (n_i, \overline p_i, \theta)\\
\text{logit} (\overline p_i) &amp; = \alpha \\
\alpha                       &amp; \sim \text{Normal} (0, 2) \\
\theta                       &amp; \sim \text{Exponential} (1)
\end{align*}\]</span>
<p>Here the size <span class="math inline">\(n = \text{applications}\)</span>. In case you’re confused, yes, our statistical model is not the one McElreath presented at the top of page 348 in the text. If you look closely, the statistical formula he presented does not match up with the one implied by his R code 11.26. Our statistical formula and the <code>brm()</code> model we’ll be fitting, below, correspond to his R code 11.26.</p>
<p>Before we fit, we have an additional complication. The beta-binomial distribution is <a href="https://github.com/paul-buerkner/brms/issues/144">not implemented in brms at this time</a>. However, brms versions 2.2.0 and above allow users to define custom distributions. You can find the handy <a href="https://cran.r-project.org/web/packages/brms/vignettes/brms_customfamilies.html">vignette here</a>. Happily, Bürkner even used the <a href="https://cran.r-project.org/web/packages/brms/vignettes/brms_customfamilies.html#the-beta-binomial-distribution">beta-binomial distribution as the exemplar</a> in the vignette.</p>
<p>Before we get carried away, let’s load the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rethinking)
<span class="kw">data</span>(UCBadmit)
d &lt;-<span class="st"> </span>UCBadmit</code></pre></div>
<p>Unload rethinking and load brms.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rm</span>(UCBadmit)
<span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)
<span class="kw">library</span>(brms)</code></pre></div>
<p>I’m not going to go into great detail explaining the ins and outs of making custom distributions for <code>brm()</code>. You’ve got Bürkner’s vignette for that. For our purposes, we need two preparatory steps. First, we need to use the <code>custom_family()</code> function to define the name and parameters of the beta-binomial distribution for use in <code>brm()</code>. Second, we have to define some functions for Stan which are not defined in Stan itself. We’ll save them as <code>stan_funs</code>. Third, we’ll make a <code>stanvar()</code> statement which will allow us to pass our <code>stan_funs</code> to <code>brm()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">beta_binomial2 &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">custom_family</span>(
    <span class="st">&quot;beta_binomial2&quot;</span>, <span class="dt">dpars =</span> <span class="kw">c</span>(<span class="st">&quot;mu&quot;</span>, <span class="st">&quot;phi&quot;</span>),
    <span class="dt">links =</span> <span class="kw">c</span>(<span class="st">&quot;logit&quot;</span>, <span class="st">&quot;log&quot;</span>), <span class="dt">lb =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="dv">0</span>),
    <span class="dt">type =</span> <span class="st">&quot;int&quot;</span>, <span class="dt">vars =</span> <span class="st">&quot;trials[n]&quot;</span>
  )

stan_funs &lt;-<span class="st"> &quot;</span>
<span class="st">  real beta_binomial2_lpmf(int y, real mu, real phi, int T) {</span>
<span class="st">    return beta_binomial_lpmf(y | T, mu * phi, (1 - mu) * phi);</span>
<span class="st">  }</span>
<span class="st">  int beta_binomial2_rng(real mu, real phi, int T) {</span>
<span class="st">    return beta_binomial_rng(T, mu * phi, (1 - mu) * phi);</span>
<span class="st">  }</span>
<span class="st">&quot;</span>

stanvars &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">stanvar</span>(<span class="dt">scode =</span> stan_funs, <span class="dt">block =</span> <span class="st">&quot;functions&quot;</span>)</code></pre></div>
<p>With that out of the way, we’re almost ready to test this baby out. Before we do, a point of clarification: What McElreath referred to as the shape parameter, <span class="math inline">\(\theta\)</span>, Bürkner called the precision parameter, <span class="math inline">\(\phi\)</span>. In our exposition, above, we followed Kruschke’s convention and called it <span class="math inline">\(\kappa\)</span>. These are all the same thing: <span class="math inline">\(\theta\)</span>, <span class="math inline">\(\phi\)</span>, and <span class="math inline">\(\kappa\)</span> are all the same thing. Perhaps less confusingly, what McElreath called the <code>pbar</code> parameter, <span class="math inline">\(\bar{p}\)</span>, Bürkner simply called <span class="math inline">\(\mu\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b11.<span class="dv">5</span> &lt;-
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, 
      <span class="dt">family =</span> beta_binomial2,  <span class="co"># here&#39;s our custom likelihood</span>
      admit <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(applications) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">exponential</span>(<span class="dv">1</span>), <span class="dt">class =</span> phi)),
      <span class="dt">iter =</span> <span class="dv">4000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">cores =</span> <span class="dv">2</span>, <span class="dt">chains =</span> <span class="dv">2</span>,
      <span class="dt">stanvars =</span> stanvars,  <span class="co"># note our `stanvars`</span>
      <span class="dt">seed =</span> <span class="dv">11</span>)</code></pre></div>
<p>Success, our results look a lot like those in the text!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b11.<span class="dv">5</span>)</code></pre></div>
<pre><code>##  Family: beta_binomial2 
##   Links: mu = logit; phi = identity 
## Formula: admit | trials(applications) ~ 1 
##    Data: d (Number of observations: 12) 
## Samples: 2 chains, each with iter = 4000; warmup = 1000; thin = 1;
##          total post-warmup samples = 6000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept    -0.38      0.31    -0.99     0.24       4058 1.00
## 
## Family Specific Parameters: 
##     Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## phi     2.77      0.95     1.29     4.97       3663 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Here’s what the corresponding <code>posterior_samples()</code> data object looks like.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(b11.<span class="dv">5</span>)

<span class="kw">head</span>(post)</code></pre></div>
<pre><code>##   b_Intercept      phi      lp__
## 1 -0.48894704 3.660582 -70.37537
## 2  0.04534325 4.072111 -72.44047
## 3 -0.57268470 2.827876 -70.24965
## 4 -0.07413730 1.750735 -71.15664
## 5 -0.52303155 3.324634 -70.24396
## 6 -0.27625574 2.279246 -70.24819</code></pre>
<p>Here’s our median and percentile-based 95% interval.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">post <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>tidybayes<span class="op">::</span><span class="kw">median_qi</span>(<span class="kw">inv_logit_scaled</span>(b_Intercept)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">3</span>)</code></pre></div>
<pre><code>##   inv_logit_scaled(b_Intercept) .lower .upper .width .point .interval
## 1                         0.406  0.271  0.559   0.95 median        qi</code></pre>
<p>To stay within the tidyverse while making the many thin lines in Figure 11.5.a, we’re going to need to do a bit of data processing. First, we’ll want a variable to index the rows in <code>post</code> (i.e., to index the posterior draws). And we’ll want to convert the <code>b_Intercept</code> to the <span class="math inline">\(\bar{p}\)</span> metric with the <code>inv_logit_scaled()</code> function. Then we’ll use <code>sample_n()</code> to randomly draw a subset of the posterior draws. Then with the <code>expand()</code> function, we’ll insert a tightly-spaced sequence of <code>x</code> values ranging between 0 and 1–the parameter space of beta distribution. Finally, we’ll use <code>pmap_dbl()</code> to compute the density values for the <code>rethinking::dbeta2</code> distribution corresponding to the unique combination of <code>x</code>, <code>p_bar</code>, and <code>phi</code> values in each row.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">11</span>)

lines &lt;-
<span class="st">  </span>post <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">iter  =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>(),
         <span class="dt">p_bar =</span> <span class="kw">inv_logit_scaled</span>(b_Intercept)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">expand</span>(<span class="kw">nesting</span>(iter, p_bar, phi),
         <span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">1</span>, <span class="dt">by =</span> .<span class="dv">005</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">density =</span> <span class="kw">pmap_dbl</span>(<span class="kw">list</span>(x, p_bar, phi), rethinking<span class="op">::</span>dbeta2))

<span class="kw">str</span>(lines)</code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    20100 obs. of  5 variables:
##  $ iter   : int  4 4 4 4 4 4 4 4 4 4 ...
##  $ p_bar  : num  0.481 0.481 0.481 0.481 0.481 ...
##  $ phi    : num  1.75 1.75 1.75 1.75 1.75 ...
##  $ x      : num  0 0.005 0.01 0.015 0.02 0.025 0.03 0.035 0.04 0.045 ...
##  $ density: num  Inf 1.78 1.59 1.5 1.43 ...</code></pre>
<p>All that was just for the thin lines. To make the thicker line for the posterior mean, we’ll get tricky with <code>stat_function()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lines <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> density)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> rethinking<span class="op">::</span>dbeta2,
                <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">prob  =</span> <span class="kw">mean</span>(<span class="kw">inv_logit_scaled</span>(post[, <span class="dv">1</span>])),
                            <span class="dt">theta =</span> <span class="kw">mean</span>(post[, <span class="dv">2</span>])),
                <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],
                <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> iter),
            <span class="dt">alpha =</span> .<span class="dv">2</span>, <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;probability admit&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>))</code></pre></div>
<p><img src="11_files/figure-html/unnamed-chunk-47-1.png" width="384" /></p>
<p>There are other ways to do this. For ideas, check out my blog post <a href="https://solomonkurz.netlify.com/post/make-rotated-gaussians-kruschke-style/"><em>Make rotated Gaussians, Kruschke style</em></a>.</p>
<p>Before we can do our variant of Figure 11.5.b, we’ll need to define a few more custom functions. The <code>log_lik_beta_binomial2()</code> and <code>predict_beta_binomial2()</code> functions are required for <code>brms::predict()</code> to work with our <code>family = beta_binomial2</code> brmfit object. Similarly, <code>fitted_beta_binomial2()</code> is required for <code>brms::fitted()</code> to work properly. And before all that, we need to throw in a line with the <code>expose_functions()</code> function. Just go with it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">expose_functions</span>(b11.<span class="dv">5</span>, <span class="dt">vectorize =</span> <span class="ot">TRUE</span>)

<span class="co"># required to use `predict()`</span>
log_lik_beta_binomial2 &lt;-<span class="st"> </span>
<span class="st">  </span><span class="cf">function</span>(i, draws) {
    mu  &lt;-<span class="st"> </span>draws<span class="op">$</span>dpars<span class="op">$</span>mu[, i]
    phi &lt;-<span class="st"> </span>draws<span class="op">$</span>dpars<span class="op">$</span>phi
    N   &lt;-<span class="st"> </span>draws<span class="op">$</span>data<span class="op">$</span>trials[i]
    y   &lt;-<span class="st"> </span>draws<span class="op">$</span>data<span class="op">$</span>Y[i]
    <span class="kw">beta_binomial2_lpmf</span>(y, mu, phi, N)
  }

predict_beta_binomial2 &lt;-<span class="st"> </span>
<span class="st">  </span><span class="cf">function</span>(i, draws, ...) {
    mu  &lt;-<span class="st"> </span>draws<span class="op">$</span>dpars<span class="op">$</span>mu[, i]
    phi &lt;-<span class="st"> </span>draws<span class="op">$</span>dpars<span class="op">$</span>phi
    N   &lt;-<span class="st"> </span>draws<span class="op">$</span>data<span class="op">$</span>trials[i]
    <span class="kw">beta_binomial2_rng</span>(mu, phi, N)
  }

<span class="co"># required to use `fitted()`</span>
fitted_beta_binomial2 &lt;-<span class="st"> </span>
<span class="st">  </span><span class="cf">function</span>(draws) {
    mu     &lt;-<span class="st"> </span>draws<span class="op">$</span>dpars<span class="op">$</span>mu
    trials &lt;-<span class="st"> </span>draws<span class="op">$</span>data<span class="op">$</span>trials
    trials &lt;-<span class="st"> </span><span class="kw">matrix</span>(trials, <span class="dt">nrow =</span> <span class="kw">nrow</span>(mu), <span class="dt">ncol =</span> <span class="kw">ncol</span>(mu), <span class="dt">byrow =</span> <span class="ot">TRUE</span>)
    mu <span class="op">*</span><span class="st"> </span>trials
  }</code></pre></div>
<p>With those intermediary steps out of the way, we’re ready to make Figure 11.5.b.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># the prediction intervals</span>
<span class="kw">predict</span>(b11.<span class="dv">5</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">transmute</span>(<span class="dt">ll =</span> Q2.<span class="dv">5</span>,
            <span class="dt">ul =</span> Q97.<span class="dv">5</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># the fitted intervals</span>
<span class="st">  </span><span class="kw">bind_cols</span>(
    <span class="kw">fitted</span>(b11.<span class="dv">5</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>()
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># Tte original data used to fit the model</span>
<span class="st">  </span><span class="kw">bind_cols</span>(b11.<span class="dv">5</span><span class="op">$</span>data) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">case =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="co"># plot</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> case)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_linerange</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> ll <span class="op">/</span><span class="st"> </span>applications, 
                     <span class="dt">ymax =</span> ul <span class="op">/</span><span class="st"> </span>applications),
                 <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">1</span>], 
                 <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2.<span class="dv">5</span>  <span class="op">/</span><span class="st"> </span>applications, 
                      <span class="dt">ymax =</span> Q97.<span class="dv">5</span> <span class="op">/</span><span class="st"> </span>applications, 
                      <span class="dt">y =</span> Estimate<span class="op">/</span>applications),
                  <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>],
                  <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">shape =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> admit<span class="op">/</span>applications),
             <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>],
             <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Posterior validation check&quot;</span>,
       <span class="dt">y        =</span> <span class="st">&quot;Admittance probability&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>),
        <span class="dt">axis.ticks.x    =</span> <span class="kw">element_blank</span>(),
        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</code></pre></div>
<p><img src="11_files/figure-html/unnamed-chunk-49-1.png" width="384" /></p>
<p>As in the text, the raw data are consistent with the prediction intervals. But those intervals are so incredibly wide, they’re hardly an endorsement of the model. Once we learn about hierarchical models, we’ll be able to do much better.</p>
</div>
<div id="negative-binomial-or-gamma-poisson." class="section level3">
<h3><span class="header-section-number">11.3.2</span> Negative-binomial or gamma-Poisson.</h3>
<p>Recall the Poisson distribution presumes <span class="math inline">\(\sigma^2\)</span> scales with <span class="math inline">\(\mu\)</span>. The negative binomial distribution relaxes this assumption and presumes “each Poisson count observation has its own rate. It estimates the shape of a gamma distribution to describe the Poisson rates across cases” (p. 350).</p>
<p>Here’s a look at the <span class="math inline">\(\gamma\)</span> distribution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mu    &lt;-<span class="st"> </span><span class="dv">3</span>
theta &lt;-<span class="st"> </span><span class="dv">1</span>

<span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">12</span>, <span class="dt">by =</span> .<span class="dv">01</span>)),
       <span class="kw">aes</span>(<span class="dt">x =</span> x)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> <span class="dv">0</span>, 
                  <span class="dt">ymax =</span> rethinking<span class="op">::</span><span class="kw">dgamma2</span>(x, mu, theta)),
              <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>, 
              <span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">4</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> mu, <span class="dt">linetype =</span> <span class="dv">3</span>,
             <span class="dt">color =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">3</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, mu, <span class="dv">10</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">10</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Our sweet &quot;</span>, gamma, <span class="st">&quot;(3, 1)&quot;</span>))) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>))</code></pre></div>
<p><img src="11_files/figure-html/unnamed-chunk-50-1.png" width="336" /></p>
<div id="bonus-lets-fit-a-negative-binomial-model." class="section level4">
<h4><span class="header-section-number">11.3.2.1</span> Bonus: Let’s fit a negative-binomial model.</h4>
<p>McElreath didn’t give an example of negative-binomial regression in the text. Here’s one with the <code>UCBadmit</code> data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> negbinomial,
    admit <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>applicant.gender,
    <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),
              <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b),
              <span class="kw">prior</span>(<span class="kw">gamma</span>(<span class="fl">0.01</span>, <span class="fl">0.01</span>), <span class="dt">class =</span> shape)),  <span class="co"># this is the brms default</span>
    <span class="dt">iter =</span> <span class="dv">4000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">cores =</span> <span class="dv">2</span>, <span class="dt">chains =</span> <span class="dv">2</span>,
    <span class="dt">seed =</span> <span class="dv">11</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">print</span>()</code></pre></div>
<pre><code>##  Family: negbinomial 
##   Links: mu = log; shape = identity 
## Formula: admit ~ 1 + applicant.gender 
##    Data: d (Number of observations: 12) 
## Samples: 2 chains, each with iter = 4000; warmup = 1000; thin = 1;
##          total post-warmup samples = 6000
## 
## Population-Level Effects: 
##                      Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept                4.70      0.40     3.99     5.58       4439 1.00
## applicant.gendermale     0.57      0.50    -0.43     1.52       4929 1.00
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## shape     1.23      0.48     0.50     2.36       4408 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Since the negative-binomial model uses the log link, you need to exponentiate to get the estimates back into the count metric. E.g.,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">exp</span>(<span class="fl">4.7</span>)</code></pre></div>
<pre><code>## [1] 109.9472</code></pre>
<p>Also, you may have noticed we used the brms default <code>prior(gamma(0.01, 0.01), class = shape)</code> for the shape parameter. Here’s what that prior looks like.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">60</span>, <span class="dt">by =</span> .<span class="dv">1</span>)),
       <span class="kw">aes</span>(<span class="dt">x =</span> x)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> <span class="dv">0</span>, 
                  <span class="dt">ymax =</span> <span class="kw">dgamma</span>(x, <span class="fl">0.01</span>, <span class="fl">0.01</span>)),
              <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>, 
              <span class="dt">fill =</span> <span class="kw">canva_pal</span>(<span class="st">&quot;Green fields&quot;</span>)(<span class="dv">4</span>)[<span class="dv">2</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">50</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Our brms default &quot;</span>, gamma, <span class="st">&quot;(0.01, 0.01) prior&quot;</span>))) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_hc</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;grey92&quot;</span>))</code></pre></div>
<p><img src="11_files/figure-html/unnamed-chunk-52-1.png" width="336" /></p>
</div>
</div>
<div id="over-dispersion-entropy-and-information-criteria." class="section level3">
<h3><span class="header-section-number">11.3.3</span> Over-dispersion, entropy, and information criteria.</h3>
<blockquote>
<p>Both the beta-binomial and the gamma-Poisson models are maximum entropy for the same constraints as the regular binomial and Poisson. They just try to account for unobserved heterogeneity in probabilities and rates. So while they can be a lot harder to fit to data, they can be usefully conceptualized much like ordinary binomial and Poisson GLMs. So in terms of model comparison using information criteria, a beta-binomial model is a binomial model, and a gamma-Poisson (negative-binomial) is a Poisson model. (pp. 350–351)</p>
</blockquote>
</div>
</div>
<div id="reference-10" class="section level2 unnumbered">
<h2>Reference</h2>
<p><a href="https://xcelab.net/rm/statistical-rethinking/">McElreath, R. (2016). <em>Statistical rethinking: A Bayesian course with examples in R and Stan.</em> Chapman &amp; Hall/CRC Press.</a></p>
</div>
<div id="session-info-10" class="section level2 unnumbered">
<h2>Session info</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sessionInfo</span>()</code></pre></div>
<pre><code>## R version 3.5.1 (2018-07-02)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS High Sierra 10.13.6
## 
## Matrix products: default
## BLAS: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] parallel  stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
##  [1] gridExtra_2.3        broom_0.5.1          ggthemes_4.0.1      
##  [4] forcats_0.3.0        stringr_1.4.0        dplyr_0.8.0.1       
##  [7] purrr_0.2.5          readr_1.1.1          tidyr_0.8.1         
## [10] tibble_2.1.1         tidyverse_1.2.1      brms_2.8.8          
## [13] Rcpp_1.0.1           rstan_2.18.2         StanHeaders_2.18.0-1
## [16] ggplot2_3.1.1       
## 
## loaded via a namespace (and not attached):
##  [1] nlme_3.1-137              matrixStats_0.54.0       
##  [3] xts_0.10-2                lubridate_1.7.4          
##  [5] threejs_0.3.1             httr_1.3.1               
##  [7] rprojroot_1.3-2           tools_3.5.1              
##  [9] backports_1.1.4           utf8_1.1.4               
## [11] R6_2.3.0                  DT_0.4                   
## [13] lazyeval_0.2.2            colorspace_1.3-2         
## [15] withr_2.1.2               tidyselect_0.2.5         
## [17] prettyunits_1.0.2         processx_3.2.1           
## [19] Brobdingnag_1.2-6         compiler_3.5.1           
## [21] rvest_0.3.2               cli_1.0.1                
## [23] arrayhelpers_1.0-20160527 xml2_1.2.0               
## [25] shinyjs_1.0               labeling_0.3             
## [27] colourpicker_1.0          bookdown_0.9             
## [29] scales_1.0.0              dygraphs_1.1.1.5         
## [31] mvtnorm_1.0-10            ggridges_0.5.0           
## [33] callr_3.1.0               digest_0.6.18            
## [35] rmarkdown_1.10            rethinking_1.80          
## [37] base64enc_0.1-3           pkgconfig_2.0.2          
## [39] htmltools_0.3.6           readxl_1.1.0             
## [41] htmlwidgets_1.2           rlang_0.3.4              
## [43] rstudioapi_0.7            shiny_1.1.0              
## [45] svUnit_0.7-12             generics_0.0.2           
## [47] zoo_1.8-2                 jsonlite_1.5             
## [49] crosstalk_1.0.0           gtools_3.8.1             
## [51] inline_0.3.15             magrittr_1.5             
## [53] loo_2.1.0                 bayesplot_1.6.0          
## [55] Matrix_1.2-14             fansi_0.4.0              
## [57] munsell_0.5.0             abind_1.4-5              
## [59] stringi_1.4.3             yaml_2.1.19              
## [61] MASS_7.3-50               ggstance_0.3             
## [63] pkgbuild_1.0.2            plyr_1.8.4               
## [65] grid_3.5.1                promises_1.0.1           
## [67] crayon_1.3.4              miniUI_0.1.1.1           
## [69] lattice_0.20-35           haven_1.1.2              
## [71] hms_0.4.2                 knitr_1.20               
## [73] ps_1.2.1                  pillar_1.3.1             
## [75] igraph_1.2.1              markdown_0.8             
## [77] shinystan_2.5.0           reshape2_1.4.3           
## [79] stats4_3.5.1              rstantools_1.5.1         
## [81] glue_1.3.1.9000           evaluate_0.10.1          
## [83] modelr_0.1.2              httpuv_1.4.4.2           
## [85] cellranger_1.1.0          gtable_0.3.0             
## [87] assertthat_0.2.0          xfun_0.3                 
## [89] mime_0.5                  xtable_1.8-2             
## [91] coda_0.19-2               later_0.7.3              
## [93] rsconnect_0.8.8           shinythemes_1.1.1        
## [95] tidybayes_1.0.4           bridgesampling_0.6-0</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="counting-and-classification.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="multilevel-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
