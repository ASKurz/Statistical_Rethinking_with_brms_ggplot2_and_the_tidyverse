<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>5 Multivariate Linear Models | Statistical Rethinking with brms, ggplot2, and the tidyverse</title>
  <meta name="description" content="This project is an attempt to re-express the code in McElreath’s textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="5 Multivariate Linear Models | Statistical Rethinking with brms, ggplot2, and the tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This project is an attempt to re-express the code in McElreath’s textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="github-repo" content="ASKURZ/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Multivariate Linear Models | Statistical Rethinking with brms, ggplot2, and the tidyverse" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This project is an attempt to re-express the code in McElreath’s textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  

<meta name="author" content="A Solomon Kurz">


<meta name="date" content="2019-05-05">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="linear-models.html">
<link rel="next" href="overfitting-regularization-and-information-criteria.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>This is a love letter</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-this"><i class="fa fa-check"></i>Why this?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#my-assumptions-about-you"><i class="fa fa-check"></i>My assumptions about you</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-use-and-understand-this-project"><i class="fa fa-check"></i>How to use and understand this project</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#you-can-do-this-too"><i class="fa fa-check"></i>You can do this, too</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#we-have-updates"><i class="fa fa-check"></i>We have updates</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague</a><ul>
<li class="chapter" data-level="" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html#reference"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a><ul>
<li class="chapter" data-level="2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#the-garden-of-forking-data"><i class="fa fa-check"></i><b>2.1</b> The garden of forking data</a><ul>
<li class="chapter" data-level="2.1.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#counting-possibilities."><i class="fa fa-check"></i><b>2.1.1</b> Counting possibilities.</a></li>
<li class="chapter" data-level="2.1.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#using-prior-information."><i class="fa fa-check"></i><b>2.1.2</b> Using prior information.</a></li>
<li class="chapter" data-level="2.1.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#from-counts-to-probability."><i class="fa fa-check"></i><b>2.1.3</b> From counts to probability.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#building-a-model"><i class="fa fa-check"></i><b>2.2</b> Building a model</a><ul>
<li class="chapter" data-level="2.2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-data-story."><i class="fa fa-check"></i><b>2.2.1</b> A data story.</a></li>
<li class="chapter" data-level="2.2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayesian-updating."><i class="fa fa-check"></i><b>2.2.2</b> Bayesian updating.</a></li>
<li class="chapter" data-level="2.2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#evaluate."><i class="fa fa-check"></i><b>2.2.3</b> Evaluate.</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#components-of-the-model"><i class="fa fa-check"></i><b>2.3</b> Components of the model</a><ul>
<li class="chapter" data-level="2.3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#likelihood."><i class="fa fa-check"></i><b>2.3.1</b> Likelihood.</a></li>
<li class="chapter" data-level="2.3.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#parameters."><i class="fa fa-check"></i><b>2.3.2</b> Parameters.</a></li>
<li class="chapter" data-level="2.3.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#prior."><i class="fa fa-check"></i><b>2.3.3</b> Prior.</a></li>
<li class="chapter" data-level="2.3.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#posterior."><i class="fa fa-check"></i><b>2.3.4</b> Posterior.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#making-the-model-go"><i class="fa fa-check"></i><b>2.4</b> Making the model go</a><ul>
<li class="chapter" data-level="2.4.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#grid-approximation."><i class="fa fa-check"></i><b>2.4.1</b> Grid approximation.</a></li>
<li class="chapter" data-level="2.4.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic-approximation."><i class="fa fa-check"></i><b>2.4.2</b> Quadratic approximation.</a></li>
<li class="chapter" data-level="2.4.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#markov-chain-monte-carlo."><i class="fa fa-check"></i><b>2.4.3</b> Markov chain Monte Carlo.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#reference-1"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a><ul>
<li class="chapter" data-level="3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-like-approximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-like approximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a><ul>
<li class="chapter" data-level="3.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-boundaries."><i class="fa fa-check"></i><b>3.2.1</b> Intervals of defined boundaries.</a></li>
<li class="chapter" data-level="3.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass."><i class="fa fa-check"></i><b>3.2.2</b> Intervals of defined mass.</a></li>
<li class="chapter" data-level="3.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimates."><i class="fa fa-check"></i><b>3.2.3</b> Point estimates.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a><ul>
<li class="chapter" data-level="3.3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#dummy-data."><i class="fa fa-check"></i><b>3.3.1</b> Dummy data.</a></li>
<li class="chapter" data-level="3.3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking."><i class="fa fa-check"></i><b>3.3.2</b> Model checking.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#summary-lets-practice-in-brms"><i class="fa fa-check"></i><b>3.4</b> <del>Summary</del> Let’s practice in brms</a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#reference-2"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="linear-models.html"><a href="linear-models.html"><i class="fa fa-check"></i><b>4</b> Linear Models</a><ul>
<li class="chapter" data-level="4.1" data-path="linear-models.html"><a href="linear-models.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why normal distributions are normal</a><ul>
<li class="chapter" data-level="4.1.1" data-path="linear-models.html"><a href="linear-models.html#normal-by-addition."><i class="fa fa-check"></i><b>4.1.1</b> Normal by addition.</a></li>
<li class="chapter" data-level="4.1.2" data-path="linear-models.html"><a href="linear-models.html#normal-by-multiplication."><i class="fa fa-check"></i><b>4.1.2</b> Normal by multiplication.</a></li>
<li class="chapter" data-level="4.1.3" data-path="linear-models.html"><a href="linear-models.html#normal-by-log-multiplication."><i class="fa fa-check"></i><b>4.1.3</b> Normal by log-multiplication.</a></li>
<li class="chapter" data-level="4.1.4" data-path="linear-models.html"><a href="linear-models.html#using-gaussian-distributions."><i class="fa fa-check"></i><b>4.1.4</b> Using Gaussian distributions.</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="linear-models.html"><a href="linear-models.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>4.2</b> A language for describing models</a><ul>
<li class="chapter" data-level="4.2.1" data-path="linear-models.html"><a href="linear-models.html#re-describing-the-globe-tossing-model."><i class="fa fa-check"></i><b>4.2.1</b> Re-describing the globe tossing model.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="linear-models.html"><a href="linear-models.html#a-gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> A Gaussian model of height</a><ul>
<li class="chapter" data-level="4.3.1" data-path="linear-models.html"><a href="linear-models.html#the-data."><i class="fa fa-check"></i><b>4.3.1</b> The data.</a></li>
<li class="chapter" data-level="4.3.2" data-path="linear-models.html"><a href="linear-models.html#the-model."><i class="fa fa-check"></i><b>4.3.2</b> The model.</a></li>
<li class="chapter" data-level="4.3.3" data-path="linear-models.html"><a href="linear-models.html#grid-approximation-of-the-posterior-distribution."><i class="fa fa-check"></i><b>4.3.3</b> Grid approximation of the posterior distribution.</a></li>
<li class="chapter" data-level="4.3.4" data-path="linear-models.html"><a href="linear-models.html#sampling-from-the-posterior."><i class="fa fa-check"></i><b>4.3.4</b> Sampling from the posterior.</a></li>
<li class="chapter" data-level="4.3.5" data-path="linear-models.html"><a href="linear-models.html#fitting-the-model-with-map-brm."><i class="fa fa-check"></i><b>4.3.5</b> Fitting the model with <del><code>map()</code></del> <code>brm()</code>.</a></li>
<li class="chapter" data-level="4.3.6" data-path="linear-models.html"><a href="linear-models.html#sampling-from-a-map-brm-fit."><i class="fa fa-check"></i><b>4.3.6</b> Sampling from a <del><code>map()</code></del> <code>brm()</code> fit.</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="linear-models.html"><a href="linear-models.html#adding-a-predictor"><i class="fa fa-check"></i><b>4.4</b> Adding a predictor</a><ul>
<li class="chapter" data-level="4.4.1" data-path="linear-models.html"><a href="linear-models.html#the-linear-model-strategy"><i class="fa fa-check"></i><b>4.4.1</b> The linear model strategy</a></li>
<li class="chapter" data-level="4.4.2" data-path="linear-models.html"><a href="linear-models.html#fitting-the-model."><i class="fa fa-check"></i><b>4.4.2</b> Fitting the model.</a></li>
<li class="chapter" data-level="4.4.3" data-path="linear-models.html"><a href="linear-models.html#interpreting-the-model-fit."><i class="fa fa-check"></i><b>4.4.3</b> Interpreting the model fit.</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="linear-models.html"><a href="linear-models.html#polynomial-regression"><i class="fa fa-check"></i><b>4.5</b> Polynomial regression</a></li>
<li class="chapter" data-level="" data-path="linear-models.html"><a href="linear-models.html#reference-3"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="linear-models.html"><a href="linear-models.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html"><i class="fa fa-check"></i><b>5</b> Multivariate Linear Models</a><ul>
<li class="chapter" data-level="5.1" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#spurious-associations"><i class="fa fa-check"></i><b>5.1</b> Spurious associations</a><ul>
<li class="chapter" data-level="5.1.1" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#multivariate-notation."><i class="fa fa-check"></i><b>5.1.1</b> Multivariate notation.</a></li>
<li class="chapter" data-level="5.1.2" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#fitting-the-model.-1"><i class="fa fa-check"></i><b>5.1.2</b> Fitting the model.</a></li>
<li class="chapter" data-level="5.1.3" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#plotting-multivariate-posteriors."><i class="fa fa-check"></i><b>5.1.3</b> Plotting multivariate posteriors.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#masked-relationship"><i class="fa fa-check"></i><b>5.2</b> Masked relationship</a></li>
<li class="chapter" data-level="5.3" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#multicollinearity"><i class="fa fa-check"></i><b>5.3</b> Multicollinearity</a><ul>
<li class="chapter" data-level="5.3.1" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#multicollinear-legs."><i class="fa fa-check"></i><b>5.3.1</b> Multicollinear legs.</a></li>
<li class="chapter" data-level="5.3.2" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#multicollinear-milk."><i class="fa fa-check"></i><b>5.3.2</b> Multicollinear <code>milk</code>.</a></li>
<li class="chapter" data-level="5.3.3" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#post-treatment-bias."><i class="fa fa-check"></i><b>5.3.3</b> Post-treatment bias.</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#categorical-variables"><i class="fa fa-check"></i><b>5.4</b> Categorical varaibles</a><ul>
<li class="chapter" data-level="5.4.1" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#binary-categories."><i class="fa fa-check"></i><b>5.4.1</b> Binary categories.</a></li>
<li class="chapter" data-level="5.4.2" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#many-categories."><i class="fa fa-check"></i><b>5.4.2</b> Many categories.</a></li>
<li class="chapter" data-level="5.4.3" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#adding-regular-predictor-variables."><i class="fa fa-check"></i><b>5.4.3</b> Adding regular predictor variables.</a></li>
<li class="chapter" data-level="5.4.4" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#another-approach-unique-intercepts."><i class="fa fa-check"></i><b>5.4.4</b> Another approach: Unique intercepts.</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#ordinary-least-squares-and-lm"><i class="fa fa-check"></i><b>5.5</b> <del>Ordinary least squares and <code>lm()</code></del></a></li>
<li class="chapter" data-level="" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#reference-4"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html"><i class="fa fa-check"></i><b>6</b> Overfitting, Regularization, and Information Criteria</a><ul>
<li class="chapter" data-level="6.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>6.1</b> The problem with parameters</a><ul>
<li class="chapter" data-level="6.1.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#more-parameters-always-improve-fit."><i class="fa fa-check"></i><b>6.1.1</b> More parameters always improve fit.</a></li>
<li class="chapter" data-level="6.1.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#too-few-parameters-hurts-too."><i class="fa fa-check"></i><b>6.1.2</b> Too few parameters hurts, too.</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#information-theory-and-model-performance"><i class="fa fa-check"></i><b>6.2</b> Information theory and model performance</a><ul>
<li class="chapter" data-level="6.2.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#firing-the-weatherperson."><i class="fa fa-check"></i><b>6.2.1</b> Firing the weatherperson.</a></li>
<li class="chapter" data-level="6.2.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#information-and-uncertainty."><i class="fa fa-check"></i><b>6.2.2</b> Information and uncertainty.</a></li>
<li class="chapter" data-level="6.2.3" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#from-entropy-to-accuracy."><i class="fa fa-check"></i><b>6.2.3</b> From entropy to accuracy.</a></li>
<li class="chapter" data-level="6.2.4" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#from-divergence-to-deviance."><i class="fa fa-check"></i><b>6.2.4</b> From divergence to deviance.</a></li>
<li class="chapter" data-level="6.2.5" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#from-deviance-to-out-of-sample."><i class="fa fa-check"></i><b>6.2.5</b> From deviance to out-of-sample.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#regularization"><i class="fa fa-check"></i><b>6.3</b> Regularization</a></li>
<li class="chapter" data-level="6.4" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#information-criteria"><i class="fa fa-check"></i><b>6.4</b> Information criteria</a><ul>
<li class="chapter" data-level="6.4.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#dic."><i class="fa fa-check"></i><b>6.4.1</b> DIC.</a></li>
<li class="chapter" data-level="6.4.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#waic."><i class="fa fa-check"></i><b>6.4.2</b> WAIC.</a></li>
<li class="chapter" data-level="6.4.3" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#dic-and-waic-as-estimates-of-deviance."><i class="fa fa-check"></i><b>6.4.3</b> DIC and WAIC as estimates of deviance.</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#using-information-criteria"><i class="fa fa-check"></i><b>6.5</b> Using information criteria</a><ul>
<li class="chapter" data-level="6.5.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#model-comparison."><i class="fa fa-check"></i><b>6.5.1</b> Model comparison.</a></li>
<li class="chapter" data-level="6.5.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#model-averaging."><i class="fa fa-check"></i><b>6.5.2</b> Model averaging.</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#summary-bonus-r2-talk"><i class="fa fa-check"></i><b>6.6</b> <del>Summary</del> Bonus: <span class="math inline">\(R^2\)</span> talk</a></li>
<li class="chapter" data-level="" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#reference-5"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="interactions.html"><a href="interactions.html"><i class="fa fa-check"></i><b>7</b> Interactions</a><ul>
<li class="chapter" data-level="7.1" data-path="interactions.html"><a href="interactions.html#building-an-interaction."><i class="fa fa-check"></i><b>7.1</b> Building an interaction.</a><ul>
<li class="chapter" data-level="7.1.1" data-path="interactions.html"><a href="interactions.html#adding-a-dummy-variable-doesnt-work."><i class="fa fa-check"></i><b>7.1.1</b> Adding a dummy variable doesn’t work.</a></li>
<li class="chapter" data-level="7.1.2" data-path="interactions.html"><a href="interactions.html#adding-a-linear-interaction-does-work."><i class="fa fa-check"></i><b>7.1.2</b> Adding a linear interaction does work.</a></li>
<li class="chapter" data-level="7.1.3" data-path="interactions.html"><a href="interactions.html#plotting-the-interaction."><i class="fa fa-check"></i><b>7.1.3</b> Plotting the interaction.</a></li>
<li class="chapter" data-level="7.1.4" data-path="interactions.html"><a href="interactions.html#interpreting-an-interaction-estimate."><i class="fa fa-check"></i><b>7.1.4</b> Interpreting an interaction estimate.</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="interactions.html"><a href="interactions.html#symmetry-of-the-linear-interaction."><i class="fa fa-check"></i><b>7.2</b> Symmetry of the linear interaction.</a><ul>
<li class="chapter" data-level="7.2.1" data-path="interactions.html"><a href="interactions.html#buridans-interaction."><i class="fa fa-check"></i><b>7.2.1</b> Buridan’s interaction.</a></li>
<li class="chapter" data-level="7.2.2" data-path="interactions.html"><a href="interactions.html#africa-depends-upon-ruggedness."><i class="fa fa-check"></i><b>7.2.2</b> Africa depends upon ruggedness.</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="interactions.html"><a href="interactions.html#continuous-interactions"><i class="fa fa-check"></i><b>7.3</b> Continuous interactions</a><ul>
<li class="chapter" data-level="7.3.1" data-path="interactions.html"><a href="interactions.html#the-data.-1"><i class="fa fa-check"></i><b>7.3.1</b> The data.</a></li>
<li class="chapter" data-level="7.3.2" data-path="interactions.html"><a href="interactions.html#the-un-centered-models."><i class="fa fa-check"></i><b>7.3.2</b> The un-centered models.</a></li>
<li class="chapter" data-level="7.3.3" data-path="interactions.html"><a href="interactions.html#center-and-re-estimate."><i class="fa fa-check"></i><b>7.3.3</b> Center and re-estimate.</a></li>
<li class="chapter" data-level="7.3.4" data-path="interactions.html"><a href="interactions.html#plotting-implied-predictions."><i class="fa fa-check"></i><b>7.3.4</b> Plotting implied predictions.</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="interactions.html"><a href="interactions.html#interactions-in-design-formulas"><i class="fa fa-check"></i><b>7.4</b> Interactions in design formulas</a></li>
<li class="chapter" data-level="7.5" data-path="interactions.html"><a href="interactions.html#summary-bonus-marginal_effects"><i class="fa fa-check"></i><b>7.5</b> <del>Summary</del> Bonus: <code>marginal_effects()</code></a></li>
<li class="chapter" data-level="" data-path="interactions.html"><a href="interactions.html#reference-6"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="interactions.html"><a href="interactions.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>8</b> Markov Chain Monte Carlo</a><ul>
<li class="chapter" data-level="8.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#good-king-markov-and-his-island-kingdom"><i class="fa fa-check"></i><b>8.1</b> Good King Markov and His island kingdom</a></li>
<li class="chapter" data-level="8.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#markov-chain-monte-carlo-1"><i class="fa fa-check"></i><b>8.2</b> Markov chain Monte Carlo</a></li>
<li class="chapter" data-level="8.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#easy-hmc-map2stan-brm"><i class="fa fa-check"></i><b>8.3</b> Easy HMC: <del>map2stan</del> <code>brm()</code></a><ul>
<li class="chapter" data-level="8.3.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#preparation."><i class="fa fa-check"></i><b>8.3.1</b> Preparation.</a></li>
<li class="chapter" data-level="8.3.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#estimation."><i class="fa fa-check"></i><b>8.3.2</b> Estimation.</a></li>
<li class="chapter" data-level="8.3.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#sampling-again-in-parallel."><i class="fa fa-check"></i><b>8.3.3</b> Sampling again, in parallel.</a></li>
<li class="chapter" data-level="8.3.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#visualization."><i class="fa fa-check"></i><b>8.3.4</b> Visualization.</a></li>
<li class="chapter" data-level="8.3.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#using-the-samples."><i class="fa fa-check"></i><b>8.3.5</b> Using the samples.</a></li>
<li class="chapter" data-level="8.3.6" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#checking-the-chain."><i class="fa fa-check"></i><b>8.3.6</b> Checking the chain.</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#care-and-feeding-of-your-markov-chain."><i class="fa fa-check"></i><b>8.4</b> Care and feeding of your Markov chain.</a><ul>
<li class="chapter" data-level="8.4.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>8.4.1</b> How many samples do you need?</a></li>
<li class="chapter" data-level="8.4.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-chains-do-you-need"><i class="fa fa-check"></i><b>8.4.2</b> How many chains do you need?</a></li>
<li class="chapter" data-level="8.4.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#taming-a-wild-chain."><i class="fa fa-check"></i><b>8.4.3</b> Taming a wild chain.</a></li>
<li class="chapter" data-level="8.4.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#non-identifiable-parameters."><i class="fa fa-check"></i><b>8.4.4</b> Non-identifiable parameters.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#reference-7"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>9</b> Big Entropy and the Generalized Linear Model</a><ul>
<li class="chapter" data-level="9.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>9.1</b> Maximum entropy</a><ul>
<li class="chapter" data-level="9.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#gaussian."><i class="fa fa-check"></i><b>9.1.1</b> Gaussian.</a></li>
<li class="chapter" data-level="9.1.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial."><i class="fa fa-check"></i><b>9.1.2</b> Binomial.</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>9.2</b> Generalized linear models</a><ul>
<li class="chapter" data-level="9.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family."><i class="fa fa-check"></i><b>9.2.1</b> Meet the family.</a></li>
<li class="chapter" data-level="9.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions."><i class="fa fa-check"></i><b>9.2.2</b> Linking linear models to distributions.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#reference-8"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="counting-and-classification.html"><a href="counting-and-classification.html"><i class="fa fa-check"></i><b>10</b> Counting and Classification</a><ul>
<li class="chapter" data-level="10.1" data-path="counting-and-classification.html"><a href="counting-and-classification.html#binomial-regression"><i class="fa fa-check"></i><b>10.1</b> Binomial regression</a><ul>
<li class="chapter" data-level="10.1.1" data-path="counting-and-classification.html"><a href="counting-and-classification.html#logistic-regression-prosocial-chimpanzees."><i class="fa fa-check"></i><b>10.1.1</b> Logistic regression: Prosocial chimpanzees.</a></li>
<li class="chapter" data-level="10.1.2" data-path="counting-and-classification.html"><a href="counting-and-classification.html#aggregated-binomial-chimpanzees-again-condensed."><i class="fa fa-check"></i><b>10.1.2</b> Aggregated binomial: Chimpanzees again, condensed.</a></li>
<li class="chapter" data-level="10.1.3" data-path="counting-and-classification.html"><a href="counting-and-classification.html#aggregated-binomial-graduate-school-admissions."><i class="fa fa-check"></i><b>10.1.3</b> Aggregated binomial: Graduate school admissions.</a></li>
<li class="chapter" data-level="10.1.4" data-path="counting-and-classification.html"><a href="counting-and-classification.html#fitting-binomial-regressions-with-glm."><i class="fa fa-check"></i><b>10.1.4</b> Fitting binomial regressions with <code>glm()</code>.</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="counting-and-classification.html"><a href="counting-and-classification.html#poisson-regression"><i class="fa fa-check"></i><b>10.2</b> Poisson regression</a><ul>
<li class="chapter" data-level="10.2.1" data-path="counting-and-classification.html"><a href="counting-and-classification.html#example-oceanic-tool-complexity."><i class="fa fa-check"></i><b>10.2.1</b> Example: Oceanic tool complexity.</a></li>
<li class="chapter" data-level="10.2.2" data-path="counting-and-classification.html"><a href="counting-and-classification.html#mcmc-islands."><i class="fa fa-check"></i><b>10.2.2</b> MCMC islands.</a></li>
<li class="chapter" data-level="10.2.3" data-path="counting-and-classification.html"><a href="counting-and-classification.html#example-exposure-and-the-offset."><i class="fa fa-check"></i><b>10.2.3</b> Example: Exposure and the offset.</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="counting-and-classification.html"><a href="counting-and-classification.html#other-count-regressions"><i class="fa fa-check"></i><b>10.3</b> Other count regressions</a><ul>
<li class="chapter" data-level="10.3.1" data-path="counting-and-classification.html"><a href="counting-and-classification.html#multinomial."><i class="fa fa-check"></i><b>10.3.1</b> Multinomial.</a></li>
<li class="chapter" data-level="10.3.2" data-path="counting-and-classification.html"><a href="counting-and-classification.html#geometric."><i class="fa fa-check"></i><b>10.3.2</b> Geometric.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="counting-and-classification.html"><a href="counting-and-classification.html#reference-9"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="counting-and-classification.html"><a href="counting-and-classification.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html"><i class="fa fa-check"></i><b>11</b> Monsters and Mixtures</a><ul>
<li class="chapter" data-level="11.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>11.1</b> Ordered categorical outcomes</a><ul>
<li class="chapter" data-level="11.1.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-moral-intuition."><i class="fa fa-check"></i><b>11.1.1</b> Example: Moral intuition.</a></li>
<li class="chapter" data-level="11.1.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#describing-an-ordered-distribution-with-intercepts."><i class="fa fa-check"></i><b>11.1.2</b> Describing an ordered distribution with intercepts.</a></li>
<li class="chapter" data-level="11.1.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#adding-predictor-variables."><i class="fa fa-check"></i><b>11.1.3</b> Adding predictor variables.</a></li>
<li class="chapter" data-level="11.1.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#bonus-figure-11.3-alternative."><i class="fa fa-check"></i><b>11.1.4</b> Bonus: Figure 11.3 alternative.</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>11.2</b> Zero-inflated outcomes</a><ul>
<li class="chapter" data-level="11.2.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-zero-inflated-poisson."><i class="fa fa-check"></i><b>11.2.1</b> Example: Zero-inflated Poisson.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersed-outcomes"><i class="fa fa-check"></i><b>11.3</b> Over-dispersed outcomes</a><ul>
<li class="chapter" data-level="11.3.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#beta-binomial."><i class="fa fa-check"></i><b>11.3.1</b> Beta-binomial.</a></li>
<li class="chapter" data-level="11.3.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#negative-binomial-or-gamma-poisson."><i class="fa fa-check"></i><b>11.3.2</b> Negative-binomial or gamma-Poisson.</a></li>
<li class="chapter" data-level="11.3.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersion-entropy-and-information-criteria."><i class="fa fa-check"></i><b>11.3.3</b> Over-dispersion, entropy, and information criteria.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#reference-10"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="multilevel-models.html"><a href="multilevel-models.html"><i class="fa fa-check"></i><b>12</b> Multilevel Models</a><ul>
<li class="chapter" data-level="12.1" data-path="multilevel-models.html"><a href="multilevel-models.html#example-multilevel-tadpoles"><i class="fa fa-check"></i><b>12.1</b> Example: Multilevel tadpoles</a></li>
<li class="chapter" data-level="12.2" data-path="multilevel-models.html"><a href="multilevel-models.html#varying-effects-and-the-underfittingoverfitting-trade-off"><i class="fa fa-check"></i><b>12.2</b> Varying effects and the underfitting/overfitting trade-off</a><ul>
<li class="chapter" data-level="12.2.1" data-path="multilevel-models.html"><a href="multilevel-models.html#the-model.-1"><i class="fa fa-check"></i><b>12.2.1</b> The model.</a></li>
<li class="chapter" data-level="12.2.2" data-path="multilevel-models.html"><a href="multilevel-models.html#assign-values-to-the-parameters."><i class="fa fa-check"></i><b>12.2.2</b> Assign values to the parameters.</a></li>
<li class="chapter" data-level="12.2.3" data-path="multilevel-models.html"><a href="multilevel-models.html#sumulate-survivors."><i class="fa fa-check"></i><b>12.2.3</b> Sumulate survivors.</a></li>
<li class="chapter" data-level="12.2.4" data-path="multilevel-models.html"><a href="multilevel-models.html#compute-the-no-pooling-estimates."><i class="fa fa-check"></i><b>12.2.4</b> Compute the no-pooling estimates.</a></li>
<li class="chapter" data-level="12.2.5" data-path="multilevel-models.html"><a href="multilevel-models.html#compute-the-partial-pooling-estimates."><i class="fa fa-check"></i><b>12.2.5</b> Compute the partial-pooling estimates.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="multilevel-models.html"><a href="multilevel-models.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>12.3</b> More than one type of cluster</a><ul>
<li class="chapter" data-level="12.3.1" data-path="multilevel-models.html"><a href="multilevel-models.html#multilevel-chimpanzees."><i class="fa fa-check"></i><b>12.3.1</b> Multilevel chimpanzees.</a></li>
<li class="chapter" data-level="12.3.2" data-path="multilevel-models.html"><a href="multilevel-models.html#two-types-of-cluster."><i class="fa fa-check"></i><b>12.3.2</b> Two types of cluster.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="multilevel-models.html"><a href="multilevel-models.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>12.4</b> Multilevel posterior predictions</a><ul>
<li class="chapter" data-level="12.4.1" data-path="multilevel-models.html"><a href="multilevel-models.html#posterior-prediction-for-same-clusters."><i class="fa fa-check"></i><b>12.4.1</b> Posterior prediction for same clusters.</a></li>
<li class="chapter" data-level="12.4.2" data-path="multilevel-models.html"><a href="multilevel-models.html#posterior-prediction-for-new-clusters."><i class="fa fa-check"></i><b>12.4.2</b> Posterior prediction for new clusters.</a></li>
<li class="chapter" data-level="12.4.3" data-path="multilevel-models.html"><a href="multilevel-models.html#focus-and-multilevel-prediction."><i class="fa fa-check"></i><b>12.4.3</b> Focus and multilevel prediction.</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="multilevel-models.html"><a href="multilevel-models.html#summary-bonus-tidybayesspread_draws"><i class="fa fa-check"></i><b>12.5</b> <del>Summary</del> Bonus: <code>tidybayes::spread_draws()</code></a><ul>
<li class="chapter" data-level="12.5.1" data-path="multilevel-models.html"><a href="multilevel-models.html#intercepts-only-models-with-one-or-two-grouping-variables"><i class="fa fa-check"></i><b>12.5.1</b> Intercepts-only models with one or two grouping variables</a></li>
<li class="chapter" data-level="12.5.2" data-path="multilevel-models.html"><a href="multilevel-models.html#brmsposterior_samples"><i class="fa fa-check"></i><b>12.5.2</b> <code>brms::posterior_samples()</code></a></li>
<li class="chapter" data-level="12.5.3" data-path="multilevel-models.html"><a href="multilevel-models.html#brmscoef"><i class="fa fa-check"></i><b>12.5.3</b> <code>brms::coef()</code></a></li>
<li class="chapter" data-level="12.5.4" data-path="multilevel-models.html"><a href="multilevel-models.html#brmsfitted"><i class="fa fa-check"></i><b>12.5.4</b> <code>brms::fitted()</code></a></li>
<li class="chapter" data-level="12.5.5" data-path="multilevel-models.html"><a href="multilevel-models.html#tidybayesspread_draws"><i class="fa fa-check"></i><b>12.5.5</b> <code>tidybayes::spread_draws()</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multilevel-models.html"><a href="multilevel-models.html#reference-11"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="multilevel-models.html"><a href="multilevel-models.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html"><i class="fa fa-check"></i><b>13</b> Adventures in Covariance</a><ul>
<li class="chapter" data-level="13.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>13.1</b> Varying slopes by construction</a><ul>
<li class="chapter" data-level="13.1.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-the-population."><i class="fa fa-check"></i><b>13.1.1</b> Simulate the population.</a></li>
<li class="chapter" data-level="13.1.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-observations."><i class="fa fa-check"></i><b>13.1.2</b> Simulate observations.</a></li>
<li class="chapter" data-level="13.1.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#the-varying-slopes-model."><i class="fa fa-check"></i><b>13.1.3</b> The varying slopes model.</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-admission-decisions-and-gender"><i class="fa fa-check"></i><b>13.2</b> Example: Admission decisions and gender</a><ul>
<li class="chapter" data-level="13.2.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-intercepts."><i class="fa fa-check"></i><b>13.2.1</b> Varying intercepts.</a></li>
<li class="chapter" data-level="13.2.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-effects-of-being-male."><i class="fa fa-check"></i><b>13.2.2</b> Varying effects of being <code>male</code>.</a></li>
<li class="chapter" data-level="13.2.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#shrinkage."><i class="fa fa-check"></i><b>13.2.3</b> Shrinkage.</a></li>
<li class="chapter" data-level="13.2.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#model-comparison.-1"><i class="fa fa-check"></i><b>13.2.4</b> Model comparison.</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-cross-classified-chimpanzees-with-varying-slopes"><i class="fa fa-check"></i><b>13.3</b> Example: Cross-classified <code>chimpanzees</code> with varying slopes</a></li>
<li class="chapter" data-level="13.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>13.4</b> Continuous categories and the Gaussian process</a><ul>
<li class="chapter" data-level="13.4.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-spatial-autocorrelation-in-oceanic-tools."><i class="fa fa-check"></i><b>13.4.1</b> Example: Spatial autocorrelation in Oceanic tools.</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#summary-bonus-another-berkley-admissions-data-like-example."><i class="fa fa-check"></i><b>13.5</b> <del>Summary</del> Bonus: Another Berkley-admissions-data-like example.</a></li>
<li class="chapter" data-level="" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#reference-12"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#session-info-12"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html"><i class="fa fa-check"></i><b>14</b> Missing Data and Other Opportunities</a><ul>
<li class="chapter" data-level="14.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#measurement-error"><i class="fa fa-check"></i><b>14.1</b> Measurement error</a><ul>
<li class="chapter" data-level="14.1.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#error-on-the-outcome."><i class="fa fa-check"></i><b>14.1.1</b> Error on the outcome.</a></li>
<li class="chapter" data-level="14.1.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#error-on-both-outcome-and-predictor."><i class="fa fa-check"></i><b>14.1.2</b> Error on both outcome and predictor.</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#missing-data"><i class="fa fa-check"></i><b>14.2</b> Missing data</a><ul>
<li class="chapter" data-level="14.2.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#imputing-neocortex"><i class="fa fa-check"></i><b>14.2.1</b> Imputing <code>neocortex</code></a></li>
<li class="chapter" data-level="14.2.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#improving-the-imputation-model"><i class="fa fa-check"></i><b>14.2.2</b> Improving the imputation model</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#summary-bonus-meta-analysis"><i class="fa fa-check"></i><b>14.3</b> <del>Summary</del> Bonus: Meta-analysis</a></li>
<li class="chapter" data-level="" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#reference-13"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#session-info-13"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html"><i class="fa fa-check"></i><b>15</b> <del>Horoscopes</del> Insights</a><ul>
<li class="chapter" data-level="15.1" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#use-r-notebooks"><i class="fa fa-check"></i><b>15.1</b> Use R Notebooks</a></li>
<li class="chapter" data-level="15.2" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#save-your-model-fits"><i class="fa fa-check"></i><b>15.2</b> Save your model fits</a></li>
<li class="chapter" data-level="15.3" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#build-your-models-slowly"><i class="fa fa-check"></i><b>15.3</b> Build your models slowly</a></li>
<li class="chapter" data-level="15.4" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#look-at-your-data"><i class="fa fa-check"></i><b>15.4</b> Look at your data</a></li>
<li class="chapter" data-level="15.5" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#use-the-0-intercept-syntax"><i class="fa fa-check"></i><b>15.5</b> Use the <code>0 + intercept</code> syntax</a></li>
<li class="chapter" data-level="15.6" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#annotate-your-workflow"><i class="fa fa-check"></i><b>15.6</b> Annotate your workflow</a></li>
<li class="chapter" data-level="15.7" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#annotate-your-code"><i class="fa fa-check"></i><b>15.7</b> Annotate your code</a></li>
<li class="chapter" data-level="15.8" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#break-up-your-workflow"><i class="fa fa-check"></i><b>15.8</b> Break up your workflow</a></li>
<li class="chapter" data-level="15.9" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#read-gelmans-blog"><i class="fa fa-check"></i><b>15.9</b> Read Gelman’s blog</a></li>
<li class="chapter" data-level="15.10" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#check-out-other-social-media-too"><i class="fa fa-check"></i><b>15.10</b> Check out other social media, too</a></li>
<li class="chapter" data-level="15.11" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#parting-wisdom"><i class="fa fa-check"></i><b>15.11</b> Parting wisdom</a></li>
<li class="chapter" data-level="" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#reference-14"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#session-info-14"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Statistical Rethinking</em> with brms, ggplot2, and the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="multivariate-linear-models" class="section level1">
<h1><span class="header-section-number">5</span> Multivariate Linear Models</h1>
<p>McElreath’s listed reasons for multivariable regression include:</p>
<ul>
<li>statistical control for confounds</li>
<li>multiple causation</li>
<li>interactions</li>
</ul>
<p>We’ll approach the first two in this chapter. Interactions are reserved for Chapter 6.</p>
<div id="spurious-associations" class="section level2">
<h2><span class="header-section-number">5.1</span> Spurious associations</h2>
<p>Load the Waffle House data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rethinking)
<span class="kw">data</span>(WaffleDivorce)
d &lt;-<span class="st"> </span>WaffleDivorce</code></pre></div>
<p>Unload rethinking and load brms and, while we’re at it, the tidyverse.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rm</span>(WaffleDivorce)
<span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)
<span class="kw">library</span>(brms)
<span class="kw">library</span>(tidyverse)</code></pre></div>
<p>I’m not going to show the output, but you might go ahead and investigate the data with the typical functions. E.g.,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(d)
<span class="kw">glimpse</span>(d)</code></pre></div>
<p>Now we have our data, we can reproduce Figure 5.1. One convenient way to get the handful of sate labels into the plot was with the <code>geom_text_repel()</code> function from the <a href="https://cran.r-project.org/web/packages/ggrepel/index.html">ggrepel package</a>. But first, we spent the last few chapters warming up with ggplot2. Going forward, each chapter will have its own plot theme. In this chapter, we’ll characterize the plots with <code>theme_bw() + theme(panel.grid = element_rect())</code> and coloring based off of <code>&quot;firebrick&quot;</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages(&quot;ggrepel&quot;, depencencies = T)</span>
<span class="kw">library</span>(ggrepel)

d <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> WaffleHouses<span class="op">/</span>Population, <span class="dt">y =</span> Divorce)) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">fullrange =</span> T, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>,
              <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">1.5</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="dt">data =</span> d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Loc <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ME&quot;</span>, <span class="st">&quot;OK&quot;</span>, <span class="st">&quot;AR&quot;</span>, <span class="st">&quot;AL&quot;</span>, <span class="st">&quot;GA&quot;</span>, <span class="st">&quot;SC&quot;</span>, <span class="st">&quot;NJ&quot;</span>)),  
                  <span class="kw">aes</span>(<span class="dt">label =</span> Loc), 
                  <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">seed =</span> <span class="dv">1042</span>) <span class="op">+</span><span class="st">  </span><span class="co"># this makes it reproducible</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Waffle Houses per million&quot;</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">55</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">50</span>, <span class="dt">ylim =</span> <span class="dv">5</span><span class="op">:</span><span class="dv">15</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Divorce rate&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())  </code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-4-1.png" width="288" /></p>
<p>With <code>coord_map()</code> and help from the <a href="https://cran.r-project.org/web/packages/fiftystater/index.html">fiftystater package</a> (which gives us access to lat/long data for all fifty states via <code>fifty_states</code>), we can plot our three major variables in a map format.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(fiftystater)

d <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># first we&#39;ll standardize the three variables to put them all on the same scale</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Divorce_z           =</span> (Divorce <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(Divorce))                     <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(Divorce),
         <span class="dt">MedianAgeMarriage_z =</span> (MedianAgeMarriage <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(MedianAgeMarriage)) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(MedianAgeMarriage),
         <span class="dt">Marriage_z          =</span> (Marriage <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(Marriage))                   <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(Marriage),
         <span class="co"># need to make the state names lowercase to match with the map data</span>
         <span class="dt">Location            =</span> <span class="kw">str_to_lower</span>(Location)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># here we select the relevant variables and put them in the long format to facet with `facet_wrap()`</span>
<span class="st">  </span><span class="kw">select</span>(Divorce_z<span class="op">:</span>Marriage_z, Location) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(key, value, <span class="op">-</span>Location) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">map_id =</span> Location)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_map</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> value), <span class="dt">map =</span> fifty_states, 
           <span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">15</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">x =</span> fifty_states<span class="op">$</span>long, <span class="dt">y =</span> fifty_states<span class="op">$</span>lat) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;#f8eaea&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_map</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid       =</span> <span class="kw">element_blank</span>(),
        <span class="dt">legend.position  =</span> <span class="st">&quot;none&quot;</span>,
        <span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;transparent&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>key)</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-5-1.png" width="768" /></p>
<p>One of the advantages of this visualization method is it just became clear that Nevada is missing from the <code>WaffleDivorce</code> data. Execute <code>d %&gt;% distinct(Location)</code> to see for yourself. Those missing data should motivate the skills we’ll cover in Chapter 14. But let’s get back on track.</p>
<p>Here we’ll officially standardize the predictor, <code>MedianAgeMarriage</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-
<span class="st">  </span>d <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">MedianAgeMarriage_s =</span> (MedianAgeMarriage <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(MedianAgeMarriage)) <span class="op">/</span>
<span class="st">           </span><span class="kw">sd</span>(MedianAgeMarriage))</code></pre></div>
<p>Now we’re ready to fit the first univariable model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b5.<span class="dv">1</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> gaussian,
      Divorce <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>MedianAgeMarriage_s,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">10</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b),
                <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sigma)),
      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,
      <span class="dt">seed =</span> <span class="dv">5</span>)</code></pre></div>
<p>Check the summary.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b5.<span class="dv">1</span>)</code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: Divorce ~ 1 + MedianAgeMarriage_s 
##    Data: d (Number of observations: 50) 
## Samples: 4 chains, each with iter = 2000; warmup = 500; thin = 1;
##          total post-warmup samples = 6000
## 
## Population-Level Effects: 
##                     Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept               9.68      0.22     9.25    10.11       5675 1.00
## MedianAgeMarriage_s    -1.04      0.22    -1.45    -0.59       5945 1.00
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sigma     1.52      0.16     1.24     1.87       4029 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>We’ll employ <code>fitted()</code> to make Figure 5.2.b. In preparation for <code>fitted()</code> we’ll make a new tibble, <code>nd</code>, composed of a handful of densely-packed values for our predictor, <code>MedianAgeMarriage_s</code>. With the <code>newdata</code> argument, we’ll use those values to return model-implied expected values for <code>Divorce</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># define the range of `MedianAgeMarriage_s` values we&#39;d like to feed into `fitted()`</span>
nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">MedianAgeMarriage_s =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="op">-</span><span class="dv">3</span>, <span class="dt">to =</span> <span class="fl">3.5</span>, <span class="dt">length.out =</span> <span class="dv">30</span>))

<span class="co"># now use `fitted()` to get the model-implied trajectories</span>
f &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">fitted</span>(b5.<span class="dv">1</span>, <span class="dt">newdata =</span> nd) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># tack the `nd` data onto the `fitted()` results</span>
<span class="st">  </span><span class="kw">bind_cols</span>(nd)

<span class="co"># plot</span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> f, 
       <span class="kw">aes</span>(<span class="dt">x =</span> MedianAgeMarriage_s, <span class="dt">y =</span> Estimate)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2.<span class="dv">5</span>, <span class="dt">ymax =</span> Q97.<span class="dv">5</span>),
              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,
              <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> d, 
             <span class="kw">aes</span>(<span class="dt">y =</span> Divorce), 
             <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Divorce&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(d<span class="op">$</span>MedianAgeMarriage_s), 
                  <span class="dt">ylim =</span> <span class="kw">range</span>(d<span class="op">$</span>Divorce)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())                   </code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-8-1.png" width="288" /></p>
<p>Before fitting the next model, we’ll standardize <code>Marriage</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-
<span class="st">  </span>d <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Marriage_s =</span> (Marriage <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(Marriage)) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(Marriage))</code></pre></div>
<p>We’re ready to fit our second univariable model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b5.<span class="dv">2</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> gaussian,
      Divorce <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Marriage_s,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">10</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b),
                <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sigma)),
      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,
      <span class="dt">seed =</span> <span class="dv">5</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b5.<span class="dv">2</span>)</code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: Divorce ~ 1 + Marriage_s 
##    Data: d (Number of observations: 50) 
## Samples: 4 chains, each with iter = 2000; warmup = 500; thin = 1;
##          total post-warmup samples = 6000
## 
## Population-Level Effects: 
##            Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept      9.69      0.25     9.20    10.18       5516 1.00
## Marriage_s     0.64      0.25     0.16     1.12       5229 1.00
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sigma     1.75      0.18     1.44     2.15       4519 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Now we’ll wangle and plot our version of Figure 5.2.a.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">Marriage_s =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="op">-</span><span class="fl">2.5</span>, <span class="dt">to =</span> <span class="fl">3.5</span>, <span class="dt">length.out =</span> <span class="dv">30</span>))

f &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">fitted</span>(b5.<span class="dv">2</span>, <span class="dt">newdata =</span> nd) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bind_cols</span>(nd)

<span class="kw">ggplot</span>(<span class="dt">data =</span> f, 
       <span class="kw">aes</span>(<span class="dt">x =</span> Marriage_s, <span class="dt">y =</span> Estimate)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2.<span class="dv">5</span>, <span class="dt">ymax =</span> Q97.<span class="dv">5</span>),
              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,
              <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> d, 
             <span class="kw">aes</span>(<span class="dt">y =</span> Divorce), 
             <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(d<span class="op">$</span>Marriage_s), 
                  <span class="dt">ylim =</span> <span class="kw">range</span>(d<span class="op">$</span>Divorce)) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Divorce&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())                   </code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-11-1.png" width="288" /></p>
<blockquote>
<p>But merely comparing parameter means between different bivariate regressions is no way to decide which predictor is better Both of these predictors could provide independent value, or they could be redundant, or one could eliminate the value of the other. So we’ll build a multivariate model with the goal of measuring the partial value of each predictor. The question we want answered is:</p>
<blockquote>
<p><em>What is the predictive value of a variable, once I already know all of the other predictor variables?</em> (p. 123, <em>emphasis</em> in the original)</p>
</blockquote>
</blockquote>
<div id="multivariate-notation." class="section level3">
<h3><span class="header-section-number">5.1.1</span> Multivariate notation.</h3>
<p>Now we’ll get both predictors in there with our very first multivariable model. We can write the statistical model as</p>
<span class="math display">\[\begin{align*}
\text{Divorce}_i &amp; \sim \text{Normal}(\mu_i, \sigma) \\
\mu_i   &amp; = \alpha + \beta_1 \text{Marriage_s}_i + \beta_2 \text{MedianAgeMarriage_s}_i \\
\alpha  &amp; \sim \text{Normal}(10, 10) \\
\beta_1 &amp; \sim \text{Normal}(0, 1) \\
\beta_2 &amp; \sim \text{Normal}(0, 1) \\
\sigma  &amp; \sim \text{Uniform}(0, 10)
\end{align*}\]</span>
<blockquote>
<p>It might help to read the <span class="math inline">\(+\)</span> symbols as “or” and then say: <em>A State’s divorce rate can be a function of its marriage rate <strong>or</strong> its median age at marriage</em>. The “or” indicates independent associations, which may be purely statistical or rather causal. (p. 124, <em>emphasis</em> in the original)</p>
</blockquote>
</div>
<div id="fitting-the-model.-1" class="section level3">
<h3><span class="header-section-number">5.1.2</span> Fitting the model.</h3>
<p>Much like we used the <code>+</code> operator to add single predictors to the intercept, we just use more <code>+</code> operators in the <code>formula</code> argument to add more predictors. Also notice we’re using the same prior <code>prior(normal(0, 1), class = b)</code> for both predictors. Within the brms framework, they are both of <code>class = b</code>. But if we wanted their priors to differ, we’d make two <code>prior()</code> statements and differentiate them with the <code>coef</code> argument. You’ll see examples of that later on.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b5.<span class="dv">3</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> gaussian,
      Divorce <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Marriage_s <span class="op">+</span><span class="st"> </span>MedianAgeMarriage_s,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">10</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b),
                <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sigma)),
      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,
      <span class="dt">seed =</span> <span class="dv">5</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b5.<span class="dv">3</span>)</code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: Divorce ~ 1 + Marriage_s + MedianAgeMarriage_s 
##    Data: d (Number of observations: 50) 
## Samples: 4 chains, each with iter = 2000; warmup = 500; thin = 1;
##          total post-warmup samples = 6000
## 
## Population-Level Effects: 
##                     Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept               9.68      0.22     9.26    10.11       5396 1.00
## Marriage_s             -0.13      0.29    -0.68     0.43       3810 1.00
## MedianAgeMarriage_s    -1.13      0.29    -1.70    -0.54       3908 1.00
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sigma     1.52      0.16     1.24     1.88       4923 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>The <code>stanplot()</code> function is an easy way to get a default coefficient plot. You just put the brmsfit object into the function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">stanplot</span>(b5.<span class="dv">3</span>)</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-13-1.png" width="576" /></p>
<p>There are numerous ways to make a coefficient plot. Another is with the <code>mcmc_intervals()</code> function from the <a href="https://cran.r-project.org/web/packages/bayesplot/index.html">bayesplot package</a>. A nice feature of the bayesplot package is its convenient way to alter the color scheme with the <code>color_scheme_set()</code> function. Here, for example, we’ll make the theme <code>red</code>. But note how the <code>mcmc_intervals()</code> function requires you to work with the <code>posterior_samples()</code> instead of the brmsfit object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages(&quot;bayesplot&quot;, dependencies = T)</span>
<span class="kw">library</span>(bayesplot)

post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(b5.<span class="dv">3</span>)

<span class="kw">color_scheme_set</span>(<span class="st">&quot;red&quot;</span>)
<span class="kw">mcmc_intervals</span>(post[, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>], 
               <span class="dt">prob =</span> .<span class="dv">5</span>,
               <span class="dt">point_est =</span> <span class="st">&quot;median&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;My fancy bayesplot-based coefficient plot&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.y  =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>),
        <span class="dt">axis.line.x  =</span> <span class="kw">element_line</span>(<span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>),
        <span class="dt">axis.line.y  =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-14-1.png" width="576" /></p>
<p>Because bayesplot produces a ggplot2 object, the plot was adjustable with familiar ggplot2 syntax. For more ideas, check out <a href="https://cran.r-project.org/web/packages/bayesplot/vignettes/plotting-mcmc-draws.html">this vignette</a>.</p>
<p>The <code>tidybaes::stat_pointintervalh()</code> function offers a third way, this time with a more ground-up ggplot2 workflow.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidybayes)

post <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>lp__) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> <span class="kw">reorder</span>(key, value))) <span class="op">+</span><span class="st">  </span><span class="co"># note how we used `reorder()` to arrange the coefficients</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_pointintervalh</span>(<span class="dt">point_interval =</span> mode_hdi, <span class="dt">.width =</span> .<span class="dv">95</span>, 
                      <span class="dt">size =</span> <span class="dv">3</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;My tidybayes-based coefficient plot&quot;</span>,
       <span class="dt">x =</span> <span class="ot">NULL</span>, <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid   =</span> <span class="kw">element_blank</span>(),
        <span class="dt">panel.grid.major.y =</span> <span class="kw">element_line</span>(<span class="dt">color =</span> <span class="kw">alpha</span>(<span class="st">&quot;firebrick4&quot;</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>), <span class="dt">linetype =</span> <span class="dv">3</span>),
        <span class="dt">axis.text.y  =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>),
        <span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-15-1.png" width="576" /></p>
<p>The substantive interpretation of all those coefficient plots is: “<em>Once we know median age at marriage for a State, there is little or no additive predictive power in also knowing the rate of marriage in that State</em>” (p. 126, <em>emphasis</em> in the original).</p>
</div>
<div id="plotting-multivariate-posteriors." class="section level3">
<h3><span class="header-section-number">5.1.3</span> Plotting multivariate posteriors.</h3>
<p>McElreath’s prose is delightfully deflationary. “There is a huge literature detailing a variety of plotting techniques that all attempt to help one understand multiple linear regression. None of these techniques is suitable for all jobs, and most do not generalize beyond linear regression” (p. 126). Now you’re inspired, let’s learn three:</p>
<ul>
<li>Predictor residual plots</li>
<li>Counterfactual plots</li>
<li>Posterior prediction plots</li>
</ul>
<div id="predictor-residual-plots." class="section level4">
<h4><span class="header-section-number">5.1.3.1</span> Predictor residual plots.</h4>
<p>To get ready to make our residual plots, we’ll predict <code>Marriage_s</code> with <code>MedianAgeMarriage_s</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b5.<span class="dv">4</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> gaussian,
      Marriage_s <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>MedianAgeMarriage_s,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b),
                <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sigma)),
      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,
      <span class="dt">seed =</span> <span class="dv">5</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b5.<span class="dv">4</span>)</code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: Marriage_s ~ 1 + MedianAgeMarriage_s 
##    Data: d (Number of observations: 50) 
## Samples: 4 chains, each with iter = 2000; warmup = 500; thin = 1;
##          total post-warmup samples = 6000
## 
## Population-Level Effects: 
##                     Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept               0.00      0.10    -0.20     0.20       5540 1.00
## MedianAgeMarriage_s    -0.71      0.10    -0.91    -0.51       4941 1.00
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sigma     0.72      0.08     0.59     0.89       5352 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>With <code>fitted()</code>, we compute the expected values for each state (with the exception of Nevada). Since the <code>MedianAgeMarriage_s</code> values for each state are in the date we used to fit the model, we’ll omit the <code>newdata</code> argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">fitted</span>(b5.<span class="dv">4</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bind_cols</span>(d)

<span class="kw">head</span>(f)</code></pre></div>
<pre><code>## # A tibble: 6 x 19
##   Estimate Est.Error     Q2.5  Q97.5 Location Loc   Population
##      &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;      &lt;dbl&gt;
## 1    0.433     0.119  2.00e-1  0.667 Alabama  AL          4.78
## 2    0.490     0.124  2.48e-1  0.733 Alaska   AK          0.71
## 3    0.146     0.105 -5.52e-2  0.354 Arizona  AZ          6.33
## 4    1.01      0.176  6.56e-1  1.35  Arkansas AR          2.92
## 5   -0.427     0.121 -6.65e-1 -0.194 Califor… CA         37.2 
## 6    0.203     0.107 -8.95e-4  0.414 Colorado CO          5.03
## # … with 12 more variables: MedianAgeMarriage &lt;dbl&gt;, Marriage &lt;dbl&gt;,
## #   Marriage.SE &lt;dbl&gt;, Divorce &lt;dbl&gt;, Divorce.SE &lt;dbl&gt;,
## #   WaffleHouses &lt;int&gt;, South &lt;int&gt;, Slaves1860 &lt;int&gt;,
## #   Population1860 &lt;int&gt;, PropSlaves1860 &lt;dbl&gt;, MedianAgeMarriage_s &lt;dbl&gt;,
## #   Marriage_s &lt;dbl&gt;</code></pre>
<p>After a little data processing, we can make Figure 5.3.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> MedianAgeMarriage_s, <span class="dt">y =</span> Marriage_s)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">xend =</span> MedianAgeMarriage_s, <span class="dt">yend =</span> Estimate), 
               <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate), 
            <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">range</span>(d<span class="op">$</span>Marriage_s)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())     </code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-18-1.png" width="288" /></p>
<p>We get the residuals with the well-named <code>residuals()</code> function. Much like with <code>brms::fitted()</code>, <code>brms::residuals()</code> returns a four-vector matrix with the number of rows equal to the number of observations in the original data (by default, anyway). The vectors have the familiar names: <code>Estimate</code>, <code>Est.Error</code>, <code>Q2.5</code>, and <code>Q97.5</code>. See the <a href="https://cran.r-project.org/web/packages/brms/brms.pdf">brms reference manual</a> for details.</p>
<p>With our residuals in hand, we just need a little more data processing to make Figure 5.4.a.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">residuals</span>(b5.<span class="dv">4</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># to use this in ggplot2, we need to make it a tibble or data frame</span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">bind_cols</span>(d)

<span class="co"># for the annotation at the top</span>
text &lt;-
<span class="st">  </span><span class="kw">tibble</span>(<span class="dt">Estimate =</span> <span class="kw">c</span>(<span class="op">-</span><span class="st"> </span><span class="fl">0.5</span>, <span class="fl">0.5</span>),
         <span class="dt">Divorce =</span> <span class="fl">14.1</span>,
         <span class="dt">label =</span> <span class="kw">c</span>(<span class="st">&quot;slower&quot;</span>, <span class="st">&quot;faster&quot;</span>))

<span class="co"># plot</span>
r <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Estimate, <span class="dt">y =</span> Divorce)) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">fullrange =</span> T,
              <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;firebrick4&quot;</span>, 
              <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">linetype =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;grey50&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> text,
            <span class="kw">aes</span>(<span class="dt">label =</span> label)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Marriage rate residuals&quot;</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(r<span class="op">$</span>Estimate),
                  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">6</span>, <span class="fl">14.1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-19-1.png" width="288" /></p>
<p>To get the <code>MedianAgeMarriage_s</code> residuals, we have to fit the corresponding model first.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b5.4b &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> gaussian,
      MedianAgeMarriage_s <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Marriage_s,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b),
                <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sigma)),
      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,
      <span class="dt">seed =</span> <span class="dv">5</span>)</code></pre></div>
<p>And now we’ll get the new batch of residuals, do a little data processing, and make a plot corresponding to Figure 5.4.b.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">text &lt;-
<span class="st">  </span><span class="kw">tibble</span>(<span class="dt">Estimate =</span> <span class="kw">c</span>(<span class="op">-</span><span class="st"> </span><span class="fl">0.7</span>, <span class="fl">0.5</span>),
         <span class="dt">Divorce  =</span> <span class="fl">14.1</span>,
         <span class="dt">label    =</span> <span class="kw">c</span>(<span class="st">&quot;younger&quot;</span>, <span class="st">&quot;older&quot;</span>))

<span class="kw">residuals</span>(b5.4b) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bind_cols</span>(d) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Estimate, <span class="dt">y =</span> Divorce)) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">fullrange =</span> T,
              <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;firebrick4&quot;</span>, 
              <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">linetype =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;grey50&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> text,
            <span class="kw">aes</span>(<span class="dt">label =</span> label)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Age of marriage residuals&quot;</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">3</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(r<span class="op">$</span>Estimate),
                  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">6</span>, <span class="fl">14.1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())  </code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-20-1.png" width="288" /></p>
</div>
<div id="counterfactual-plots." class="section level4">
<h4><span class="header-section-number">5.1.3.2</span> Counterfactual plots.</h4>
<blockquote>
<p>A second sort of inferential plot displays the implied predictions of the model. I call these plots <em>counterfactual</em>, because they can be produced for any values of the predictor variable you like, even unobserved or impossible combinations like very high median age of marriage and very high marriage rate. There are no States with this combination, but in a counterfactual plot, you can ask the model for a prediction for such a State. (p. 129, <em>emphasis</em> in the original)</p>
</blockquote>
<p>Making Figure 5.5.a requires a little more data wrangling than before.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># we need new `nd` data</span>
nd &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">tibble</span>(<span class="dt">Marriage_s          =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="op">-</span><span class="dv">3</span>, <span class="dt">to =</span> <span class="dv">3</span>, <span class="dt">length.out =</span> <span class="dv">30</span>),
         <span class="dt">MedianAgeMarriage_s =</span> <span class="kw">mean</span>(d<span class="op">$</span>MedianAgeMarriage_s))

<span class="kw">fitted</span>(b5.<span class="dv">3</span>, <span class="dt">newdata =</span> nd) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># since `fitted()` and `predict()` name their intervals the same way, </span>
<span class="st">  </span><span class="co"># we&#39;ll need to `rename()` them to keep them straight</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">f_ll =</span> Q2.<span class="dv">5</span>,
         <span class="dt">f_ul =</span> Q97.<span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># note how we&#39;re just nesting the `predict()` code right inside `bind_cols()`</span>
<span class="st">  </span><span class="kw">bind_cols</span>(
    <span class="kw">predict</span>(b5.<span class="dv">3</span>, <span class="dt">newdata =</span> nd) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="co"># since we only need the intervals, we&#39;ll use `transmute()` rather than `mutate()`</span>
<span class="st">      </span><span class="kw">transmute</span>(<span class="dt">p_ll =</span> Q2.<span class="dv">5</span>,
                <span class="dt">p_ul =</span> Q97.<span class="dv">5</span>),
    <span class="co"># now tack on the `nd` data</span>
    nd) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="co"># we&#39;re finally ready to plot</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Marriage_s, <span class="dt">y =</span> Estimate)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> p_ll, <span class="dt">ymax =</span> p_ul),
              <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> f_ll, <span class="dt">ymax =</span> f_ul),
              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,
              <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(d<span class="op">$</span>Marriage_s),
                  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">6</span>, <span class="dv">14</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Counterfactual plot for which</span><span class="ch">\n</span><span class="st">MedianAgeMarriage_s = 0&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Divorce&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())     </code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-21-1.png" width="288" /></p>
<p>We follow the same process for Figure 5.5.b.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># new data</span>
nd &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">tibble</span>(<span class="dt">MedianAgeMarriage_s =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="op">-</span><span class="dv">3</span>, <span class="dt">to =</span> <span class="fl">3.5</span>, <span class="dt">length.out =</span> <span class="dv">30</span>),
         <span class="dt">Marriage_s          =</span> <span class="kw">mean</span>(d<span class="op">$</span>Marriage_s))
  
<span class="co"># `fitted()` + `predict()`</span>
<span class="kw">fitted</span>(b5.<span class="dv">3</span>, <span class="dt">newdata =</span> nd) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">f_ll =</span> Q2.<span class="dv">5</span>,
         <span class="dt">f_ul =</span> Q97.<span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">bind_cols</span>(
    <span class="kw">predict</span>(b5.<span class="dv">3</span>, <span class="dt">newdata =</span> nd) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">transmute</span>(<span class="dt">p_ll =</span> Q2.<span class="dv">5</span>,
                <span class="dt">p_ul =</span> Q97.<span class="dv">5</span>),
    nd
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="co"># plot</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> MedianAgeMarriage_s, <span class="dt">y =</span> Estimate)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> p_ll, <span class="dt">ymax =</span> p_ul),
              <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> f_ll, <span class="dt">ymax =</span> f_ul),
              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,
              <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(d<span class="op">$</span>MedianAgeMarriage_s),
                  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">6</span>, <span class="dv">14</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Counterfactual plot for which</span><span class="ch">\n</span><span class="st">Marriage_s = 0&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Divorce&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())   </code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-22-1.png" width="288" /></p>
<blockquote>
<p>A tension with such plots, however, lies in their counterfactual nature. In the small world of the model, it is possible to change median age of marriage without also changing the marriage rate. But is this also possible in the large world of reality? Probably not…</p>
<p>…If our goal is to intervene in the world, there may not be any realistic way to manipulate each predictor without also manipulating the others. This is a serious obstacle to applied science, whether you are an ecologist, an economist, or an epidemiologist [or a psychologist] (p. 131)</p>
</blockquote>
</div>
<div id="posterior-prediction-plots." class="section level4">
<h4><span class="header-section-number">5.1.3.3</span> Posterior prediction plots.</h4>
<p>“In addition to understanding the estimates, it’s important to check the model fit against the observed data” (p. 131). For more on the topic, check out Gabry and colleagues’ <a href="https://arxiv.org/abs/1709.01449"><em>Visualization in Bayesian workflow</em></a> or Simpson’s related blog post <a href="http://andrewgelman.com/2017/09/07/touch-want-feel-data/"><em>Touch me, I want to feel your data</em></a>.</p>
<p>In this version of Figure 5.6.a, the thin lines are the 95% intervals and the thicker lines are +/- the posterior <span class="math inline">\(SD\)</span>, both of which are returned when you use <code>fitted()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fitted</span>(b5.<span class="dv">3</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bind_cols</span>(d) <span class="op">%&gt;%</span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Divorce, <span class="dt">y =</span> Estimate)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">linetype =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="dt">size =</span> .<span class="dv">5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">1.5</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">3</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_linerange</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2.<span class="dv">5</span>, <span class="dt">ymax =</span> Q97.<span class="dv">5</span>),
                 <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_linerange</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Estimate <span class="op">-</span><span class="st"> </span>Est.Error, 
                     <span class="dt">ymax =</span> Estimate <span class="op">+</span><span class="st"> </span>Est.Error),
                 <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="co"># Note our use of the dot placeholder, here: https://magrittr.tidyverse.org/reference/pipe.html</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> . <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Loc <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;UT&quot;</span>)),
            <span class="kw">aes</span>(<span class="dt">label =</span> Loc), 
            <span class="dt">hjust =</span> <span class="dv">0</span>, <span class="dt">nudge_x =</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.65</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Observed divorce&quot;</span>, 
       <span class="dt">y =</span> <span class="st">&quot;Predicted divorce&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-23-1.png" width="288" /></p>
<p>In order to make Figure 5.6.b, we need to clarify the relationships among <code>fitted()</code>, <code>predict()</code>, and <code>residuals()</code>. Here’s my attempt in a table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tibble</span>(<span class="st">`</span><span class="dt">brms function</span><span class="st">`</span> =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;fitted&quot;</span>, <span class="st">&quot;predict&quot;</span>, <span class="st">&quot;residual&quot;</span>),
       <span class="dt">mean  =</span> <span class="kw">c</span>(<span class="st">&quot;same as the data&quot;</span>, <span class="st">&quot;same as the data&quot;</span>, <span class="st">&quot;in a deviance-score metric&quot;</span>),
       <span class="dt">scale =</span> <span class="kw">c</span>(<span class="st">&quot;excludes sigma&quot;</span>, <span class="st">&quot;includes sigma&quot;</span>, <span class="st">&quot;excludes sigma&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>()</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">brms function</th>
<th align="left">mean</th>
<th align="left">scale</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">fitted</td>
<td align="left">same as the data</td>
<td align="left">excludes sigma</td>
</tr>
<tr class="even">
<td align="left">predict</td>
<td align="left">same as the data</td>
<td align="left">includes sigma</td>
</tr>
<tr class="odd">
<td align="left">residual</td>
<td align="left">in a deviance-score metric</td>
<td align="left">excludes sigma</td>
</tr>
</tbody>
</table>
<p>Hopefully this clarifies that if we want to incorporate the prediction interval in a deviance metric, we’ll need to first use <code>predict()</code> and then subtract the intervals from their corresponding <code>Divorce</code> values in the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">residuals</span>(b5.<span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">f_ll =</span> Q2.<span class="dv">5</span>,
         <span class="dt">f_ul =</span> Q97.<span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">bind_cols</span>(
    <span class="kw">predict</span>(b5.<span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">transmute</span>(<span class="dt">p_ll =</span> Q2.<span class="dv">5</span>,
                <span class="dt">p_ul =</span> Q97.<span class="dv">5</span>),
    d
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># here we put our `predict()` intervals into a deviance metric</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">p_ll =</span> Divorce <span class="op">-</span><span class="st"> </span>p_ll,
         <span class="dt">p_ul =</span> Divorce <span class="op">-</span><span class="st"> </span>p_ul) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="co"># now plot!</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(Loc, Estimate), <span class="dt">y =</span> Estimate)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, 
             <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> f_ll, <span class="dt">ymax =</span> f_ul),
                  <span class="dt">size =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">shape =</span> <span class="dv">20</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">y    =</span> Estimate <span class="op">-</span><span class="st"> </span>Est.Error, 
                   <span class="dt">yend =</span> Estimate <span class="op">+</span><span class="st"> </span>Est.Error,
                   <span class="dt">x    =</span> Loc, 
                   <span class="dt">xend =</span> Loc),
               <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">y    =</span> p_ll, 
                   <span class="dt">yend =</span> p_ul,
                   <span class="dt">x    =</span> Loc, 
                   <span class="dt">xend =</span> Loc),
               <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>, <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">6</span>, <span class="dv">5</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid   =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.text.y  =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>))</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-25-1.png" width="216" /></p>
<p>Compared to the last couple plots, Figure 5.6.c is pretty simple.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">residuals</span>(b5.<span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">bind_cols</span>(d) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">wpc =</span> WaffleHouses <span class="op">/</span><span class="st"> </span>Population) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> wpc, <span class="dt">y =</span> Estimate)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">1.5</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">fullrange =</span> T,
              <span class="dt">color  =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, 
              <span class="dt">fill   =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="dt">data =</span> . <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Loc <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ME&quot;</span>, <span class="st">&quot;AR&quot;</span>, <span class="st">&quot;MS&quot;</span>, <span class="st">&quot;AL&quot;</span>, <span class="st">&quot;GA&quot;</span>, <span class="st">&quot;SC&quot;</span>, <span class="st">&quot;ID&quot;</span>)),
                  <span class="kw">aes</span>(<span class="dt">label =</span> Loc),
                  <span class="dt">seed =</span> <span class="fl">5.6</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Waffles per capita&quot;</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">45</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(<span class="dv">0</span>, <span class="dv">40</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Divorce error&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-26-1.png" width="288" /></p>
<p>More McElreath inspiration: “No matter how many predictors you’ve already included in a regression, it’s still possible to find spurious correlations with the remaining variation” (p. 134). To keep our deflation train going, it’s worthwhile to repeat the message in McElreath’s <strong>Rethinking: Stats, huh, yeah what is it good for?</strong> box.</p>
<blockquote>
<p>Often people want statistical modeling to do things that statistical modeling cannot do. For example, we’d like to know whether an effect is real or rather spurious. Unfortunately, modeling merely quantifies uncertainty in the precise way that the model understands the problem. Usually answers to large world questions about truth and causation depend upon information not included in the model. For example, any observed correlation between an outcome and predictor could be eliminated or reversed once another predictor is added to the model. But if we cannot think of another predictor, we might never notice this. Therefore all statistical models are vulnerable to and demand critique, regardless of the precision of their estimates and apparent accuracy of their predictions. (p. 134)</p>
</blockquote>
</div>
<div id="overthinking-simulating-spurious-association." class="section level4">
<h4><span class="header-section-number">5.1.3.4</span> Overthinking: Simulating spurious association.</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n &lt;-<span class="st"> </span><span class="dv">100</span>                             <span class="co"># number of cases</span>

<span class="kw">set.seed</span>(<span class="dv">5</span>)                          <span class="co"># setting the seed makes the results reproducible</span>
d &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">tibble</span>(<span class="dt">x_real =</span> <span class="kw">rnorm</span>(n),          <span class="co"># x_real as Gaussian with mean 0 and SD 1 (i.e., the defaults)</span>
         <span class="dt">x_spur =</span> <span class="kw">rnorm</span>(n, x_real),  <span class="co"># x_spur as Gaussian with mean = x_real</span>
         <span class="dt">y =</span>      <span class="kw">rnorm</span>(n, x_real))  <span class="co"># y as Gaussian with mean = x_real</span></code></pre></div>
<p>Here are the quick <code>pairs()</code> plots.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pairs</span>(d, <span class="dt">col =</span> <span class="st">&quot;firebrick4&quot;</span>)</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-28-1.png" width="432" /></p>
<p>We may as well fit a model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> gaussian,
    y <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x_real <span class="op">+</span><span class="st"> </span>x_spur,
    <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),
              <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b),
              <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sigma)),
    <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,
    <span class="dt">seed =</span> <span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">fixef</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code>##           Estimate Est.Error  Q2.5 Q97.5
## Intercept     0.00      0.10 -0.19  0.19
## x_real        0.98      0.15  0.69  1.27
## x_spur        0.06      0.09 -0.12  0.24</code></pre>
</div>
</div>
</div>
<div id="masked-relationship" class="section level2">
<h2><span class="header-section-number">5.2</span> Masked relationship</h2>
<p>Let’s load those tasty <code>milk</code> data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rethinking)
<span class="kw">data</span>(milk)
d &lt;-<span class="st"> </span>milk</code></pre></div>
<p>Unload rethinking and load brms.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rm</span>(milk)
<span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)
<span class="kw">library</span>(brms)</code></pre></div>
<p>You might inspect the data like this.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(kcal.per.g, mass, neocortex.perc) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">pairs</span>(<span class="dt">col =</span> <span class="st">&quot;firebrick4&quot;</span>)</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-31-1.png" width="432" /></p>
<p>By just looking at that mess, do you think you could describe the associations of <code>mass</code> and <code>neocortex.perc</code> with the criterion, <code>kcal.per.g</code>? I couldn’t. It’s a good thing we have math.</p>
<p>McElreath has us start of with a simple univariable <code>milk</code> model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b5.<span class="dv">5</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> gaussian,
      kcal.per.g <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>neocortex.perc,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b),
                <span class="kw">prior</span>(<span class="kw">cauchy</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sigma)),
      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,
      <span class="dt">seed =</span> <span class="dv">5</span>)</code></pre></div>
<p>The uniform prior was difficult on Stan. After playing around a bit, I just switched to a unit-scale half Cauchy. Similar to the rethinking example in the text, brms warned that “Rows containing NAs were excluded from the model.” This isn’t necessarily a problem; the model fit just fine. But we should be ashamed of ourselves and look eagerly forward to Chapter 14 where we’ll learn how to do better.</p>
<p>To compliment how McElreath removed cases with missing values on our variables of interest with Base R <code>complete.cases()</code>, here we’ll do so with <code>tidyr::drop_na()</code> and a little help with <code>ends_with()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dcc &lt;-<span class="st"> </span>
<span class="st">  </span>d <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">drop_na</span>(<span class="kw">ends_with</span>(<span class="st">&quot;_s&quot;</span>))              </code></pre></div>
<p>But anyway, let’s inspect the parameter summary.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b5.<span class="dv">5</span>, <span class="dt">digits =</span> <span class="dv">3</span>)</code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: kcal.per.g ~ 1 + neocortex.perc 
##    Data: d (Number of observations: 17) 
## Samples: 4 chains, each with iter = 2000; warmup = 500; thin = 1;
##          total post-warmup samples = 6000
## 
## Population-Level Effects: 
##                Estimate Est.Error l-95% CI u-95% CI Eff.Sample  Rhat
## Intercept         0.357     0.560   -0.770    1.483       5182 1.002
## neocortex.perc    0.004     0.008   -0.012    0.021       5196 1.002
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample  Rhat
## sigma    0.192     0.039    0.132    0.283       3532 1.000
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Did you notice now we set <code>digits = 3</code> within <code>print()</code> much the way McElreath set <code>digits=3</code> within <code>precis()</code>?</p>
<p>To get the brms answer to what McElreath did with <code>coef()</code>, we’ll use the <code>fixef()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fixef</span>(b5.<span class="dv">5</span>)[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>(<span class="dv">76</span> <span class="op">-</span><span class="st"> </span><span class="dv">55</span>)</code></pre></div>
<pre><code>## [1] 0.09351993</code></pre>
<p>Yes, indeed, “that’s less than 0.1 kilocalories” (p. 137).</p>
<p>Just for kicks, we’ll superimpose 50% intervals atop 95% intervals for the next few plots. Here’s Figure 5.7, top left.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">neocortex.perc =</span> <span class="dv">54</span><span class="op">:</span><span class="dv">80</span>)

<span class="kw">fitted</span>(b5.<span class="dv">5</span>, 
       <span class="dt">newdata =</span> nd,
       <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">025</span>, .<span class="dv">975</span>, .<span class="dv">25</span>, .<span class="dv">75</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> neocortex.perc, <span class="dt">y =</span> Estimate)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2.<span class="dv">5</span>, <span class="dt">ymax =</span> Q97.<span class="dv">5</span>),
              <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q25, <span class="dt">ymax =</span> Q75),
              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,
              <span class="dt">fill =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> dcc, 
             <span class="kw">aes</span>(<span class="dt">y =</span> kcal.per.g),
             <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(dcc<span class="op">$</span>neocortex.perc), 
                  <span class="dt">ylim =</span> <span class="kw">range</span>(dcc<span class="op">$</span>kcal.per.g)) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;kcal.per.g&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-35-1.png" width="288" /></p>
<p>Do note the <code>probs</code> argument in the <code>fitted()</code> code, above. Let’s make the <code>log_mass</code> variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dcc &lt;-
<span class="st">  </span>dcc <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">log_mass =</span> <span class="kw">log</span>(mass))</code></pre></div>
<p>Now we use <code>log_mass</code> as the new sole predictor.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b5.<span class="dv">6</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> dcc, <span class="dt">family =</span> gaussian,
      kcal.per.g <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>log_mass,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b),
                <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sigma)),
      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,
      <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">0.9</span>),
      <span class="dt">seed =</span> <span class="dv">5</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b5.<span class="dv">6</span>, <span class="dt">digits =</span> <span class="dv">3</span>)</code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: kcal.per.g ~ 1 + log_mass 
##    Data: dcc (Number of observations: 17) 
## Samples: 4 chains, each with iter = 2000; warmup = 500; thin = 1;
##          total post-warmup samples = 6000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample  Rhat
## Intercept    0.705     0.060    0.586    0.821       5103 1.000
## log_mass    -0.032     0.024   -0.080    0.017       4577 1.000
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample  Rhat
## sigma    0.183     0.037    0.128    0.270       3747 1.001
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Make Figure 5.7, top right.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">log_mass =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="op">-</span><span class="fl">2.5</span>, <span class="dt">to =</span> <span class="dv">5</span>, <span class="dt">length.out =</span> <span class="dv">30</span>))

<span class="kw">fitted</span>(b5.<span class="dv">6</span>, 
       <span class="dt">newdata =</span> nd,
       <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">025</span>, .<span class="dv">975</span>, .<span class="dv">25</span>, .<span class="dv">75</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> log_mass, <span class="dt">y =</span> Estimate)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2.<span class="dv">5</span>, <span class="dt">ymax =</span> Q97.<span class="dv">5</span>),
              <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q25, <span class="dt">ymax =</span> Q75),
              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,
              <span class="dt">fill =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> dcc, 
             <span class="kw">aes</span>(<span class="dt">y =</span> kcal.per.g),
             <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(dcc<span class="op">$</span>log_mass), 
                  <span class="dt">ylim =</span> <span class="kw">range</span>(dcc<span class="op">$</span>kcal.per.g)) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;kcal.per.g&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-38-1.png" width="288" /></p>
<p>Finally, we’re ready to fit with both predictors included in the “joint model.” Here’s the statistical formula</p>
<span class="math display">\[\begin{align*}
\text{kcal.per.g}_i &amp; \sim \text{Normal}(\mu_i, \sigma) \\
\mu_i   &amp; = \alpha + \beta_1 \text{neocortex.perc}_i + \beta_2 \text{log}(\text{mass}_i) \\
\alpha  &amp; \sim \text{Normal}(0, 100) \\
\beta_1 &amp; \sim \text{Normal}(0, 1) \\
\beta_2 &amp; \sim \text{Normal}(0, 1) \\
\sigma  &amp; \sim \text{Uniform}(0, 1)
\end{align*}\]</span>
<p>Note, the HMC chains required a longer <code>warmup</code> period and a higher <code>adapt_delta</code> setting for the model to converge properly. Life will be much better once we ditch the uniform prior for good.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b5.<span class="dv">7</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> dcc, <span class="dt">family =</span> gaussian,
      kcal.per.g <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>neocortex.perc <span class="op">+</span><span class="st"> </span>log_mass,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b),
                <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sigma)),
      <span class="dt">iter =</span> <span class="dv">4000</span>, <span class="dt">warmup =</span> <span class="dv">2000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,
      <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">0.999</span>),
      <span class="dt">seed =</span> <span class="dv">5</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b5.<span class="dv">7</span>, <span class="dt">digits =</span> <span class="dv">3</span>)</code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: kcal.per.g ~ 1 + neocortex.perc + log_mass 
##    Data: dcc (Number of observations: 17) 
## Samples: 4 chains, each with iter = 4000; warmup = 2000; thin = 1;
##          total post-warmup samples = 8000
## 
## Population-Level Effects: 
##                Estimate Est.Error l-95% CI u-95% CI Eff.Sample  Rhat
## Intercept        -1.081     0.575   -2.206    0.078       3660 1.000
## neocortex.perc    0.028     0.009    0.010    0.045       3561 1.000
## log_mass         -0.096     0.028   -0.150   -0.040       3424 1.001
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample  Rhat
## sigma    0.139     0.030    0.095    0.212       3137 1.002
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Make Figure 5.7, bottom left.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nd &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">tibble</span>(<span class="dt">neocortex.perc =</span> <span class="dv">54</span><span class="op">:</span><span class="dv">80</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.double</span>(),
         <span class="dt">log_mass       =</span> <span class="kw">mean</span>(dcc<span class="op">$</span>log_mass))

b5.<span class="dv">7</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">fitted</span>(<span class="dt">newdata =</span> nd, 
         <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">025</span>, .<span class="dv">975</span>, .<span class="dv">25</span>, .<span class="dv">75</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span><span class="st"> </span>

<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> neocortex.perc, <span class="dt">y =</span> Estimate)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2.<span class="dv">5</span>, <span class="dt">ymax =</span> Q97.<span class="dv">5</span>),
              <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q25, <span class="dt">ymax =</span> Q75),
              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,
              <span class="dt">fill =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> dcc, 
             <span class="kw">aes</span>(<span class="dt">y =</span> kcal.per.g),
             <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(dcc<span class="op">$</span>neocortex.perc), 
                  <span class="dt">ylim =</span> <span class="kw">range</span>(dcc<span class="op">$</span>kcal.per.g)) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;kcal.per.g&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-40-1.png" width="288" /></p>
<p>And make Figure 5.7, bottom right.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nd &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">tibble</span>(<span class="dt">log_mass       =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="op">-</span><span class="fl">2.5</span>, <span class="dt">to =</span> <span class="dv">5</span>, <span class="dt">length.out =</span> <span class="dv">30</span>),
         <span class="dt">neocortex.perc =</span> <span class="kw">mean</span>(dcc<span class="op">$</span>neocortex.perc))

b5.<span class="dv">7</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">fitted</span>(<span class="dt">newdata =</span> nd,
         <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">025</span>, .<span class="dv">975</span>, .<span class="dv">25</span>, .<span class="dv">75</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bind_cols</span>(nd) <span class="op">%&gt;%</span><span class="st"> </span>

<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> log_mass, <span class="dt">y =</span> Estimate)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q2.<span class="dv">5</span>, <span class="dt">ymax =</span> Q97.<span class="dv">5</span>),
              <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q25, <span class="dt">ymax =</span> Q75),
              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,
              <span class="dt">fill =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> dcc, 
             <span class="kw">aes</span>(<span class="dt">y =</span> kcal.per.g),
             <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">range</span>(dcc<span class="op">$</span>log_mass), 
                  <span class="dt">ylim =</span> <span class="kw">range</span>(dcc<span class="op">$</span>kcal.per.g)) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;kcal.per.g&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-41-1.png" width="288" /></p>
<blockquote>
<p>What [this regression model did was] ask if species that have high neocortex percent <em>for their body mass</em> have higher milk energy. Likewise, the model [asked] if species with high body mass <em>for their neocortex percent</em> have higher milk energy. Bigger species, like apes, have milk with less energy. But species with more neocortex tend to have richer milk. The fact that these two variables, body size and neocortex, are correlated across species makes it hard to see these relationships, unless we statistically account for both. (pp. 140–141, <em>emphasis</em> in the original)</p>
</blockquote>
<div id="overthinking-simulating-a-masking-relationship." class="section level4">
<h4><span class="header-section-number">5.2.0.1</span> Overthinking: Simulating a masking relationship.</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n   &lt;-<span class="st"> </span><span class="dv">100</span>   <span class="co"># number of cases</span>
rho &lt;-<span class="st"> </span>.<span class="dv">7</span>    <span class="co"># correlation between x_pos and x_neg</span>

<span class="kw">set.seed</span>(<span class="dv">5</span>)  <span class="co"># setting the seed makes the results reproducible</span>
d &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">tibble</span>(<span class="dt">x_pos =</span> <span class="kw">rnorm</span>(n),                                <span class="co"># x_pos as a standard Gaussian</span>
         <span class="dt">x_neg =</span> <span class="kw">rnorm</span>(n, rho <span class="op">*</span><span class="st"> </span>x_pos, <span class="kw">sqrt</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>rho<span class="op">^</span><span class="dv">2</span>)),  <span class="co"># x_neg correlated with x_pos</span>
         <span class="dt">y     =</span> <span class="kw">rnorm</span>(n, x_pos <span class="op">-</span><span class="st"> </span>x_neg))                 <span class="co"># y equally associated with x_pos and x_neg</span></code></pre></div>
<p>Here are the quick <code>pairs()</code> plots.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pairs</span>(d, <span class="dt">col =</span> <span class="st">&quot;firebrick4&quot;</span>)</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-43-1.png" width="432" /></p>
<p>Here we fit the models with a little help from the <code>update()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b5.O.both &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> gaussian,
      y <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x_pos <span class="op">+</span><span class="st"> </span>x_neg,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b),
                <span class="kw">prior</span>(<span class="kw">cauchy</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sigma)),
      <span class="dt">seed =</span> <span class="dv">5</span>)

b5.O.pos &lt;-
<span class="st">  </span><span class="kw">update</span>(b5.O.both, 
         <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x_pos)

b5.O.neg &lt;-
<span class="st">  </span><span class="kw">update</span>(b5.O.both, 
         <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x_neg)</code></pre></div>
<p>Compare the coefficients.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fixef</span>(b5.O.pos)  <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code>##           Estimate Est.Error  Q2.5 Q97.5
## Intercept    -0.01      0.12 -0.24  0.23
## x_pos         0.26      0.13  0.01  0.51</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fixef</span>(b5.O.neg)  <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code>##           Estimate Est.Error  Q2.5 Q97.5
## Intercept     0.01      0.12 -0.23  0.24
## x_neg        -0.29      0.11 -0.50 -0.06</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fixef</span>(b5.O.both) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code>##           Estimate Est.Error  Q2.5 Q97.5
## Intercept     0.00      0.10 -0.20  0.19
## x_pos         0.97      0.15  0.67  1.24
## x_neg        -0.90      0.13 -1.15 -0.64</code></pre>
</div>
</div>
<div id="multicollinearity" class="section level2">
<h2><span class="header-section-number">5.3</span> Multicollinearity</h2>
<blockquote>
<p>Multicollinearity means very strong correlation between two or more predictor variables. The consequence of it is that the posterior distribution will say that a very large range of parameter values are plausible, from tiny associations to massive ones, even if all of the variables are in reality strongly associated with the outcome. This frustrating phenomenon arises from the details of how statistical control works. So once you understand multicollinearity, you will better understand [multivariable] models in general. (pp. 141–142)</p>
</blockquote>
<div id="multicollinear-legs." class="section level3">
<h3><span class="header-section-number">5.3.1</span> Multicollinear legs.</h3>
<p>Let’s simulate some leg data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n &lt;-<span class="st"> </span><span class="dv">100</span>
<span class="kw">set.seed</span>(<span class="dv">5</span>)

d &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">tibble</span>(<span class="dt">height    =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">10</span>, <span class="dt">sd =</span> <span class="dv">2</span>),
         <span class="dt">leg_prop  =</span> <span class="kw">runif</span>(n, <span class="dt">min =</span> <span class="fl">0.4</span>, <span class="dt">max =</span> <span class="fl">0.5</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">leg_left  =</span> leg_prop <span class="op">*</span><span class="st"> </span>height <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="fl">0.02</span>),
         <span class="dt">leg_right =</span> leg_prop <span class="op">*</span><span class="st"> </span>height <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="fl">0.02</span>))</code></pre></div>
<p><code>leg_left</code> and <code>leg_right</code> are <strong>highly</strong> correlated.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(leg_left<span class="op">:</span>leg_right) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">cor</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">4</span>)</code></pre></div>
<pre><code>##           leg_left leg_right
## leg_left    1.0000    0.9996
## leg_right   0.9996    1.0000</code></pre>
<p>Have you ever even seen a <span class="math inline">\(\rho = .9996\)</span> correlation, before? Here it is in a plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> leg_left, <span class="dt">y =</span> leg_right)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-47-1.png" width="288" /></p>
<p>Here’s our attempt to predict <code>height</code> with both legs.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b5.<span class="dv">8</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> gaussian,
      height <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>leg_left <span class="op">+</span><span class="st"> </span>leg_right,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">10</span>, <span class="dv">100</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">2</span>, <span class="dv">10</span>), <span class="dt">class =</span> b),
                <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sigma)),
      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,
      <span class="dt">seed =</span> <span class="dv">5</span>)</code></pre></div>
<p>Let’s inspect the damage.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b5.<span class="dv">8</span>)</code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ 1 + leg_left + leg_right 
##    Data: d (Number of observations: 100) 
## Samples: 4 chains, each with iter = 2000; warmup = 500; thin = 1;
##          total post-warmup samples = 6000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept     1.79      0.29     1.21     2.35       5680 1.00
## leg_left      0.72      2.16    -3.45     5.04       1808 1.00
## leg_right     1.12      2.16    -3.19     5.29       1810 1.00
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sigma     0.61      0.04     0.53     0.70       3593 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>That ‘Est.Error’ column isn’t looking too good. But it’s easy to miss that, which is why McElreath suggested “a graphical view of the [output] is more useful because it displays the posterior [estimates] and [intervals] in a way that allows us with a glance to see that something has gone wrong here” (p. 143).</p>
<p>Here’s our coefficient plot using <code>brms::stanplot()</code> with a little help from <code>bayesplot::color_scheme_set()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">color_scheme_set</span>(<span class="st">&quot;red&quot;</span>)

<span class="kw">stanplot</span>(b5.<span class="dv">8</span>, 
         <span class="dt">type =</span> <span class="st">&quot;intervals&quot;</span>, 
         <span class="dt">prob =</span> .<span class="dv">5</span>, 
         <span class="dt">prob_outer =</span> .<span class="dv">95</span>,
         <span class="dt">point_est =</span> <span class="st">&quot;median&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title    =</span> <span class="st">&quot;The coefficient plot for the two-leg model&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Holy smokes; look at the widths of those betas!&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">text         =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">14</span>),
        <span class="dt">panel.grid   =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.text.y  =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>))</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-49-1.png" width="624" /></p>
<p>Now you can use the <code>brms::stanplot()</code> function without explicitly loading the bayesplot package. But loading bayesplot allows you to set the color scheme with <code>color_scheme_set()</code>.</p>
<p>This is perhaps the simplest way to plot the bivariate posterior of our two predictor coefficients, Figure 6.2.a.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pairs</span>(b5.<span class="dv">8</span>, <span class="dt">pars =</span> <span class="kw">parnames</span>(b5.<span class="dv">8</span>)[<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>])</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-50-1.png" width="288" /></p>
<p>If you’d like a nicer and more focused attempt, you might have to revert to the <code>posterior_samples()</code> function and a little ggplot2 code.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(b5.<span class="dv">8</span>)
  
post <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> b_leg_left, <span class="dt">y =</span> b_leg_right)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-51-1.png" width="288" /></p>
<p>While we’re at it, you can make a similar plot with the <a href="https://cran.r-project.org/web/packages/bayesplot/vignettes/plotting-mcmc-draws.html"><code>mcmc_scatter()</code> function</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">post <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mcmc_scatter</span>(<span class="dt">pars  =</span> <span class="kw">c</span>(<span class="st">&quot;b_leg_left&quot;</span>, <span class="st">&quot;b_leg_right&quot;</span>),
               <span class="dt">size  =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, 
               <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-52-1.png" width="288" /></p>
<p>But wow, those coefficients look about as highly correlated as the predictors, just with the reversed sign.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">post <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(b_leg_left<span class="op">:</span>b_leg_right) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">cor</span>()</code></pre></div>
<pre><code>##             b_leg_left b_leg_right
## b_leg_left   1.0000000  -0.9995795
## b_leg_right -0.9995795   1.0000000</code></pre>
<p>On page 165, McElreath clarified that “from the computer’s perspective, this model is simply:”</p>
<span class="math display">\[\begin{align*}
y_i   &amp; \sim \text{Normal}(\mu_i, \sigma) \\
\mu_i &amp; = \alpha + (\beta_1 + \beta_2) x_i
\end{align*}\]</span>
<p>Accordingly, here’s the posterior of the sum of the two regression coefficients, Figure 6.2.b. We’ll use <code>tidybayes::geom_halfeyeh()</code> to both plot the density and mark off the posterior median and percentile-based 95% probability intervals at its base.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidybayes)

post <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> b_leg_left <span class="op">+</span><span class="st"> </span>b_leg_right, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_halfeyeh</span>(<span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, 
                <span class="dt">point_interval =</span> median_qi, <span class="dt">.width =</span> .<span class="dv">95</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title    =</span> <span class="st">&quot;Sum the multicollinear coefficients&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Marked by the median and 95% PIs&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-54-1.png" width="288" /></p>
<p>Now we fit the model after ditching one of the leg lengths.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b5.<span class="dv">9</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> gaussian,
      height <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>leg_left,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">10</span>, <span class="dv">100</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">2</span>, <span class="dv">10</span>), <span class="dt">class =</span> b),
                <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sigma)),
      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,
      <span class="dt">seed =</span> <span class="dv">5</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b5.<span class="dv">9</span>)</code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ 1 + leg_left 
##    Data: d (Number of observations: 100) 
## Samples: 4 chains, each with iter = 2000; warmup = 500; thin = 1;
##          total post-warmup samples = 6000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept     1.79      0.28     1.23     2.34       7237 1.00
## leg_left      1.84      0.06     1.72     1.96       7355 1.00
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sigma     0.60      0.04     0.53     0.69       7203 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>That posterior <span class="math inline">\(SD\)</span> looks much better. Compare this density to the one in Figure 6.1.b.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">posterior_samples</span>(b5.<span class="dv">9</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> b_leg_left, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_halfeyeh</span>(<span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, 
                <span class="dt">point_interval =</span> median_qi, <span class="dt">.width =</span> .<span class="dv">95</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title    =</span> <span class="st">&quot;Just one coefficient needed&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Marked by the median and 95% PIs&quot;</span>,
       <span class="dt">x        =</span> <span class="st">&quot;only b_leg_left, this time&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-56-1.png" width="288" /></p>
<blockquote>
<p><em>When two predictor variables are very strongly correlated, including both in a model may lead to confusion.</em> The posterior distribution isn’t wrong, in such a case. It’s telling you that the question you asked cannot be answered with these data. And that’s a great thing for a model to say, that it cannot answer your question. (p. 145, <em>emphasis</em> in the original)</p>
</blockquote>
</div>
<div id="multicollinear-milk." class="section level3">
<h3><span class="header-section-number">5.3.2</span> Multicollinear <code>milk</code>.</h3>
<p>Multicollinearity arises in real data, too.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rethinking)
<span class="kw">data</span>(milk)
d &lt;-<span class="st"> </span>milk</code></pre></div>
<p>Unload rethinking and load brms.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rm</span>(milk)
<span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> <span class="ot">TRUE</span>)
<span class="kw">library</span>(brms)</code></pre></div>
<p>We’ll follow the text and fit the two univariable models, first. Note our use of the <code>update()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># `kcal.per.g` regressed on `perc.fat`</span>
b5.<span class="dv">10</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> gaussian,
      kcal.per.g <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>perc.fat,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(.<span class="dv">6</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b),
                <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sigma)),
      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,
      <span class="dt">seed =</span> <span class="dv">5</span>)

<span class="co"># `kcal.per.g` regressed on `perc.lactose`</span>
b5.<span class="dv">11</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">update</span>(b5.<span class="dv">10</span>,
         <span class="dt">newdata =</span> d,
         <span class="dt">formula =</span> kcal.per.g <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>perc.lactose)</code></pre></div>
<p>Compare the coefficients.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">posterior_summary</span>(b5.<span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</code></pre></div>
<pre><code>##             Estimate Est.Error   Q2.5  Q97.5
## b_Intercept    0.301     0.040  0.223  0.379
## b_perc.fat     0.010     0.001  0.008  0.012
## sigma          0.080     0.011  0.061  0.106
## lp__          24.017     1.275 20.740 25.490</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">posterior_summary</span>(b5.<span class="dv">11</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</code></pre></div>
<pre><code>##                Estimate Est.Error   Q2.5  Q97.5
## b_Intercept       1.167     0.047  1.078  1.261
## b_perc.lactose   -0.011     0.001 -0.012 -0.009
## sigma             0.067     0.010  0.051  0.090
## lp__             28.776     1.273 25.582 30.273</code></pre>
<p>If you’d like to get just the 95% intervals similar to the way McElreath reported them in the prose on page 146, you might use the handy <code>posterior_interval()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">posterior_interval</span>(b5.<span class="dv">10</span>)[<span class="dv">2</span>, ] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</code></pre></div>
<pre><code>##  2.5% 97.5% 
## 0.008 0.012</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">posterior_interval</span>(b5.<span class="dv">11</span>)[<span class="dv">2</span>, ] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</code></pre></div>
<pre><code>##   2.5%  97.5% 
## -0.012 -0.009</code></pre>
<p>Now “watch what happens when we place both predictor variables in the same regression model” (p. 146).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b5.<span class="dv">12</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">update</span>(b5.<span class="dv">11</span>,
         <span class="dt">newdata =</span> d,
         <span class="dt">formula =</span> kcal.per.g <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>perc.fat <span class="op">+</span><span class="st"> </span>perc.lactose)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">posterior_summary</span>(b5.<span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</code></pre></div>
<pre><code>##                Estimate Est.Error   Q2.5  Q97.5
## b_Intercept       1.008     0.227  0.558  1.455
## b_perc.fat        0.002     0.003 -0.003  0.007
## b_perc.lactose   -0.009     0.003 -0.014 -0.003
## sigma             0.068     0.010  0.051  0.091
## lp__             27.570     1.535 23.649 29.514</code></pre>
<p>You can make custom pairs plots with <a href="https://cran.r-project.org/web/packages/GGally/index.html">GGally</a>, which will also compute the point estimates for the bivariate correlations. Here’s a default plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#install.packages(&quot;GGally&quot;, dependencies = T)</span>
<span class="kw">library</span>(GGally)

<span class="kw">ggpairs</span>(<span class="dt">data =</span> d, <span class="dt">columns =</span> <span class="kw">c</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">6</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-62-1.png" width="288" /></p>
<p>But you can customize <a href="http://ggobi.github.io/ggally/">these</a>, too. E.g.,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_diag &lt;-<span class="st"> </span><span class="cf">function</span>(data, mapping, ...){
  <span class="kw">ggplot</span>(<span class="dt">data =</span> data, <span class="dt">mapping =</span> mapping) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_density</span>(<span class="dt">fill =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">size =</span> <span class="dv">0</span>)
}

my_lower &lt;-<span class="st"> </span><span class="cf">function</span>(data, mapping, ...){
  <span class="kw">ggplot</span>(<span class="dt">data =</span> data, <span class="dt">mapping =</span> mapping) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, 
                <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">alpha =</span> .<span class="dv">8</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>)
  }

<span class="co"># then plug those custom functions into `ggpairs()`</span>
<span class="kw">ggpairs</span>(<span class="dt">data  =</span> d, <span class="dt">columns =</span> <span class="kw">c</span>(<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">6</span>),
        <span class="dt">diag  =</span> <span class="kw">list</span>(<span class="dt">continuous =</span> my_diag),
        <span class="dt">lower =</span> <span class="kw">list</span>(<span class="dt">continuous =</span> my_lower)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>),
        <span class="dt">axis.text        =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.ticks       =</span> <span class="kw">element_blank</span>(),
        <span class="dt">panel.grid       =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-63-1.png" width="288" /></p>
<p>Our two predictor “variables are negatively correlated, and so strongly so that they are nearly redundant. Either helps in predicting <code>kcal.per.g</code>, but neither helps much <em>once you already know the other</em>” (p. 148, <em>emphasis</em> in the original). You can really see that on the lower two scatter plots. You’ll note the <code>ggpairs()</code> plot also showed the Pearson’s correlation coefficients, se we don’t need to use the <code>cor()</code> function like McElreath did in the text.</p>
<p>In the next section, we’ll run the simulation necessary for our version of Figure 5.10.</p>
<div id="overthinking-simulating-collinearity." class="section level4">
<h4><span class="header-section-number">5.3.2.1</span> Overthinking: Simulating collinearity.</h4>
<p>First we’ll get the data and define the functions. You’ll note I’ve defined my <code>sim_coll()</code> a little differently from <code>sim.coll()</code> in the text. I’ve omitted <code>rep.sim.coll()</code> as an independent function altogether, but computed similar summary information with the <code>summarise()</code> code at the bottom of the block.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_coll &lt;-<span class="st"> </span><span class="cf">function</span>(seed, rho){
  <span class="kw">set.seed</span>(seed)
  d &lt;-
<span class="st">    </span>d <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">x =</span> <span class="kw">rnorm</span>(<span class="kw">n</span>(), 
                     <span class="dt">mean =</span> perc.fat <span class="op">*</span><span class="st"> </span>rho,
                     <span class="dt">sd   =</span> <span class="kw">sqrt</span>((<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>rho<span class="op">^</span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span><span class="kw">var</span>(perc.fat))))
    
  m &lt;-<span class="st"> </span><span class="kw">lm</span>(kcal.per.g <span class="op">~</span><span class="st"> </span>perc.fat <span class="op">+</span><span class="st"> </span>x, <span class="dt">data =</span> d)
  
  <span class="kw">sqrt</span>(<span class="kw">diag</span>(<span class="kw">vcov</span>(m)))[<span class="dv">2</span>]  <span class="co"># parameter SD</span>
}

<span class="co"># how many simulations per `rho`-value would you like?</span>
n_seed &lt;-<span class="st"> </span><span class="dv">100</span>
<span class="co"># how many `rho`-values from 0 to .99 would you like to evaluate the process over?</span>
n_rho  &lt;-<span class="st"> </span><span class="dv">30</span>

d &lt;-
<span class="st">  </span><span class="kw">tibble</span>(<span class="dt">seed =</span> <span class="dv">1</span><span class="op">:</span>n_seed) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">expand</span>(seed, <span class="dt">rho =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> .<span class="dv">99</span>, <span class="dt">length.out =</span> n_rho)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">parameter_sd =</span> purrr<span class="op">::</span><span class="kw">map2_dbl</span>(seed, rho, sim_coll)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(rho) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># we&#39;ll `summarise()` our output by the mean and 95% intervals</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(parameter_sd),
            <span class="dt">ll   =</span> <span class="kw">quantile</span>(parameter_sd, <span class="dt">prob =</span> .<span class="dv">025</span>),
            <span class="dt">ul   =</span> <span class="kw">quantile</span>(parameter_sd, <span class="dt">prob =</span> .<span class="dv">975</span>))</code></pre></div>
<p>We’ve added 95% interval bands to our version of Figure 5.10.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rho, <span class="dt">y =</span> mean)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> ll, <span class="dt">ymax =</span> ul),
              <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>,
              <span class="dt">fill =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;firebrick4&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">size =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(rho),
       <span class="dt">y =</span> <span class="st">&quot;parameter SD&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, .<span class="dv">0072</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-65-1.png" width="312" /></p>
<p>Did you notice we used the base R <code>lm()</code> function to fit the models? As McElreath rightly pointed out, <code>lm()</code> presumes flat priors. Proper Bayesian modeling could improve on that. But then we’d have to wait for a whole lot of HMC chains to run and until our personal computers or the algorithms we use to fit our Bayesian models become orders of magnitude faster, we just don’t have time for that.</p>
</div>
</div>
<div id="post-treatment-bias." class="section level3">
<h3><span class="header-section-number">5.3.3</span> Post-treatment bias.</h3>
<p>It helped me understand the next example by mapping out the sequence of events McElreath described in the second paragraph:</p>
<ul>
<li>seed and sprout plants</li>
<li>measure heights</li>
<li>apply different antifungal soil treatments (i.e., the experimental manipulation)</li>
<li>measure (a) the heights and (b) the presence of fungus</li>
</ul>
<p>Based on the design, let’s simulate our data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n &lt;-<span class="st"> </span><span class="dv">100</span>

<span class="kw">set.seed</span>(<span class="dv">5</span>)
d &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">tibble</span>(<span class="dt">h0        =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">10</span>, <span class="dt">sd =</span> <span class="dv">2</span>), 
         <span class="dt">treatment =</span> <span class="kw">rep</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">each =</span> n <span class="op">/</span><span class="st"> </span><span class="dv">2</span>),
         <span class="dt">fungus    =</span> <span class="kw">rbinom</span>(n, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> .<span class="dv">5</span> <span class="op">-</span><span class="st"> </span>treatment <span class="op">*</span><span class="st"> </span><span class="fl">0.4</span>),
         <span class="dt">h1        =</span> h0 <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">mean =</span> <span class="dv">5</span> <span class="op">-</span><span class="st"> </span><span class="dv">3</span> <span class="op">*</span><span class="st"> </span>fungus, <span class="dt">sd =</span> <span class="dv">1</span>))</code></pre></div>
<p>We’ll use <code>head()</code> to peek at the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>()</code></pre></div>
<pre><code>## # A tibble: 6 x 4
##      h0 treatment fungus    h1
##   &lt;dbl&gt;     &lt;int&gt;  &lt;int&gt; &lt;dbl&gt;
## 1  8.32         0      0 14.3 
## 2 12.8          0      0 18.5 
## 3  7.49         0      1  8.97
## 4 10.1          0      1 12.9 
## 5 13.4          0      1 14.8 
## 6  8.79         0      1 12.0</code></pre>
<p>These data + the model were rough on Stan, at first, which spat out warnings about divergent transitions. The model ran fine after setting <code>warmup = 1000</code> and <code>adapt_delta = 0.99</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b5.<span class="dv">13</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> gaussian,
      h1 <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>h0 <span class="op">+</span><span class="st"> </span>treatment <span class="op">+</span><span class="st"> </span>fungus,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> b),
                <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sigma)),
      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,
      <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">0.99</span>),
      <span class="dt">seed =</span> <span class="dv">5</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b5.<span class="dv">13</span>)</code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: h1 ~ 1 + h0 + treatment + fungus 
##    Data: d (Number of observations: 100) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept     5.58      0.56     4.49     6.69       2954 1.00
## h0            0.94      0.05     0.83     1.05       3313 1.00
## treatment     0.05      0.22    -0.41     0.48        917 1.00
## fungus       -2.76      0.26    -3.26    -2.26       1950 1.00
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sigma     1.01      0.08     0.87     1.16       3046 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Now fit the model after excluding <code>fungus</code>, our post-treatment variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b5.<span class="dv">14</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">update</span>(b5.<span class="dv">13</span>, 
         <span class="dt">formula =</span> h1 <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>h0 <span class="op">+</span><span class="st"> </span>treatment)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b5.<span class="dv">14</span>)</code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: h1 ~ h0 + treatment 
##    Data: d (Number of observations: 100) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept     5.49      0.83     3.87     7.13       1882 1.00
## h0            0.82      0.08     0.67     0.98       1956 1.00
## treatment     1.01      0.31     0.39     1.60       1748 1.00
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sigma     1.53      0.12     1.32     1.76       1153 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>“Now the impact of treatment is strong and positive, as it should be” (p. 152). In this case, there were really two outcomes. The first was the one we modeled, the height at the end of the experiment (i.e., <code>h1</code>). The second outcome, which was clearly related to <code>h1</code>, was the presence of fungus, captured by our binomial variable <code>fungus</code>. If you wanted to model that, you’d fit a logistic regression model, which we’ll learn about in Chapter 10.</p>
</div>
</div>
<div id="categorical-variables" class="section level2">
<h2><span class="header-section-number">5.4</span> Categorical variables</h2>
<blockquote>
<p>Many readers will already know that variables like this, routinely called <em>factors</em>, can easily be included in linear models. But what is not widely understood is how these variables are included in a model… Knowing how the machine works removes a lot of this difficulty. (p. 153, <em>emphasis</em> in the original)</p>
</blockquote>
<div id="binary-categories." class="section level3">
<h3><span class="header-section-number">5.4.1</span> Binary categories.</h3>
<p>Reload the <code>Howell1</code> data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rethinking)
<span class="kw">data</span>(Howell1)
d &lt;-<span class="st"> </span>Howell1</code></pre></div>
<p>Unload rethinking and load brms.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rm</span>(Howell1)
<span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)
<span class="kw">library</span>(brms)</code></pre></div>
<p>Just in case you forgot what these data were like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">glimpse</span>()</code></pre></div>
<pre><code>## Observations: 544
## Variables: 4
## $ height &lt;dbl&gt; 151.7650, 139.7000, 136.5250, 156.8450, 145.4150, 163.830…
## $ weight &lt;dbl&gt; 47.82561, 36.48581, 31.86484, 53.04191, 41.27687, 62.9925…
## $ age    &lt;dbl&gt; 63.0, 63.0, 65.0, 41.0, 51.0, 35.0, 32.0, 27.0, 19.0, 54.…
## $ male   &lt;int&gt; 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 1, …</code></pre>
<p>Let’s fit the first <code>height</code> model with the <code>male</code> dummy.</p>
<p>Note. The uniform prior McElreath used in the text in conjunction with the <code>brms::brm()</code> function seemed to cause problems for the HMC chains, here. After experimenting with start values, increasing <code>warmup</code>, and increasing <code>adapt_delta</code>, switching out the uniform prior did the trick. Anticipating Chapter 8, I recommend you use a weakly-regularizing half Cauchy for <span class="math inline">\(\sigma\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b5.<span class="dv">15</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> gaussian,
      height <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>male,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">178</span>, <span class="dv">100</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> b),
                <span class="kw">prior</span>(<span class="kw">cauchy</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="dt">class =</span> sigma)),
      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,
      <span class="dt">seed =</span> <span class="dv">5</span>)</code></pre></div>
<p>Check the summary.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b5.<span class="dv">15</span>)</code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ 1 + male 
##    Data: d (Number of observations: 544) 
## Samples: 4 chains, each with iter = 2000; warmup = 500; thin = 1;
##          total post-warmup samples = 6000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept   134.84      1.61   131.63   137.99       6321 1.00
## male          7.23      2.31     2.66    11.84       6303 1.00
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sigma    27.38      0.84    25.80    29.06       6445 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Our samples from the posterior are already in the HMC iterations. All we need to do is put them in a data frame and then put them to work.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">post &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(b5.<span class="dv">15</span>)

post <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">transmute</span>(<span class="dt">male_height =</span> b_Intercept <span class="op">+</span><span class="st"> </span>b_male) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mean_qi</span>(<span class="dt">.width =</span> .<span class="dv">89</span>)</code></pre></div>
<pre><code>##   male_height   .lower  .upper .width .point .interval
## 1    142.0679 139.3071 144.855   0.89   mean        qi</code></pre>
<p>You can also do this with <code>fitted()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">male =</span> <span class="dv">1</span>)

<span class="kw">fitted</span>(b5.<span class="dv">15</span>,
       <span class="dt">newdata =</span> nd)</code></pre></div>
<pre><code>##      Estimate Est.Error     Q2.5    Q97.5
## [1,] 142.0679  1.723907 138.7037 145.4691</code></pre>
<p>And you could even plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fitted</span>(b5.<span class="dv">15</span>,
       <span class="dt">newdata =</span> nd,
       <span class="dt">summary =</span> F) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> V1, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_halfeyeh</span>(<span class="dt">fill =</span> <span class="st">&quot;firebrick4&quot;</span>, 
                <span class="dt">point_interval =</span> median_qi, <span class="dt">.width =</span> .<span class="dv">95</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Model-implied male heights&quot;</span>,
       <span class="dt">x =</span> <span class="kw">expression</span>(alpha <span class="op">+</span><span class="st"> </span>beta[<span class="st">&quot;male&quot;</span>])) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-76-1.png" width="288" /></p>
<div id="overthinking-re-parameterizing-the-model." class="section level4">
<h4><span class="header-section-number">5.4.1.1</span> Overthinking: Re-parameterizing the model.</h4>
<p>The reparameterized model follows the form</p>
<span class="math display">\[\begin{align*}
\text{height}_i &amp; \sim \text{Normal}(\mu_i, \sigma) \\
\mu_i &amp; = \alpha_\text{female} (1 - \text{male}_i) + \alpha_\text{male} \text{male}_i
\end{align*}\]</span>
<p>So then a <code>female</code> dummy would satisfy the condition <span class="math inline">\(\text{female}_i = (1 - \text{male}_i)\)</span>. Let’s make that dummy.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-
<span class="st">  </span>d <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">female =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>male)</code></pre></div>
<p>Everyone has their own idiosyncratic way of coding. One of my quirks is I always explicitly specify a model’s intercept following the form <code>y ~ 1 + x</code>, where <code>y</code> is the criterion, <code>x</code> stands for the predictors, and <code>1</code> is the intercept. You don’t have to do this, of course. You could just code <code>y ~ x</code> to get the same results. The <code>brm()</code> function assumes you want that intercept. One of the reasons I like the verbose version is it reminds me to think about the intercept and to include it in my priors. Another nice feature is that is helps me make sense of the code for this model: <code>height ~ 0 + male + female</code>. When we replace <code>… ~ 1 + …</code> with <code>… ~ 0 + …</code>, we tell <code>brm()</code> to remove the intercept. Removing the intercept allows us to include ALL levels of a given categorical variable in our model. In this case, we’ve expressed sex as two dummies, <code>female</code> and <code>male</code>. Taking out the intercept lets us put both dummies into the formula.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b5.15b &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> gaussian,
      height <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>male <span class="op">+</span><span class="st"> </span>female,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">178</span>, <span class="dv">100</span>), <span class="dt">class =</span> b),
                <span class="kw">prior</span>(<span class="kw">cauchy</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="dt">class =</span> sigma)),
      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,
      <span class="dt">seed =</span> <span class="dv">5</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b5.15b)</code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: height ~ 0 + male + female 
##    Data: d (Number of observations: 544) 
## Samples: 4 chains, each with iter = 2000; warmup = 500; thin = 1;
##          total post-warmup samples = 6000
## 
## Population-Level Effects: 
##        Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## male     142.35      1.70   139.04   145.66       5863 1.00
## female   134.63      1.61   131.48   137.70       5442 1.00
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sigma    27.38      0.84    25.79    29.12       5000 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>If we wanted the formal difference score from such a model, we’d subtract.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">posterior_samples</span>(b5.15b) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">transmute</span>(<span class="dt">dif =</span> b_male <span class="op">-</span><span class="st"> </span>b_female) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> dif, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_halfeyeh</span>(<span class="dt">fill =</span> <span class="st">&quot;firebrick4&quot;</span>, 
                <span class="dt">point_interval =</span> median_qi, <span class="dt">.width =</span> .<span class="dv">95</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Model-implied difference score&quot;</span>,
       <span class="dt">x =</span> <span class="kw">expression</span>(alpha[<span class="st">&quot;male&quot;</span>] <span class="op">-</span><span class="st"> </span>alpha[<span class="st">&quot;female&quot;</span>])) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-79-1.png" width="288" /></p>
</div>
</div>
<div id="many-categories." class="section level3">
<h3><span class="header-section-number">5.4.2</span> Many categories.</h3>
<blockquote>
<p>When there are more than two categories, you’ll need more than one dummy variable. Here’s the general rule: To include <span class="math inline">\(k\)</span> categories in a linear model, you require <span class="math inline">\(k - 1\)</span> dummy variables. Each dummy variable indicates, with the value 1, a unique category. The category with no dummy variable assigned to it ends up again as the “intercept” category. (p. 155)</p>
</blockquote>
<p>We’ll practice with <code>milk</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rethinking)
<span class="kw">data</span>(milk)
d &lt;-<span class="st"> </span>milk</code></pre></div>
<p>Unload rethinking and load brms.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rm</span>(milk)
<span class="kw">detach</span>(package<span class="op">:</span>rethinking, <span class="dt">unload =</span> T)
<span class="kw">library</span>(brms)</code></pre></div>
<p>With the tidyverse, we can peek at <code>clade</code> with <code>distinct()</code> in the place of base R <code>unique()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">distinct</span>(clade)</code></pre></div>
<pre><code>##              clade
## 1    Strepsirrhine
## 2 New World Monkey
## 3 Old World Monkey
## 4              Ape</code></pre>
<p>As <code>clade</code> has 4 categories, let’s use <code>ifelse()</code> to convert these to 4 dummy variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span>
<span class="st">  </span>d <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">clade_nwm =</span> <span class="kw">ifelse</span>(clade <span class="op">==</span><span class="st"> &quot;New World Monkey&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>),
         <span class="dt">clade_owm =</span> <span class="kw">ifelse</span>(clade <span class="op">==</span><span class="st"> &quot;Old World Monkey&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>),
         <span class="dt">clade_s   =</span> <span class="kw">ifelse</span>(clade <span class="op">==</span><span class="st"> &quot;Strepsirrhine&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>),
         <span class="dt">clade_ape =</span> <span class="kw">ifelse</span>(clade <span class="op">==</span><span class="st"> &quot;Ape&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>))</code></pre></div>
<p>Now we’ll fit the model with three of the four dummies. In this model, <code>clade_ape</code> is the reference category captured by the intercept.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b5.<span class="dv">16</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> gaussian,
      kcal.per.g <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>clade_nwm <span class="op">+</span><span class="st"> </span>clade_owm <span class="op">+</span><span class="st"> </span>clade_s,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(.<span class="dv">6</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> b),
                <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sigma)),
      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,
      <span class="dt">seed =</span> <span class="dv">5</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b5.<span class="dv">16</span>)</code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: kcal.per.g ~ 1 + clade_nwm + clade_owm + clade_s 
##    Data: d (Number of observations: 29) 
## Samples: 4 chains, each with iter = 2000; warmup = 500; thin = 1;
##          total post-warmup samples = 6000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept     0.55      0.04     0.46     0.63       4771 1.00
## clade_nwm     0.17      0.06     0.05     0.29       4874 1.00
## clade_owm     0.24      0.07     0.11     0.38       5031 1.00
## clade_s      -0.04      0.07    -0.18     0.11       5308 1.00
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sigma     0.13      0.02     0.10     0.17       5397 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Here we grab the chains, our draws from the posterior.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">post &lt;-<span class="st"> </span>
<span class="st">  </span>b5.<span class="dv">16</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">posterior_samples</span>()

<span class="kw">head</span>(post)</code></pre></div>
<pre><code>##   b_Intercept b_clade_nwm b_clade_owm    b_clade_s     sigma     lp__
## 1   0.5575386   0.1932337   0.2276990  0.043159795 0.1275090 9.271587
## 2   0.4800805   0.2532488   0.2068195  0.010154008 0.1325052 7.787578
## 3   0.5449358   0.1740914   0.3652368  0.006283387 0.1182335 7.644787
## 4   0.4359255   0.2517067   0.3219673  0.128277164 0.1410273 6.847354
## 5   0.5666455   0.2048127   0.2708950 -0.025282543 0.1228911 9.358463
## 6   0.5470347   0.2507482   0.1803077 -0.098373317 0.1195493 7.604434</code></pre>
<p>You might compute averages for each category and summarizing the results with the transpose of base R’s <code>apply()</code> function, rounding to two digits of precision.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">post<span class="op">$</span>mu_ape &lt;-<span class="st"> </span>post<span class="op">$</span>b_Intercept
post<span class="op">$</span>mu_nwm &lt;-<span class="st"> </span>post<span class="op">$</span>b_Intercept <span class="op">+</span><span class="st"> </span>post<span class="op">$</span>b_clade_nwm
post<span class="op">$</span>mu_owm &lt;-<span class="st"> </span>post<span class="op">$</span>b_Intercept <span class="op">+</span><span class="st"> </span>post<span class="op">$</span>b_clade_owm
post<span class="op">$</span>mu_s   &lt;-<span class="st"> </span>post<span class="op">$</span>b_Intercept <span class="op">+</span><span class="st"> </span>post<span class="op">$</span>b_clade_s

<span class="kw">round</span>(<span class="kw">t</span>(<span class="kw">apply</span>(post[ ,<span class="dv">7</span><span class="op">:</span><span class="dv">10</span>], <span class="dv">2</span>, quantile, <span class="kw">c</span>(.<span class="dv">5</span>, .<span class="dv">025</span>, .<span class="dv">975</span>))), <span class="dt">digits =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code>##         50% 2.5% 97.5%
## mu_ape 0.55 0.46  0.63
## mu_nwm 0.71 0.63  0.80
## mu_owm 0.79 0.68  0.89
## mu_s   0.51 0.39  0.63</code></pre>
<p>Here’s a more tidyverse sort of way to get the same thing, but this time with means and HPDIs via the <code>tidybayes::mean_hdi()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">post <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">transmute</span>(<span class="dt">mu_ape =</span> b_Intercept,
            <span class="dt">mu_nwm =</span> b_Intercept <span class="op">+</span><span class="st"> </span>b_clade_nwm,
            <span class="dt">mu_owm =</span> b_Intercept <span class="op">+</span><span class="st"> </span>b_clade_owm,
            <span class="dt">mu_s   =</span> b_Intercept <span class="op">+</span><span class="st"> </span>b_clade_s) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(key) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mean_hdi</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate_if</span>(is.double, round, <span class="dt">digits =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code>## # A tibble: 4 x 7
##   key    value .lower .upper .width .point .interval
##   &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 mu_ape  0.55   0.46   0.63   0.95 mean   hdi      
## 2 mu_nwm  0.71   0.62   0.8    0.95 mean   hdi      
## 3 mu_owm  0.79   0.68   0.89   0.95 mean   hdi      
## 4 mu_s    0.51   0.4    0.63   0.95 mean   hdi</code></pre>
<p>You could also summarize with <code>fitted()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nd &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">clade_nwm =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),
             <span class="dt">clade_owm =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>),
             <span class="dt">clade_s   =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),
             <span class="dt">primate   =</span> <span class="kw">c</span>(<span class="st">&quot;New World Monkey&quot;</span>, <span class="st">&quot;Old World Monkey&quot;</span>, <span class="st">&quot;Strepsirrhine&quot;</span>, <span class="st">&quot;Ape&quot;</span>))

<span class="kw">fitted</span>(b5.<span class="dv">16</span>,
       <span class="dt">newdata =</span> nd,
       <span class="dt">summary =</span> F) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">primate =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;New World Monkey&quot;</span>, <span class="st">&quot;Old World Monkey&quot;</span>, <span class="st">&quot;Strepsirrhine&quot;</span>, <span class="st">&quot;Ape&quot;</span>), 
                       <span class="dt">each =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">4</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> <span class="kw">reorder</span>(primate, value))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_halfeyeh</span>(<span class="dt">fill =</span> <span class="st">&quot;firebrick4&quot;</span>, 
                <span class="dt">point_interval =</span> median_qi, <span class="dt">.width =</span> .<span class="dv">95</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;kcal.per.g&quot;</span>,
       <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid   =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.text.y  =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>))</code></pre></div>
<p><img src="05_files/figure-html/unnamed-chunk-88-1.png" width="576" /></p>
<p>And there are multiple ways to compute summary statistics for the difference between <code>NWM</code> and <code>OWM</code>, too.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># base R</span>
<span class="kw">quantile</span>(post<span class="op">$</span>mu_nwm <span class="op">-</span><span class="st"> </span>post<span class="op">$</span>mu_owm, <span class="dt">probs =</span> <span class="kw">c</span>(.<span class="dv">5</span>, .<span class="dv">025</span>, .<span class="dv">975</span>))</code></pre></div>
<pre><code>##         50%        2.5%       97.5% 
## -0.07362279 -0.21514058  0.06410530</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># tidyverse + tidybayes</span>
post <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">transmute</span>(<span class="dt">dif =</span> mu_nwm <span class="op">-</span><span class="st"> </span>mu_owm) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">median_qi</span>()</code></pre></div>
<pre><code>##           dif     .lower    .upper .width .point .interval
## 1 -0.07362279 -0.2151406 0.0641053   0.95 median        qi</code></pre>
</div>
<div id="adding-regular-predictor-variables." class="section level3">
<h3><span class="header-section-number">5.4.3</span> Adding regular predictor variables.</h3>
<p>If we wanted to fit the model including <code>perc.fat</code> as an additional predictor, the basic statistical formula would be</p>
<p><span class="math display">\[
\mu_i = \alpha + \beta_\text{clade_nwm} \text{clade_nwm}_i + \beta_\text{clade_owm} \text{clade_owm}_i + \beta_\text{clade_s} \text{clade_s}_i + \beta_\text{perc.fat} \text{perc.fat}_i
\]</span></p>
<p>The corresponding <code>formula</code> argument within <code>brm()</code> would be <code>kcal.per.g ~ 1 + clade_nwm + clade_owm + clade_s + perc.fat</code>.</p>
</div>
<div id="another-approach-unique-intercepts." class="section level3">
<h3><span class="header-section-number">5.4.4</span> Another approach: Unique intercepts.</h3>
<p>Using the code below, there’s no need to transform <code>d$clade</code> into <code>d$clade_id</code>. The advantage of this approach is the indices in the model summary are more descriptive than <code>a[1]</code> through <code>a[4]</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b5.16_alt &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> d, <span class="dt">family =</span> gaussian,
      kcal.per.g <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>clade,
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(.<span class="dv">6</span>, <span class="dv">10</span>), <span class="dt">class =</span> b),
                <span class="kw">prior</span>(<span class="kw">uniform</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> sigma)),
      <span class="dt">iter =</span> <span class="dv">2000</span>, <span class="dt">warmup =</span> <span class="dv">500</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,
      <span class="dt">seed =</span> <span class="dv">5</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(b5.16_alt)</code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: kcal.per.g ~ 0 + clade 
##    Data: d (Number of observations: 29) 
## Samples: 4 chains, each with iter = 2000; warmup = 500; thin = 1;
##          total post-warmup samples = 6000
## 
## Population-Level Effects: 
##                     Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## cladeApe                0.55      0.04     0.46     0.64       7023 1.00
## cladeNewWorldMonkey     0.71      0.04     0.63     0.80       7420 1.00
## cladeOldWorldMonkey     0.79      0.05     0.68     0.89       6222 1.00
## cladeStrepsirrhine      0.51      0.06     0.39     0.63       7233 1.00
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sigma     0.13      0.02     0.10     0.17       4777 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>See? This is much easier than trying to remember which one was which in an arbitrary numeric index.</p>
</div>
</div>
<div id="ordinary-least-squares-and-lm" class="section level2">
<h2><span class="header-section-number">5.5</span> <del>Ordinary least squares and <code>lm()</code></del></h2>
<p>Since this section centers on the frequentist <code>lm()</code> function, I’m going to largely ignore it. A couple things, though. You’ll note how the brms package uses the <code>lm()</code>-like design formula syntax. Although not as pedagogical as the more formal rethinking syntax, it has the advantage of cohering with the popular <a href="https://cran.r-project.org/web/packages/lme4/index.html">lme4</a> syntax for multilevel models.</p>
<p>Also, on page 161 McElreath clarified that one cannot use the <code>I()</code> syntax with his rethinking package. Not so with brms. The <code>I()</code> syntax works just fine with <code>brms::brm()</code>. We’ve already made use of it in the “Polynomial regression” section of Chapter 4.</p>
</div>
<div id="reference-4" class="section level2 unnumbered">
<h2>Reference</h2>
<p><a href="https://xcelab.net/rm/statistical-rethinking/">McElreath, R. (2016). <em>Statistical rethinking: A Bayesian course with examples in R and Stan.</em> Chapman &amp; Hall/CRC Press.</a></p>
</div>
<div id="session-info-4" class="section level2 unnumbered">
<h2>Session info</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sessionInfo</span>()</code></pre></div>
<pre><code>## R version 3.5.1 (2018-07-02)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS High Sierra 10.13.6
## 
## Matrix products: default
## BLAS: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] parallel  stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
##  [1] GGally_1.4.0         tidybayes_1.0.4      bayesplot_1.6.0     
##  [4] fiftystater_1.0.1    ggrepel_0.8.0        forcats_0.3.0       
##  [7] stringr_1.4.0        dplyr_0.8.0.1        purrr_0.2.5         
## [10] readr_1.1.1          tidyr_0.8.1          tibble_2.1.1        
## [13] tidyverse_1.2.1      brms_2.8.8           Rcpp_1.0.1          
## [16] rstan_2.18.2         StanHeaders_2.18.0-1 ggplot2_3.1.1       
## 
## loaded via a namespace (and not attached):
##   [1] colorspace_1.3-2          ggridges_0.5.0           
##   [3] rsconnect_0.8.8           rprojroot_1.3-2          
##   [5] ggstance_0.3              markdown_0.8             
##   [7] base64enc_0.1-3           rstudioapi_0.7           
##   [9] svUnit_0.7-12             DT_0.4                   
##  [11] fansi_0.4.0               mvtnorm_1.0-10           
##  [13] lubridate_1.7.4           xml2_1.2.0               
##  [15] bridgesampling_0.6-0      knitr_1.20               
##  [17] shinythemes_1.1.1         jsonlite_1.5             
##  [19] LaplacesDemon_16.1.1      broom_0.5.1              
##  [21] shiny_1.1.0               mapproj_1.2.6            
##  [23] compiler_3.5.1            httr_1.3.1               
##  [25] backports_1.1.4           assertthat_0.2.0         
##  [27] Matrix_1.2-14             lazyeval_0.2.2           
##  [29] cli_1.0.1                 later_0.7.3              
##  [31] htmltools_0.3.6           prettyunits_1.0.2        
##  [33] tools_3.5.1               igraph_1.2.1             
##  [35] coda_0.19-2               gtable_0.3.0             
##  [37] glue_1.3.1.9000           reshape2_1.4.3           
##  [39] maps_3.3.0                cellranger_1.1.0         
##  [41] nlme_3.1-137              crosstalk_1.0.0          
##  [43] xfun_0.3                  ps_1.2.1                 
##  [45] rvest_0.3.2               mime_0.5                 
##  [47] miniUI_0.1.1.1            gtools_3.8.1             
##  [49] MASS_7.3-50               zoo_1.8-2                
##  [51] scales_1.0.0              colourpicker_1.0         
##  [53] hms_0.4.2                 promises_1.0.1           
##  [55] Brobdingnag_1.2-6         inline_0.3.15            
##  [57] RColorBrewer_1.1-2        shinystan_2.5.0          
##  [59] yaml_2.1.19               gridExtra_2.3            
##  [61] loo_2.1.0                 reshape_0.8.7            
##  [63] stringi_1.4.3             highr_0.7                
##  [65] dygraphs_1.1.1.5          pkgbuild_1.0.2           
##  [67] rlang_0.3.4               pkgconfig_2.0.2          
##  [69] matrixStats_0.54.0        HDInterval_0.2.0         
##  [71] evaluate_0.10.1           lattice_0.20-35          
##  [73] rstantools_1.5.1          htmlwidgets_1.2          
##  [75] labeling_0.3              processx_3.2.1           
##  [77] tidyselect_0.2.5          plyr_1.8.4               
##  [79] magrittr_1.5              bookdown_0.9             
##  [81] R6_2.3.0                  generics_0.0.2           
##  [83] pillar_1.3.1              haven_1.1.2              
##  [85] withr_2.1.2               xts_0.10-2               
##  [87] abind_1.4-5               modelr_0.1.2             
##  [89] crayon_1.3.4              arrayhelpers_1.0-20160527
##  [91] utf8_1.1.4                rmarkdown_1.10           
##  [93] grid_3.5.1                readxl_1.1.0             
##  [95] callr_3.1.0               threejs_0.3.1            
##  [97] digest_0.6.18             xtable_1.8-2             
##  [99] httpuv_1.4.4.2            stats4_3.5.1             
## [101] munsell_0.5.0             shinyjs_1.0</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="linear-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="overfitting-regularization-and-information-criteria.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
