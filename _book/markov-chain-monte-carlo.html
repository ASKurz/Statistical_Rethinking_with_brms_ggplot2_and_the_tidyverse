<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 Markov Chain Monte Carlo | Statistical rethinking with brms, ggplot2, and the tidyverse</title>
  <meta name="description" content="This project is an attempt to re-express the code in McElreath’s textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="generator" content="bookdown 0.28 and GitBook 2.6.7" />

  <meta property="og:title" content="8 Markov Chain Monte Carlo | Statistical rethinking with brms, ggplot2, and the tidyverse" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This project is an attempt to re-express the code in McElreath’s textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="github-repo" content="ASKURZ/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 Markov Chain Monte Carlo | Statistical rethinking with brms, ggplot2, and the tidyverse" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This project is an attempt to re-express the code in McElreath’s textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  

<meta name="author" content="A Solomon Kurz" />


<meta name="date" content="2023-01-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="interactions.html"/>
<link rel="next" href="big-entropy-and-the-generalized-linear-model.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/vembedr-0.1.5/css/vembedr.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>This is a love letter</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-this"><i class="fa fa-check"></i>Why this?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#my-assumptions-about-you"><i class="fa fa-check"></i>My assumptions about you</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-use-and-understand-this-project"><i class="fa fa-check"></i>How to use and understand this project</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#you-can-do-this-too"><i class="fa fa-check"></i>You can do this, too</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#we-have-updates"><i class="fa fa-check"></i>We have updates</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.9.0."><i class="fa fa-check"></i>Version 0.9.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-1.0.0."><i class="fa fa-check"></i>Version 1.0.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-1.0.1."><i class="fa fa-check"></i>Version 1.0.1.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-1.1.0."><i class="fa fa-check"></i>Version 1.1.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-1.2.0."><i class="fa fa-check"></i>Version 1.2.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-1.3.0."><i class="fa fa-check"></i>Version 1.3.0.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#is-this-material-obsolete"><i class="fa fa-check"></i>Is this material obsolete?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#thank-yous-are-in-order"><i class="fa fa-check"></i>Thank-you’s are in order</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html"><i class="fa fa-check"></i><b>1</b> The Golem of Prague</a>
<ul>
<li class="chapter" data-level="" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Small Worlds and Large Worlds</a>
<ul>
<li class="chapter" data-level="2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#the-garden-of-forking-data"><i class="fa fa-check"></i><b>2.1</b> The garden of forking data</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#counting-possibilities."><i class="fa fa-check"></i><b>2.1.1</b> Counting possibilities.</a></li>
<li class="chapter" data-level="2.1.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#using-prior-information."><i class="fa fa-check"></i><b>2.1.2</b> Using prior information.</a></li>
<li class="chapter" data-level="2.1.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#from-counts-to-probability."><i class="fa fa-check"></i><b>2.1.3</b> From counts to probability.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#building-a-model"><i class="fa fa-check"></i><b>2.2</b> Building a model</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#a-data-story."><i class="fa fa-check"></i><b>2.2.1</b> A data story.</a></li>
<li class="chapter" data-level="2.2.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#bayesian-updating."><i class="fa fa-check"></i><b>2.2.2</b> Bayesian updating.</a></li>
<li class="chapter" data-level="2.2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#evaluate."><i class="fa fa-check"></i><b>2.2.3</b> Evaluate.</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#components-of-the-model"><i class="fa fa-check"></i><b>2.3</b> Components of the model</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#likelihood."><i class="fa fa-check"></i><b>2.3.1</b> Likelihood.</a></li>
<li class="chapter" data-level="2.3.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#parameters."><i class="fa fa-check"></i><b>2.3.2</b> Parameters.</a></li>
<li class="chapter" data-level="2.3.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#prior."><i class="fa fa-check"></i><b>2.3.3</b> Prior.</a></li>
<li class="chapter" data-level="2.3.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#posterior."><i class="fa fa-check"></i><b>2.3.4</b> Posterior.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#making-the-model-go"><i class="fa fa-check"></i><b>2.4</b> Making the model go</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#grid-approximation."><i class="fa fa-check"></i><b>2.4.1</b> Grid approximation.</a></li>
<li class="chapter" data-level="2.4.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic-approximation."><i class="fa fa-check"></i><b>2.4.2</b> Quadratic approximation.</a></li>
<li class="chapter" data-level="2.4.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#markov-chain-monte-carlo."><i class="fa fa-check"></i><b>2.4.3</b> Markov chain Monte Carlo.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Sampling the Imaginary</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-like-approximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-like approximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-boundaries."><i class="fa fa-check"></i><b>3.2.1</b> Intervals of defined boundaries.</a></li>
<li class="chapter" data-level="3.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass."><i class="fa fa-check"></i><b>3.2.2</b> Intervals of defined mass.</a></li>
<li class="chapter" data-level="3.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimates."><i class="fa fa-check"></i><b>3.2.3</b> Point estimates.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#dummy-data."><i class="fa fa-check"></i><b>3.3.1</b> Dummy data.</a></li>
<li class="chapter" data-level="3.3.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking."><i class="fa fa-check"></i><b>3.3.2</b> Model checking.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#summary-lets-practice-with-brms"><i class="fa fa-check"></i><b>3.4</b> <del>Summary</del> Let’s practice with brms</a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="linear-models.html"><a href="linear-models.html"><i class="fa fa-check"></i><b>4</b> Linear Models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="linear-models.html"><a href="linear-models.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why normal distributions are normal</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="linear-models.html"><a href="linear-models.html#normal-by-addition."><i class="fa fa-check"></i><b>4.1.1</b> Normal by addition.</a></li>
<li class="chapter" data-level="4.1.2" data-path="linear-models.html"><a href="linear-models.html#normal-by-multiplication."><i class="fa fa-check"></i><b>4.1.2</b> Normal by multiplication.</a></li>
<li class="chapter" data-level="4.1.3" data-path="linear-models.html"><a href="linear-models.html#normal-by-log-multiplication."><i class="fa fa-check"></i><b>4.1.3</b> Normal by log-multiplication.</a></li>
<li class="chapter" data-level="4.1.4" data-path="linear-models.html"><a href="linear-models.html#using-gaussian-distributions."><i class="fa fa-check"></i><b>4.1.4</b> Using Gaussian distributions.</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="linear-models.html"><a href="linear-models.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>4.2</b> A language for describing models</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="linear-models.html"><a href="linear-models.html#re-describing-the-globe-tossing-model."><i class="fa fa-check"></i><b>4.2.1</b> Re-describing the globe tossing model.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="linear-models.html"><a href="linear-models.html#a-gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> A Gaussian model of height</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="linear-models.html"><a href="linear-models.html#the-data."><i class="fa fa-check"></i><b>4.3.1</b> The data.</a></li>
<li class="chapter" data-level="4.3.2" data-path="linear-models.html"><a href="linear-models.html#the-model."><i class="fa fa-check"></i><b>4.3.2</b> The model.</a></li>
<li class="chapter" data-level="4.3.3" data-path="linear-models.html"><a href="linear-models.html#grid-approximation-of-the-posterior-distribution."><i class="fa fa-check"></i><b>4.3.3</b> Grid approximation of the posterior distribution.</a></li>
<li class="chapter" data-level="4.3.4" data-path="linear-models.html"><a href="linear-models.html#sampling-from-the-posterior."><i class="fa fa-check"></i><b>4.3.4</b> Sampling from the posterior.</a></li>
<li class="chapter" data-level="4.3.5" data-path="linear-models.html"><a href="linear-models.html#fitting-the-model-with-map-brm."><i class="fa fa-check"></i><b>4.3.5</b> Fitting the model with <del><code>map</code></del> <code>brm()</code>.</a></li>
<li class="chapter" data-level="4.3.6" data-path="linear-models.html"><a href="linear-models.html#sampling-from-a-map-brm-fit."><i class="fa fa-check"></i><b>4.3.6</b> Sampling from a <del><code>map</code></del> <code>brm()</code> fit.</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="linear-models.html"><a href="linear-models.html#adding-a-predictor"><i class="fa fa-check"></i><b>4.4</b> Adding a predictor</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="linear-models.html"><a href="linear-models.html#the-linear-model-strategy."><i class="fa fa-check"></i><b>4.4.1</b> The linear model strategy.</a></li>
<li class="chapter" data-level="4.4.2" data-path="linear-models.html"><a href="linear-models.html#fitting-the-model."><i class="fa fa-check"></i><b>4.4.2</b> Fitting the model.</a></li>
<li class="chapter" data-level="4.4.3" data-path="linear-models.html"><a href="linear-models.html#interpreting-the-model-fit."><i class="fa fa-check"></i><b>4.4.3</b> Interpreting the model fit.</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="linear-models.html"><a href="linear-models.html#polynomial-regression"><i class="fa fa-check"></i><b>4.5</b> Polynomial regression</a></li>
<li class="chapter" data-level="" data-path="linear-models.html"><a href="linear-models.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html"><i class="fa fa-check"></i><b>5</b> Multivariate Linear Models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#spurious-associations"><i class="fa fa-check"></i><b>5.1</b> Spurious associations</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#multivariate-notation."><i class="fa fa-check"></i><b>5.1.1</b> Multivariate notation.</a></li>
<li class="chapter" data-level="5.1.2" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#fitting-the-model.-1"><i class="fa fa-check"></i><b>5.1.2</b> Fitting the model.</a></li>
<li class="chapter" data-level="5.1.3" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#plotting-multivariate-posteriors."><i class="fa fa-check"></i><b>5.1.3</b> Plotting multivariate posteriors.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#masked-relationship"><i class="fa fa-check"></i><b>5.2</b> Masked relationship</a></li>
<li class="chapter" data-level="5.3" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#multicollinearity"><i class="fa fa-check"></i><b>5.3</b> Multicollinearity</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#multicollinear-legs."><i class="fa fa-check"></i><b>5.3.1</b> Multicollinear legs.</a></li>
<li class="chapter" data-level="5.3.2" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#multicollinear-milk."><i class="fa fa-check"></i><b>5.3.2</b> Multicollinear <code>milk</code>.</a></li>
<li class="chapter" data-level="5.3.3" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#post-treatment-bias."><i class="fa fa-check"></i><b>5.3.3</b> Post-treatment bias.</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#categorical-variables"><i class="fa fa-check"></i><b>5.4</b> Categorical variables</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#binary-categories."><i class="fa fa-check"></i><b>5.4.1</b> Binary categories.</a></li>
<li class="chapter" data-level="5.4.2" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#many-categories."><i class="fa fa-check"></i><b>5.4.2</b> Many categories.</a></li>
<li class="chapter" data-level="5.4.3" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#adding-regular-predictor-variables."><i class="fa fa-check"></i><b>5.4.3</b> Adding regular predictor variables.</a></li>
<li class="chapter" data-level="5.4.4" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#another-approach-unique-intercepts."><i class="fa fa-check"></i><b>5.4.4</b> Another approach: Unique intercepts.</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#ordinary-least-squares-and-lm"><i class="fa fa-check"></i><b>5.5</b> <del>Ordinary least squares and <code>lm()</code></del></a></li>
<li class="chapter" data-level="" data-path="multivariate-linear-models.html"><a href="multivariate-linear-models.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html"><i class="fa fa-check"></i><b>6</b> Overfitting, Regularization, and Information Criteria</a>
<ul>
<li class="chapter" data-level="6.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>6.1</b> The problem with parameters</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#more-parameters-always-improve-fit."><i class="fa fa-check"></i><b>6.1.1</b> More parameters always improve fit.</a></li>
<li class="chapter" data-level="6.1.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#too-few-parameters-hurts-too."><i class="fa fa-check"></i><b>6.1.2</b> Too few parameters hurts, too.</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#information-theory-and-model-performance"><i class="fa fa-check"></i><b>6.2</b> Information theory and model performance</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#firing-the-weatherperson."><i class="fa fa-check"></i><b>6.2.1</b> Firing the weatherperson.</a></li>
<li class="chapter" data-level="6.2.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#information-and-uncertainty."><i class="fa fa-check"></i><b>6.2.2</b> Information and uncertainty.</a></li>
<li class="chapter" data-level="6.2.3" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#from-entropy-to-accuracy."><i class="fa fa-check"></i><b>6.2.3</b> From entropy to accuracy.</a></li>
<li class="chapter" data-level="6.2.4" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#from-divergence-to-deviance."><i class="fa fa-check"></i><b>6.2.4</b> From divergence to deviance.</a></li>
<li class="chapter" data-level="6.2.5" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#from-deviance-to-out-of-sample."><i class="fa fa-check"></i><b>6.2.5</b> From deviance to out-of-sample.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#regularization"><i class="fa fa-check"></i><b>6.3</b> Regularization</a></li>
<li class="chapter" data-level="6.4" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#information-criteria"><i class="fa fa-check"></i><b>6.4</b> Information criteria</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#dic."><i class="fa fa-check"></i><b>6.4.1</b> DIC.</a></li>
<li class="chapter" data-level="6.4.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#waic."><i class="fa fa-check"></i><b>6.4.2</b> WAIC.</a></li>
<li class="chapter" data-level="6.4.3" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#dic-and-waic-as-estimates-of-deviance."><i class="fa fa-check"></i><b>6.4.3</b> DIC and WAIC as estimates of deviance.</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#using-information-criteria"><i class="fa fa-check"></i><b>6.5</b> Using information criteria</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#model-comparison."><i class="fa fa-check"></i><b>6.5.1</b> Model comparison.</a></li>
<li class="chapter" data-level="6.5.2" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#model-averaging."><i class="fa fa-check"></i><b>6.5.2</b> Model averaging.</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#summary-bonus-r2-talk"><i class="fa fa-check"></i><b>6.6</b> <del>Summary</del> Bonus: <span class="math inline">\(R^2\)</span> talk</a></li>
<li class="chapter" data-level="" data-path="overfitting-regularization-and-information-criteria.html"><a href="overfitting-regularization-and-information-criteria.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="interactions.html"><a href="interactions.html"><i class="fa fa-check"></i><b>7</b> Interactions</a>
<ul>
<li class="chapter" data-level="7.1" data-path="interactions.html"><a href="interactions.html#building-an-interaction."><i class="fa fa-check"></i><b>7.1</b> Building an interaction.</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="interactions.html"><a href="interactions.html#adding-a-dummy-variable-doesnt-work."><i class="fa fa-check"></i><b>7.1.1</b> Adding a dummy variable doesn’t work.</a></li>
<li class="chapter" data-level="7.1.2" data-path="interactions.html"><a href="interactions.html#adding-a-linear-interaction-does-work."><i class="fa fa-check"></i><b>7.1.2</b> Adding a linear interaction does work.</a></li>
<li class="chapter" data-level="7.1.3" data-path="interactions.html"><a href="interactions.html#plotting-the-interaction."><i class="fa fa-check"></i><b>7.1.3</b> Plotting the interaction.</a></li>
<li class="chapter" data-level="7.1.4" data-path="interactions.html"><a href="interactions.html#interpreting-an-interaction-estimate."><i class="fa fa-check"></i><b>7.1.4</b> Interpreting an interaction estimate.</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="interactions.html"><a href="interactions.html#symmetry-of-the-linear-interaction."><i class="fa fa-check"></i><b>7.2</b> Symmetry of the linear interaction.</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="interactions.html"><a href="interactions.html#buridans-interaction."><i class="fa fa-check"></i><b>7.2.1</b> Buridan’s interaction.</a></li>
<li class="chapter" data-level="7.2.2" data-path="interactions.html"><a href="interactions.html#africa-depends-upon-ruggedness."><i class="fa fa-check"></i><b>7.2.2</b> Africa depends upon ruggedness.</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="interactions.html"><a href="interactions.html#continuous-interactions"><i class="fa fa-check"></i><b>7.3</b> Continuous interactions</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="interactions.html"><a href="interactions.html#the-data.-1"><i class="fa fa-check"></i><b>7.3.1</b> The data.</a></li>
<li class="chapter" data-level="7.3.2" data-path="interactions.html"><a href="interactions.html#the-un-centered-models."><i class="fa fa-check"></i><b>7.3.2</b> The un-centered models.</a></li>
<li class="chapter" data-level="7.3.3" data-path="interactions.html"><a href="interactions.html#center-and-re-estimate."><i class="fa fa-check"></i><b>7.3.3</b> Center and re-estimate.</a></li>
<li class="chapter" data-level="7.3.4" data-path="interactions.html"><a href="interactions.html#plotting-implied-predictions."><i class="fa fa-check"></i><b>7.3.4</b> Plotting implied predictions.</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="interactions.html"><a href="interactions.html#interactions-in-design-formulas"><i class="fa fa-check"></i><b>7.4</b> Interactions in design formulas</a></li>
<li class="chapter" data-level="7.5" data-path="interactions.html"><a href="interactions.html#summary-bonus-marginal_effectsconditional_effects"><i class="fa fa-check"></i><b>7.5</b> <del>Summary</del> Bonus: <code>marginal_effects()</code>/<code>conditional_effects()</code></a></li>
<li class="chapter" data-level="" data-path="interactions.html"><a href="interactions.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>8</b> Markov Chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="8.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#good-king-markov-and-his-island-kingdom"><i class="fa fa-check"></i><b>8.1</b> Good King Markov and His island kingdom</a></li>
<li class="chapter" data-level="8.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#markov-chain-monte-carlo-1"><i class="fa fa-check"></i><b>8.2</b> Markov chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#gibbs-sampling."><i class="fa fa-check"></i><b>8.2.1</b> Gibbs sampling.</a></li>
<li class="chapter" data-level="8.2.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#hamiltonian-monte-carlo."><i class="fa fa-check"></i><b>8.2.2</b> Hamiltonian Monte Carlo.</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#easy-hmc-map2stan-brm"><i class="fa fa-check"></i><b>8.3</b> Easy HMC: <del>map2stan</del> <code>brm()</code></a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#preparation."><i class="fa fa-check"></i><b>8.3.1</b> Preparation.</a></li>
<li class="chapter" data-level="8.3.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#estimation."><i class="fa fa-check"></i><b>8.3.2</b> Estimation.</a></li>
<li class="chapter" data-level="8.3.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#sampling-again-in-parallel."><i class="fa fa-check"></i><b>8.3.3</b> Sampling again, in parallel.</a></li>
<li class="chapter" data-level="8.3.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#visualization."><i class="fa fa-check"></i><b>8.3.4</b> Visualization.</a></li>
<li class="chapter" data-level="8.3.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#using-the-samples."><i class="fa fa-check"></i><b>8.3.5</b> Using the samples.</a></li>
<li class="chapter" data-level="8.3.6" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#checking-the-chain."><i class="fa fa-check"></i><b>8.3.6</b> Checking the chain.</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#care-and-feeding-of-your-markov-chain."><i class="fa fa-check"></i><b>8.4</b> Care and feeding of your Markov chain.</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>8.4.1</b> How many samples do you need?</a></li>
<li class="chapter" data-level="8.4.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#how-many-chains-do-you-need"><i class="fa fa-check"></i><b>8.4.2</b> How many chains do you need?</a></li>
<li class="chapter" data-level="8.4.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#taming-a-wild-chain."><i class="fa fa-check"></i><b>8.4.3</b> Taming a wild chain.</a></li>
<li class="chapter" data-level="8.4.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#non-identifiable-parameters."><i class="fa fa-check"></i><b>8.4.4</b> Non-identifiable parameters.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>9</b> Big Entropy and the Generalized Linear Model</a>
<ul>
<li class="chapter" data-level="9.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>9.1</b> Maximum entropy</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#gaussian."><i class="fa fa-check"></i><b>9.1.1</b> Gaussian.</a></li>
<li class="chapter" data-level="9.1.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial."><i class="fa fa-check"></i><b>9.1.2</b> Binomial.</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>9.2</b> Generalized linear models</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family."><i class="fa fa-check"></i><b>9.2.1</b> Meet the family.</a></li>
<li class="chapter" data-level="9.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions."><i class="fa fa-check"></i><b>9.2.2</b> Linking linear models to distributions.</a></li>
<li class="chapter" data-level="9.2.3" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#absolute-and-relative-differences."><i class="fa fa-check"></i><b>9.2.3</b> Absolute and relative differences.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="counting-and-classification.html"><a href="counting-and-classification.html"><i class="fa fa-check"></i><b>10</b> Counting and Classification</a>
<ul>
<li class="chapter" data-level="10.1" data-path="counting-and-classification.html"><a href="counting-and-classification.html#binomial-regression"><i class="fa fa-check"></i><b>10.1</b> Binomial regression</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="counting-and-classification.html"><a href="counting-and-classification.html#logistic-regression-prosocial-chimpanzees."><i class="fa fa-check"></i><b>10.1.1</b> Logistic regression: Prosocial chimpanzees.</a></li>
<li class="chapter" data-level="10.1.2" data-path="counting-and-classification.html"><a href="counting-and-classification.html#aggregated-binomial-chimpanzees-again-condensed."><i class="fa fa-check"></i><b>10.1.2</b> Aggregated binomial: Chimpanzees again, condensed.</a></li>
<li class="chapter" data-level="10.1.3" data-path="counting-and-classification.html"><a href="counting-and-classification.html#aggregated-binomial-graduate-school-admissions."><i class="fa fa-check"></i><b>10.1.3</b> Aggregated binomial: Graduate school admissions.</a></li>
<li class="chapter" data-level="10.1.4" data-path="counting-and-classification.html"><a href="counting-and-classification.html#fitting-binomial-regressions-with-glm."><i class="fa fa-check"></i><b>10.1.4</b> Fitting binomial regressions with <code>glm()</code>.</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="counting-and-classification.html"><a href="counting-and-classification.html#poisson-regression"><i class="fa fa-check"></i><b>10.2</b> Poisson regression</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="counting-and-classification.html"><a href="counting-and-classification.html#example-oceanic-tool-complexity."><i class="fa fa-check"></i><b>10.2.1</b> Example: Oceanic tool complexity.</a></li>
<li class="chapter" data-level="10.2.2" data-path="counting-and-classification.html"><a href="counting-and-classification.html#mcmc-islands."><i class="fa fa-check"></i><b>10.2.2</b> MCMC islands.</a></li>
<li class="chapter" data-level="10.2.3" data-path="counting-and-classification.html"><a href="counting-and-classification.html#example-exposure-and-the-offset."><i class="fa fa-check"></i><b>10.2.3</b> Example: Exposure and the offset.</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="counting-and-classification.html"><a href="counting-and-classification.html#other-count-regressions"><i class="fa fa-check"></i><b>10.3</b> Other count regressions</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="counting-and-classification.html"><a href="counting-and-classification.html#multinomial."><i class="fa fa-check"></i><b>10.3.1</b> Multinomial.</a></li>
<li class="chapter" data-level="10.3.2" data-path="counting-and-classification.html"><a href="counting-and-classification.html#geometric."><i class="fa fa-check"></i><b>10.3.2</b> Geometric.</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="counting-and-classification.html"><a href="counting-and-classification.html#summary"><i class="fa fa-check"></i><b>10.4</b> Summary</a></li>
<li class="chapter" data-level="" data-path="counting-and-classification.html"><a href="counting-and-classification.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html"><i class="fa fa-check"></i><b>11</b> Monsters and Mixtures</a>
<ul>
<li class="chapter" data-level="11.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>11.1</b> Ordered categorical outcomes</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-moral-intuition."><i class="fa fa-check"></i><b>11.1.1</b> Example: Moral intuition.</a></li>
<li class="chapter" data-level="11.1.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#describing-an-ordered-distribution-with-intercepts."><i class="fa fa-check"></i><b>11.1.2</b> Describing an ordered distribution with intercepts.</a></li>
<li class="chapter" data-level="11.1.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#adding-predictor-variables."><i class="fa fa-check"></i><b>11.1.3</b> Adding predictor variables.</a></li>
<li class="chapter" data-level="11.1.4" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#bonus-figure-11.3-alternative."><i class="fa fa-check"></i><b>11.1.4</b> Bonus: Figure 11.3 alternative.</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>11.2</b> Zero-inflated outcomes</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#example-zero-inflated-poisson."><i class="fa fa-check"></i><b>11.2.1</b> Example: Zero-inflated Poisson.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersed-outcomes"><i class="fa fa-check"></i><b>11.3</b> Over-dispersed outcomes</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#beta-binomial."><i class="fa fa-check"></i><b>11.3.1</b> Beta-binomial.</a></li>
<li class="chapter" data-level="11.3.2" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#negative-binomial-or-gamma-poisson."><i class="fa fa-check"></i><b>11.3.2</b> Negative-binomial or gamma-Poisson.</a></li>
<li class="chapter" data-level="11.3.3" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#over-dispersion-entropy-and-information-criteria."><i class="fa fa-check"></i><b>11.3.3</b> Over-dispersion, entropy, and information criteria.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="monsters-and-mixtures.html"><a href="monsters-and-mixtures.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="multilevel-models.html"><a href="multilevel-models.html"><i class="fa fa-check"></i><b>12</b> Multilevel Models</a>
<ul>
<li class="chapter" data-level="12.1" data-path="multilevel-models.html"><a href="multilevel-models.html#example-multilevel-tadpoles"><i class="fa fa-check"></i><b>12.1</b> Example: Multilevel tadpoles</a></li>
<li class="chapter" data-level="12.2" data-path="multilevel-models.html"><a href="multilevel-models.html#varying-effects-and-the-underfittingoverfitting-trade-off"><i class="fa fa-check"></i><b>12.2</b> Varying effects and the underfitting/overfitting trade-off</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="multilevel-models.html"><a href="multilevel-models.html#the-model.-1"><i class="fa fa-check"></i><b>12.2.1</b> The model.</a></li>
<li class="chapter" data-level="12.2.2" data-path="multilevel-models.html"><a href="multilevel-models.html#assign-values-to-the-parameters."><i class="fa fa-check"></i><b>12.2.2</b> Assign values to the parameters.</a></li>
<li class="chapter" data-level="12.2.3" data-path="multilevel-models.html"><a href="multilevel-models.html#sumulate-survivors."><i class="fa fa-check"></i><b>12.2.3</b> Sumulate survivors.</a></li>
<li class="chapter" data-level="12.2.4" data-path="multilevel-models.html"><a href="multilevel-models.html#compute-the-no-pooling-estimates."><i class="fa fa-check"></i><b>12.2.4</b> Compute the no-pooling estimates.</a></li>
<li class="chapter" data-level="12.2.5" data-path="multilevel-models.html"><a href="multilevel-models.html#compute-the-partial-pooling-estimates."><i class="fa fa-check"></i><b>12.2.5</b> Compute the partial-pooling estimates.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="multilevel-models.html"><a href="multilevel-models.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>12.3</b> More than one type of cluster</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="multilevel-models.html"><a href="multilevel-models.html#multilevel-chimpanzees."><i class="fa fa-check"></i><b>12.3.1</b> Multilevel chimpanzees.</a></li>
<li class="chapter" data-level="12.3.2" data-path="multilevel-models.html"><a href="multilevel-models.html#two-types-of-cluster."><i class="fa fa-check"></i><b>12.3.2</b> Two types of cluster.</a></li>
<li class="chapter" data-level="12.3.3" data-path="multilevel-models.html"><a href="multilevel-models.html#even-more-clusters."><i class="fa fa-check"></i><b>12.3.3</b> Even more clusters.</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="multilevel-models.html"><a href="multilevel-models.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>12.4</b> Multilevel posterior predictions</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="multilevel-models.html"><a href="multilevel-models.html#posterior-prediction-for-same-clusters."><i class="fa fa-check"></i><b>12.4.1</b> Posterior prediction for same clusters.</a></li>
<li class="chapter" data-level="12.4.2" data-path="multilevel-models.html"><a href="multilevel-models.html#posterior-prediction-for-new-clusters."><i class="fa fa-check"></i><b>12.4.2</b> Posterior prediction for new clusters.</a></li>
<li class="chapter" data-level="12.4.3" data-path="multilevel-models.html"><a href="multilevel-models.html#focus-and-multilevel-prediction."><i class="fa fa-check"></i><b>12.4.3</b> Focus and multilevel prediction.</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="multilevel-models.html"><a href="multilevel-models.html#summary-bonus-put-your-random-effects-to-work"><i class="fa fa-check"></i><b>12.5</b> <del>Summary</del> Bonus: Put your random effects to work</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="multilevel-models.html"><a href="multilevel-models.html#intercepts-only-models-with-one-or-two-grouping-variables."><i class="fa fa-check"></i><b>12.5.1</b> Intercepts-only models with one or two grouping variables.</a></li>
<li class="chapter" data-level="12.5.2" data-path="multilevel-models.html"><a href="multilevel-models.html#brmsas_draws_df."><i class="fa fa-check"></i><b>12.5.2</b> <code>brms::as_draws_df()</code>.</a></li>
<li class="chapter" data-level="12.5.3" data-path="multilevel-models.html"><a href="multilevel-models.html#brmscoef."><i class="fa fa-check"></i><b>12.5.3</b> <code>brms::coef()</code>.</a></li>
<li class="chapter" data-level="12.5.4" data-path="multilevel-models.html"><a href="multilevel-models.html#brmsfitted."><i class="fa fa-check"></i><b>12.5.4</b> <code>brms::fitted()</code>.</a></li>
<li class="chapter" data-level="12.5.5" data-path="multilevel-models.html"><a href="multilevel-models.html#tidybayesspread_draws."><i class="fa fa-check"></i><b>12.5.5</b> <code>tidybayes::spread_draws()</code>.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multilevel-models.html"><a href="multilevel-models.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html"><i class="fa fa-check"></i><b>13</b> Adventures in Covariance</a>
<ul>
<li class="chapter" data-level="13.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>13.1</b> Varying slopes by construction</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-the-population."><i class="fa fa-check"></i><b>13.1.1</b> Simulate the population.</a></li>
<li class="chapter" data-level="13.1.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#simulate-observations."><i class="fa fa-check"></i><b>13.1.2</b> Simulate observations.</a></li>
<li class="chapter" data-level="13.1.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#the-varying-slopes-model."><i class="fa fa-check"></i><b>13.1.3</b> The varying slopes model.</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-admission-decisions-and-gender"><i class="fa fa-check"></i><b>13.2</b> Example: Admission decisions and gender</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-intercepts."><i class="fa fa-check"></i><b>13.2.1</b> Varying intercepts.</a></li>
<li class="chapter" data-level="13.2.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#varying-effects-of-being-male."><i class="fa fa-check"></i><b>13.2.2</b> Varying effects of being <code>male</code>.</a></li>
<li class="chapter" data-level="13.2.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#shrinkage."><i class="fa fa-check"></i><b>13.2.3</b> Shrinkage.</a></li>
<li class="chapter" data-level="13.2.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#model-comparison.-1"><i class="fa fa-check"></i><b>13.2.4</b> Model comparison.</a></li>
<li class="chapter" data-level="13.2.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#more-slopes."><i class="fa fa-check"></i><b>13.2.5</b> More slopes.</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-cross-classified-chimpanzees-with-varying-slopes"><i class="fa fa-check"></i><b>13.3</b> Example: Cross-classified <code>chimpanzees</code> with varying slopes</a></li>
<li class="chapter" data-level="13.4" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>13.4</b> Continuous categories and the Gaussian process</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#example-spatial-autocorrelation-in-oceanic-tools."><i class="fa fa-check"></i><b>13.4.1</b> Example: Spatial autocorrelation in Oceanic tools.</a></li>
<li class="chapter" data-level="13.4.2" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#other-kinds-of-distance."><i class="fa fa-check"></i><b>13.4.2</b> Other kinds of “distance”.</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#summary-bonus-another-berkeley-admissions-data-like-example."><i class="fa fa-check"></i><b>13.5</b> <del>Summary</del> Bonus: Another Berkeley-admissions-data-like example.</a></li>
<li class="chapter" data-level="" data-path="adventures-in-covariance.html"><a href="adventures-in-covariance.html#session-info-12"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html"><i class="fa fa-check"></i><b>14</b> Missing Data and Other Opportunities</a>
<ul>
<li class="chapter" data-level="14.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#measurement-error"><i class="fa fa-check"></i><b>14.1</b> Measurement error</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#error-on-the-outcome."><i class="fa fa-check"></i><b>14.1.1</b> Error on the outcome.</a></li>
<li class="chapter" data-level="14.1.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#error-on-both-outcome-and-predictor."><i class="fa fa-check"></i><b>14.1.2</b> Error on both outcome and predictor.</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#missing-data"><i class="fa fa-check"></i><b>14.2</b> Missing data</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#imputing-neocortex"><i class="fa fa-check"></i><b>14.2.1</b> Imputing <code>neocortex</code></a></li>
<li class="chapter" data-level="14.2.2" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#improving-the-imputation-model"><i class="fa fa-check"></i><b>14.2.2</b> Improving the imputation model</a></li>
<li class="chapter" data-level="14.2.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#bonus-mi-can-replace-me"><i class="fa fa-check"></i><b>14.2.3</b> Bonus: <code>mi()</code> can replace <code>me()</code></a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#summary-bonus-meta-analysis"><i class="fa fa-check"></i><b>14.3</b> <del>Summary</del> Bonus: Meta-analysis</a></li>
<li class="chapter" data-level="" data-path="missing-data-and-other-opportunities.html"><a href="missing-data-and-other-opportunities.html#session-info-13"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html"><i class="fa fa-check"></i><b>15</b> <del>Horoscopes</del> Insights</a>
<ul>
<li class="chapter" data-level="15.1" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#use-r-notebooks"><i class="fa fa-check"></i><b>15.1</b> Use R Notebooks</a></li>
<li class="chapter" data-level="15.2" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#save-your-model-fits"><i class="fa fa-check"></i><b>15.2</b> Save your model fits</a></li>
<li class="chapter" data-level="15.3" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#build-your-models-slowly"><i class="fa fa-check"></i><b>15.3</b> Build your models slowly</a></li>
<li class="chapter" data-level="15.4" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#look-at-your-data"><i class="fa fa-check"></i><b>15.4</b> Look at your data</a></li>
<li class="chapter" data-level="15.5" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#use-the-0-intercept-syntax"><i class="fa fa-check"></i><b>15.5</b> Use the <code>0 + Intercept</code> syntax</a></li>
<li class="chapter" data-level="15.6" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#annotate-your-workflow"><i class="fa fa-check"></i><b>15.6</b> Annotate your workflow</a></li>
<li class="chapter" data-level="15.7" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#annotate-your-code"><i class="fa fa-check"></i><b>15.7</b> Annotate your code</a></li>
<li class="chapter" data-level="15.8" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#break-up-your-workflow"><i class="fa fa-check"></i><b>15.8</b> Break up your workflow</a></li>
<li class="chapter" data-level="15.9" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#code-in-public"><i class="fa fa-check"></i><b>15.9</b> Code in public</a></li>
<li class="chapter" data-level="15.10" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#read-gelmans-blog"><i class="fa fa-check"></i><b>15.10</b> Read Gelman’s blog</a></li>
<li class="chapter" data-level="15.11" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#check-out-other-social-media-too"><i class="fa fa-check"></i><b>15.11</b> Check out other social media, too</a></li>
<li class="chapter" data-level="15.12" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#parting-wisdom"><i class="fa fa-check"></i><b>15.12</b> Parting wisdom</a></li>
<li class="chapter" data-level="" data-path="horoscopes-insights.html"><a href="horoscopes-insights.html#session-info-14"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Statistical rethinking</em> with brms, ggplot2, and the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="markov-chain-monte-carlo" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">8</span> Markov Chain Monte Carlo<a href="markov-chain-monte-carlo.html#markov-chain-monte-carlo" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>“This chapter introduces one of the more marvelous examples of how <a href="https://en.wikipedia.org/wiki/Rota_Fortunae#/media/File:Lydgate-siege-troy-wheel-fortune-detail.jpg">Fortuna</a> and <a href="https://en.wikipedia.org/wiki/Minerva#/media/File:Minerva-Vedder-Highsmith-detail-1.jpeg">Minerva</a> cooperate: the estimation of posterior probability distributions using a stochastic process known as Markov chain Monte Carlo (MCMC) estimation” <span class="citation">(<a href="#ref-mcelreathStatisticalRethinkingBayesian2015" role="doc-biblioref">McElreath, 2015, p. 241</a>)</span>. Though we’ve been using MCMC via the brms package for chapters, now, this chapter should clarify some of the questions you might have about the details.</p>
<div id="good-king-markov-and-his-island-kingdom" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Good King Markov and His island kingdom<a href="markov-chain-monte-carlo.html#good-king-markov-and-his-island-kingdom" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here we simulate King Markov’s journey. In this version of the code, we’ve added <code>set.seed()</code>, which helps make the exact results reproducible.</p>
<div class="sourceCode" id="cb775"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb775-1"><a href="markov-chain-monte-carlo.html#cb775-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb775-2"><a href="markov-chain-monte-carlo.html#cb775-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb775-3"><a href="markov-chain-monte-carlo.html#cb775-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">8</span>)</span>
<span id="cb775-4"><a href="markov-chain-monte-carlo.html#cb775-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb775-5"><a href="markov-chain-monte-carlo.html#cb775-5" aria-hidden="true" tabindex="-1"></a>num_weeks <span class="ot">&lt;-</span> <span class="fl">1e5</span></span>
<span id="cb775-6"><a href="markov-chain-monte-carlo.html#cb775-6" aria-hidden="true" tabindex="-1"></a>positions <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, num_weeks)</span>
<span id="cb775-7"><a href="markov-chain-monte-carlo.html#cb775-7" aria-hidden="true" tabindex="-1"></a>current   <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb775-8"><a href="markov-chain-monte-carlo.html#cb775-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_weeks) {</span>
<span id="cb775-9"><a href="markov-chain-monte-carlo.html#cb775-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># record current position</span></span>
<span id="cb775-10"><a href="markov-chain-monte-carlo.html#cb775-10" aria-hidden="true" tabindex="-1"></a>  positions[i] <span class="ot">&lt;-</span> current</span>
<span id="cb775-11"><a href="markov-chain-monte-carlo.html#cb775-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># flip coin to generate proposal</span></span>
<span id="cb775-12"><a href="markov-chain-monte-carlo.html#cb775-12" aria-hidden="true" tabindex="-1"></a>  proposal <span class="ot">&lt;-</span> current <span class="sc">+</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb775-13"><a href="markov-chain-monte-carlo.html#cb775-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># now make sure he loops around the archipelago</span></span>
<span id="cb775-14"><a href="markov-chain-monte-carlo.html#cb775-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (proposal <span class="sc">&lt;</span> <span class="dv">1</span>) proposal <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb775-15"><a href="markov-chain-monte-carlo.html#cb775-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (proposal <span class="sc">&gt;</span> <span class="dv">10</span>) proposal <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb775-16"><a href="markov-chain-monte-carlo.html#cb775-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># move?</span></span>
<span id="cb775-17"><a href="markov-chain-monte-carlo.html#cb775-17" aria-hidden="true" tabindex="-1"></a>  prob_move <span class="ot">&lt;-</span> proposal <span class="sc">/</span> current</span>
<span id="cb775-18"><a href="markov-chain-monte-carlo.html#cb775-18" aria-hidden="true" tabindex="-1"></a>  current   <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> prob_move, proposal, current)</span>
<span id="cb775-19"><a href="markov-chain-monte-carlo.html#cb775-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>In this chapter, we’ll borrow a theme, <code>theme_ipsum()</code>, from the <a href="https://cran.r-project.org/package=hrbrthemes">hrbrthemes package</a> <span class="citation">(<a href="#ref-R-hrbrthemes" role="doc-biblioref">Rudis, 2020</a>)</span>.</p>
<div class="sourceCode" id="cb776"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb776-1"><a href="markov-chain-monte-carlo.html#cb776-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;hrbrthemes&quot;, dependencies = T)</span></span>
<span id="cb776-2"><a href="markov-chain-monte-carlo.html#cb776-2" aria-hidden="true" tabindex="-1"></a><span class="co"># macOS users may need to install XQuartz, too (https://www.xquartz.org/)</span></span>
<span id="cb776-3"><a href="markov-chain-monte-carlo.html#cb776-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hrbrthemes)</span></code></pre></div>
<p>Figure 8.2.a.</p>
<div class="sourceCode" id="cb777"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb777-1"><a href="markov-chain-monte-carlo.html#cb777-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb777-2"><a href="markov-chain-monte-carlo.html#cb777-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb777-3"><a href="markov-chain-monte-carlo.html#cb777-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">week   =</span> <span class="dv">1</span><span class="sc">:</span><span class="fl">1e5</span>,</span>
<span id="cb777-4"><a href="markov-chain-monte-carlo.html#cb777-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">island =</span> positions) <span class="sc">%&gt;%</span></span>
<span id="cb777-5"><a href="markov-chain-monte-carlo.html#cb777-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb777-6"><a href="markov-chain-monte-carlo.html#cb777-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> island)) <span class="sc">+</span></span>
<span id="cb777-7"><a href="markov-chain-monte-carlo.html#cb777-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb777-8"><a href="markov-chain-monte-carlo.html#cb777-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb777-9"><a href="markov-chain-monte-carlo.html#cb777-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">10</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb777-10"><a href="markov-chain-monte-carlo.html#cb777-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb777-11"><a href="markov-chain-monte-carlo.html#cb777-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title    =</span> <span class="st">&quot;Behold: The Metropolis algorithm in action!&quot;</span>,</span>
<span id="cb777-12"><a href="markov-chain-monte-carlo.html#cb777-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;The dots show the king&#39;s path over the first 100 weeks.&quot;</span>) <span class="sc">+</span></span>
<span id="cb777-13"><a href="markov-chain-monte-carlo.html#cb777-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_ipsum</span>()</span></code></pre></div>
<p><img src="08_files/figure-html/unnamed-chunk-5-1.png" width="528" /></p>
<p>Figure 8.2.b.</p>
<div class="sourceCode" id="cb778"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb778-1"><a href="markov-chain-monte-carlo.html#cb778-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">week   =</span> <span class="dv">1</span><span class="sc">:</span><span class="fl">1e5</span>,</span>
<span id="cb778-2"><a href="markov-chain-monte-carlo.html#cb778-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">island =</span> positions) <span class="sc">%&gt;%</span></span>
<span id="cb778-3"><a href="markov-chain-monte-carlo.html#cb778-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">island =</span> <span class="fu">factor</span>(island)) <span class="sc">%&gt;%</span></span>
<span id="cb778-4"><a href="markov-chain-monte-carlo.html#cb778-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb778-5"><a href="markov-chain-monte-carlo.html#cb778-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> island)) <span class="sc">+</span></span>
<span id="cb778-6"><a href="markov-chain-monte-carlo.html#cb778-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb778-7"><a href="markov-chain-monte-carlo.html#cb778-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title    =</span> <span class="st">&quot;Old Metropolis shines in the long run.&quot;</span>,</span>
<span id="cb778-8"><a href="markov-chain-monte-carlo.html#cb778-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Sure enough, the time the king spent on each island was</span><span class="sc">\n</span><span class="st">proportional to its population size.&quot;</span>) <span class="sc">+</span></span>
<span id="cb778-9"><a href="markov-chain-monte-carlo.html#cb778-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_ipsum</span>()</span></code></pre></div>
<p><img src="08_files/figure-html/unnamed-chunk-6-1.png" width="528" /></p>
</div>
<div id="markov-chain-monte-carlo-1" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Markov chain Monte Carlo<a href="markov-chain-monte-carlo.html#markov-chain-monte-carlo-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>“The metropolis algorithm is the grandparent of several different strategies for getting samples from unknown posterior distributions” (p. 245). If you’re interested, <span class="citation">Robert &amp; Casella (<a href="#ref-robertShortHistoryMarkov2011" role="doc-biblioref">2011</a>)</span> wrote a <a href="https://arxiv.org/pdf/0808.2902.pdf">good historical overview of MCMC</a>.</p>
<div id="gibbs-sampling." class="section level3 hasAnchor" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> Gibbs sampling.<a href="markov-chain-monte-carlo.html#gibbs-sampling." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Gibbs sampler <span class="citation">(<a href="#ref-casellaExplainingGibbsSampler1992" role="doc-biblioref">Casella &amp; George, 1992</a>; <a href="#ref-gemanStochasticRelaxationGibbs1984" role="doc-biblioref">Geman &amp; Geman, 1984</a>)</span> uses <em>conjugate</em> pairs (i.e., pairs of priors and likelihoods that have analytic solutions for the posterior of an individual parameter) to efficiently sample from the posterior. Gibbs was the workhorse algorithm during the rise of Bayesian computation in the 1990s. However, it’s limited in that (a) you might not want to use conjugate priors and (b) it can be quite inefficient with complex hierarchical models, which we’ll be fitting soon.</p>
<p>We will not be using the Gibbs sampler in this project. It’s available for use in R. For an extensive applied introduction, check out Kruschke’s <span class="citation">(<a href="#ref-kruschkeDoingBayesianData2015" role="doc-biblioref">2015</a>)</span> <a href="https://sites.google.com/site/doingbayesiandataanalysis/">text</a>.</p>
</div>
<div id="hamiltonian-monte-carlo." class="section level3 hasAnchor" number="8.2.2">
<h3><span class="header-section-number">8.2.2</span> Hamiltonian Monte Carlo.<a href="markov-chain-monte-carlo.html#hamiltonian-monte-carlo." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Hamiltonian Monte Carlo (HMC) is more computationally costly and more efficient than Gibbs at sampling from the posterior. It needs fewer samples, especially when fitting models with many parameters. To learn more about how HMC works, check out McElreath’s <a href="https://youtu.be/v-j0UmWf3Us">lecture on the topic from January 2019</a> or one of these lectures (<a href="https://youtu.be/jUSZboSq1zg">here</a>, <a href="https://youtu.be/_fnDz2Bz3h8">here</a>, or <a href="https://youtu.be/pHsuIaPbNbY">here</a>) by Michael Betancourt.</p>
</div>
</div>
<div id="easy-hmc-map2stan-brm" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Easy HMC: <del>map2stan</del> <code>brm()</code><a href="markov-chain-monte-carlo.html#easy-hmc-map2stan-brm" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Much like McElreath’s rethinking package, brms provides a convenient interface to HMC via Stan. Other packages providing Stan interfaces include <a href="https://mc-stan.org/rstanarm/">rstanarm</a> <span class="citation">(<a href="#ref-rstanarm2018" role="doc-biblioref">Brilleman et al., 2018</a>; <a href="#ref-R-rstanarm" role="doc-biblioref">Gabry &amp; Goodrich, 2022</a>)</span> and <a href="https://ecmerkle.github.io/blavaan/">blavaan</a> <span class="citation">(<a href="#ref-blavaan2021" role="doc-biblioref">Merkle et al., 2021</a>, <a href="#ref-R-blavaan" role="doc-biblioref">2022</a>; <a href="#ref-Merkle2018blavaan" role="doc-biblioref">Merkle &amp; Rosseel, 2018</a>)</span>. I’m not aware of any up-to-date comparisons across the packages. If you’re ever inclined to make one, <a href="https://github.com/ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse/issues">let the rest of us know</a>!</p>
<p>Here we load the <code>rugged</code> data.</p>
<div class="sourceCode" id="cb779"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb779-1"><a href="markov-chain-monte-carlo.html#cb779-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb779-2"><a href="markov-chain-monte-carlo.html#cb779-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(rugged)</span>
<span id="cb779-3"><a href="markov-chain-monte-carlo.html#cb779-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> rugged</span></code></pre></div>
<p>Switch from rethinking to brms.</p>
<div class="sourceCode" id="cb780"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb780-1"><a href="markov-chain-monte-carlo.html#cb780-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>rethinking)</span>
<span id="cb780-2"><a href="markov-chain-monte-carlo.html#cb780-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb780-3"><a href="markov-chain-monte-carlo.html#cb780-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(rugged)</span></code></pre></div>
<p>It takes just a sec to do a little data manipulation.</p>
<div class="sourceCode" id="cb781"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb781-1"><a href="markov-chain-monte-carlo.html#cb781-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> </span>
<span id="cb781-2"><a href="markov-chain-monte-carlo.html#cb781-2" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb781-3"><a href="markov-chain-monte-carlo.html#cb781-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_gdp =</span> <span class="fu">log</span>(rgdppc_2000))</span>
<span id="cb781-4"><a href="markov-chain-monte-carlo.html#cb781-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb781-5"><a href="markov-chain-monte-carlo.html#cb781-5" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span></span>
<span id="cb781-6"><a href="markov-chain-monte-carlo.html#cb781-6" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb781-7"><a href="markov-chain-monte-carlo.html#cb781-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(rgdppc_2000)</span></code></pre></div>
<p>In the context of this chapter, it doesn’t make sense to translate McElreath’s m8.1 <code>map()</code> code to <code>brm()</code> code. Below, we’ll just go directly to the <code>brm()</code> variant of his <code>m8.1stan</code>.</p>
<div id="preparation." class="section level3 hasAnchor" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> Preparation.<a href="markov-chain-monte-carlo.html#preparation." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When working with brms, you don’t need to do the data processing McElreath did on pages 248 and 249. If you wanted to, however, here’s how you might do it within the tidyverse.</p>
<div class="sourceCode" id="cb782"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb782-1"><a href="markov-chain-monte-carlo.html#cb782-1" aria-hidden="true" tabindex="-1"></a>dd.trim <span class="ot">&lt;-</span></span>
<span id="cb782-2"><a href="markov-chain-monte-carlo.html#cb782-2" aria-hidden="true" tabindex="-1"></a>  dd <span class="sc">%&gt;%</span></span>
<span id="cb782-3"><a href="markov-chain-monte-carlo.html#cb782-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(log_gdp, rugged, cont_africa)</span>
<span id="cb782-4"><a href="markov-chain-monte-carlo.html#cb782-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb782-5"><a href="markov-chain-monte-carlo.html#cb782-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dd.trim)</span></code></pre></div>
</div>
<div id="estimation." class="section level3 hasAnchor" number="8.3.2">
<h3><span class="header-section-number">8.3.2</span> Estimation.<a href="markov-chain-monte-carlo.html#estimation." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Finally, we get to work that sweet HMC via <code>brms::brm()</code>.</p>
<div class="sourceCode" id="cb783"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb783-1"><a href="markov-chain-monte-carlo.html#cb783-1" aria-hidden="true" tabindex="-1"></a>b8<span class="fl">.1</span> <span class="ot">&lt;-</span></span>
<span id="cb783-2"><a href="markov-chain-monte-carlo.html#cb783-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> dd, </span>
<span id="cb783-3"><a href="markov-chain-monte-carlo.html#cb783-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb783-4"><a href="markov-chain-monte-carlo.html#cb783-4" aria-hidden="true" tabindex="-1"></a>      log_gdp <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> rugged <span class="sc">+</span> cont_africa <span class="sc">+</span> rugged<span class="sc">:</span>cont_africa,</span>
<span id="cb783-5"><a href="markov-chain-monte-carlo.html#cb783-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb783-6"><a href="markov-chain-monte-carlo.html#cb783-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb783-7"><a href="markov-chain-monte-carlo.html#cb783-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb783-8"><a href="markov-chain-monte-carlo.html#cb783-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">8</span>,</span>
<span id="cb783-9"><a href="markov-chain-monte-carlo.html#cb783-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b08.01&quot;</span>)</span></code></pre></div>
<p>Now we have officially ditched the uniform distribution for <span class="math inline">\(\sigma\)</span>. Never again! Here’s the posterior.</p>
<div class="sourceCode" id="cb784"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb784-1"><a href="markov-chain-monte-carlo.html#cb784-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b8<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: log_gdp ~ 1 + rugged + cont_africa + rugged:cont_africa 
##    Data: dd (Number of observations: 170) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##                    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept              9.23      0.14     8.94     9.51 1.00     3351     3290
## rugged                -0.20      0.08    -0.36    -0.05 1.00     3375     3389
## cont_africa           -1.95      0.23    -2.40    -1.51 1.00     3007     3101
## rugged:cont_africa     0.39      0.13     0.13     0.65 1.00     2854     3320
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.95      0.05     0.85     1.06 1.00     4356     2577
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Do note a couple things: If you look closely at the summary information at the top, you’ll see that the <code>brm()</code> function defaults to <code>chains = 4</code>. If you check the manual, you’ll see it also defaults to <code>cores = 1</code>, as well as <code>iter = 2000</code> and <code>warmup = 1000</code>. Also of note, McElreath’s <code>rethinking::precis()</code> returns highest posterior density intervals (HPDIs) when summarizing <code>map2stan()</code> models. Not so with brms. If you want HPDIs, you’ll have to use the convenience functions from the tidybayes package. Here’s an example.</p>
<div class="sourceCode" id="cb786"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb786-1"><a href="markov-chain-monte-carlo.html#cb786-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb786-2"><a href="markov-chain-monte-carlo.html#cb786-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb786-3"><a href="markov-chain-monte-carlo.html#cb786-3" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b8<span class="fl">.1</span>)</span>
<span id="cb786-4"><a href="markov-chain-monte-carlo.html#cb786-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb786-5"><a href="markov-chain-monte-carlo.html#cb786-5" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb786-6"><a href="markov-chain-monte-carlo.html#cb786-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(b_Intercept<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb786-7"><a href="markov-chain-monte-carlo.html#cb786-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb786-8"><a href="markov-chain-monte-carlo.html#cb786-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(key) <span class="sc">%&gt;%</span> </span>
<span id="cb786-9"><a href="markov-chain-monte-carlo.html#cb786-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_hdi</span>(value, <span class="at">.width =</span> .<span class="dv">89</span>)  <span class="co"># note our rare use of 89% intervals</span></span></code></pre></div>
<pre><code>## # A tibble: 5 × 7
##   key                   value .lower  .upper .width .point .interval
##   &lt;chr&gt;                 &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 b_cont_africa        -1.95  -2.31  -1.59     0.89 mean   hdi      
## 2 b_Intercept           9.23   9.00   9.45     0.89 mean   hdi      
## 3 b_rugged             -0.203 -0.327 -0.0743   0.89 mean   hdi      
## 4 b_rugged:cont_africa  0.391  0.167  0.586    0.89 mean   hdi      
## 5 sigma                 0.950  0.870  1.04     0.89 mean   hdi</code></pre>
<p>There’s one more important difference in our brms summary output compared to McElreath’s <code>rethinking::precis()</code> output. In the text we learn <code>precis()</code> returns <code>n_eff</code> values for each parameter. Earlier versions of brms used to have a direct analogue named <code>Eff.Sample</code>. Both were estimates of the effective number of samples (a.k.a. the effective sample size) for each parameter. As with typical sample size, the more the merrier. Starting with version 2.10.0, brms now returns two columns: <code>Bulk_ESS</code> and <code>Tail_ESS</code>. These originate from a <span class="citation">(<a href="#ref-vehtariRanknormalizationFoldingLocalization2021" role="doc-biblioref">2021</a>)</span> <a href="https://doi.org/10.1214/20-BA1221">paper</a> by Stan-team all-stars Vehtari, Gelman, Simpson, Carpenter, and Bürkner. From their paper, we read:</p>
<blockquote>
<p>If you plan to report quantile estimates or posterior intervals, we strongly suggest assessing the convergence of the chains for these quantiles. In Section 4.3 we show that convergence of Markov chains is not uniform across the parameter space and propose diagnostics and effective sample sizes specifically for extreme quantiles. This is <em>different</em> from the standard ESS estimate (which we refer to as the “bulk-ESS”), which mainly assesses how well the centre of the distribution is resolved. Instead, these “tail-ESS” measures allow the user to estimate the MCSE for interval estimates. (p. 5, <em>emphasis</em> in the original)</p>
</blockquote>
<p>For more technical details, see the paper. In short, <code>Bulk_ESS</code> in the output from brms 2.10.0+ is what was previously referred to as <code>Eff.Sample</code> in earlier versions. It’s also what corresponds to what McElreath calls <code>n_eff</code>. This indexed the number of effective samples in ‘the center of the’ posterior distribution (i.e., the posterior mean or median). But since we also care about uncertainty in our parameters, we care about stability in the 95% intervals and such. The new <code>Tail_ESS</code> in brms output allows us to gauge the effective sample size for those intervals.</p>
</div>
<div id="sampling-again-in-parallel." class="section level3 hasAnchor" number="8.3.3">
<h3><span class="header-section-number">8.3.3</span> Sampling again, in parallel.<a href="markov-chain-monte-carlo.html#sampling-again-in-parallel." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here we sample in parallel by adding <code>cores = 4</code>.</p>
<div class="sourceCode" id="cb788"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb788-1"><a href="markov-chain-monte-carlo.html#cb788-1" aria-hidden="true" tabindex="-1"></a>b8<span class="fl">.1</span>b <span class="ot">&lt;-</span> </span>
<span id="cb788-2"><a href="markov-chain-monte-carlo.html#cb788-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update</span>(b8<span class="fl">.1</span>, </span>
<span id="cb788-3"><a href="markov-chain-monte-carlo.html#cb788-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb788-4"><a href="markov-chain-monte-carlo.html#cb788-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">seed =</span> <span class="dv">8</span>,</span>
<span id="cb788-5"><a href="markov-chain-monte-carlo.html#cb788-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">file =</span> <span class="st">&quot;fits/b08.01b&quot;</span>)</span></code></pre></div>
<p>This model sampled so fast that it really didn’t matter if we sampled in parallel or not. It will for others.</p>
<div class="sourceCode" id="cb789"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb789-1"><a href="markov-chain-monte-carlo.html#cb789-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b8<span class="fl">.1</span>b)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: log_gdp ~ 1 + rugged + cont_africa + rugged:cont_africa 
##    Data: dd (Number of observations: 170) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##                    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept              9.23      0.14     8.94     9.51 1.00     3351     3290
## rugged                -0.20      0.08    -0.36    -0.05 1.00     3375     3389
## cont_africa           -1.95      0.23    -2.40    -1.51 1.00     3007     3101
## rugged:cont_africa     0.39      0.13     0.13     0.65 1.00     2854     3320
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.95      0.05     0.85     1.06 1.00     4356     2577
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div id="visualization." class="section level3 hasAnchor" number="8.3.4">
<h3><span class="header-section-number">8.3.4</span> Visualization.<a href="markov-chain-monte-carlo.html#visualization." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Unlike the way rethinking’s <code>extract.samples()</code> yields a list, brms’s <code>as_draws_df()</code> returns a data frame.</p>
<div class="sourceCode" id="cb791"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb791-1"><a href="markov-chain-monte-carlo.html#cb791-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b8<span class="fl">.1</span>)</span>
<span id="cb791-2"><a href="markov-chain-monte-carlo.html#cb791-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(post)</span></code></pre></div>
<pre><code>## draws_df [4,000 × 10] (S3: draws_df/draws/tbl_df/tbl/data.frame)
##  $ b_Intercept         : num [1:4000] 9.31 9.14 9.07 9.1 9.21 ...
##  $ b_rugged            : num [1:4000] -0.27 -0.205 -0.256 -0.194 -0.223 ...
##  $ b_cont_africa       : num [1:4000] -2.14 -2.19 -1.87 -1.85 -2 ...
##  $ b_rugged:cont_africa: num [1:4000] 0.554 0.48 0.404 0.412 0.395 ...
##  $ sigma               : num [1:4000] 0.931 0.942 0.946 0.899 0.996 ...
##  $ lprior              : num [1:4000] -16.6 -16.6 -16.6 -16.5 -16.6 ...
##  $ lp__                : num [1:4000] -247 -248 -250 -247 -247 ...
##  $ .chain              : int [1:4000] 1 1 1 1 1 1 1 1 1 1 ...
##  $ .iteration          : int [1:4000] 1 2 3 4 5 6 7 8 9 10 ...
##  $ .draw               : int [1:4000] 1 2 3 4 5 6 7 8 9 10 ...</code></pre>
<p>Though we won’t be doing so in this ebook, you could instead use the <code>as_draws()</code> or <code>as_draws_list()</code> functions if you really wanted your posterior draws in a list format.</p>
<p>As with McElreath’s rethinking, brms allows users to put the <code>post</code> data frame or the brmsfit object directly in <code>pairs()</code>.</p>
<div class="sourceCode" id="cb793"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb793-1"><a href="markov-chain-monte-carlo.html#cb793-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(b8<span class="fl">.1</span>,</span>
<span id="cb793-2"><a href="markov-chain-monte-carlo.html#cb793-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">off_diag_args =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>))</span></code></pre></div>
<p><img src="08_files/figure-html/unnamed-chunk-15-1.png" width="576" /></p>
<p>Another nice way to customize your pairs plot is with the <a href="https://cran.r-project.org/package=GGally">GGally package</a>.</p>
<div class="sourceCode" id="cb794"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb794-1"><a href="markov-chain-monte-carlo.html#cb794-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span></code></pre></div>
<div class="sourceCode" id="cb795"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb795-1"><a href="markov-chain-monte-carlo.html#cb795-1" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span></span>
<span id="cb795-2"><a href="markov-chain-monte-carlo.html#cb795-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(b_Intercept<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span></span>
<span id="cb795-3"><a href="markov-chain-monte-carlo.html#cb795-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>()</span></code></pre></div>
<p><img src="08_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>Since <code>GGally::ggpairs()</code> returns a ggplot2 object, you can customize it as you please.</p>
<div class="sourceCode" id="cb796"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb796-1"><a href="markov-chain-monte-carlo.html#cb796-1" aria-hidden="true" tabindex="-1"></a>my_upper <span class="ot">&lt;-</span> <span class="cf">function</span>(data, mapping, ...) {</span>
<span id="cb796-2"><a href="markov-chain-monte-carlo.html#cb796-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb796-3"><a href="markov-chain-monte-carlo.html#cb796-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get the x and y data to use the other code</span></span>
<span id="cb796-4"><a href="markov-chain-monte-carlo.html#cb796-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">eval_data_col</span>(data, mapping<span class="sc">$</span>x)</span>
<span id="cb796-5"><a href="markov-chain-monte-carlo.html#cb796-5" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">eval_data_col</span>(data, mapping<span class="sc">$</span>y)</span>
<span id="cb796-6"><a href="markov-chain-monte-carlo.html#cb796-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb796-7"><a href="markov-chain-monte-carlo.html#cb796-7" aria-hidden="true" tabindex="-1"></a>  r  <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">cor.test</span>(x, y)<span class="sc">$</span>estimate)</span>
<span id="cb796-8"><a href="markov-chain-monte-carlo.html#cb796-8" aria-hidden="true" tabindex="-1"></a>  rt <span class="ot">&lt;-</span> <span class="fu">format</span>(r, <span class="at">digits =</span> <span class="dv">2</span>)[<span class="dv">1</span>]</span>
<span id="cb796-9"><a href="markov-chain-monte-carlo.html#cb796-9" aria-hidden="true" tabindex="-1"></a>  tt <span class="ot">&lt;-</span> <span class="fu">as.character</span>(rt)</span>
<span id="cb796-10"><a href="markov-chain-monte-carlo.html#cb796-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb796-11"><a href="markov-chain-monte-carlo.html#cb796-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot the cor value</span></span>
<span id="cb796-12"><a href="markov-chain-monte-carlo.html#cb796-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggally_text</span>(</span>
<span id="cb796-13"><a href="markov-chain-monte-carlo.html#cb796-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> tt, </span>
<span id="cb796-14"><a href="markov-chain-monte-carlo.html#cb796-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(),</span>
<span id="cb796-15"><a href="markov-chain-monte-carlo.html#cb796-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb796-16"><a href="markov-chain-monte-carlo.html#cb796-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;grey20&quot;</span>) <span class="sc">+</span></span>
<span id="cb796-17"><a href="markov-chain-monte-carlo.html#cb796-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>() </span>
<span id="cb796-18"><a href="markov-chain-monte-carlo.html#cb796-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb796-19"><a href="markov-chain-monte-carlo.html#cb796-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb796-20"><a href="markov-chain-monte-carlo.html#cb796-20" aria-hidden="true" tabindex="-1"></a>my_diag <span class="ot">&lt;-</span> <span class="cf">function</span>(data, mapping, ...) {</span>
<span id="cb796-21"><a href="markov-chain-monte-carlo.html#cb796-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="at">mapping =</span> mapping) <span class="sc">+</span> </span>
<span id="cb796-22"><a href="markov-chain-monte-carlo.html#cb796-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&quot;grey50&quot;</span>) <span class="sc">+</span></span>
<span id="cb796-23"><a href="markov-chain-monte-carlo.html#cb796-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_ipsum</span>()</span>
<span id="cb796-24"><a href="markov-chain-monte-carlo.html#cb796-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb796-25"><a href="markov-chain-monte-carlo.html#cb796-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb796-26"><a href="markov-chain-monte-carlo.html#cb796-26" aria-hidden="true" tabindex="-1"></a>my_lower <span class="ot">&lt;-</span> <span class="cf">function</span>(data, mapping, ...) {</span>
<span id="cb796-27"><a href="markov-chain-monte-carlo.html#cb796-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="at">mapping =</span> mapping) <span class="sc">+</span> </span>
<span id="cb796-28"><a href="markov-chain-monte-carlo.html#cb796-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb796-29"><a href="markov-chain-monte-carlo.html#cb796-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_ipsum</span>()</span>
<span id="cb796-30"><a href="markov-chain-monte-carlo.html#cb796-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb796-31"><a href="markov-chain-monte-carlo.html#cb796-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb796-32"><a href="markov-chain-monte-carlo.html#cb796-32" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span></span>
<span id="cb796-33"><a href="markov-chain-monte-carlo.html#cb796-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(b_Intercept<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span></span>
<span id="cb796-34"><a href="markov-chain-monte-carlo.html#cb796-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb796-35"><a href="markov-chain-monte-carlo.html#cb796-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(<span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> my_upper),</span>
<span id="cb796-36"><a href="markov-chain-monte-carlo.html#cb796-36" aria-hidden="true" tabindex="-1"></a>          <span class="at">diag  =</span> <span class="fu">list</span>(<span class="at">continuous =</span> my_diag),</span>
<span id="cb796-37"><a href="markov-chain-monte-carlo.html#cb796-37" aria-hidden="true" tabindex="-1"></a>          <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> my_lower)) <span class="sc">+</span></span>
<span id="cb796-38"><a href="markov-chain-monte-carlo.html#cb796-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;My custom pairs plot&quot;</span>) <span class="sc">+</span></span>
<span id="cb796-39"><a href="markov-chain-monte-carlo.html#cb796-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span></code></pre></div>
<p><img src="08_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>For more ideas on customizing a <code>ggpairs()</code> plot, go <a href="https://ggobi.github.io/ggally/articles/ggpairs.html">here</a>.</p>
</div>
<div id="using-the-samples." class="section level3 hasAnchor" number="8.3.5">
<h3><span class="header-section-number">8.3.5</span> Using the samples.<a href="markov-chain-monte-carlo.html#using-the-samples." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Older versions of brms allowed users to include information criteria as a part of the model summary by adding <code>loo = T</code> and/or <code>waic = T</code> in the <code>summary()</code> function (e.g., <code>summary(b8.1, loo = T, waic = T)</code>. However, this is no longer the case. E.g.,</p>
<div class="sourceCode" id="cb797"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb797-1"><a href="markov-chain-monte-carlo.html#cb797-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(b8<span class="fl">.1</span>, <span class="at">loo =</span> T, <span class="at">waic =</span> T)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: log_gdp ~ 1 + rugged + cont_africa + rugged:cont_africa 
##    Data: dd (Number of observations: 170) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##                    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept              9.23      0.14     8.94     9.51 1.00     3351     3290
## rugged                -0.20      0.08    -0.36    -0.05 1.00     3375     3389
## cont_africa           -1.95      0.23    -2.40    -1.51 1.00     3007     3101
## rugged:cont_africa     0.39      0.13     0.13     0.65 1.00     2854     3320
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.95      0.05     0.85     1.06 1.00     4356     2577
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Although R didn’t bark at us for adding <code>loo = T, waic = T</code>, they didn’t do anything. Nowadays, if you want that information, you’ll have to use the <code>waic()</code> and/or <code>loo()</code> functions.</p>
<div class="sourceCode" id="cb799"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb799-1"><a href="markov-chain-monte-carlo.html#cb799-1" aria-hidden="true" tabindex="-1"></a><span class="fu">waic</span>(b8<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>## 
## Computed from 4000 by 170 log-likelihood matrix
## 
##           Estimate   SE
## elpd_waic   -234.7  7.4
## p_waic         5.1  0.9
## waic         469.3 14.8
## 
## 2 (1.2%) p_waic estimates greater than 0.4. We recommend trying loo instead.</code></pre>
<div class="sourceCode" id="cb801"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb801-1"><a href="markov-chain-monte-carlo.html#cb801-1" aria-hidden="true" tabindex="-1"></a>(l_b8<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">loo</span>(b8<span class="fl">.1</span>))</span></code></pre></div>
<pre><code>## 
## Computed from 4000 by 170 log-likelihood matrix
## 
##          Estimate   SE
## elpd_loo   -234.7  7.4
## p_loo         5.2  0.9
## looic       469.5 14.9
## ------
## Monte Carlo SE of elpd_loo is 0.0.
## 
## All Pareto k estimates are good (k &lt; 0.5).
## See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<p>The recommended workflow since brms version 2.8.0 is to save the information criteria information with your <code>brm()</code> fit objects with the <code>add_criterion()</code> function.</p>
<div class="sourceCode" id="cb803"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb803-1"><a href="markov-chain-monte-carlo.html#cb803-1" aria-hidden="true" tabindex="-1"></a>b8<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(b8<span class="fl">.1</span>, <span class="fu">c</span>(<span class="st">&quot;waic&quot;</span>, <span class="st">&quot;loo&quot;</span>))</span></code></pre></div>
<p>You retrieve that information by subsetting the fit object.</p>
<div class="sourceCode" id="cb804"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb804-1"><a href="markov-chain-monte-carlo.html#cb804-1" aria-hidden="true" tabindex="-1"></a>b8<span class="fl">.1</span><span class="sc">$</span>criteria<span class="sc">$</span>waic</span></code></pre></div>
<pre><code>## 
## Computed from 4000 by 170 log-likelihood matrix
## 
##           Estimate   SE
## elpd_waic   -234.7  7.4
## p_waic         5.1  0.9
## waic         469.3 14.8
## 
## 2 (1.2%) p_waic estimates greater than 0.4. We recommend trying loo instead.</code></pre>
<div class="sourceCode" id="cb806"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb806-1"><a href="markov-chain-monte-carlo.html#cb806-1" aria-hidden="true" tabindex="-1"></a>b8<span class="fl">.1</span><span class="sc">$</span>criteria<span class="sc">$</span>loo</span></code></pre></div>
<pre><code>## 
## Computed from 4000 by 170 log-likelihood matrix
## 
##          Estimate   SE
## elpd_loo   -234.7  7.4
## p_loo         5.2  0.9
## looic       469.5 14.9
## ------
## Monte Carlo SE of elpd_loo is 0.0.
## 
## All Pareto k estimates are good (k &lt; 0.5).
## See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<p>In response to the brms version 2.8.0 update, which itself accommodated updates to the loo package and both of which occurred years after McElreath published the first edition of his text, we’ve been bantering on about the <span class="math inline">\(\text{elpd}\)</span> and its relation to the WAIC and the LOO since <a href="overfitting-regularization-and-information-criteria.html#information-criteria">Chapter 6</a>. This is a fine place to go into some detail.</p>
<p>The <code>elpd</code> values returned by <code>loo()</code> and <code>waic()</code> are the expected log pointwise predictive density for new data. It follows the formula</p>
<p><span class="math display">\[\text{elpd} = \sum_{i = 1}^n \int p_t (\tilde y_i) \log p (\tilde y_i | y) d \tilde y_i,\]</span></p>
<blockquote>
<p>where <span class="math inline">\(p_t (\tilde y_i)\)</span> is the distribution representing the true data-generating process for <span class="math inline">\(\tilde y_i\)</span>. The <span class="math inline">\(p_t (\tilde y_i)\)</span>’s are unknown, and we will use cross-validation or WAIC to approximate. In a regression, these distributions are also implicitly conditioned on any predictors in the model. <span class="citation">(<a href="#ref-vehtariPracticalBayesianModel2017" role="doc-biblioref">Vehtari et al., 2017, p. 2</a>)</span>.</p>
</blockquote>
<p>Later in the paper, we learn the <code>elpd_loo</code> (i.e., the Bayesian LOO estimate of out-of-sample predictive fit) is defined as</p>
<p><span class="math display">\[\text{elpd}_\text{loo} = \sum_{i = 1}^n \log p (y_i | y - _i),\]</span></p>
<p>where</p>
<p><span class="math display">\[p (y_i | y - _i) = \int p (y_i | \theta) p (\theta | y - _i) d \theta\]</span></p>
<p>“is the leave-one-out predictive density given the data without the <span class="math inline">\(i\)</span>th data point” (p. 3). And recall, you can convert the <span class="math inline">\(\text{elpd}\)</span> to the conventional information criteria metric by multiplying it by -2.</p>
<p>To learn more about the <span class="math inline">\(\text{elpd}\)</span>, read the rest of the paper and the <a href="https://cran.r-project.org/package=loo">other works referenced by the loo package team</a>. And if you prefer watching video lectures to reading technical papers, check out Vehtari’s <a href="https://youtu.be/Re-2yVd0Mqk"><em>Model assessment, selection and averaging</em></a>.</p>
</div>
<div id="checking-the-chain." class="section level3 hasAnchor" number="8.3.6">
<h3><span class="header-section-number">8.3.6</span> Checking the chain.<a href="markov-chain-monte-carlo.html#checking-the-chain." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Using <code>plot()</code> for a <code>brm()</code> fit returns both density and trace lots for the parameters.</p>
<div class="sourceCode" id="cb808"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb808-1"><a href="markov-chain-monte-carlo.html#cb808-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b8<span class="fl">.1</span>, <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>))</span></code></pre></div>
<p><img src="08_files/figure-html/unnamed-chunk-23-1.png" width="768" /></p>
<p>The <a href="https://cran.r-project.org/package=bayesplot">bayesplot</a> package allows a little more control. Here, we use bayesplot’s <code>mcmc_trace()</code> to show only trace plots with our custom theme. Note that <code>mcmc_trace()</code> works with data frames, not brmfit objects.</p>
<div class="sourceCode" id="cb809"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb809-1"><a href="markov-chain-monte-carlo.html#cb809-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb809-2"><a href="markov-chain-monte-carlo.html#cb809-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb809-3"><a href="markov-chain-monte-carlo.html#cb809-3" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b8<span class="fl">.1</span>)</span>
<span id="cb809-4"><a href="markov-chain-monte-carlo.html#cb809-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb809-5"><a href="markov-chain-monte-carlo.html#cb809-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(post, </span>
<span id="cb809-6"><a href="markov-chain-monte-carlo.html#cb809-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">pars =</span> <span class="fu">vars</span>(b_Intercept<span class="sc">:</span>sigma),</span>
<span id="cb809-7"><a href="markov-chain-monte-carlo.html#cb809-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">facet_args =</span> <span class="fu">list</span>(<span class="at">ncol =</span> <span class="dv">3</span>), </span>
<span id="cb809-8"><a href="markov-chain-monte-carlo.html#cb809-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb809-9"><a href="markov-chain-monte-carlo.html#cb809-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_ipsum</span>() <span class="sc">+</span></span>
<span id="cb809-10"><a href="markov-chain-monte-carlo.html#cb809-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;My custom trace plots&quot;</span>) <span class="sc">+</span></span>
<span id="cb809-11"><a href="markov-chain-monte-carlo.html#cb809-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_ipsum</span>() <span class="sc">+</span></span>
<span id="cb809-12"><a href="markov-chain-monte-carlo.html#cb809-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">95</span>, .<span class="dv">2</span>))</span></code></pre></div>
<p><img src="08_files/figure-html/unnamed-chunk-24-1.png" width="768" /></p>
<p>The bayesplot package offers a variety of diagnostic plots. Here we make autocorrelation plots for all model parameters, one for each HMC chain.</p>
<div class="sourceCode" id="cb810"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb810-1"><a href="markov-chain-monte-carlo.html#cb810-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_acf</span>(post, </span>
<span id="cb810-2"><a href="markov-chain-monte-carlo.html#cb810-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">pars =</span> <span class="fu">vars</span>(b_Intercept<span class="sc">:</span>sigma),</span>
<span id="cb810-3"><a href="markov-chain-monte-carlo.html#cb810-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">lags =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb810-4"><a href="markov-chain-monte-carlo.html#cb810-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_ipsum</span>() <span class="sc">+</span></span>
<span id="cb810-5"><a href="markov-chain-monte-carlo.html#cb810-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_ipsum</span>()</span></code></pre></div>
<p><img src="08_files/figure-html/unnamed-chunk-25-1.png" width="768" /></p>
<p>That’s just what we like to see–nice L-shaped autocorrelation plots. Those are the kinds of shapes you’d expect when you have reasonably large effective samples.</p>
<p>Before we move on, there’s an important difference between the trace plots McElreath showed in the text and the ones we just made. McElreath’s trace plots include the warmup iterations. Ours did not. That’s why his <span class="math inline">\(x\)</span>-axis values ranged from 1 to 2,000 and ours only ranged from 1 to 1,000. To my knowledge, neither the <code>brms::plot()</code> nor the <code>bayesplot::mcmc_trace()</code> functions support including warmups in their trace plots. One quick way to get them is with the <a href="https://cran.rstudio.com/package=ggmcmc">ggmcmc package</a> <span class="citation">(<a href="#ref-fernandezGGMCMCAnalysisofMCMC2016" role="doc-biblioref">Fernández i Marín, 2016</a>, <a href="#ref-R-ggmcmc" role="doc-biblioref">2021</a>)</span>.</p>
<div class="sourceCode" id="cb811"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb811-1"><a href="markov-chain-monte-carlo.html#cb811-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmcmc)</span></code></pre></div>
<p>The ggmcmc package has a variety of convenience functions for working with MCMC chains. The <code>ggs()</code> function extracts the posterior draws, including <code>warmup</code>, and arranges them in a tidy tibble.</p>
<div class="sourceCode" id="cb812"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb812-1"><a href="markov-chain-monte-carlo.html#cb812-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs</span>(b8<span class="fl">.1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb812-2"><a href="markov-chain-monte-carlo.html#cb812-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code></pre></div>
<pre><code>## tibble [48,000 × 4] (S3: tbl_df/tbl/data.frame)
##  $ Iteration: int [1:48000] 1 2 3 4 5 6 7 8 9 10 ...
##  $ Chain    : int [1:48000] 1 1 1 1 1 1 1 1 1 1 ...
##  $ Parameter: Factor w/ 6 levels &quot;b_cont_africa&quot;,..: 2 2 2 2 2 2 2 2 2 2 ...
##  $ value    : num [1:48000] 0.815 0.815 0.815 0.815 0.871 ...
##  - attr(*, &quot;nChains&quot;)= int 4
##  - attr(*, &quot;nParameters&quot;)= int 6
##  - attr(*, &quot;nIterations&quot;)= int 2000
##  - attr(*, &quot;nBurnin&quot;)= num 1000
##  - attr(*, &quot;nThin&quot;)= num 1
##  - attr(*, &quot;description&quot;)= chr &quot;644a2f8c915761c6340d991526fba09f&quot;</code></pre>
<p>With this in hand, we can now include those warmup draws in our trace plots. Here’s how to do so without convenience functions like <code>bayesplot::mcmc_trace()</code>.</p>
<div class="sourceCode" id="cb814"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb814-1"><a href="markov-chain-monte-carlo.html#cb814-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs</span>(b8<span class="fl">.1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb814-2"><a href="markov-chain-monte-carlo.html#cb814-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">!=</span> <span class="st">&quot;lprior&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb814-3"><a href="markov-chain-monte-carlo.html#cb814-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chain =</span> <span class="fu">factor</span>(Chain)) <span class="sc">%&gt;%</span> </span>
<span id="cb814-4"><a href="markov-chain-monte-carlo.html#cb814-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb814-5"><a href="markov-chain-monte-carlo.html#cb814-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Iteration, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb814-6"><a href="markov-chain-monte-carlo.html#cb814-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this marks off the warmups</span></span>
<span id="cb814-7"><a href="markov-chain-monte-carlo.html#cb814-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;rect&quot;</span>, </span>
<span id="cb814-8"><a href="markov-chain-monte-carlo.html#cb814-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> <span class="dv">1000</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb814-9"><a href="markov-chain-monte-carlo.html#cb814-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">linewidth =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb814-10"><a href="markov-chain-monte-carlo.html#cb814-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> chain),</span>
<span id="cb814-11"><a href="markov-chain-monte-carlo.html#cb814-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb814-12"><a href="markov-chain-monte-carlo.html#cb814-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_ipsum</span>() <span class="sc">+</span></span>
<span id="cb814-13"><a href="markov-chain-monte-carlo.html#cb814-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;My custom trace plots with warmups via ggmcmc::ggs()&quot;</span>,</span>
<span id="cb814-14"><a href="markov-chain-monte-carlo.html#cb814-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb814-15"><a href="markov-chain-monte-carlo.html#cb814-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_ipsum</span>() <span class="sc">+</span></span>
<span id="cb814-16"><a href="markov-chain-monte-carlo.html#cb814-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">95</span>, .<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb814-17"><a href="markov-chain-monte-carlo.html#cb814-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Parameter, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="08_files/figure-html/unnamed-chunk-28-1.png" width="768" /></p>
<p>Following brms defaults, we won’t include warmup iterations in the trace plots for other models in this book. A nice thing about plots that do contain them, though, is they reveal how quickly our HMC chains transition away from their start values into the posterior. To get a better sense of this, let’s make those trace plots once more, but this time zooming in on the first 100 iterations.</p>
<div class="sourceCode" id="cb815"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb815-1"><a href="markov-chain-monte-carlo.html#cb815-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs</span>(b8<span class="fl">.1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb815-2"><a href="markov-chain-monte-carlo.html#cb815-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">!=</span> <span class="st">&quot;lprior&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb815-3"><a href="markov-chain-monte-carlo.html#cb815-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chain =</span> <span class="fu">factor</span>(Chain)) <span class="sc">%&gt;%</span> </span>
<span id="cb815-4"><a href="markov-chain-monte-carlo.html#cb815-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb815-5"><a href="markov-chain-monte-carlo.html#cb815-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Iteration, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb815-6"><a href="markov-chain-monte-carlo.html#cb815-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this marks off the warmups</span></span>
<span id="cb815-7"><a href="markov-chain-monte-carlo.html#cb815-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;rect&quot;</span>, </span>
<span id="cb815-8"><a href="markov-chain-monte-carlo.html#cb815-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> <span class="dv">1000</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb815-9"><a href="markov-chain-monte-carlo.html#cb815-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">linewidth =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb815-10"><a href="markov-chain-monte-carlo.html#cb815-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> chain),</span>
<span id="cb815-11"><a href="markov-chain-monte-carlo.html#cb815-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb815-12"><a href="markov-chain-monte-carlo.html#cb815-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_ipsum</span>() <span class="sc">+</span></span>
<span id="cb815-13"><a href="markov-chain-monte-carlo.html#cb815-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;My custom trace plots with warmups via ggmcmc::ggs()&quot;</span>,</span>
<span id="cb815-14"><a href="markov-chain-monte-carlo.html#cb815-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb815-15"><a href="markov-chain-monte-carlo.html#cb815-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb815-16"><a href="markov-chain-monte-carlo.html#cb815-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_ipsum</span>() <span class="sc">+</span></span>
<span id="cb815-17"><a href="markov-chain-monte-carlo.html#cb815-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">95</span>, .<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb815-18"><a href="markov-chain-monte-carlo.html#cb815-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Parameter, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="08_files/figure-html/unnamed-chunk-29-1.png" width="768" /></p>
<p>For each parameter, the all four chains had moved away from their starting values to converge on the marginal posteriors by the 50<sup>th</sup> iteration or so.</p>
<div id="overthinking-raw-stan-model-code." class="section level4 hasAnchor" number="8.3.6.1">
<h4><span class="header-section-number">8.3.6.1</span> Overthinking: Raw Stan model code.<a href="markov-chain-monte-carlo.html#overthinking-raw-stan-model-code." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The <code>stancode()</code> function works in brms much like it does in rethinking.</p>
<div class="sourceCode" id="cb816"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb816-1"><a href="markov-chain-monte-carlo.html#cb816-1" aria-hidden="true" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">stancode</span>(b8<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>## // generated with brms 2.18.0
## functions {
## }
## data {
##   int&lt;lower=1&gt; N;  // total number of observations
##   vector[N] Y;  // response variable
##   int&lt;lower=1&gt; K;  // number of population-level effects
##   matrix[N, K] X;  // population-level design matrix
##   int prior_only;  // should the likelihood be ignored?
## }
## transformed data {
##   int Kc = K - 1;
##   matrix[N, Kc] Xc;  // centered version of X without an intercept
##   vector[Kc] means_X;  // column means of X before centering
##   for (i in 2:K) {
##     means_X[i - 1] = mean(X[, i]);
##     Xc[, i - 1] = X[, i] - means_X[i - 1];
##   }
## }
## parameters {
##   vector[Kc] b;  // population-level effects
##   real Intercept;  // temporary intercept for centered predictors
##   real&lt;lower=0&gt; sigma;  // dispersion parameter
## }
## transformed parameters {
##   real lprior = 0;  // prior contributions to the log posterior
##   lprior += normal_lpdf(b | 0, 10);
##   lprior += normal_lpdf(Intercept | 0, 100);
##   lprior += cauchy_lpdf(sigma | 0, 2)
##     - 1 * cauchy_lccdf(0 | 0, 2);
## }
## model {
##   // likelihood including constants
##   if (!prior_only) {
##     target += normal_id_glm_lpdf(Y | Xc, Intercept, b, sigma);
##   }
##   // priors including constants
##   target += lprior;
## }
## generated quantities {
##   // actual population-level intercept
##   real b_Intercept = Intercept - dot_product(means_X, b);
## }</code></pre>
<p>You can also get that information with <code>b8.1$model</code> or <code>b8.1$fit@stanmodel</code>.</p>
</div>
</div>
</div>
<div id="care-and-feeding-of-your-markov-chain." class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> Care and feeding of your Markov chain.<a href="markov-chain-monte-carlo.html#care-and-feeding-of-your-markov-chain." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p>Markov chain Monte Carlo is a highly technical and usually automated procedure. Most people who use it don’t really understand what it is doing. That’s okay, up to a point. Science requires division of labor, and if every one of us had to write our own Markov chains from scratch, a lot less research would get done in the aggregate. (p. 255)</p>
</blockquote>
<p>But if you do want to learn more about HMC, McElreath has some nice introductory lectures on the topic (see <a href="https://youtu.be/v-j0UmWf3Us">here</a> and <a href="https://youtu.be/BWEtS3HuU5A">here</a>). To dive even deeper, <a href="https://betanalpha.github.io/">Michael Betancourt</a> from the Stan team has given many lectures on the topic (e.g., <a href="https://youtu.be/_fnDz2Bz3h8">here</a> and <a href="https://youtu.be/jUSZboSq1zg">here</a>).</p>
<div id="how-many-samples-do-you-need" class="section level3 hasAnchor" number="8.4.1">
<h3><span class="header-section-number">8.4.1</span> How many samples do you need?<a href="markov-chain-monte-carlo.html#how-many-samples-do-you-need" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The brms defaults for <code>iter</code> and <code>warmup</code> match those of McElreath’s rethinking.</p>
<blockquote>
<p>If all you want are posterior means, it doesn’t take many samples at all to get very good estimates. Even a couple hundred samples will do. But if you care about the exact shape in the extreme tails of the posterior, the 99th percentile or so, then you’ll need many many more. So there is no universally useful number of samples to aim for. In most typical regression applications, you can get a very good estimate of the posterior mean with as few as 200 effective samples. And if the posterior is approximately Gaussian, then all you need in addition is a good estimate of the variance, which can be had with one order of magnitude more, in most cases. For highly skewed posteriors, you’ll have to think more about which region of the distribution interests you. (p. 255)</p>
</blockquote>
<p>And remember, with changes from brms version 2.10.0, we now have both <code>Bulk_ESS</code> and <code>Tail_ESS</code> to consult when thinking about the effective sample size.</p>
</div>
<div id="how-many-chains-do-you-need" class="section level3 hasAnchor" number="8.4.2">
<h3><span class="header-section-number">8.4.2</span> How many chains do you need?<a href="markov-chain-monte-carlo.html#how-many-chains-do-you-need" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>“Using 3 or 4 chains is conventional, and quite often more than enough to reassure us that the sampling is working properly” (p. 257).</p>
<div id="convergence-diagnostics." class="section level4 hasAnchor" number="8.4.2.1">
<h4><span class="header-section-number">8.4.2.1</span> Convergence diagnostics.<a href="markov-chain-monte-carlo.html#convergence-diagnostics." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Times have changed. In the text, we read:</p>
<blockquote>
<p>The default diagnostic output from Stan includes two metrics, <code>n_eff</code> and <code>Rhat</code>. The first is a measure of the effective number of samples. The second is the Gelman-Rubin convergence diagnostic, <span class="math inline">\(\widehat R\)</span>. When <code>n_eff</code> is much lower than the actual number of iterations (minus warmup) of your chains, it means the chains are inefficient, but possibly still okay. When <code>Rhat</code> is above 1.00, it usually indicates that the chain has not yet converged, and probably you shouldn’t trust the samples. If you draw more iterations, it could be fine, or it could never converge. See the <a href="https://mc-stan.org/users/documentation/index.html">Stan user manual</a> for more details. It’s important however not to rely too much on these diagnostics. Like all heuristics, there are cases in which they provide poor advice. (p. 257)</p>
</blockquote>
<p>We’ve already covered how brms has expanded the traditional notion of effective samples (i.e., <code>n_eff</code>) to <code>Bulk_ESS</code> and <code>Tail_ESS</code>. Times are changing for the <span class="math inline">\(\widehat R\)</span>, too. As it turns out, the Stan team has found some deficiencies with the <span class="math inline">\(\widehat R\)</span>, for which they’ve made recommendations that will be implemented in the Stan ecosystem sometime soon (see <a href="https://discourse.mc-stan.org/t/new-r-hat-and-ess/8165">here</a> for a related thread on the Stan Forums). In the meantime, you can read all about it in <span class="citation">Vehtari et al. (<a href="#ref-vehtariRanknormalizationFoldingLocalization2021" role="doc-biblioref">2021</a>)</span> and in one of Dan Simpson’s <a href="https://statmodeling.stat.columbia.edu/2019/03/19/maybe-its-time-to-let-the-old-ways-die-or-we-broke-r-hat-so-now-we-have-to-fix-it/">blog posts</a>.</p>
<p>For more on these topics, you might also check out Gabry and Modrák’s <span class="citation">(<a href="#ref-gabryVisualMCMCDiagnostics2022" role="doc-biblioref">2022</a>)</span> vignette, <a href="https://CRAN.R-project.org/package=bayesplot/vignettes/plotting-mcmc-draws.html"><em>Visual MCMC diagnostics using the bayesplot package</em></a>.</p>
</div>
</div>
<div id="taming-a-wild-chain." class="section level3 hasAnchor" number="8.4.3">
<h3><span class="header-section-number">8.4.3</span> Taming a wild chain.<a href="markov-chain-monte-carlo.html#taming-a-wild-chain." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As with rethinking, brms can take data in the form of a list. Recall however, that in order to specify starting values, you need to specify a list of lists with an <code>init</code> argument rather than with <code>start</code>.</p>
<div class="sourceCode" id="cb818"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb818-1"><a href="markov-chain-monte-carlo.html#cb818-1" aria-hidden="true" tabindex="-1"></a>b8<span class="fl">.2</span> <span class="ot">&lt;-</span></span>
<span id="cb818-2"><a href="markov-chain-monte-carlo.html#cb818-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)), </span>
<span id="cb818-3"><a href="markov-chain-monte-carlo.html#cb818-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb818-4"><a href="markov-chain-monte-carlo.html#cb818-4" aria-hidden="true" tabindex="-1"></a>      y <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb818-5"><a href="markov-chain-monte-carlo.html#cb818-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="sc">-</span><span class="fl">1e10</span>, <span class="fl">1e10</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb818-6"><a href="markov-chain-monte-carlo.html#cb818-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="dv">0</span>, <span class="fl">1e10</span>), <span class="at">class =</span> sigma, <span class="at">ub =</span> <span class="fl">1e10</span>)),</span>
<span id="cb818-7"><a href="markov-chain-monte-carlo.html#cb818-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">init =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">Intercept =</span> <span class="dv">0</span>, <span class="at">sigma =</span> <span class="dv">1</span>),</span>
<span id="cb818-8"><a href="markov-chain-monte-carlo.html#cb818-8" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="at">Intercept =</span> <span class="dv">0</span>, <span class="at">sigma =</span> <span class="dv">1</span>)),</span>
<span id="cb818-9"><a href="markov-chain-monte-carlo.html#cb818-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb818-10"><a href="markov-chain-monte-carlo.html#cb818-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">8</span>,</span>
<span id="cb818-11"><a href="markov-chain-monte-carlo.html#cb818-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b08.02&quot;</span>)</span></code></pre></div>
<p>Those were some silly flat priors. Check the damage.</p>
<div class="sourceCode" id="cb819"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb819-1"><a href="markov-chain-monte-carlo.html#cb819-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b8<span class="fl">.2</span>)</span>
<span id="cb819-2"><a href="markov-chain-monte-carlo.html#cb819-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb819-3"><a href="markov-chain-monte-carlo.html#cb819-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(post,</span>
<span id="cb819-4"><a href="markov-chain-monte-carlo.html#cb819-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">pars =</span> <span class="fu">vars</span>(b_Intercept<span class="sc">:</span>sigma),</span>
<span id="cb819-5"><a href="markov-chain-monte-carlo.html#cb819-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb819-6"><a href="markov-chain-monte-carlo.html#cb819-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;My version of Figure 8.5.a.&quot;</span>,</span>
<span id="cb819-7"><a href="markov-chain-monte-carlo.html#cb819-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;These trace plots do not look like the fuzzy caterpillars we usually hope for.&quot;</span>) <span class="sc">+</span></span>
<span id="cb819-8"><a href="markov-chain-monte-carlo.html#cb819-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_ipsum</span>() <span class="sc">+</span></span>
<span id="cb819-9"><a href="markov-chain-monte-carlo.html#cb819-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_ipsum</span>() <span class="sc">+</span></span>
<span id="cb819-10"><a href="markov-chain-monte-carlo.html#cb819-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb819-11"><a href="markov-chain-monte-carlo.html#cb819-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">85</span>, <span class="fl">1.5</span>))</span></code></pre></div>
<p><img src="08_files/figure-html/unnamed-chunk-31-1.png" width="624" /></p>
<p>Let’s peek at the summary.</p>
<div class="sourceCode" id="cb820"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb820-1"><a href="markov-chain-monte-carlo.html#cb820-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b8<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## Warning: Parts of the model have not converged (some Rhats are &gt; 1.05). Be careful when analysing
## the results! We recommend running more iterations and/or setting stronger priors.</code></pre>
<pre><code>## Warning: There were 276 divergent transitions after warmup. Increasing adapt_delta above 0.8 may
## help. See http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</code></pre>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: y ~ 1 
##    Data: list(y = c(-1, 1)) (Number of observations: 2) 
##   Draws: 2 chains, each with iter = 4000; warmup = 1000; thin = 1;
##          total post-warmup draws = 6000
## 
## Population-Level Effects: 
##             Estimate  Est.Error     l-95% CI   u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept -546879.04 4143195.56 -13079947.72 6389605.41 1.06       24       16
## 
## Family Specific Parameters: 
##          Estimate    Est.Error l-95% CI    u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma 14987222.47 126012619.27  1220.06 85397775.81 1.04       26       86
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Holy smokes, those parameters are a mess! Plus we got nasty warning messages, too. Watch our reasonable priors save the day.</p>
<div class="sourceCode" id="cb824"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb824-1"><a href="markov-chain-monte-carlo.html#cb824-1" aria-hidden="true" tabindex="-1"></a>b8<span class="fl">.3</span> <span class="ot">&lt;-</span></span>
<span id="cb824-2"><a href="markov-chain-monte-carlo.html#cb824-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)), </span>
<span id="cb824-3"><a href="markov-chain-monte-carlo.html#cb824-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb824-4"><a href="markov-chain-monte-carlo.html#cb824-4" aria-hidden="true" tabindex="-1"></a>      y <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb824-5"><a href="markov-chain-monte-carlo.html#cb824-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb824-6"><a href="markov-chain-monte-carlo.html#cb824-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb824-7"><a href="markov-chain-monte-carlo.html#cb824-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">init =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">Intercept =</span> <span class="dv">0</span>, <span class="at">sigma =</span> <span class="dv">1</span>),</span>
<span id="cb824-8"><a href="markov-chain-monte-carlo.html#cb824-8" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="at">Intercept =</span> <span class="dv">0</span>, <span class="at">sigma =</span> <span class="dv">1</span>)),</span>
<span id="cb824-9"><a href="markov-chain-monte-carlo.html#cb824-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb824-10"><a href="markov-chain-monte-carlo.html#cb824-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">8</span>,</span>
<span id="cb824-11"><a href="markov-chain-monte-carlo.html#cb824-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b08.03&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb825"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb825-1"><a href="markov-chain-monte-carlo.html#cb825-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b8<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: y ~ 1 
##    Data: list(y = c(-1, 1)) (Number of observations: 2) 
##   Draws: 2 chains, each with iter = 4000; warmup = 1000; thin = 1;
##          total post-warmup draws = 6000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.04      1.74    -3.28     3.63 1.00     1638     1069
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     2.05      2.13     0.62     6.84 1.00     1307     1940
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>As in the text, no more warning signs and no more silly estimates. The trace plots look great, too.</p>
<div class="sourceCode" id="cb827"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb827-1"><a href="markov-chain-monte-carlo.html#cb827-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b8<span class="fl">.3</span>)</span>
<span id="cb827-2"><a href="markov-chain-monte-carlo.html#cb827-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb827-3"><a href="markov-chain-monte-carlo.html#cb827-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(post,</span>
<span id="cb827-4"><a href="markov-chain-monte-carlo.html#cb827-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">pars =</span> <span class="fu">vars</span>(b_Intercept<span class="sc">:</span>sigma),</span>
<span id="cb827-5"><a href="markov-chain-monte-carlo.html#cb827-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb827-6"><a href="markov-chain-monte-carlo.html#cb827-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;My version of Figure 8.5.b&quot;</span>,</span>
<span id="cb827-7"><a href="markov-chain-monte-carlo.html#cb827-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Oh man. This looks so much better.&quot;</span>) <span class="sc">+</span></span>
<span id="cb827-8"><a href="markov-chain-monte-carlo.html#cb827-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_ipsum</span>() <span class="sc">+</span></span>
<span id="cb827-9"><a href="markov-chain-monte-carlo.html#cb827-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_ipsum</span>() <span class="sc">+</span></span>
<span id="cb827-10"><a href="markov-chain-monte-carlo.html#cb827-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb827-11"><a href="markov-chain-monte-carlo.html#cb827-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">85</span>, <span class="fl">1.5</span>))</span></code></pre></div>
<p><img src="08_files/figure-html/unnamed-chunk-34-1.png" width="624" /></p>
<p>Now behold our version of Figure 8.6.</p>
<div class="sourceCode" id="cb828"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb828-1"><a href="markov-chain-monte-carlo.html#cb828-1" aria-hidden="true" tabindex="-1"></a><span class="co"># left</span></span>
<span id="cb828-2"><a href="markov-chain-monte-carlo.html#cb828-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb828-3"><a href="markov-chain-monte-carlo.html#cb828-3" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span></span>
<span id="cb828-4"><a href="markov-chain-monte-carlo.html#cb828-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(b_Intercept) <span class="sc">%&gt;%</span></span>
<span id="cb828-5"><a href="markov-chain-monte-carlo.html#cb828-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb828-6"><a href="markov-chain-monte-carlo.html#cb828-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> b_Intercept)) <span class="sc">+</span></span>
<span id="cb828-7"><a href="markov-chain-monte-carlo.html#cb828-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density</span>(<span class="at">geom =</span> <span class="st">&quot;line&quot;</span>) <span class="sc">+</span></span>
<span id="cb828-8"><a href="markov-chain-monte-carlo.html#cb828-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(post<span class="sc">$</span>b_Intercept),</span>
<span id="cb828-9"><a href="markov-chain-monte-carlo.html#cb828-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">to =</span> <span class="fu">max</span>(post<span class="sc">$</span>b_Intercept),</span>
<span id="cb828-10"><a href="markov-chain-monte-carlo.html#cb828-10" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">length.out =</span> <span class="dv">50</span>)),</span>
<span id="cb828-11"><a href="markov-chain-monte-carlo.html#cb828-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">dnorm</span>(<span class="at">x =</span> x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">10</span>)),</span>
<span id="cb828-12"><a href="markov-chain-monte-carlo.html#cb828-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="fu">ipsum_pal</span>()(<span class="dv">1</span>), <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb828-13"><a href="markov-chain-monte-carlo.html#cb828-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_ipsum</span>()</span>
<span id="cb828-14"><a href="markov-chain-monte-carlo.html#cb828-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb828-15"><a href="markov-chain-monte-carlo.html#cb828-15" aria-hidden="true" tabindex="-1"></a><span class="co"># right</span></span>
<span id="cb828-16"><a href="markov-chain-monte-carlo.html#cb828-16" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb828-17"><a href="markov-chain-monte-carlo.html#cb828-17" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span></span>
<span id="cb828-18"><a href="markov-chain-monte-carlo.html#cb828-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sigma) <span class="sc">%&gt;%</span></span>
<span id="cb828-19"><a href="markov-chain-monte-carlo.html#cb828-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb828-20"><a href="markov-chain-monte-carlo.html#cb828-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sigma)) <span class="sc">+</span></span>
<span id="cb828-21"><a href="markov-chain-monte-carlo.html#cb828-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density</span>(<span class="at">geom =</span> <span class="st">&quot;line&quot;</span>) <span class="sc">+</span></span>
<span id="cb828-22"><a href="markov-chain-monte-carlo.html#cb828-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>,</span>
<span id="cb828-23"><a href="markov-chain-monte-carlo.html#cb828-23" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">to =</span> <span class="fu">max</span>(post<span class="sc">$</span>sigma),</span>
<span id="cb828-24"><a href="markov-chain-monte-carlo.html#cb828-24" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">length.out =</span> <span class="dv">50</span>)),</span>
<span id="cb828-25"><a href="markov-chain-monte-carlo.html#cb828-25" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">dcauchy</span>(<span class="at">x =</span> x, <span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="dv">1</span>)<span class="sc">*</span><span class="dv">2</span>),</span>
<span id="cb828-26"><a href="markov-chain-monte-carlo.html#cb828-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="fu">ipsum_pal</span>()(<span class="dv">2</span>)[<span class="dv">2</span>], <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb828-27"><a href="markov-chain-monte-carlo.html#cb828-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb828-28"><a href="markov-chain-monte-carlo.html#cb828-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb828-29"><a href="markov-chain-monte-carlo.html#cb828-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_ipsum</span>()</span>
<span id="cb828-30"><a href="markov-chain-monte-carlo.html#cb828-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb828-31"><a href="markov-chain-monte-carlo.html#cb828-31" aria-hidden="true" tabindex="-1"></a><span class="co"># combine the two</span></span>
<span id="cb828-32"><a href="markov-chain-monte-carlo.html#cb828-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb828-33"><a href="markov-chain-monte-carlo.html#cb828-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb828-34"><a href="markov-chain-monte-carlo.html#cb828-34" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Prior (dashed) and posterior (solid) distributions for the</span><span class="sc">\n</span><span class="st">model with weakly-informative priors, b8.3&quot;</span>,</span>
<span id="cb828-35"><a href="markov-chain-monte-carlo.html#cb828-35" aria-hidden="true" tabindex="-1"></a>                          <span class="at">theme =</span> <span class="fu">theme_ipsum</span>())</span></code></pre></div>
<p><img src="08_files/figure-html/unnamed-chunk-35-1.png" width="696" /></p>
<div id="overthinking-cauchy-distribution." class="section level4 hasAnchor" number="8.4.3.1">
<h4><span class="header-section-number">8.4.3.1</span> Overthinking: Cauchy distribution.<a href="markov-chain-monte-carlo.html#overthinking-cauchy-distribution." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Behold the beautiful Cauchy probability density:</p>
<p><span class="math display">\[p(x|x_0, \gamma) = \left ( \pi \gamma \left [ 1 + \left ( \frac{x - x_0}{\gamma} \right ) ^2 \right ] \right ) ^{-1}.\]</span></p>
<p>The Cauchy has no mean and variance, but <span class="math inline">\(x_0\)</span> is the location and <span class="math inline">\(\gamma\)</span> is the scale. Here’s our version of the simulation. Note our use of the <code>cummean()</code> function.</p>
<div class="sourceCode" id="cb829"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb829-1"><a href="markov-chain-monte-carlo.html#cb829-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb829-2"><a href="markov-chain-monte-carlo.html#cb829-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb829-3"><a href="markov-chain-monte-carlo.html#cb829-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">8</span>)</span>
<span id="cb829-4"><a href="markov-chain-monte-carlo.html#cb829-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">y     =</span> <span class="fu">rcauchy</span>(n, <span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="dv">5</span>),</span>
<span id="cb829-5"><a href="markov-chain-monte-carlo.html#cb829-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">mu    =</span> <span class="fu">cummean</span>(y),</span>
<span id="cb829-6"><a href="markov-chain-monte-carlo.html#cb829-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">index =</span> <span class="dv">1</span><span class="sc">:</span>n) <span class="sc">%&gt;%</span> </span>
<span id="cb829-7"><a href="markov-chain-monte-carlo.html#cb829-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb829-8"><a href="markov-chain-monte-carlo.html#cb829-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> mu)) <span class="sc">+</span></span>
<span id="cb829-9"><a href="markov-chain-monte-carlo.html#cb829-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb829-10"><a href="markov-chain-monte-carlo.html#cb829-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_ipsum</span>()</span></code></pre></div>
<p><img src="08_files/figure-html/unnamed-chunk-36-1.png" width="384" /></p>
<p>The whole thing is quite remarkable. Just for kicks, here we do it again with nine simulations.</p>
<div class="sourceCode" id="cb830"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb830-1"><a href="markov-chain-monte-carlo.html#cb830-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb830-2"><a href="markov-chain-monte-carlo.html#cb830-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb830-3"><a href="markov-chain-monte-carlo.html#cb830-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">8</span>)</span>
<span id="cb830-4"><a href="markov-chain-monte-carlo.html#cb830-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">a =</span> <span class="fu">rcauchy</span>(n, <span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="dv">5</span>),</span>
<span id="cb830-5"><a href="markov-chain-monte-carlo.html#cb830-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">b =</span> <span class="fu">rcauchy</span>(n, <span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="dv">5</span>),</span>
<span id="cb830-6"><a href="markov-chain-monte-carlo.html#cb830-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">c =</span> <span class="fu">rcauchy</span>(n, <span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="dv">5</span>),</span>
<span id="cb830-7"><a href="markov-chain-monte-carlo.html#cb830-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">d =</span> <span class="fu">rcauchy</span>(n, <span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="dv">5</span>),</span>
<span id="cb830-8"><a href="markov-chain-monte-carlo.html#cb830-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">e =</span> <span class="fu">rcauchy</span>(n, <span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="dv">5</span>),</span>
<span id="cb830-9"><a href="markov-chain-monte-carlo.html#cb830-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">f =</span> <span class="fu">rcauchy</span>(n, <span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="dv">5</span>),</span>
<span id="cb830-10"><a href="markov-chain-monte-carlo.html#cb830-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">g =</span> <span class="fu">rcauchy</span>(n, <span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="dv">5</span>),</span>
<span id="cb830-11"><a href="markov-chain-monte-carlo.html#cb830-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">h =</span> <span class="fu">rcauchy</span>(n, <span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="dv">5</span>),</span>
<span id="cb830-12"><a href="markov-chain-monte-carlo.html#cb830-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">i =</span> <span class="fu">rcauchy</span>(n, <span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="dv">5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb830-13"><a href="markov-chain-monte-carlo.html#cb830-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb830-14"><a href="markov-chain-monte-carlo.html#cb830-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(key) <span class="sc">%&gt;%</span> </span>
<span id="cb830-15"><a href="markov-chain-monte-carlo.html#cb830-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mu =</span> <span class="fu">cummean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb830-16"><a href="markov-chain-monte-carlo.html#cb830-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb830-17"><a href="markov-chain-monte-carlo.html#cb830-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="at">times =</span> <span class="dv">9</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb830-18"><a href="markov-chain-monte-carlo.html#cb830-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb830-19"><a href="markov-chain-monte-carlo.html#cb830-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> mu)) <span class="sc">+</span></span>
<span id="cb830-20"><a href="markov-chain-monte-carlo.html#cb830-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> key)) <span class="sc">+</span></span>
<span id="cb830-21"><a href="markov-chain-monte-carlo.html#cb830-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">ipsum_pal</span>()(<span class="dv">9</span>)) <span class="sc">+</span></span>
<span id="cb830-22"><a href="markov-chain-monte-carlo.html#cb830-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5000</span>, <span class="dv">10000</span>)) <span class="sc">+</span></span>
<span id="cb830-23"><a href="markov-chain-monte-carlo.html#cb830-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_ipsum</span>() <span class="sc">+</span></span>
<span id="cb830-24"><a href="markov-chain-monte-carlo.html#cb830-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb830-25"><a href="markov-chain-monte-carlo.html#cb830-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>key, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p><img src="08_files/figure-html/unnamed-chunk-37-1.png" width="768" /></p>
</div>
</div>
<div id="non-identifiable-parameters." class="section level3 hasAnchor" number="8.4.4">
<h3><span class="header-section-number">8.4.4</span> Non-identifiable parameters.<a href="markov-chain-monte-carlo.html#non-identifiable-parameters." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It appears that the <a href="https://github.com/ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse/issues/3">only way</a> to get a brms version of McElreath’s <code>m8.4</code> and <code>m8.5</code> is to augment the data. In addition to the Gaussian <code>y</code> vector, we’ll add two constants to the data, <code>intercept_1 = 1</code> and <code>intercept_2 = 1</code>.</p>
<div class="sourceCode" id="cb831"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb831-1"><a href="markov-chain-monte-carlo.html#cb831-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">8</span>)</span>
<span id="cb831-2"><a href="markov-chain-monte-carlo.html#cb831-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="sourceCode" id="cb832"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb832-1"><a href="markov-chain-monte-carlo.html#cb832-1" aria-hidden="true" tabindex="-1"></a>b8<span class="fl">.4</span> <span class="ot">&lt;-</span></span>
<span id="cb832-2"><a href="markov-chain-monte-carlo.html#cb832-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> <span class="fu">list</span>(<span class="at">y           =</span> y,</span>
<span id="cb832-3"><a href="markov-chain-monte-carlo.html#cb832-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">intercept_1 =</span> <span class="dv">1</span>,</span>
<span id="cb832-4"><a href="markov-chain-monte-carlo.html#cb832-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">intercept_2 =</span> <span class="dv">1</span>), </span>
<span id="cb832-5"><a href="markov-chain-monte-carlo.html#cb832-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb832-6"><a href="markov-chain-monte-carlo.html#cb832-6" aria-hidden="true" tabindex="-1"></a>      y <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> intercept_1 <span class="sc">+</span> intercept_2,</span>
<span id="cb832-7"><a href="markov-chain-monte-carlo.html#cb832-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="sc">-</span><span class="fl">1e10</span>, <span class="fl">1e10</span>), <span class="at">class =</span> b),</span>
<span id="cb832-8"><a href="markov-chain-monte-carlo.html#cb832-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb832-9"><a href="markov-chain-monte-carlo.html#cb832-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">init =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">intercept_1 =</span> <span class="dv">0</span>, <span class="at">intercept_2 =</span> <span class="dv">0</span>, <span class="at">sigma =</span> <span class="dv">1</span>),</span>
<span id="cb832-10"><a href="markov-chain-monte-carlo.html#cb832-10" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="at">intercept_1 =</span> <span class="dv">0</span>, <span class="at">intercept_2 =</span> <span class="dv">0</span>, <span class="at">sigma =</span> <span class="dv">1</span>)),</span>
<span id="cb832-11"><a href="markov-chain-monte-carlo.html#cb832-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb832-12"><a href="markov-chain-monte-carlo.html#cb832-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">8</span>,</span>
<span id="cb832-13"><a href="markov-chain-monte-carlo.html#cb832-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b08.04&quot;</span>)</span></code></pre></div>
<p>Our model results don’t perfectly mirror McElreath’s, but they’re identical in spirit.</p>
<div class="sourceCode" id="cb833"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb833-1"><a href="markov-chain-monte-carlo.html#cb833-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b8<span class="fl">.4</span>)</span></code></pre></div>
<pre><code>## Warning: Parts of the model have not converged (some Rhats are &gt; 1.05). Be careful when analysing
## the results! We recommend running more iterations and/or setting stronger priors.</code></pre>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: y ~ 0 + intercept_1 + intercept_2 
##    Data: list(y = y, intercept_1 = 1, intercept_2 = 1) (Number of observations: 100) 
##   Draws: 2 chains, each with iter = 4000; warmup = 1000; thin = 1;
##          total post-warmup draws = 6000
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## intercept_1  -118.40   1513.42 -2685.34  2723.23 2.54        2       21
## intercept_2   118.30   1513.43 -2723.26  2685.36 2.54        2       21
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     1.10      0.08     0.96     1.26 1.05       24       67
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Note the frightening warning message. Those results are a mess! Let’s try again.</p>
<div class="sourceCode" id="cb836"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb836-1"><a href="markov-chain-monte-carlo.html#cb836-1" aria-hidden="true" tabindex="-1"></a>b8<span class="fl">.5</span> <span class="ot">&lt;-</span></span>
<span id="cb836-2"><a href="markov-chain-monte-carlo.html#cb836-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> <span class="fu">list</span>(<span class="at">y           =</span> y,</span>
<span id="cb836-3"><a href="markov-chain-monte-carlo.html#cb836-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">intercept_1 =</span> <span class="dv">1</span>,</span>
<span id="cb836-4"><a href="markov-chain-monte-carlo.html#cb836-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">intercept_2 =</span> <span class="dv">1</span>),</span>
<span id="cb836-5"><a href="markov-chain-monte-carlo.html#cb836-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb836-6"><a href="markov-chain-monte-carlo.html#cb836-6" aria-hidden="true" tabindex="-1"></a>      y <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> intercept_1 <span class="sc">+</span> intercept_2,</span>
<span id="cb836-7"><a href="markov-chain-monte-carlo.html#cb836-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb836-8"><a href="markov-chain-monte-carlo.html#cb836-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb836-9"><a href="markov-chain-monte-carlo.html#cb836-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">init =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">intercept_1 =</span> <span class="dv">0</span>, <span class="at">intercept_2 =</span> <span class="dv">0</span>, <span class="at">sigma =</span> <span class="dv">1</span>),</span>
<span id="cb836-10"><a href="markov-chain-monte-carlo.html#cb836-10" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="at">intercept_1 =</span> <span class="dv">0</span>, <span class="at">intercept_2 =</span> <span class="dv">0</span>, <span class="at">sigma =</span> <span class="dv">1</span>)),</span>
<span id="cb836-11"><a href="markov-chain-monte-carlo.html#cb836-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb836-12"><a href="markov-chain-monte-carlo.html#cb836-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">8</span>,</span>
<span id="cb836-13"><a href="markov-chain-monte-carlo.html#cb836-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b08.05&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb837"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb837-1"><a href="markov-chain-monte-carlo.html#cb837-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b8<span class="fl">.5</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: y ~ 0 + intercept_1 + intercept_2 
##    Data: list(y = y, intercept_1 = 1, intercept_2 = 1) (Number of observations: 100) 
##   Draws: 2 chains, each with iter = 4000; warmup = 1000; thin = 1;
##          total post-warmup draws = 6000
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## intercept_1    -0.27      6.88   -13.79    13.69 1.00     1513     1714
## intercept_2     0.18      6.88   -13.80    13.70 1.00     1514     1728
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     1.09      0.08     0.95     1.25 1.00     2300     1996
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Much better. For our version of Figure 8.7, we’ll make the trace plots for the two models separately and combine them with patchwork.</p>
<div class="sourceCode" id="cb839"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb839-1"><a href="markov-chain-monte-carlo.html#cb839-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b8<span class="fl">.4</span>)</span>
<span id="cb839-2"><a href="markov-chain-monte-carlo.html#cb839-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb839-3"><a href="markov-chain-monte-carlo.html#cb839-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb839-4"><a href="markov-chain-monte-carlo.html#cb839-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_trace</span>(post,</span>
<span id="cb839-5"><a href="markov-chain-monte-carlo.html#cb839-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">pars =</span> <span class="fu">vars</span>(b_intercept_1<span class="sc">:</span>sigma),</span>
<span id="cb839-6"><a href="markov-chain-monte-carlo.html#cb839-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb839-7"><a href="markov-chain-monte-carlo.html#cb839-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">facet_args =</span> <span class="fu">c</span>(<span class="at">ncol =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb839-8"><a href="markov-chain-monte-carlo.html#cb839-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_ipsum</span>() <span class="sc">+</span></span>
<span id="cb839-9"><a href="markov-chain-monte-carlo.html#cb839-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;flat priors&quot;</span>) <span class="sc">+</span></span>
<span id="cb839-10"><a href="markov-chain-monte-carlo.html#cb839-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_ipsum</span>() <span class="sc">+</span></span>
<span id="cb839-11"><a href="markov-chain-monte-carlo.html#cb839-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb839-12"><a href="markov-chain-monte-carlo.html#cb839-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))</span>
<span id="cb839-13"><a href="markov-chain-monte-carlo.html#cb839-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb839-14"><a href="markov-chain-monte-carlo.html#cb839-14" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b8<span class="fl">.5</span>)</span>
<span id="cb839-15"><a href="markov-chain-monte-carlo.html#cb839-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb839-16"><a href="markov-chain-monte-carlo.html#cb839-16" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb839-17"><a href="markov-chain-monte-carlo.html#cb839-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_trace</span>(post,</span>
<span id="cb839-18"><a href="markov-chain-monte-carlo.html#cb839-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">pars =</span> <span class="fu">vars</span>(b_intercept_1<span class="sc">:</span>sigma),</span>
<span id="cb839-19"><a href="markov-chain-monte-carlo.html#cb839-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb839-20"><a href="markov-chain-monte-carlo.html#cb839-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">facet_args =</span> <span class="fu">c</span>(<span class="at">ncol =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb839-21"><a href="markov-chain-monte-carlo.html#cb839-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_ipsum</span>() <span class="sc">+</span></span>
<span id="cb839-22"><a href="markov-chain-monte-carlo.html#cb839-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;weakly-informative priors&quot;</span>) <span class="sc">+</span></span>
<span id="cb839-23"><a href="markov-chain-monte-carlo.html#cb839-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_ipsum</span>() <span class="sc">+</span></span>
<span id="cb839-24"><a href="markov-chain-monte-carlo.html#cb839-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb839-25"><a href="markov-chain-monte-carlo.html#cb839-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))</span>
<span id="cb839-26"><a href="markov-chain-monte-carlo.html#cb839-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb839-27"><a href="markov-chain-monte-carlo.html#cb839-27" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Prior strength matters&quot;</span>,</span>
<span id="cb839-28"><a href="markov-chain-monte-carlo.html#cb839-28" aria-hidden="true" tabindex="-1"></a>                          <span class="at">theme =</span> <span class="fu">theme_ipsum</span>())</span></code></pre></div>
<p><img src="08_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<p>The central message in the text, default to weakly-regularizing priors, holds for brms just as it does in rethinking. For more on the topic, see the <a href="https://github.com/stan-dev/stan/wiki/Prior-Choice-Recommendations">recommendations from the Stan team</a>. If you want to dive deeper, check out <a href="https://statmodeling.stat.columbia.edu/2017/09/05/never-total-eclipse-prior/">Simpson’s post on Gelman’s blog</a> and their corresponding <span class="citation">(<a href="#ref-gelmanPriorCanOften2017" role="doc-biblioref">2017</a>)</span> paper with Betancourt, <a href="https://doi.org/10.3390/e19100555"><em>The prior can often only be understood in the context of the likelihood</em></a></p>
</div>
</div>
<div id="session-info-7" class="section level2 unnumbered hasAnchor">
<h2>Session info<a href="markov-chain-monte-carlo.html#session-info-7" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb840"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb840-1"><a href="markov-chain-monte-carlo.html#cb840-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.2.2 (2022-10-31)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur ... 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] parallel  stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] patchwork_1.1.2      ggmcmc_1.5.1.1       bayesplot_1.10.0     GGally_2.1.2        
##  [5] tidybayes_3.0.2      brms_2.18.0          Rcpp_1.0.9           cmdstanr_0.5.3      
##  [9] rstan_2.21.8         StanHeaders_2.21.0-7 extrafont_0.18       hrbrthemes_0.8.0    
## [13] forcats_0.5.1        stringr_1.4.1        dplyr_1.0.10         purrr_1.0.1         
## [17] readr_2.1.2          tidyr_1.2.1          tibble_3.1.8         ggplot2_3.4.0       
## [21] tidyverse_1.3.2     
## 
## loaded via a namespace (and not attached):
##   [1] readxl_1.4.1         backports_1.4.1      systemfonts_1.0.4    plyr_1.8.7          
##   [5] igraph_1.3.4         svUnit_1.0.6         sp_1.5-0             splines_4.2.2       
##   [9] crosstalk_1.2.0      TH.data_1.1-1        rstantools_2.2.0     inline_0.3.19       
##  [13] digest_0.6.31        htmltools_0.5.3      rethinking_2.21      fansi_1.0.3         
##  [17] magrittr_2.0.3       checkmate_2.1.0      googlesheets4_1.0.1  tzdb_0.3.0          
##  [21] modelr_0.1.8         RcppParallel_5.1.5   matrixStats_0.63.0   xts_0.12.1          
##  [25] sandwich_3.0-2       extrafontdb_1.0      prettyunits_1.1.1    colorspace_2.0-3    
##  [29] rvest_1.0.2          ggdist_3.2.1         rgdal_1.5-30         haven_2.5.1         
##  [33] xfun_0.35            callr_3.7.3          crayon_1.5.2         jsonlite_1.8.4      
##  [37] lme4_1.1-31          survival_3.4-0       zoo_1.8-10           glue_1.6.2          
##  [41] gtable_0.3.1         gargle_1.2.0         emmeans_1.8.0        distributional_0.3.1
##  [45] pkgbuild_1.3.1       Rttf2pt1_1.3.10      shape_1.4.6          abind_1.4-5         
##  [49] scales_1.2.1         mvtnorm_1.1-3        DBI_1.1.3            miniUI_0.1.1.1      
##  [53] xtable_1.8-4         HDInterval_0.2.4     stats4_4.2.2         DT_0.24             
##  [57] htmlwidgets_1.5.4    httr_1.4.4           threejs_0.3.3        RColorBrewer_1.1-3  
##  [61] arrayhelpers_1.1-0   posterior_1.3.1      ellipsis_0.3.2       reshape_0.8.9       
##  [65] pkgconfig_2.0.3      loo_2.5.1            farver_2.1.1         sass_0.4.2          
##  [69] dbplyr_2.2.1         utf8_1.2.2           tidyselect_1.2.0     labeling_0.4.2      
##  [73] rlang_1.0.6          reshape2_1.4.4       later_1.3.0          munsell_0.5.0       
##  [77] cellranger_1.1.0     tools_4.2.2          cachem_1.0.6         cli_3.6.0           
##  [81] generics_0.1.3       broom_1.0.2          evaluate_0.18        fastmap_1.1.0       
##  [85] processx_3.8.0       knitr_1.40           fs_1.5.2             nlme_3.1-160        
##  [89] projpred_2.2.1       mime_0.12            xml2_1.3.3           compiler_4.2.2      
##  [93] shinythemes_1.2.0    rstudioapi_0.13      gamm4_0.2-6          reprex_2.0.2        
##  [97] bslib_0.4.0          stringi_1.7.8        highr_0.9            ps_1.7.2            
## [101] Brobdingnag_1.2-8    gdtools_0.2.4        lattice_0.20-45      Matrix_1.5-1        
## [105] nloptr_2.0.3         markdown_1.1         shinyjs_2.1.0        tensorA_0.36.2      
## [109] vctrs_0.5.1          pillar_1.8.1         lifecycle_1.0.3      jquerylib_0.1.4     
## [113] bridgesampling_1.1-2 estimability_1.4.1   httpuv_1.6.5         R6_2.5.1            
## [117] bookdown_0.28        promises_1.2.0.1     gridExtra_2.3        codetools_0.2-18    
## [121] boot_1.3-28          colourpicker_1.1.1   MASS_7.3-58.1        gtools_3.9.4        
## [125] assertthat_0.2.1     withr_2.5.0          shinystan_2.6.0      multcomp_1.4-20     
## [129] mgcv_1.8-41          hms_1.1.1            grid_4.2.2           minqa_1.2.5         
## [133] coda_0.19-4          rmarkdown_2.16       googledrive_2.0.0    shiny_1.7.2         
## [137] lubridate_1.8.0      base64enc_0.1-3      dygraphs_1.1.1.6</code></pre>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-rstanarm2018" class="csl-entry">
Brilleman, S., Crowther, M., Moreno-Betancur, M., Buros Novik, J., &amp; Wolfe, R. (2018). <em>Joint longitudinal and time-to-event models via <span>Stan</span>.</em> <a href="https://github.com/stan-dev/stancon_talks/">https://github.com/stan-dev/stancon_talks/</a>
</div>
<div id="ref-casellaExplainingGibbsSampler1992" class="csl-entry">
Casella, G., &amp; George, E. I. (1992). Explaining the <span>Gibbs</span> sampler. <em>The American Statistician</em>, <em>46</em>(3), 167–174. <a href="https://doi.org/10.1080/00031305.1992.10475878">https://doi.org/10.1080/00031305.1992.10475878</a>
</div>
<div id="ref-fernandezGGMCMCAnalysisofMCMC2016" class="csl-entry">
Fernández i Marín, X. (2016). <span class="nocase">ggmcmc</span>: <span>Analysis</span> of <span>MCMC</span> samples and <span>Bayesian</span> inference. <em>Journal of Statistical Software</em>, <em>70</em>(9), 1–20. <a href="https://doi.org/10.18637/jss.v070.i09">https://doi.org/10.18637/jss.v070.i09</a>
</div>
<div id="ref-R-ggmcmc" class="csl-entry">
Fernández i Marín, X. (2021). <em><span class="nocase">ggmcmc</span>: <span>Tools</span> for analyzing <span>MCMC</span> simulations from <span>Bayesian</span> inference</em> [Manual]. <a href="https://CRAN.R-project.org/package=ggmcmc">https://CRAN.R-project.org/package=ggmcmc</a>
</div>
<div id="ref-R-rstanarm" class="csl-entry">
Gabry, J., &amp; Goodrich, B. (2022). <em><span class="nocase">rstanarm</span>: <span>Bayesian</span> applied regression modeling via stan</em> [Manual]. <a href="https://CRAN.R-project.org/package=rstanarm">https://CRAN.R-project.org/package=rstanarm</a>
</div>
<div id="ref-gabryVisualMCMCDiagnostics2022" class="csl-entry">
Gabry, J., &amp; Modrák, M. (2022). <em>Visual <span>MCMC</span> diagnostics using the <span class="nocase">bayesplot</span> package</em>. <a href="https://CRAN.R-project.org/package=bayesplot/vignettes/plotting-mcmc-draws.html">https://CRAN.R-project.org/package=bayesplot/vignettes/plotting-mcmc-draws.html</a>
</div>
<div id="ref-gelmanPriorCanOften2017" class="csl-entry">
Gelman, A., Simpson, D., &amp; Betancourt, M. (2017). The prior can often only be understood in the context of the likelihood. <em>Entropy</em>, <em>19</em>(10, 10), 555. <a href="https://doi.org/10.3390/e19100555">https://doi.org/10.3390/e19100555</a>
</div>
<div id="ref-gemanStochasticRelaxationGibbs1984" class="csl-entry">
Geman, S., &amp; Geman, D. (1984). Stochastic relaxation, <span>Gibbs</span> distributions, and the <span>Bayesian</span> restoration of images. <em>IEEE Transactions on Pattern Analysis and Machine Intelligence</em>, <em>PAMI-6</em>(6), 721–741. <a href="https://doi.org/10.1109/TPAMI.1984.4767596">https://doi.org/10.1109/TPAMI.1984.4767596</a>
</div>
<div id="ref-kruschkeDoingBayesianData2015" class="csl-entry">
Kruschke, J. K. (2015). <em>Doing <span>Bayesian</span> data analysis: <span>A</span> tutorial with <span>R</span>, <span>JAGS</span>, and <span>Stan</span></em>. <span>Academic Press</span>. <a href="https://sites.google.com/site/doingbayesiandataanalysis/">https://sites.google.com/site/doingbayesiandataanalysis/</a>
</div>
<div id="ref-mcelreathStatisticalRethinkingBayesian2015" class="csl-entry">
McElreath, R. (2015). <em>Statistical rethinking: <span>A Bayesian</span> course with examples in <span>R</span> and <span>Stan</span></em>. <span>CRC press</span>. <a href="https://xcelab.net/rm/statistical-rethinking/">https://xcelab.net/rm/statistical-rethinking/</a>
</div>
<div id="ref-blavaan2021" class="csl-entry">
Merkle, E. C., Fitzsimmons, E., Uanhoro, J., &amp; Goodrich, B. (2021). Efficient <span>Bayesian</span> structural equation modeling in <span>Stan</span>. <em>Journal of Statistical Software</em>, <em>100</em>(6), 1–22. <a href="https://doi.org/10.18637/jss.v100.i06">https://doi.org/10.18637/jss.v100.i06</a>
</div>
<div id="ref-Merkle2018blavaan" class="csl-entry">
Merkle, E. C., &amp; Rosseel, Y. (2018). <span class="nocase">blavaan</span>: <span>Bayesian</span> structural equation models via parameter expansion. <em>Journal of Statistical Software</em>, <em>85</em>(4), 1–30. <a href="https://doi.org/10.18637/jss.v085.i04">https://doi.org/10.18637/jss.v085.i04</a>
</div>
<div id="ref-R-blavaan" class="csl-entry">
Merkle, E. C., Rosseel, Y., &amp; Goodrich, B. (2022). <em><span class="nocase">blavaan</span>: <span>Bayesian</span> latent variable analysis</em>. <a href="https://CRAN.R-project.org/package=blavaan">https://CRAN.R-project.org/package=blavaan</a>
</div>
<div id="ref-robertShortHistoryMarkov2011" class="csl-entry">
Robert, C., &amp; Casella, G. (2011). A short history of <span>Markov</span> chain <span>Monte Carlo</span>: <span>Subjective</span> recollections from incomplete data. <em>Statistical Science</em>, <em>26</em>(1), 102–115. <a href="https://arxiv.org/pdf/0808.2902.pdf">https://arxiv.org/pdf/0808.2902.pdf</a>
</div>
<div id="ref-R-hrbrthemes" class="csl-entry">
Rudis, B. (2020). <em><span class="nocase">hrbrthemes</span>: <span>Additional</span> themes, theme components and utilities for ’Ggplot2’</em> [Manual]. <a href="https://CRAN.R-project.org/package=hrbrthemes">https://CRAN.R-project.org/package=hrbrthemes</a>
</div>
<div id="ref-vehtariPracticalBayesianModel2017" class="csl-entry">
Vehtari, A., Gelman, A., &amp; Gabry, J. (2017). Practical <span>Bayesian</span> model evaluation using leave-one-out cross-validation and <span>WAIC</span>. <em>Statistics and Computing</em>, <em>27</em>(5), 1413–1432. <a href="https://doi.org/10.1007/s11222-016-9696-4">https://doi.org/10.1007/s11222-016-9696-4</a>
</div>
<div id="ref-vehtariRanknormalizationFoldingLocalization2021" class="csl-entry">
Vehtari, A., Gelman, A., Simpson, D., Carpenter, B., &amp; Bürkner, P.-C. (2021). Rank-normalization, folding, and localization: <span>An</span> improved <span><span class="math inline">\(\widehat{R}\)</span></span> for assessing convergence of <span>MCMC</span> (with <span>Discussion</span>). <em>Bayesian Analysis</em>, <em>16</em>(2), 667–718. <a href="https://doi.org/10.1214/20-BA1221">https://doi.org/10.1214/20-BA1221</a>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="interactions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="big-entropy-and-the-generalized-linear-model.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
